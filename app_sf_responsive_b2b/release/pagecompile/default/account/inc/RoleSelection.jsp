<%@  page buffer="none" import="java.util.*,java.io.*,com.intershop.beehive.core.internal.template.*,com.intershop.beehive.core.internal.template.isml.*,com.intershop.beehive.core.capi.log.*,com.intershop.beehive.core.capi.resource.*,com.intershop.beehive.core.capi.util.UUIDMgr,com.intershop.beehive.core.capi.util.XMLHelper,com.intershop.beehive.foundation.util.*,com.intershop.beehive.core.internal.url.*,com.intershop.beehive.core.internal.resource.*,com.intershop.beehive.core.internal.wsrp.*,com.intershop.beehive.core.capi.pipeline.PipelineDictionary,com.intershop.beehive.core.capi.naming.NamingMgr,com.intershop.beehive.core.capi.pagecache.PageCacheMgr,com.intershop.beehive.core.capi.request.SessionMgr,com.intershop.beehive.core.internal.request.SessionMgrImpl,com.intershop.beehive.core.pipelet.PipelineConstants" extends="com.intershop.beehive.core.internal.template.AbstractTemplate" %><% 
boolean _boolean_result=false;
TemplateExecutionConfig context = getTemplateExecutionConfig();
createTemplatePageConfig(context.getServletRequest());
printHeader(out);
 %>
<% %><%@ page contentType="text/html;charset=utf-8" %><%setEncodingType("text/html"); %><% {Object temp_obj = (getObject("SelectedUser:Extension(\"UserBORoleExtension\")")); getPipelineDictionary().put("SelectedUserRoleExtension", temp_obj);} %><% {Object temp_obj = ((((context.getFormattedValue(getObject("SelectedUserRoleExtension:hasRole(\"APP_B2B_OCI_USER\")"),null).equals(context.getFormattedValue("true",null)))) ? Boolean.TRUE : Boolean.FALSE)); getPipelineDictionary().put("EditingOCIUser", temp_obj);} %><% {Object temp_obj = ((((context.getFormattedValue(getObject("CurrentUser:Profile:UUID"),null).equals(context.getFormattedValue(getObject("SelectedUser:ID"),null)))) ? Boolean.TRUE : Boolean.FALSE)); getPipelineDictionary().put("EditingCurrentUser", temp_obj);} %><fieldset>
<div class="form-group">
<span class="control-label col-sm-4"><% {out.write(localizeISText("account.user.new.role.label","",null,null,null,null,null,null,null,null,null,null,null));} %></span>
<div class="col-sm-8" id="user-roles-container">
<div class="row"><% while (loop("ImplicitlyAssignedRoles","Role",null)) { %><div class="col-md-6">
<div class="checkbox">
<label for="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {18}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>">
<input type="checkbox" 
disabled="disabled" 
<% _boolean_result=false;try {_boolean_result=((Boolean)((((Boolean) getObject("EditingOCIUser")).booleanValue() ? Boolean.FALSE : Boolean.TRUE) )).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",22,e);}if (_boolean_result) { %>
checked="checked" 
<% } %>
/><% {String value = null;try{value=context.getFormattedValue(getObject("Role:Name"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {26}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %></label>
</div>
</div><% } %><% while (loop("AssignableRoles","Role",null)) { %><div class="col-md-6">
<div class="checkbox">
<label for="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {35}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>">
<input type="checkbox"
id="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {37}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"
name="SelectedUserRolesUUID"
value="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {39}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"
<% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("SelectedUserRoleExtension:hasRole(Role:ID)"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",43,e);}if (_boolean_result) { %> checked="checked"
<% _boolean_result=false;try {_boolean_result=((Boolean)(((((Boolean) (((((Boolean) ((((context.getFormattedValue(getObject("Role:ID"),null).equals(context.getFormattedValue("APP_B2B_ACCOUNT_OWNER",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue() && ((Boolean) ((((context.getFormattedValue(getObject("CurrentUser:Profile:UUID"),null).equals(context.getFormattedValue(getObject("SelectedUser:ID"),null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue() || ((Boolean) getObject("EditingOCIUser")).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",44,e);}if (_boolean_result) { %> disabled="disabled"
<% } %><% } else {_boolean_result=false;try {_boolean_result=((Boolean)(((((Boolean) getObject("EditingOCIUser")).booleanValue() || ((Boolean) ((((context.getFormattedValue(getObject("Role:ID"),null).equals(context.getFormattedValue("APP_B2B_OCI_USER",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",47,e);}if (_boolean_result) { %> disabled="disabled" 
<% }} %>
/><% {String value = null;try{value=context.getFormattedValue(getObject("Role:Name"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {50}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %></label><% _boolean_result=false;try {_boolean_result=((Boolean)(((((Boolean) ((((context.getFormattedValue(getObject("Role:ID"),null).equals(context.getFormattedValue("APP_B2B_ACCOUNT_OWNER",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue() && ((Boolean) getObject("SelectedUserRoleExtension:hasRole(Role:ID)")).booleanValue() && ((Boolean) ((((context.getFormattedValue(getObject("CurrentUser:Profile:UUID"),null).equals(context.getFormattedValue(getObject("SelectedUser:ID"),null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",52,e);}if (_boolean_result) { %><input type="hidden" name="SelectedUserRolesUUID" value="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {54}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" /><% } %></div>
</div><% } %><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("EditingOCIUser"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",60,e);}if (_boolean_result) { %><input type="hidden" name="SelectedUserRolesUUID" value="APP_B2B_OCI_USER"><% } %></div>
</div>
</div>
<div class="form-group">
<span class="control-label col-sm-4"><% {out.write(localizeISText("account.user.new.permissions.label","",null,null,null,null,null,null,null,null,null,null,null));} %></span>
<div class="col-sm-8" id="selected-permissions"></div>
<div class="col-sm-8 hidden"><% _boolean_result=false;try {_boolean_result=((Boolean)((hasLoopElements("ImplicitlyAssignedRoles") ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",71,e);}if (_boolean_result) { %><ul><% while (loop("ImplicitlyAssignedRoles","Role",null)) { %><li id="<% {String value = null;try{value=context.getFormattedValue(context.getFormattedValue(getObject("Role:ID"),null) + context.getFormattedValue("_permissions",null),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {74}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" class="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {74}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %> text-left"><% _boolean_result=false;try {_boolean_result=((Boolean)((hasLoopElements("Role:RolePermissionAssignments") ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",75,e);}if (_boolean_result) { %><ul><% while (loop("Role:RolePermissionAssignments","Assignment",null)) { %><% _boolean_result=false;try {_boolean_result=((Boolean)(((((Boolean) (disableErrorMessages().isDefined(getObject("Assignment:Permission:Name")))).booleanValue() && ((Boolean) (((!(context.getFormattedValue(getObject("Assignment:Permission:Name"),null).equals(context.getFormattedValue("",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",78,e);}if (_boolean_result) { %><li><% {String value = null;try{value=context.getFormattedValue(getObject("Assignment:Permission:Name"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {79}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %></li><% } %><% } %></ul><% } %></li><% } %></ul><% } %><% _boolean_result=false;try {_boolean_result=((Boolean)((hasLoopElements("AssignableRoles") ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",88,e);}if (_boolean_result) { %><ul><% while (loop("AssignableRoles","Role",null)) { %><li
<% _boolean_result=false;try {_boolean_result=((Boolean)((((Boolean) (getObject("SelectedUserRoleExtension:hasRole(Role:ID)"))).booleanValue() ? Boolean.FALSE : Boolean.TRUE) )).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",92,e);}if (_boolean_result) { %> style="display:none"<% } %> 
id="<% {String value = null;try{value=context.getFormattedValue(context.getFormattedValue(getObject("Role:ID"),null) + context.getFormattedValue("_permissions",null),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {93}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" class="<% {String value = null;try{value=context.getFormattedValue(getObject("Role:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {93}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %> text-left" 
><% _boolean_result=false;try {_boolean_result=((Boolean)((hasLoopElements("Role:RolePermissionAssignments") ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",95,e);}if (_boolean_result) { %><ul><% while (loop("Role:RolePermissionAssignments","Assignment",null)) { %><% _boolean_result=false;try {_boolean_result=((Boolean)(((((Boolean) (disableErrorMessages().isDefined(getObject("Assignment:Permission:Name")))).booleanValue() && ((Boolean) (((!(context.getFormattedValue(getObject("Assignment:Permission:Name"),null).equals(context.getFormattedValue("",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",98,e);}if (_boolean_result) { %><li><% {String value = null;try{value=context.getFormattedValue(getObject("Assignment:Permission:Name"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {99}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %></li><% } %><% } %></ul><% } %></li><% } %></ul><% } %></div>
</div>
<script>
$(document).ready(function () {
$.fn.showUniquePermissions = function() {
var permissionsList = [];
var name;
var roleID;
// Collect permissions
$("<%=context.getFormattedValue("#",null)%>user-roles-container").find("input[type='checkbox']").each(function () {
$label = $(this).closest("label");
roleID = $label.attr("for");
if (roleID && $(this).is(":checked")) {
$("<%=context.getFormattedValue("#",null)%>" + roleID + "_permissions").find("li").each(function () {
name = $(this).text();
if ($.inArray(name, permissionsList) == -1) {
permissionsList.push(name);
}
});
}
});
// Sort permissions alphabetically
permissionsList.sort(function(a, b) {
return a.localeCompare(b, '<% {String value = null;try{value=context.getFormattedValue(getObject("Language"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {131}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>', {'sensitivity': 'base'});
});
// Display permissions as list items
$ul = $("<dl>").append($.map(permissionsList, function(permission){ return $("<dd>").text(permission); }));
$("<%=context.getFormattedValue("#",null)%>selected-permissions" ).html($ul);
};
$(this).showUniquePermissions();
$("<%=context.getFormattedValue("#",null)%>user-roles-container").find('input[name="SelectedUserRolesUUID"]').on("change", function () {$(this).showUniquePermissions();});
});
</script>
</fieldset><% printFooter(out); %>