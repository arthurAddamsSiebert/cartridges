<?xml version="1.0" encoding="UTF-8"?>
<!--@Group Payment-->

<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessPayment" overrideMode="Inherit" type="process">
<!--Basket
@Location 0,0-->
  <nodes xsi:type="pipeline:Text" nodeID="Text0"/>
<!--Capabilities
@Location 0,14-->
  <nodes xsi:type="pipeline:Text" nodeID="Text1"/>
<!--User
@Location 0,22-->
  <nodes xsi:type="pipeline:Text" nodeID="Text2"/>
<!--General
@Location 23,0-->
  <nodes xsi:type="pipeline:Text" nodeID="Text3"/>
<!--Processing
@Location 0,36-->
  <nodes xsi:type="pipeline:Text" nodeID="Text6"/>
<!--TODO
Can we deprecate these EPs?
@Location 35,18-->
  <nodes xsi:type="pipeline:Text" nodeID="Text_0WwYkAl3EeeMKMaQjlYK1A"/>
<!--Calling this might lead to calling ProcessPayment\-
ReverseAuthorization from bc_orderprocess, use
RevertAuthorization to make sure
@Location 23,25-->
  <nodes xsi:type="pipeline:Text" nodeID="Text_dc1nkC80EeewvaWwtcQ7QQ"/>
<!--TODO 
Can we deprecate these EPs?
@Location 42,18-->
  <nodes xsi:type="pipeline:Text" nodeID="Text_oajDQAmNEeehTpq6CHM4Aw"/>
<!--@Location 4,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode10" strict="true" name="Authorize"
      callMode="Private">
    <nodeSuccessors name="next" next="AuthorizePayment0_Input"/>
<!--The payment to authorize.	-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--@Location 4,16-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="AuthorizePayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.AuthorizePayment.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 9,34-->
      <nodeSuccessors next="ExtensionPointNode14"/>
    </outConnectors>
    <outConnectors name="Pending">
<!--@BendPoints 11,34-->
      <nodeSuccessors next="ExtensionPointNode33"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 13,33-->
      <nodeSuccessors next="ExtensionPointNode15"/>
    </outConnectors>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point AuthorizePostProcessingHandler\-AuthorizePostProcessing instead.<br/>@Deprecated since 7.9. Please use Java extension point AuthorizePostProcessingHandler\-AuthorizePostProcessing instead.
The extension point is called after the successfull completion of the payment authorization.
<br>The transaction state was set to <b>AUTHORIZED</b> or \- in case of a capturing authorization \- to <b>CAPTURED</b>.
@Location 4,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode14" name="AuthorizedPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode9"/>
<!--The authorized payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just successful completed authorization.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Location 4,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode9" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point AuthorizePostProcessingHandler\-AuthorizePostProcessing instead.<br/>
The extension point is called when the payment authorization has been triggered, but has not yet completed. <br>
The transaction state is changed but further capability calls will not be triggered until a notification has been received that the authorization was successful.
@Location 5,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode33" name="PendingAuthorizePayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode42"/>
<!--The payment whose authorization status is pending.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just completed authorization call.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Location 5,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode42" name="Pending" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point AuthorizePostProcessingHandler\-AuthorizePostProcessing instead.<br/>
The extension point is called when the payment authorization failed. <br>
The transaction state is <b>not</b> changed. The view logic has to decide if the user can try again or not.
@Location 6,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode15" name="FailedAuthorizePayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode2"/>
<!--The payment which could not be authorized successfully.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just successful completed authorization.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Location 6,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Location 31,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode25" strict="true" name="CalculateRedirectURL"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode3"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="CallbackSuccessURL" type="java.net.URI" optional="true"/>
    <parameters name="CallbackCancelURL" type="java.net.URI" optional="true"/>
    <parameters name="CallbackFailureURL" type="java.net.URI" optional="true"/>
    <parameters name="CallbackPipeline" type="java.lang.String" optional="true"/>
    <parameters name="JumpTargetPipeline" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 31,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="PaymentBO:PaymentServiceBO:Extension(&quot;RedirectBeforeCheckout&quot;)">
<!--@BendPoints 65,33-->
    <nodeSuccessors name="decision_yes" next="JoinNode24"/>
<!--@BendPoints 63,34-->
    <nodeSuccessors name="decision_no" next="DecisionNode4"/>
  </nodes>
<!--@Location 32,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode24">
    <nodeSuccessors name="next" next="CalculatePaymentRedirectURL0"/>
  </nodes>
<!--@Location 33,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CalculatePaymentRedirectURL0">
    <pipelet href="enfinity:/bc_payment/pipelets/CalculatePaymentRedirectURL.xml"/>
    <nodeSuccessors name="next" next="EndNode40"/>
<!--@BendPoints 68,35 69,35-->
    <nodeSuccessors name="pipelet_error" next="JoinNode21"/>
  </nodes>
<!--@Location 33,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode40" strict="true">
    <returnValues name="RedirectURL" type="java.net.URI"/>
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RedirectURLCreationResult>"/>
  </nodes>
<!--@Location 34,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode21">
    <nodeSuccessors name="next" next="EndNode41"/>
  </nodes>
<!--@Location 34,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode41" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RedirectURLCreationResult>"
        optional="true"/>
  </nodes>
<!--@Location 31,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="PaymentBO:PaymentServiceBO:Extension(&quot;RedirectAfterCheckout&quot;)">
    <nodeSuccessors name="decision_yes" next="JoinNode24"/>
<!--@BendPoints 63,36-->
    <nodeSuccessors name="decision_no" next="DecisionNode7"/>
  </nodes>
<!--@Location 31,18-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode7" conditionKey="PaymentBO:PaymentServiceBO:Extension(&quot;FastCheckout&quot;)">
<!--@BendPoints 65,37-->
    <nodeSuccessors name="decision_yes" next="JoinNode24"/>
<!--@BendPoints 63,38 63,39-->
    <nodeSuccessors name="decision_no" next="JoinNode21"/>
  </nodes>
<!--@Location 12,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode11" strict="true" name="Cancel"
      callMode="Private">
    <nodeSuccessors name="next" next="CancelPayment0_Input"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--@Location 12,16-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CancelPayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CancelPayment.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 25,34-->
      <nodeSuccessors next="ExtensionPointNode28"/>
    </outConnectors>
    <outConnectors name="Pending">
<!--@BendPoints 27,34-->
      <nodeSuccessors next="ExtensionPointNode35"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 29,33-->
      <nodeSuccessors next="ExtensionPointNode29"/>
    </outConnectors>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point CancelPostProcessingHandler\-CancelPostProcessing instead.<br/>
The extension point is called when a payment was successfully cancelled.
@Location 12,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode28" name="CancelledPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode6"/>
<!--The cancelled payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the payment cancellation.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CancelResult>"/>
  </nodes>
<!--@Location 12,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode6" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CancelResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point CancelPostProcessingHandler\-CancelPostProcessing instead.<br/>
The extension point is called when the payment cancellation has been triggered, but has not yet completed. <br>
The transaction state is changed but further capability calls will not be triggered until a notification has been received that the cancellation was successful.
@Location 13,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode35" name="PendingCancelPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode61"/>
<!--The payment whose cancel status is pending.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just completed cancel call.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CancelResult>"/>
  </nodes>
<!--@Location 13,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode61" name="Pending" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CancelResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point CancelPostProcessingHandler\-CancelPostProcessing instead.<br/>
The extension point is called when the payment cancellation failed.
@Location 14,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode29" name="FailedCancelPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode49"/>
<!--The payment which could not be cancelled.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result set of the attempt to cancel the payment.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CancelResult>"/>
  </nodes>
<!--@Location 14,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode49" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CancelResult>"/>
  </nodes>
<!--@Location 8,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode4" strict="true" name="Capture"
      callMode="Private">
    <nodeSuccessors name="next" next="CapturePayment0_Input"/>
<!--The payment to capture the amount from.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The amount to capture. If not given the whole authorized amount is captured.-->
    <parameters name="CaptureAmount" type="com.intershop.beehive.foundation.quantity.Money"
        optional="true"/>
  </nodes>
<!--@Location 8,16-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CapturePayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CapturePayment.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 17,34-->
      <nodeSuccessors next="ExtensionPointNode18"/>
    </outConnectors>
    <outConnectors name="Pending">
<!--@BendPoints 19,34-->
      <nodeSuccessors next="ExtensionPointNode34"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 21,33-->
      <nodeSuccessors next="ExtensionPointNode19"/>
    </outConnectors>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point CapturePostProcessingHandler\-CapturePostProcessing instead.<br/>
The extension point is called after the successfull completion of payment capture request.
<br>The transaction state was set to <b>CAPTURED</b>.
@Location 8,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode18" name="CapturedPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode7"/>
<!--The captured payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just successful completed capture request.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CaptureResult>"/>
  </nodes>
<!--@Location 8,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode7" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CaptureResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point CapturePostProcessingHandler\-CapturePostProcessing instead.<br/>
The extension point is called when the payment capturing has been triggered, but has not yet completed. <br>
The transaction state is changed but further capability calls will not be triggered until a notification has been received that the capturing was successful.
@Location 9,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode34" name="PendingCapturePayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode43"/>
<!--The payment whose capture status is pending.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just completed capture call.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CaptureResult>"/>
  </nodes>
<!--@Location 9,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode43" name="Pending" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CaptureResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point CapturePostProcessingHandler\-CapturePostProcessing instead.<br/>
The extension point is called when the payment capture request failed. <br>
The transaction state is <b>not</b> changed. The view logic has to decide if the user can try again or not.
@Location 10,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode19" name="FailedCapturePayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode44"/>
<!--The payment which could not be captured successfully.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just successful completed capture request-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.CaptureResult>"/>
  </nodes>
<!--@Location 10,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode44" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"/>
  </nodes>
<!--@Location 32,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode33" strict="true" name="CopyPaymentInstrument"
      callMode="Private">
    <nodeSuccessors name="next" next="CopyPaymentInstrument0"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
<!--TargetRepository for the payment instrument-->
    <parameters name="PaymentInstrumentBORepository" type="com.intershop.component.payment.capi.PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 32,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CopyPaymentInstrument0">
    <pipelet href="enfinity:/bc_payment/pipelets/CopyPaymentInstrument.xml"/>
    <nodeSuccessors name="next" next="EndNode65"/>
    <nodeSuccessors name="pipelet_error" next="EndNode68"/>
  </nodes>
<!--@Location 32,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode65" strict="true">
    <returnValues name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 33,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode68" name="Error" strict="true"/>
<!--@Location 9,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode6" strict="true" name="CreatePayment"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode2"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--Extension point is called just before a payment for a chosen payment instrument is created. The call is done outside of the transaction.
@Location 9,2-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode2" name="CreatePayment"
      strict="true">
    <nodeSuccessors name="next" next="KeyMapper1"/>
<!--@BendPoints 20,5 21,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode4"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 9,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper1">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CreatePayment0" action="begin"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentBORepository"/>
  </nodes>
<!--@Location 9,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/CreatePayment.xml"/>
    <nodeSuccessors name="next" next="CallNode5"/>
  </nodes>
<!--@Location 9,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode5">
    <nodeSuccessors name="next" next="ExtensionPointNode6"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--Extension point is called (inside of the transaction) when a payment for a chosen payment instrument was created.
@Location 9,6-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode6" name="CreatedPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode5" action="commit"/>
<!--@BendPoints 20,13-->
    <nodeSuccessors name="pipelet_error" next="JoinNode4" action="rollback"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 9,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode5" strict="true">
    <returnValues name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--@Location 10,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
    <nodeSuccessors name="next" next="EndNode14"/>
  </nodes>
<!--@Location 10,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode14" name="Error" strict="true"/>
<!--@Location 1,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode7" strict="true" name="CreatePaymentInstrumentForBasket"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode9"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"
        optional="true"/>
  </nodes>
<!--Extension point called (outside of the transaction) before the payment instrument for a basket is created.
@Location 1,2-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode9" name="CreatePaymentInstrumentForBasket"
      strict="true">
    <nodeSuccessors name="next" next="KeyMapper2"/>
<!--@BendPoints 4,5 5,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode9"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--@Location 1,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper2">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DecisionNode1"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 1,4-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="PaymentServiceBO:PaymentInstrumentParameters"
      operator="has_elements">
    <nodeSuccessors name="decision_yes" next="CallNode6"/>
<!--@BendPoints 2,9 2,13-->
    <nodeSuccessors name="decision_no" next="JoinNode16"/>
  </nodes>
<!--@Location 1,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode6">
    <nodeSuccessors name="next" next="JoinNode16"/>
    <nodeSuccessors name="Error" next="JoinNode9"/>
    <startNode referencedName="This:Validate"/>
  </nodes>
<!--@Location 1,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode16">
    <nodeSuccessors name="next" next="CreatePaymentInstrument0" action="begin"/>
  </nodes>
<!--@Location 1,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePaymentInstrument0">
    <pipelet href="enfinity:/bc_payment/pipelets/CreatePaymentInstrument.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode1"/>
<!--@BendPoints 4,15 5,15-->
    <nodeSuccessors name="pipelet_error" next="JoinNode29"/>
  </nodes>
<!--Extension point called directly after the payment instrument for a basket was created. The extension point is part of the creation transaction.
@Location 1,8-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode1" name="CreatedPaymentInstrumentForBasket"
      strict="true">
    <nodeSuccessors name="next" next="EndNode3" action="commit"/>
<!--@BendPoints 4,17-->
    <nodeSuccessors name="pipelet_error" next="JoinNode29"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--@Location 1,9-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode3" strict="true">
    <returnValues name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 2,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode29">
    <nodeSuccessors name="next" next="JoinNode1" action="rollback"/>
  </nodes>
<!--@Location 3,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
    <nodeSuccessors name="next" next="EndNode12"/>
  </nodes>
<!--@Location 3,9-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode12" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ValidationResult>"
        optional="true"/>
    <returnValues name="ConstraintViolations" type="java.util.Collection&lt;com.intershop.platform.property.capi.validation.ConstraintViolation>"
        optional="true"/>
  </nodes>
<!--@Location 2,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
<!--@BendPoints 5,14 6,14 7,14 7,16-->
    <nodeSuccessors name="next" next="JoinNode1"/>
  </nodes>
<!--@Location 1,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode3" strict="true" name="CreatePaymentInstrumentForUser"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode8"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"
        optional="true"/>
  </nodes>
<!--Extension point called (outside of the transaction) before the payment instrument is created in the user wallet.
@Location 1,24-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode8" name="CreatePaymentInstrumentForUser"
      strict="true">
    <nodeSuccessors name="next" next="KeyMapper3"/>
<!--@BendPoints 4,49 5,49-->
    <nodeSuccessors name="pipelet_error" next="JoinNode11"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--@Location 1,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper3">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DecisionNode2"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;PaymentInstrument&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 1,26-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="PaymentServiceBO:PaymentInstrumentParameters"
      operator="has_elements">
    <nodeSuccessors name="decision_yes" next="CallNode3"/>
<!--@BendPoints 2,53 2,57-->
    <nodeSuccessors name="decision_no" next="JoinNode17"/>
  </nodes>
<!--@Location 1,27-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode3">
    <nodeSuccessors name="next" next="JoinNode17"/>
    <nodeSuccessors name="Error" next="JoinNode11"/>
    <startNode referencedName="This:Validate"/>
  </nodes>
<!--@Location 1,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode17">
    <nodeSuccessors name="next" next="CreatePaymentInstrument1" action="begin"/>
  </nodes>
<!--@Location 1,29-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePaymentInstrument1">
    <pipelet href="enfinity:/bc_payment/pipelets/CreatePaymentInstrument.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode11"/>
<!--@BendPoints 4,59 5,59-->
    <nodeSuccessors name="pipelet_error" next="JoinNode33"/>
  </nodes>
<!--Extension point called directly after the payment instrument for a user was created. The extension point is part of the creation transaction.
@Location 1,30-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode11" name="CreatedPaymentInstrumentForUser"
      strict="true">
    <nodeSuccessors name="next" next="EndNode10" action="commit"/>
<!--@BendPoints 4,61-->
    <nodeSuccessors name="pipelet_error" next="JoinNode33"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--@Location 1,31-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode10" strict="true">
    <returnValues name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 2,30-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode33">
    <nodeSuccessors name="next" next="JoinNode0" action="rollback"/>
  </nodes>
<!--@Location 3,30-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode0">
    <nodeSuccessors name="next" next="EndNode8"/>
  </nodes>
<!--@Location 3,31-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode8" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;ValidationResult>"
        optional="true"/>
    <returnValues name="ConstraintViolations" type="java.util.Collection&lt;com.intershop.platform.property.capi.validation.ConstraintViolation>"
        optional="true"/>
  </nodes>
<!--@Location 2,27-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
<!--@BendPoints 7,55-->
    <nodeSuccessors name="next" next="JoinNode0"/>
  </nodes>
<!--@Location 21,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode17" strict="true" name="GetApplicablePaymentServices"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicablePaymentServices0"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentServiceBORepository" type="com.intershop.component.payment.capi.PaymentServiceBORepository"
        optional="true"/>
  </nodes>
<!--@Location 21,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicablePaymentServices0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetApplicablePaymentServices.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode26"/>
  </nodes>
<!--Provides the possibility to filter out some payment methods although the payment service confirmed the applicability for the basket context.
But be careful when extending it, while this one may be skipped (Pipeline not called) its corresponding ExtensionPoint 
"PaymentServiceBOApplicabilityHandler\-ApplicabilityProcessingForBasket" which is aways called when the applicability of a 
payment services is checked. 
@Location 21,3-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode26" name="FilterApplicablePaymentServices"
      strict="true">
    <nodeSuccessors name="next" next="EndNode26"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentServiceBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentServiceBO>"/>
  </nodes>
<!--@Location 21,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode26" strict="true">
    <returnValues name="PaymentServiceBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentServiceBO>"/>
  </nodes>
<!--@Location 16,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode24" strict="true" name="GetApplicablePaymentServicesByUser"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicablePaymentServicesByUser0"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentServiceBORepository" type="com.intershop.component.payment.capi.PaymentServiceBORepository"
        optional="true"/>
  </nodes>
<!--@Location 16,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicablePaymentServicesByUser0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetApplicablePaymentServicesByUser.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode27"/>
  </nodes>
<!--Provides the possibility to filter out some payment methods although the payment service confirmed the availibity for this user.
But be careful when extending it, while this one may be skipped (Pipeline not called) its corresponding ExtensionPoint 
"PaymentServiceBOApplicabilityHandler\-ApplicabilityProcessingForUser" which is aways called when the applicability of a 
payment services is checked. 
@Location 16,25-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode27" name="FilterApplicablePaymentServicesByUser"
      strict="true">
    <nodeSuccessors name="next" next="EndNode39"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentServiceBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentServiceBO>"/>
  </nodes>
<!--@Location 16,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode39" strict="true">
    <returnValues name="PaymentServiceBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentServiceBO>"/>
  </nodes>
<!--@Location 30,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode30" strict="true" name="GetAvailablePaymentInstrumentsFromBasket"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper10"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 30,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper10">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetAvailablePaymentInstruments0"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 30,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAvailablePaymentInstruments0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetAvailablePaymentInstruments.xml"/>
    <nodeSuccessors name="next" next="EndNode52"/>
  </nodes>
<!--@Location 30,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode52" strict="true">
    <returnValues name="PaymentInstrumentBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentInstrumentBO>"/>
  </nodes>
<!--@Location 17,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode19" strict="true" name="GetPaymentFromBasketByID"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper12"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentID" type="java.lang.String"/>
  </nodes>
<!--@Location 17,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper12">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetPaymentByID0"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentBORepository"/>
  </nodes>
<!--@Location 17,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentByID0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentByID.xml"/>
    <nodeSuccessors name="next" next="EndNode29"/>
<!--@BendPoints 36,7 37,7-->
    <nodeSuccessors name="pipelet_error" next="EndNode30"/>
  </nodes>
<!--@Location 17,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode29" strict="true">
    <returnValues name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--@Location 18,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode30" name="Error" strict="true"/>
<!--@Location 5,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode18" strict="true" name="GetPaymentInstrumentFromBasketByID"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper11"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentInstrumentID" type="java.lang.String"/>
  </nodes>
<!--@Location 5,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper11">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetPaymentInstrumentByID0"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 5,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentInstrumentByID0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentInstrumentByID.xml"/>
    <nodeSuccessors name="next" next="EndNode27"/>
<!--@BendPoints 12,7 13,7-->
    <nodeSuccessors name="pipelet_error" next="EndNode28"/>
  </nodes>
<!--@Location 5,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode27" strict="true">
    <returnValues name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 6,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode28" name="Error" strict="true"/>
<!--@Location 10,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode20" strict="true" name="GetPaymentInstrumentFromUserByID"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper13"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentInstrumentID" type="java.lang.String"/>
  </nodes>
<!--@Location 10,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper13">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetPaymentInstrumentByID1"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;PaymentInstrument&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 10,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentInstrumentByID1">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentInstrumentByID.xml"/>
    <nodeSuccessors name="next" next="EndNode31"/>
<!--@BendPoints 22,51 23,51-->
    <nodeSuccessors name="pipelet_error" next="EndNode32"/>
  </nodes>
<!--@Location 10,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode31" strict="true">
    <returnValues name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 11,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode32" name="Error" strict="true"/>
<!--@Location 7,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode12" strict="true" name="GetPaymentInstrumentsFromBasket"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper7"/>
<!--The owning Basket for the instuments to be looked up.-->
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
<!--Filters the payment instruments to lookup for the given service.	-->
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"
        optional="true"/>
  </nodes>
<!--@Location 7,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper7">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetPaymentInstruments0"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 7,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentInstruments0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentInstruments.xml"/>
    <nodeSuccessors name="next" next="EndNode20"/>
  </nodes>
<!--@Location 7,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode20" strict="true">
    <returnValues name="PaymentInstrumentBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentInstrumentBO>"/>
  </nodes>
<!--@Location 13,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode13" strict="true" name="GetPaymentInstrumentsFromUser"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper8"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
  </nodes>
<!--@Location 13,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper8">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetPaymentInstruments1"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;PaymentInstrument&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 13,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentInstruments1">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentInstruments.xml"/>
    <nodeSuccessors name="next" next="EndNode21"/>
  </nodes>
<!--@Location 13,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode21" strict="true">
    <returnValues name="PaymentInstrumentBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentInstrumentBO>"/>
  </nodes>
<!--@Location 26,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode21" strict="true" name="GetPaymentServiceByID"
      callMode="Private">
    <nodeSuccessors name="next" next="GetPaymentServiceByID0"/>
    <parameters name="PaymentServiceID" type="java.lang.String"/>
    <parameters name="PaymentServiceBORepository" type="com.intershop.component.payment.capi.PaymentServiceBORepository"
        optional="true"/>
  </nodes>
<!--@Location 26,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentServiceByID0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentServiceByID.xml"/>
    <nodeSuccessors name="next" next="EndNode33"/>
<!--@BendPoints 54,5 55,5-->
    <nodeSuccessors name="pipelet_error" next="EndNode34"/>
  </nodes>
<!--@Location 26,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode33" strict="true">
    <returnValues name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
  </nodes>
<!--@Location 27,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode34" name="Error" strict="true"/>
<!--@Location 28,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode23" strict="true" name="GetPaymentServiceByPaymentServiceConfigurationID"
      callMode="Private">
    <nodeSuccessors name="next" next="GetPaymentServiceByPaymentConfigurationID0"/>
    <parameters name="PaymentServiceConfigurationID" type="java.lang.String"/>
    <parameters name="PaymentServiceBORepository" type="com.intershop.component.payment.capi.PaymentServiceBORepository"
        optional="true"/>
  </nodes>
<!--@Location 28,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentServiceByPaymentConfigurationID0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentServiceByPaymentConfigurationID.xml"/>
    <nodeSuccessors name="next" next="EndNode38"/>
<!--@BendPoints 59,5-->
    <nodeSuccessors name="pipelet_error" next="EndNode37"/>
  </nodes>
<!--@Location 28,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode38" strict="true">
    <returnValues name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
  </nodes>
<!--@Location 29,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode37" name="Error" strict="true"/>
<!--@Location 23,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode31" strict="true" name="GetPaymentServices"
      callMode="Private">
    <nodeSuccessors name="next" next="GetPaymentServiceBOs0"/>
    <parameters name="PaymentServiceBORepository" type="com.intershop.component.payment.capi.PaymentServiceBORepository"
        optional="true"/>
  </nodes>
<!--@Location 23,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentServiceBOs0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPaymentServiceBOs.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode30"/>
  </nodes>
<!--Provides the possibility to filter out some payment methods although the payment service confirmed the applicability for the basket context.
@Location 23,3-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode30" name="FilterPaymentServices"
      strict="true">
    <nodeSuccessors name="next" next="EndNode59"/>
    <parameters name="PaymentServiceBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentServiceBO>"/>
  </nodes>
<!--@Location 23,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode59" strict="true">
    <returnValues name="PaymentServiceBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentServiceBO>"/>
  </nodes>
<!--@Location 19,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode16" strict="true" name="GetPaymentsFromBasket"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper9"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 19,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper9">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetPayments0"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentBORepository"/>
  </nodes>
<!--@Location 19,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPayments0">
    <pipelet href="enfinity:/bc_payment/pipelets/GetPayments.xml"/>
    <nodeSuccessors name="next" next="EndNode25"/>
  </nodes>
<!--@Location 19,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode25" strict="true">
    <returnValues name="PaymentBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentBO>"/>
  </nodes>
<!--@Location 50,15-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="NotificationStartNode0" name="Notify">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.NotificationStartNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Output">
      <nodeSuccessors next="DecisionNode_GbQF0PnYEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 109,31-->
      <nodeSuccessors next="JoinNode_X1B1EPnYEeetkMZgfpTcbQ"/>
    </outConnectors>
  </nodes>
<!--@Location 50,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode_GbQF0PnYEeetkMZgfpTcbQ"
      conditionKey="ApplicationBO:Configuration:getString(&quot;intershop.order.creationchain.enable&quot;)"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="JoinNode_OEVXEPnYEeetkMZgfpTcbQ"/>
    <nodeSuccessors name="decision_no" next="JoinNode_VfuKkPnYEeetkMZgfpTcbQ"/>
  </nodes>
<!--@Location 51,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_OEVXEPnYEeetkMZgfpTcbQ">
    <nodeSuccessors name="next" next="CreateOrderPaymentNotificationCallbackNode_ocXuYB9pEeePRK80YI41Pg_Input"/>
  </nodes>
<!--@Location 51,17-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CreateOrderPaymentNotificationCallbackNode_ocXuYB9pEeePRK80YI41Pg">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CreateOrderPaymentNotificationCallbackNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
      <nodeSuccessors next="CreateOrder_Z-1aMPnYEeetkMZgfpTcbQ_Input"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 104,37-->
      <nodeSuccessors next="JoinNode_X1B1EPnYEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="NotOrderCreationProcessRelated">
<!--@BendPoints 102,37-->
      <nodeSuccessors next="JoinNode_VfuKkPnYEeetkMZgfpTcbQ"/>
    </outConnectors>
  </nodes>
<!--@Location 51,19-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CreateOrder_Z-1aMPnYEeetkMZgfpTcbQ">
    <pipelet href="enfinity:/bc_order/pipelets/com.intershop.component.order.pipelet.CreateOrder.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
      <nodeSuccessors next="JoinNode_LSj9kPnZEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 104,41-->
      <nodeSuccessors next="OrderCreationResultToResultMapper_4ozoEAWoEeixX_MBbHNqvA"/>
    </outConnectors>
    <outConnectors name="Stopped">
      <nodeSuccessors next="JoinNode_LSj9kPnZEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="Redirect">
      <nodeSuccessors next="JoinNode_LSj9kPnZEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="Workflow">
      <nodeSuccessors next="JoinNode_LSj9kPnZEeetkMZgfpTcbQ"/>
    </outConnectors>
  </nodes>
<!--@Location 51,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_LSj9kPnZEeetkMZgfpTcbQ">
<!--@BendPoints 103,49-->
    <nodeSuccessors name="next" next="JoinNode_AtOWkPnZEeetkMZgfpTcbQ"/>
  </nodes>
<!--@Location 50,24-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_AtOWkPnZEeetkMZgfpTcbQ">
    <nodeSuccessors name="next" next="EndNode64"/>
  </nodes>
<!--@Location 50,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode64" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 53,20-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="OrderCreationResultToResultMapper_4ozoEAWoEeixX_MBbHNqvA">
    <pipelet href="enfinity:/bc_payment/pipelets/OrderCreationResultToResultMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode_DUsIEPnZEeetkMZgfpTcbQ"/>
  </nodes>
<!--@Location 54,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_DUsIEPnZEeetkMZgfpTcbQ">
<!--@BendPoints 109,49-->
    <nodeSuccessors name="next" next="JoinNode_pR3FgAWjEeixX_MBbHNqvA"/>
  </nodes>
<!--@Location 53,24-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_pR3FgAWjEeixX_MBbHNqvA">
    <nodeSuccessors name="next" next="EndNode67"/>
  </nodes>
<!--@Location 53,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode67" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 54,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_X1B1EPnYEeetkMZgfpTcbQ">
    <nodeSuccessors name="next" next="JoinNode_DUsIEPnZEeetkMZgfpTcbQ"/>
  </nodes>
<!--@Location 50,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_VfuKkPnYEeetkMZgfpTcbQ">
    <nodeSuccessors name="next" next="NotificationCallback0_Input"/>
  </nodes>
<!--@Location 50,21-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="NotificationCallback0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.NotificationCallback.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
      <nodeSuccessors next="ExtensionPointNode38"/>
    </outConnectors>
    <outConnectors name="Pending">
<!--@BendPoints 105,46-->
      <nodeSuccessors next="ExtensionPointNode39"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="JoinNode39"/>
    </outConnectors>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point responsible for your notification callback instead. e.g. AuthorizePostProcessingHandler\-AuthorizePostProcessing, CapturePostProcessingHandler\-CapturePostProcessing<br/>
The extension point is called when a notification about a successfully processed payment transaction has been received from the payment provider. The transaction status change has been completed and the pending flag is cleared.
@Location 50,23-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode38" name="PaymentNotificationSuccess"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode_AtOWkPnZEeetkMZgfpTcbQ"/>
<!--The payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the payment notification callback.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point responsible for your notification callback instead. e.g. AuthorizePostProcessingHandler\-AuthorizePostProcessing, CapturePostProcessingHandler\-CapturePostProcessing<br/>
The extension point is called when a notification about a still pending payment transaction has been received from the payment provider. The transaction status change has not yet succeeded and the transaction is still marked as pending.
@Location 52,23-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode39" name="PaymentNotificationPending"
      strict="true">
    <nodeSuccessors name="next" next="EndNode66"/>
<!--The payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the payment notification callback.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 52,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode66" name="Pending" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 53,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode39">
    <nodeSuccessors name="next" next="ExtensionPointNode40"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point responsible for your notification callback instead. e.g. AuthorizePostProcessingHandler\-AuthorizePostProcessing, CapturePostProcessingHandler\-CapturePostProcessing<br/>
The extension point is called when a notification about a failed payment transaction has been received from the payment provider. The transaction status is not changed.
@Location 53,23-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode40" name="PaymentNotificationFailed"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode_pR3FgAWjEeixX_MBbHNqvA"/>
<!--The payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the payment notification callback.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Deprecated
starting with 7.10.0 Please use ProcessPayment\-Notify instead.
@Location 55,15-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="NotificationStartNode_Os458PnaEeetkMZgfpTcbQ"
      name="OrderCreationNotify">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.NotificationStartNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Output">
      <nodeSuccessors next="CreateOrderPaymentNotificationCallbackNode_OtEgIPnaEeetkMZgfpTcbQ_Input"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="JoinNode_Os0BcPnaEeetkMZgfpTcbQ"/>
    </outConnectors>
  </nodes>
<!--@Location 55,16-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CreateOrderPaymentNotificationCallbackNode_OtEgIPnaEeetkMZgfpTcbQ">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CreateOrderPaymentNotificationCallbackNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
      <nodeSuccessors next="EndNode_OtBc0PnaEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="JoinNode_Os0BcPnaEeetkMZgfpTcbQ"/>
    </outConnectors>
    <outConnectors name="NotOrderCreationProcessRelated">
<!--@BendPoints 113,34-->
      <nodeSuccessors next="EndNode_Os9ycPnaEeetkMZgfpTcbQ"/>
    </outConnectors>
  </nodes>
<!--@Location 55,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode_OtBc0PnaEeetkMZgfpTcbQ" name="Success"
      strict="true">
    <returnValues name="OrderCreationContext" type="com.intershop.component.order.capi.handlerchain.OrderCreationContext"/>
  </nodes>
<!--@Location 57,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_Os0BcPnaEeetkMZgfpTcbQ">
    <nodeSuccessors name="next" next="EndNode_OsvI8PnaEeetkMZgfpTcbQ"/>
  </nodes>
<!--@Location 57,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode_OsvI8PnaEeetkMZgfpTcbQ" name="Error"
      strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 56,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode_Os9ycPnaEeetkMZgfpTcbQ" name="NotOrderCreationProcessRelated"
      strict="true"/>
<!--@Location 43,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode29" strict="true" name="ProcessAfterCheckoutCallback"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode11"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;java.lang.String,java.lang.String>"/>
    <parameters name="RedirectResultStatus" type="java.lang.String"/>
  </nodes>
<!--@Location 43,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode11" conditionKey="RedirectResultStatus"
      operator="str_eq" conditionValue="SUCCESS">
    <nodeSuccessors name="decision_yes" next="ExtensionPointNode20"/>
<!--@BendPoints 88,33-->
    <nodeSuccessors name="decision_no" next="DecisionNode9"/>
  </nodes>
<!--@Location 43,19-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode20" name="CallbackAfterCheckoutSuccess"
      strict="true">
<!--@BendPoints 87,41-->
    <nodeSuccessors name="next" next="JoinNode36"/>
<!--@BendPoints 88,39-->
    <nodeSuccessors name="pipelet_error" next="JoinNode34"/>
    <parameters name="RedirectResultStatus" type="com.intershop.api.service.payment.v1.capability.EnumRedirectResultStatus"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;K,V>"/>
  </nodes>
<!--@Location 44,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode36">
    <nodeSuccessors name="next" next="CallbackAfterCheckoutRedirectNode0_Input" action="begin"/>
  </nodes>
<!--@Location 44,21-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CallbackAfterCheckoutRedirectNode0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CallbackAfterCheckoutRedirectNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 91,44-->
      <nodeSuccessors next="EndNode58" action="commit"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="JoinNode37" action="commit"/>
    </outConnectors>
    <outConnectors name="Failure">
<!--@BendPoints 93,44-->
      <nodeSuccessors next="EndNode57" action="commit"/>
    </outConnectors>
    <outConnectors name="Cancel">
<!--@BendPoints 95,44-->
      <nodeSuccessors next="EndNode55" action="commit"/>
    </outConnectors>
  </nodes>
<!--@Location 45,23-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode58" name="Success" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 48,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode37">
    <nodeSuccessors name="next" next="EndNode50"/>
  </nodes>
<!--@Location 48,23-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode50" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 46,23-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode57" name="Failure" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 47,23-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode55" name="Cancel" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 48,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode34">
    <nodeSuccessors name="next" next="JoinNode37"/>
  </nodes>
<!--@Location 44,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode9" conditionKey="RedirectResultStatus"
      operator="str_eq" conditionValue="FAILURE">
    <nodeSuccessors name="decision_yes" next="ExtensionPointNode24"/>
<!--@BendPoints 90,33 91,33-->
    <nodeSuccessors name="decision_no" next="ExtensionPointNode25"/>
  </nodes>
<!--@Location 44,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode24" name="CallbackAfterCheckoutFailure"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode36"/>
<!--@BendPoints 90,37-->
    <nodeSuccessors name="pipelet_error" next="JoinNode32"/>
    <parameters name="RedirectResultStatus" type="com.intershop.api.service.payment.v1.capability.EnumRedirectResultStatus"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;K,V>"/>
  </nodes>
<!--@Location 48,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode32">
    <nodeSuccessors name="next" next="JoinNode34"/>
  </nodes>
<!--@Location 45,17-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode25" name="CallbackAfterCheckoutCancel"
      strict="true">
<!--@BendPoints 91,41-->
    <nodeSuccessors name="next" next="JoinNode36"/>
<!--@BendPoints 92,35 93,35 95,35 97,35-->
    <nodeSuccessors name="pipelet_error" next="JoinNode32"/>
    <parameters name="RedirectResultStatus" type="com.intershop.api.service.payment.v1.capability.EnumRedirectResultStatus"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;K,V>"/>
  </nodes>
<!--@Location 36,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode26" strict="true" name="ProcessBeforeCheckoutCallback"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode5"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;java.lang.String,java.lang.String>"/>
    <parameters name="RedirectResultStatus" type="java.lang.String"/>
  </nodes>
<!--@Location 36,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode5" conditionKey="RedirectResultStatus"
      operator="str_eq" conditionValue="SUCCESS">
    <nodeSuccessors name="decision_yes" next="ExtensionPointNode21"/>
<!--@BendPoints 74,33-->
    <nodeSuccessors name="decision_no" next="DecisionNode6"/>
  </nodes>
<!--@Location 36,19-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode21" name="CallbackBeforeCheckoutSuccess"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode18"/>
<!--@BendPoints 74,39-->
    <nodeSuccessors name="pipelet_error" next="JoinNode28"/>
    <parameters name="RedirectResultStatus" type="com.intershop.api.service.payment.v1.capability.EnumRedirectResultStatus"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;K,V>"/>
  </nodes>
<!--@Location 36,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode18">
    <nodeSuccessors name="next" next="DecisionNode17" action="begin"/>
  </nodes>
<!--@Location 36,21-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode17" conditionKey="PaymentBO:PaymentServiceBO:Extension(&quot;FastCheckout&quot;)">
<!--@BendPoints 72,43 72,47-->
    <nodeSuccessors name="decision_yes" next="CallbackFastCheckoutRedirectNode0_Input"/>
    <nodeSuccessors name="decision_no" next="CallbackBeforeCheckoutRedirectNode1_Input"/>
  </nodes>
<!--@Location 36,23-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CallbackFastCheckoutRedirectNode0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CallbackFastCheckoutRedirectNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 75,47-->
      <nodeSuccessors next="EndNode53" action="commit"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="JoinNode41" action="commit"/>
    </outConnectors>
    <outConnectors name="Failure">
<!--@BendPoints 77,47-->
      <nodeSuccessors next="EndNode48" action="commit"/>
    </outConnectors>
    <outConnectors name="Cancel">
<!--@BendPoints 79,47-->
      <nodeSuccessors next="EndNode54" action="commit"/>
    </outConnectors>
  </nodes>
<!--@Location 37,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode53" name="Success" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 40,23-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode41">
    <nodeSuccessors name="next" next="EndNode47"/>
  </nodes>
<!--@Location 40,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode47" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 38,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode48" name="Failure" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 39,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode54" name="Cancel" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;? extends com.intershop.api.service.payment.v1.result.CallbackResult>"/>
  </nodes>
<!--@Location 36,22-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CallbackBeforeCheckoutRedirectNode1">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CallbackBeforeCheckoutRedirectNode.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 75,45-->
      <nodeSuccessors next="EndNode53" action="commit"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="JoinNode22" action="commit"/>
    </outConnectors>
    <outConnectors name="Failure">
<!--@BendPoints 77,45-->
      <nodeSuccessors next="EndNode48" action="commit"/>
    </outConnectors>
    <outConnectors name="Cancel">
<!--@BendPoints 79,45-->
      <nodeSuccessors next="EndNode54" action="commit"/>
    </outConnectors>
  </nodes>
<!--@Location 40,22-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode22">
    <nodeSuccessors name="next" next="JoinNode41"/>
  </nodes>
<!--@Location 40,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode28">
    <nodeSuccessors name="next" next="JoinNode22"/>
  </nodes>
<!--@Location 37,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode6" conditionKey="RedirectResultStatus"
      operator="str_eq" conditionValue="FAILURE">
    <nodeSuccessors name="decision_yes" next="ExtensionPointNode22"/>
<!--@BendPoints 76,33 77,33-->
    <nodeSuccessors name="decision_no" next="ExtensionPointNode23"/>
  </nodes>
<!--@Location 37,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode22" name="CallbackBeforeCheckoutFailure"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode6"/>
<!--@BendPoints 76,37-->
    <nodeSuccessors name="pipelet_error" next="JoinNode31"/>
    <parameters name="RedirectResultStatus" type="com.intershop.api.service.payment.v1.capability.EnumRedirectResultStatus"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;K,V>"/>
  </nodes>
<!--@Location 37,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
    <nodeSuccessors name="next" next="JoinNode18"/>
  </nodes>
<!--@Location 40,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode31">
    <nodeSuccessors name="next" next="JoinNode28"/>
  </nodes>
<!--@Location 38,17-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode23" name="CallbackBeforeCheckoutCancel"
      strict="true">
<!--@BendPoints 77,41-->
    <nodeSuccessors name="next" next="JoinNode6"/>
<!--@BendPoints 78,35 81,35-->
    <nodeSuccessors name="pipelet_error" next="JoinNode31"/>
    <parameters name="RedirectResultStatus" type="com.intershop.api.service.payment.v1.capability.EnumRedirectResultStatus"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="QueryParameters" type="java.util.Map&lt;K,V>"/>
  </nodes>
<!--@Location 20,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode15" strict="true" name="Reduce"
      callMode="Private">
    <nodeSuccessors name="next" next="ReducePayment0_Input"/>
<!--The payment to reduce.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--Amount to which the authorization amount has to be reduced to.
Either this value or the ReduceByAmount has to be given. If none is provided the error exit is used. If both are given the RedduceToAmount is used.-->
    <parameters name="ReduceToAmount" type="com.intershop.beehive.foundation.quantity.Money"
        optional="true"/>
<!--Amount by which the authorization amount has to be reduced.
Either this value or the ReduceToAmount has to be given. If none is provided the error exit is used. If both are given the RedduceToAmount is used.-->
    <parameters name="ReduceByAmount" type="com.intershop.beehive.foundation.quantity.Money"
        optional="true"/>
<!--Informational message why the authorization amount has to be reduced.-->
    <parameters name="ReduceReason" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 20,16-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="ReducePayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.ReducePayment.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 41,34-->
      <nodeSuccessors next="ExtensionPointNode31"/>
    </outConnectors>
    <outConnectors name="Pending">
<!--@BendPoints 43,34-->
      <nodeSuccessors next="ExtensionPointNode37"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 45,33-->
      <nodeSuccessors next="ExtensionPointNode32"/>
    </outConnectors>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point ReducePostProcessingHandler\-ReducePostProcessing instead.<br/>
The extension point is called when a payment was successfully reduced.
@Location 20,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode31" name="ReducedPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode24"/>
<!--The reduced payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the payment reduction.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ReduceResult>"/>
  </nodes>
<!--@Location 20,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode24" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ReduceResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point ReducePostProcessingHandler\-ReducePostProcessing instead.<br/>
The extension point is called when the payment reduction has been triggered, but has not yet completed. <br>
The transaction state is changed but further capability calls will not be triggered until a notification has been received that the reduction was successful.
@Location 21,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode37" name="PendingReducePayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode63"/>
<!--The payment whose reduce status is pending.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just completed reduce call.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ReduceResult>"/>
  </nodes>
<!--@Location 21,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode63" name="Pending" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ReduceResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point ReducePostProcessingHandler\-ReducePostProcessing instead.<br/>
The extension point is called when the payment refunding failed.
@Location 22,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode32" name="FailedReducePayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode15"/>
<!--The payment which could not be reduced.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the attempt to reduce the payment.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ReduceResult>"/>
  </nodes>
<!--@Location 22,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode15" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ReduceResult>"/>
  </nodes>
<!--@Location 16,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode14" strict="true" name="Refund"
      callMode="Private">
    <nodeSuccessors name="next" next="RefundPayment0_Input"/>
<!--The payment to refund.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The amount to refund. If not given the whole captured amount is refunded.-->
    <parameters name="RefundAmount" type="com.intershop.beehive.foundation.quantity.Money"
        optional="true"/>
<!--The reason why the payment refunding has been triggered.-->
    <parameters name="RefundReason" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 16,16-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="RefundPayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.RefundPayment.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="Success">
<!--@BendPoints 33,34-->
      <nodeSuccessors next="ExtensionPointNode16"/>
    </outConnectors>
    <outConnectors name="Pending">
<!--@BendPoints 35,34-->
      <nodeSuccessors next="ExtensionPointNode36"/>
    </outConnectors>
    <outConnectors name="Error">
<!--@BendPoints 37,33-->
      <nodeSuccessors next="ExtensionPointNode17"/>
    </outConnectors>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point RefundPostProcessingHandler\-RefundPostProcessing instead.<br/>
The extension point is called when a payment was successfully refunded.
@Location 16,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode16" name="RefundedPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode23"/>
<!--The refunded payment.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the payment refunding.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RefundResult>"/>
  </nodes>
<!--@Location 16,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode23" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RefundResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point RefundPostProcessingHandler\-RefundPostProcessing instead.<br/>
The extension point is called when the payment refunding has been triggered, but has not yet completed. <br>
The transaction state is changed but further capability calls will not be triggered until a notification has been received that the refunding was successful.
@Location 17,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode36" name="PendingRefundPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode62"/>
<!--The payment whose refund status is pending.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the just completed refund call.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RefundResult>"/>
  </nodes>
<!--@Location 17,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode62" name="Pending" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RefundResult>"/>
  </nodes>
<!--@Deprecated since 7.9. Please use Java extension point RefundPostProcessingHandler\-RefundPostProcessing instead.<br/>
The extension point is called when the payment refunding failed.
@Location 18,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode17" name="FailedRefundPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode13"/>
<!--The payment which could not be refunded.-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
<!--The result of the attempt to refund the payment.-->
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RefundResult>"/>
  </nodes>
<!--@Location 18,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode13" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.RefundResult>"/>
  </nodes>
<!--@Location 11,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode8" strict="true" name="RemovePayment"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode4"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--The extension point is called before the removel of a payment from the basket.
@Location 11,2-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode4" name="RemovePayment"
      strict="true">
    <nodeSuccessors name="next" next="KeyMapper5"/>
<!--@BendPoints 25,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode30"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--@Location 11,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper5">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DeletePayment0" action="begin"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentBORepository"/>
  </nodes>
<!--@Location 11,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeletePayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/DeletePayment.xml"/>
    <nodeSuccessors name="next" next="CallNode2"/>
<!--@BendPoints 24,9-->
    <nodeSuccessors name="pipelet_error" next="JoinNode30" action="rollback"/>
  </nodes>
<!--@Location 11,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode2">
    <nodeSuccessors name="next" next="ExtensionPointNode7"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--The extension point is called after  the successful removal of a payment from the basket. It is part of the transaction.
@Location 11,6-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode7" name="RemovedPayment"
      strict="true">
    <nodeSuccessors name="next" next="EndNode16" action="commit"/>
<!--@BendPoints 24,13-->
    <nodeSuccessors name="pipelet_error" next="JoinNode3" action="rollback"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 11,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode16" strict="true"/>
<!--@Location 12,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
    <nodeSuccessors name="next" next="EndNode11"/>
  </nodes>
<!--@Location 12,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode11" name="Error" strict="true"/>
<!--@Location 12,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode30">
    <nodeSuccessors name="next" next="JoinNode3"/>
  </nodes>
<!--@Location 3,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode2" strict="true" name="RemovePaymentInstrumentFromBasket"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode10"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--Extension point called (outside of the transaction) before the payment instrument is removed from the basket.
@Location 3,2-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode10" name="RemovePaymentInstrumentFromBasket"
      strict="true">
    <nodeSuccessors name="next" next="KeyMapper6"/>
<!--@BendPoints 8,5 9,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode19"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 3,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper6">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DeletePaymentInstrument1" action="begin"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 3,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeletePaymentInstrument1">
    <pipelet href="enfinity:/bc_payment/pipelets/DeletePaymentInstrument.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode3"/>
<!--@BendPoints 8,9-->
    <nodeSuccessors name="pipelet_error" next="JoinNode19" action="rollback"/>
  </nodes>
<!--The extension point is called directly after the successful removal of a payment instrument from the basket. It is part of the transaction.
@Location 3,5-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode3" name="RemovedPaymentInstrumentFromBasket"
      strict="true">
    <nodeSuccessors name="next" next="EndNode17" action="commit"/>
<!--@BendPoints 8,11-->
    <nodeSuccessors name="pipelet_error" next="JoinNode2" action="rollback"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 3,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode17" strict="true"/>
<!--@Location 4,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
    <nodeSuccessors name="next" next="EndNode19"/>
  </nodes>
<!--@Location 4,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode19" name="Error" strict="true"/>
<!--@Location 4,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode19">
    <nodeSuccessors name="next" next="JoinNode2"/>
  </nodes>
<!--@Location 4,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode9" strict="true" name="RemovePaymentInstrumentFromUser"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode5"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--Extension point called (outside of the transaction) before the payment instrument is removed from the basket wallet.
@Location 4,24-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode5" name="RemovePaymentInstrumentFromUser"
      strict="true">
    <nodeSuccessors name="next" next="KeyMapper4"/>
<!--@BendPoints 10,49 11,49-->
    <nodeSuccessors name="pipelet_error" next="JoinNode20"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 4,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper4">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DeletePaymentInstrument0" action="begin"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;PaymentInstrument&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentInstrumentBORepository"/>
  </nodes>
<!--@Location 4,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeletePaymentInstrument0">
    <pipelet href="enfinity:/bc_payment/pipelets/DeletePaymentInstrument.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode0"/>
<!--@BendPoints 10,53-->
    <nodeSuccessors name="pipelet_error" next="JoinNode20" action="rollback"/>
  </nodes>
<!--Extension point called after the successful removal of the payment instrument from the users wallet.
@Location 4,27-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode0" name="RemovedPaymentInstrumentFromUser"
      strict="true">
    <nodeSuccessors name="next" next="EndNode18" action="commit"/>
<!--@BendPoints 10,55-->
    <nodeSuccessors name="pipelet_error" next="JoinNode7" action="rollback"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
  </nodes>
<!--@Location 4,28-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode18" strict="true"/>
<!--@Location 5,27-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
    <nodeSuccessors name="next" next="EndNode1"/>
  </nodes>
<!--@Location 5,28-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" name="Error" strict="true"/>
<!--@Location 5,26-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode20">
    <nodeSuccessors name="next" next="JoinNode7"/>
  </nodes>
<!--@Location 14,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode0" strict="true" name="RemovePayments"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper0"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 14,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper0">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DecisionNode0"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;Payment&quot;):PaymentBOs"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentBOs"/>
  </nodes>
<!--@Location 14,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode0" conditionKey="PaymentBOs"
      operator="has_elements">
    <nodeSuccessors name="decision_yes" next="LoopNode0"/>
<!--@BendPoints 30,7 33,7-->
    <nodeSuccessors name="decision_no" next="JoinNode8"/>
  </nodes>
<!--@Location 14,4-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode0" loop="PaymentBOs">
    <nodeSuccessors name="next" next="JoinNode8"/>
    <entry key="PaymentBO">
<!--@BendPoints 29,10-->
      <nodeSuccessors name="loop_entry_next" next="CallNode1"/>
    </entry>
  </nodes>
<!--@Location 14,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
<!--@BendPoints 29,13 28,13 28,9-->
    <nodeSuccessors name="next" next="LoopNode0_Entry"/>
<!--@BendPoints 31,11-->
    <nodeSuccessors name="Error" next="EndNode51"/>
    <startNode referencedName="This:RemovePayment"/>
  </nodes>
<!--@Location 15,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode51" name="Error" strict="true"/>
<!--@Location 16,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
    <nodeSuccessors name="next" next="EndNode0"/>
  </nodes>
<!--@Location 16,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode0" strict="true"/>
<!--@Location 24,25-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode28" strict="true" name="ReverseAuthorization"
      callMode="Private">
    <nodeSuccessors name="next" next="JoinNode_X5KcEC8SEeewvaWwtcQ7QQ"/>
<!--Collection of already processed payment transactions where the authorization needs to roll back	-->
    <parameters name="PaymentTransactionBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentTransactionBO>"/>
<!--Owning Order-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
  </nodes>
<!--@Location 24,26-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_X5KcEC8SEeewvaWwtcQ7QQ">
    <nodeSuccessors name="next" next="LoopNode1"/>
  </nodes>
<!--@Location 24,27-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode1" loop="PaymentTransactionBOs">
    <nodeSuccessors name="next" next="EndNode69"/>
    <entry key="PaymentTransactionBO">
      <nodeSuccessors name="loop_entry_next" next="CallNode10"/>
    </entry>
  </nodes>
<!--@Location 24,28-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode10">
    <nodeSuccessors name="next" next="UpdateOrderBOStatus0"/>
<!--@BendPoints 51,57-->
    <nodeSuccessors name="Error" next="UpdateOrderBOStatus1"/>
    <parameterBindings name="PaymentBO" objectPath="PaymentTransactionBO:PaymentBO"/>
    <startNode referencedName="ProcessPayment-Rollback"/>
  </nodes>
<!--@Location 24,29-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderBOStatus0">
    <pipelet href="enfinity:/bc_order/pipelets/UpdateOrderBOStatus.xml"/>
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="newOrderStatus" constant="CANCELLED"/>
  </nodes>
<!--@Location 24,30-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="AddObjectToCollection2"/>
  </nodes>
<!--@Location 24,31-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToCollection2">
    <pipelet href="enfinity:/core/pipelets/AddObjectToCollection.xml"/>
    <nodeSuccessors name="next" next="RemoveDictionaryValue0"/>
    <parameterBindings name="InCollection" objectPath="PaymentReversalResults"/>
    <parameterBindings name="InObject" objectPath="Result"/>
    <returnValueBindings name="OutCollection" objectPath="PaymentReversalResults"/>
  </nodes>
<!--@Location 24,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue0">
    <configurationValues name="Key" value="Result"/>
    <pipelet href="enfinity:/core/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 47,65 47,55-->
    <nodeSuccessors name="next" next="LoopNode1_Entry"/>
  </nodes>
<!--@Location 25,29-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderBOStatus1">
    <pipelet href="enfinity:/bc_order/pipelets/UpdateOrderBOStatus.xml"/>
<!--@BendPoints 51,61-->
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="newOrderStatus" constant="MANUAL_INTERVENTION_NEEDED"/>
  </nodes>
<!--@Location 26,27-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode69" strict="true">
<!--Collection of results from the sub Rollback calls-->
    <returnValues name="PaymentReversalResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result>"
        optional="true"/>
  </nodes>
<!--@Location 25,25-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode_mUEuAC80EeewvaWwtcQ7QQ" strict="true"
      name="RevertAuthorization" callMode="Private">
<!--@BendPoints 51,53-->
    <nodeSuccessors name="next" next="JoinNode_X5KcEC8SEeewvaWwtcQ7QQ"/>
<!--Collection of already processed payment transactions where the authorization needs to roll back	-->
    <parameters name="PaymentTransactionBOs" type="java.util.Collection&lt;com.intershop.component.payment.capi.PaymentTransactionBO>"/>
<!--Owning Order-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
  </nodes>
<!--@Location 24,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="Rollback"
      callMode="Private">
    <nodeSuccessors name="next" next="CanBeCancelled0_Input"/>
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
  </nodes>
<!--@Location 24,17-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CanBeCancelled0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CanBeCancelled.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="yes">
      <nodeSuccessors next="CallNode0"/>
    </outConnectors>
    <outConnectors name="no">
      <nodeSuccessors next="CanBeReduced0_Input"/>
    </outConnectors>
  </nodes>
<!--@Location 26,17-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode0">
    <nodeSuccessors name="next" next="JoinNode38"/>
<!--@BendPoints 57,35-->
    <nodeSuccessors name="Error" next="JoinNode23"/>
    <nodeSuccessors name="Pending" next="JoinNode38"/>
    <startNode referencedName="This:Cancel"/>
  </nodes>
<!--@Location 27,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode38">
<!--@BendPoints 55,41-->
    <nodeSuccessors name="next" next="JoinNode35"/>
  </nodes>
<!--@Location 24,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode35">
    <nodeSuccessors name="next" next="EndNode56"/>
  </nodes>
<!--@Location 24,22-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode56" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"
        optional="true"/>
  </nodes>
<!--@Location 28,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode23">
    <nodeSuccessors name="next" next="JoinNode5"/>
  </nodes>
<!--@Location 28,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
    <nodeSuccessors name="next" next="EndNode60"/>
  </nodes>
<!--@Location 28,22-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode60" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"
        optional="true"/>
  </nodes>
<!--@Location 24,18-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CanBeReduced0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CanBeReduced.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="yes">
      <nodeSuccessors next="CallNode8"/>
    </outConnectors>
    <outConnectors name="no">
      <nodeSuccessors next="CanBeRefunded0_Input"/>
    </outConnectors>
  </nodes>
<!--@Location 27,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode8">
    <nodeSuccessors name="next" next="JoinNode38"/>
    <nodeSuccessors name="Error" next="JoinNode23"/>
    <nodeSuccessors name="Pending" next="JoinNode38"/>
    <parameterBindings name="ReduceByAmount" objectPath="PaymentBO:PaymentTransactionBO:AmountAuthorized"/>
    <startNode referencedName="ProcessPayment-Reduce"/>
  </nodes>
<!--@Location 24,19-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CanBeRefunded0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CanBeRefunded.pipelinenode"/>
    <inConnectors name="Input"/>
    <outConnectors name="yes">
      <nodeSuccessors next="CallNode9"/>
    </outConnectors>
    <outConnectors name="no">
      <nodeSuccessors next="JoinNode35"/>
    </outConnectors>
  </nodes>
<!--@Location 26,19-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode9">
    <nodeSuccessors name="next" next="JoinNode38"/>
<!--@BendPoints 53,43-->
    <nodeSuccessors name="Error" next="JoinNode5"/>
    <nodeSuccessors name="Pending" next="JoinNode38"/>
    <startNode referencedName="This:Refund"/>
  </nodes>
<!--@Location 1,37-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode27" strict="true" name="StartPayment"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper18"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO" optional="true"/>
  </nodes>
<!--@Location 1,38-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper18">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DeterminePaymentAuthorizationSequence0"/>
    <parameterBindings name="InValue_1" objectPath="OrderBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="Order"/>
  </nodes>
<!--@Location 1,39-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeterminePaymentAuthorizationSequence0">
    <pipelet href="enfinity:/bc_payment/pipelets/DeterminePaymentAuthorizationSequence.xml"/>
    <nodeSuccessors name="next" next="LoopNode5"/>
  </nodes>
<!--@Location 1,40-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode5" loop="PaymentTransactionBOs">
    <nodeSuccessors name="next" next="EndNode45"/>
    <entry key="PaymentTransactionBO">
      <nodeSuccessors name="loop_entry_next" next="CanBeAuthorized0_Input"/>
    </entry>
  </nodes>
<!--@Location 1,41-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="CanBeAuthorized0">
    <pipelet href="enfinity:/bc_payment/pipelets/com.intershop.component.payment.pipelet.CanBeAuthorized.pipelinenode"/>
    <inConnectors name="Input">
      <parameterBindings name="PaymentBO" objectPath="PaymentTransactionBO:PaymentBO"/>
    </inConnectors>
    <outConnectors name="yes">
      <nodeSuccessors next="KeyMapper19"/>
    </outConnectors>
    <outConnectors name="no">
<!--@BendPoints 9,83-->
      <nodeSuccessors next="JoinNode26"/>
    </outConnectors>
  </nodes>
<!--@Location 1,42-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper19">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DecisionNode10"/>
    <parameterBindings name="InValue_1" objectPath="PaymentTransactionBO:PaymentBO"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentBO"/>
  </nodes>
<!--@Location 1,43-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode10" conditionKey="PaymentBO:PaymentServiceBO:Extension(&quot;RedirectAfterCheckout&quot;)">
    <nodeSuccessors name="decision_yes" next="SetDictionaryValue0"/>
<!--@BendPoints 3,88-->
    <nodeSuccessors name="decision_no" next="CallNode7"/>
  </nodes>
<!--@Location 2,43-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue0">
    <configurationValues name="Name" value="NEEDS_REDIRECT"/>
    <configurationValues name="Value" value="true"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/core/pipelets/SetDictionaryValue.xml"/>
    <nodeSuccessors name="next" next="JoinNode26"/>
  </nodes>
<!--@Location 4,43-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode26">
<!--@BendPoints 9,99-->
    <nodeSuccessors name="next" next="JoinNode25"/>
  </nodes>
<!--@Location 1,49-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode25">
<!--@BendPoints 0,99 0,81 2,81-->
    <nodeSuccessors name="next" next="LoopNode5_Entry"/>
  </nodes>
<!--@Location 1,44-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode7">
    <nodeSuccessors name="next" next="AddObjectToCollection1"/>
<!--@BendPoints 7,89-->
    <nodeSuccessors name="Error" next="AddObjectToCollection6"/>
    <nodeSuccessors name="Pending" next="AddObjectToCollection1"/>
    <startNode referencedName="ProcessPayment-Authorize"/>
  </nodes>
<!--@Location 1,45-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToCollection1">
    <pipelet href="enfinity:/core/pipelets/AddObjectToCollection.xml"/>
    <nodeSuccessors name="next" next="AddObjectToCollection5"/>
    <parameterBindings name="InCollection" objectPath="AutorizationResults"/>
    <parameterBindings name="InObject" objectPath="Result"/>
    <returnValueBindings name="OutCollection" objectPath="AutorizationResults"/>
  </nodes>
<!--@Location 1,46-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToCollection5">
    <pipelet href="enfinity:/core/pipelets/AddObjectToCollection.xml"/>
    <nodeSuccessors name="next" next="JoinNode25"/>
    <parameterBindings name="InCollection" objectPath="PaymentTransactionBOs"/>
    <parameterBindings name="InObject" objectPath="PaymentTransactionBO"/>
    <returnValueBindings name="OutCollection" objectPath="PaymentTransactionBOs"/>
  </nodes>
<!--@Location 3,45-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToCollection6">
    <pipelet href="enfinity:/core/pipelets/AddObjectToCollection.xml"/>
    <nodeSuccessors name="next" next="AddObjectToCollection0"/>
    <parameterBindings name="InCollection" objectPath="AuthorizationResults"/>
    <parameterBindings name="InObject" objectPath="Result"/>
    <returnValueBindings name="OutCollection" objectPath="AuthorizationResults"/>
  </nodes>
<!--@Location 3,46-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToCollection0">
    <pipelet href="enfinity:/core/pipelets/AddObjectToCollection.xml"/>
    <nodeSuccessors name="next" next="CallNode12"/>
    <parameterBindings name="InCollection" objectPath="PaymentTransactionBOs"/>
    <parameterBindings name="InObject" objectPath="PaymentBO:PaymentTransactionBO"/>
    <returnValueBindings name="OutCollection" objectPath="PaymentTransactionBOs"/>
  </nodes>
<!--@Location 3,47-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode12">
    <nodeSuccessors name="next" next="EndNode46"/>
    <startNode referencedName="ProcessPayment-ReverseAuthorization"/>
  </nodes>
<!--@Location 3,48-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode46" name="ERROR" strict="true">
<!--Result of the last processed authorization-->
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"
        optional="true"/>
<!--Collection of the results of all processed authorization-->
    <returnValues name="AuthorizationResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>>"
        optional="true"/>
<!--In case of an error the collection of results of the reverse authorization calls-->
    <returnValues name="PaymentReversalResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result>"
        optional="true"/>
  </nodes>
<!--@Location 4,40-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode45" strict="true">
    <returnValues name="NEEDS_REDIRECT" type="java.lang.String" optional="true"/>
<!--Result of the last processed authorization-->
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result"
        optional="true"/>
<!--Collection of the results of all processed authorization-->
    <returnValues name="AuthorizationResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>>"
        optional="true"/>
<!--In case of an error the collection of results of the reverse authorization calls-->
    <returnValues name="PaymentReversalResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result>"
        optional="true"/>
  </nodes>
<!--@Location 7,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode22" strict="true" name="UpdatePaymentInstrument"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode12"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--The extension point is called just before the payment instrument data are updated. It is not part of the transaction.
@Location 7,24-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode12" name="UpdatePaymentInstrument"
      strict="true">
    <nodeSuccessors name="next" next="CallNode4"/>
<!--@BendPoints 16,49 17,49-->
    <nodeSuccessors name="pipelet_error" next="JoinNode14"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--@Location 7,25-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
    <nodeSuccessors name="next" next="LoopNode3" action="begin"/>
    <nodeSuccessors name="Error" next="JoinNode14"/>
    <parameterBindings name="PaymentServiceBO" objectPath="PaymentInstrumentBO:PaymentServiceBO"/>
    <startNode referencedName="This:Validate"/>
  </nodes>
<!--@Location 7,26-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode3" loop="PaymentParameters">
<!--@BendPoints 13,53-->
    <nodeSuccessors name="next" next="ExtensionPointNode13"/>
    <entry key="PaymentParameter">
<!--@BendPoints 15,54-->
      <nodeSuccessors name="loop_entry_next" next="StorePropertyGroupValue2"/>
    </entry>
  </nodes>
<!--@Location 7,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="StorePropertyGroupValue2">
    <pipelet href="enfinity:/core/pipelets/StorePropertyGroupValue.xml"/>
<!--@BendPoints 16,55 16,53-->
    <nodeSuccessors name="next" next="LoopNode3_Entry"/>
<!--@BendPoints 15,56-->
    <nodeSuccessors name="pipelet_error" next="JoinNode27"/>
    <parameterBindings name="Owner" objectPath="PaymentInstrumentBO"/>
    <parameterBindings name="PropertyGroupValue" objectPath="PaymentParameter"/>
  </nodes>
<!--@Location 7,29-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode27">
    <nodeSuccessors name="next" next="JoinNode15" action="rollback"/>
  </nodes>
<!--@Location 8,29-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode15">
    <nodeSuccessors name="next" next="EndNode36"/>
  </nodes>
<!--@Location 8,30-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode36" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ValidationResult>"
        optional="true"/>
    <returnValues name="ConstraintViolations" type="java.util.Collection&lt;com.intershop.platform.property.capi.validation.ConstraintViolation>"
        optional="true"/>
  </nodes>
<!--The extension point is called right after the new payment data have been written to the payment instrument. It is part of the transaction.
@Location 6,29-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode13" name="UpdatedPaymentInstrument"
      strict="true">
    <nodeSuccessors name="next" next="EndNode35" action="commit"/>
<!--@BendPoints 14,59-->
    <nodeSuccessors name="pipelet_error" next="JoinNode27"/>
    <parameters name="PaymentInstrumentBO" type="com.intershop.component.payment.capi.PaymentInstrumentBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
  </nodes>
<!--@Location 6,30-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode35" strict="true"/>
<!--@Location 8,25-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode14">
    <nodeSuccessors name="next" next="JoinNode13"/>
  </nodes>
<!--@Location 8,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
    <nodeSuccessors name="next" next="JoinNode15"/>
  </nodes>
<!--@Location 1,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode5" strict="true" name="Validate"
      callMode="Private">
    <nodeSuccessors name="next" next="ValidatePayment0"/>
    <parameters name="PaymentServiceBO" type="com.intershop.component.payment.capi.PaymentServiceBO"/>
    <parameters name="PaymentParameters" type="java.util.Collection&lt;com.intershop.platform.property.capi.PropertyGroupValue>"/>
    <parameters name="PaymentInstrumentBORepository" type="com.intershop.component.payment.capi.PaymentInstrumentBORepository"
        optional="true"/>
  </nodes>
<!--@Location 1,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ValidatePayment0">
    <pipelet href="enfinity:/bc_payment/pipelets/ValidatePayment.xml"/>
    <nodeSuccessors name="next" next="EndNode4"/>
<!--@BendPoints 4,33 5,33-->
    <nodeSuccessors name="pipelet_error" next="EndNode22"/>
  </nodes>
<!--@Location 1,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode4" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ValidationResult>"/>
  </nodes>
<!--@Location 2,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode22" name="Error" strict="true">
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.ValidationResult>"/>
    <returnValues name="ConstraintViolations" type="java.util.Collection&lt;com.intershop.platform.property.capi.validation.ConstraintViolation>"/>
  </nodes>
</pipeline:Pipeline>
