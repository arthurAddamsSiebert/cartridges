<?xml version="1.0" encoding="UTF-8"?>
<!--This pipeline includes the main logic pipelines around address handling. 
@Group Checkout-->

<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessCheckoutAddresses" type="process">
<!--@Location 16,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode17" strict="true" name="AddAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode15"/>
    <parameters name="AddressForm" type="com.intershop.beehive.core.capi.webform.Form"/>
    <parameters name="addAndSelectAsBilling" type="java.lang.String" optional="true"/>
    <parameters name="AddressID" type="java.lang.String"/>
    <parameters name="CurrentCartBO" type="com.intershop.component.basket.capi.BasketBO"
        optional="true"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"
        optional="true"/>
    <parameters name="addAndSelectAsShipping" type="java.lang.String" optional="true"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"
        optional="true"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 16,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode15" conditionKey="addAndSelectAsBilling"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 33,6-->
    <nodeSuccessors name="decision_yes" next="CallNode33"/>
<!--@BendPoints 34,5 34,9-->
    <nodeSuccessors name="decision_no" next="JoinNode3"/>
  </nodes>
<!--@Location 16,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode33">
    <nodeSuccessors name="next" next="JoinNode3"/>
    <parameterBindings name="AddressID" objectPath="AddressID"/>
    <startNode referencedName="ProcessCheckoutAddresses-SetAsBillingAddress"/>
  </nodes>
<!--@Location 16,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
<!--@BendPoints 33,10-->
    <nodeSuccessors name="next" next="DecisionNode16"/>
  </nodes>
<!--@Location 16,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode16" conditionKey="addAndSelectAsShipping"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 33,12-->
    <nodeSuccessors name="decision_yes" next="CallNode34"/>
<!--@BendPoints 35,11-->
    <nodeSuccessors name="decision_no" next="JoinNode13"/>
  </nodes>
<!--@Location 16,6-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode34">
    <nodeSuccessors name="next" next="JoinNode4"/>
    <nodeSuccessors name="Error" next="JoinNode13"/>
    <parameterBindings name="AddressID" objectPath="AddressID"/>
    <startNode referencedName="ProcessCheckoutAddresses-SetAsShippingAddress"/>
  </nodes>
<!--@Location 16,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
    <nodeSuccessors name="next" next="KeyMapper6"/>
  </nodes>
<!--@Location 16,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper6">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode40"/>
    <parameterBindings name="InValue_1" objectPath="CurrentCartBO"/>
    <parameterBindings name="InValue_2" objectPath="ApplicationBO:Repository(&quot;ServiceConfigurationBORepository&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="AddressBORepository"/>
    <returnValueBindings name="OutValue_2" objectPath="ServiceConfigurationBORepository"/>
  </nodes>
<!--@Location 16,9-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode40">
    <nodeSuccessors name="next" next="EndNode28"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 16,10-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode28" strict="true">
    <returnValues name="Address" type="com.intershop.beehive.core.capi.profile.Address"
        optional="true"/>
    <returnValues name="AddressBORepository" type="com.intershop.component.address.capi.AddressBORepository"
        optional="true"/>
    <returnValues name="ServiceConfigurationBORepository" type="com.intershop.component.service.capi.service.ServiceConfigurationBORepository"
        optional="true"/>
  </nodes>
<!--@Location 17,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
<!--@BendPoints 35,15-->
    <nodeSuccessors name="next" next="JoinNode4"/>
  </nodes>
<!--@Location 20,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode16" name="AddressToBeCreated"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode0"/>
    <parameters name="UpdateAddressWebForm" type="com.intershop.beehive.core.capi.webform.Form"/>
  </nodes>
<!--Called before the address is created
@Location 20,12-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode0" name="AddressCreating"
      strict="true">
    <nodeSuccessors name="next" next="EndNode27"/>
    <parameters name="NewAddressForm" type="com.intershop.beehive.core.capi.webform.Form"/>
  </nodes>
<!--@Location 20,13-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode27"/>
<!--@Location 18,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode12" name="AddressToBeUpdated"
      callMode="Private">
    <nodeSuccessors name="next" next="ExtensionPointNode1"/>
    <parameters name="UpdateAddressWebForm" type="com.intershop.beehive.core.capi.webform.Form"/>
  </nodes>
<!--Called for the address is updated
@Location 18,12-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode1" name="AddressUpdating"
      strict="true">
    <nodeSuccessors name="next" next="EndNode21"/>
    <parameters name="UpdateAddressWebForm" type="com.intershop.beehive.core.capi.webform.Form"/>
  </nodes>
<!--@Location 18,13-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode21"/>
<!--@Location 5,40-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode5" strict="true" name="ApplyAddressSuggest"
      callMode="Include">
    <nodeSuccessors name="next" next="ResolveAddressFromBasket4"/>
<!--The address ID.-->
    <parameters name="AddressID" type="java.lang.String"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="AddressSuggestID" type="java.lang.String"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="ServiceConfigurationBORepository" type="com.intershop.component.service.capi.service.ServiceConfigurationBORepository"/>
    <parameters name="CurrentOrganization" type="com.intershop.component.organization.capi.Organization"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 5,41-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ResolveAddressFromBasket4">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/ResolveAddressFromBasket.xml"/>
    <nodeSuccessors name="next" next="GetAddressBO1"/>
    <nodeSuccessors name="pipelet_error" next="JumpNode3"/>
    <parameterBindings name="CurrentCartBO" objectPath="CartBO"/>
  </nodes>
<!--@Location 5,42-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAddressBO1">
    <pipelet href="enfinity:/bc_address/pipelets/GetAddressBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper10"/>
  </nodes>
<!--@Location 5,43-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper10">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode11"/>
    <parameterBindings name="InValue_1" objectPath="AddressBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="Address"/>
  </nodes>
<!--@Location 5,44-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode11">
    <nodeSuccessors name="next" next="UpdateAddressBO4"/>
    <nodeSuccessors name="error" next="EndNode14"/>
    <startNode referencedName="ProcessCheckoutAddresses-GetAddressSuggest"/>
  </nodes>
<!--@Location 5,45-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateAddressBO4">
    <configurationValues name="UpdateMissingProperties" value="false"/>
    <pipelet href="enfinity:/bc_address/pipelets/UpdateAddressBO.xml"/>
    <nodeSuccessors name="next" next="EndNode13"/>
    <parameterBindings name="Address1" objectPath="AddressSuggest:Street"/>
    <parameterBindings name="Address2" objectPath="AddressSuggest:Street2"/>
    <parameterBindings name="Address3" objectPath="AddressSuggest:Street3"/>
    <parameterBindings name="City" objectPath="AddressSuggest:City"/>
    <parameterBindings name="CountryCode" objectPath="AddressSuggest:CountryCode"/>
    <parameterBindings name="FirstName" objectPath="AddressSuggest:FirstName"/>
    <parameterBindings name="LastName" objectPath="AddressSuggest:LastName"/>
    <parameterBindings name="PostalCode" objectPath="AddressSuggest:PostalCode"/>
    <parameterBindings name="State" objectPath="AddressSuggest:State"/>
  </nodes>
<!--@Location 5,46-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode13" name="" strict="true"/>
<!--@Location 6,44-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode14" name="ERROR" strict="true"/>
<!--@Location 6,42-->
  <nodes xsi:type="pipeline:JumpNode" nodeID="JumpNode3">
    <startNode referencedName="Error-Page"/>
  </nodes>
<!--@padss
@Location 20,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode13" strict="true" name="CheckDefaultSettings"
      callMode="Private">
<!--@BendPoints 41,2-->
    <nodeSuccessors name="next" next="DecisionNode10"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 20,1-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode10" conditionKey="BasketBO:InvoiceToAddressBO">
    <nodeSuccessors name="decision_yes" next="CallNode0"/>
<!--@BendPoints 42,3-->
    <nodeSuccessors name="decision_no" next="SetDictionaryValue0"/>
  </nodes>
<!--@Location 20,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode0">
    <nodeSuccessors name="next" next="EndNode5"/>
    <nodeSuccessors name="ERROR" next="JoinNode7"/>
    <startNode referencedName="ProcessCheckoutAddresses-ValidateAddressSelection"/>
  </nodes>
<!--@Location 20,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode5" name="" strict="true"/>
<!--@Location 21,2-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
    <nodeSuccessors name="next" next="EndNode11"/>
  </nodes>
<!--@Location 21,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode11" name="ERROR" strict="true">
    <returnValues name="RestrictedItemsMap" type="java.util.Map" optional="true"/>
  </nodes>
<!--@Location 21,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue0">
    <configurationValues name="Name" value="ERROR_AddressSelection"/>
    <configurationValues name="Value" value="CartInvoiceToAddressNotSet"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/core/pipelets/SetDictionaryValue.xml"/>
    <nodeSuccessors name="next" next="JoinNode7"/>
  </nodes>
<!--@Location 0,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode7" strict="true" name="CreateInvoiceToAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper1"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="InvoiceToAddressForm" type="com.intershop.beehive.core.capi.webform.Form"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="Email" type="com.intershop.beehive.core.capi.webform.Form" optional="true"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 0,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper1">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode31"/>
    <parameterBindings name="InValue_1" objectPath="InvoiceToAddressForm"/>
    <returnValueBindings name="OutValue_1" objectPath="NewAddressForm"/>
  </nodes>
<!--@Location 0,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode31">
    <nodeSuccessors name="next" next="DecisionNode13"/>
    <startNode referencedName="This:AddressToBeCreated"/>
  </nodes>
<!--@Location 0,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode13" conditionKey="InvoiceToAddressForm:Title:Value"
      operator="str_empty">
<!--@BendPoints 3,7 3,11-->
    <nodeSuccessors name="decision_yes" next="JoinNode18"/>
    <nodeSuccessors name="decision_no" next="GetLocalizedTextByKey0"/>
  </nodes>
<!--@Location 0,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode18">
    <nodeSuccessors name="next" next="DecisionNode14"/>
  </nodes>
<!--@Location 0,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode14" conditionKey="Email">
    <nodeSuccessors name="decision_yes" next="KeyMapper9"/>
<!--@BendPoints 2,13 2,17-->
    <nodeSuccessors name="decision_no" next="JoinNode43"/>
  </nodes>
<!--@Location 0,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper9">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode43"/>
    <parameterBindings name="InValue_1" objectPath="Email:Email:Value"/>
    <returnValueBindings name="OutValue_1" objectPath="EmailAddress"/>
  </nodes>
<!--@Location 0,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode43">
    <nodeSuccessors name="next" next="CheckUserLoggedIn1"/>
  </nodes>
<!--@Location 0,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn1">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
    <nodeSuccessors name="next" next="CallNode1"/>
<!--@BendPoints 5,19-->
    <nodeSuccessors name="pipelet_error" next="CreateAddressBO4"/>
  </nodes>
<!--@Location 0,10-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
    <nodeSuccessors name="next" next="DecisionNode0"/>
    <startNode referencedName="ProcessUser-GetCurrentUserBOAndCustomerBO"/>
  </nodes>
<!--@Location 0,13-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode0" conditionKey="CustomerBO">
    <nodeSuccessors name="decision_yes" next="CreateAddressBO2"/>
    <nodeSuccessors name="decision_no" next="JoinNode0"/>
  </nodes>
<!--@Location 0,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateAddressBO2">
    <pipelet href="enfinity:/bc_address/pipelets/CreateAddressBO.xml"/>
    <nodeSuccessors name="next" next="SetInvoiceToAddress0"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode0"/>
    <parameterBindings name="AddressBORepository" objectPath="CustomerBO"/>
    <parameterBindings name="AddressLine1" objectPath="InvoiceToAddressForm:Address1:Value"/>
    <parameterBindings name="AddressLine2" objectPath="InvoiceToAddressForm:Address2:Value"/>
    <parameterBindings name="AddressLine3" objectPath="InvoiceToAddressForm:Address3:Value"/>
    <parameterBindings name="City" objectPath="InvoiceToAddressForm:City:Value"/>
    <parameterBindings name="CompanyName1" objectPath="InvoiceToAddressForm:CompanyName:Value"/>
    <parameterBindings name="CompanyName2" objectPath="InvoiceToAddressForm:CompanyName2:Value"/>
    <parameterBindings name="CountryCode" objectPath="InvoiceToAddressForm:CountryCode:Value"/>
    <parameterBindings name="EMail" objectPath="EmailAddress"/>
    <parameterBindings name="FirstName" objectPath="InvoiceToAddressForm:FirstName:Value"/>
    <parameterBindings name="InvoiceToAddress" constant="(Boolean)true"/>
    <parameterBindings name="LastName" objectPath="InvoiceToAddressForm:LastName:Value"/>
    <parameterBindings name="MainDivision" objectPath="InvoiceToAddressForm:State:Value"/>
    <parameterBindings name="PhoneHome" objectPath="InvoiceToAddressForm:PhoneHome:Value"/>
    <parameterBindings name="PostalCode" objectPath="InvoiceToAddressForm:PostalCode:Value"/>
    <parameterBindings name="ShipToAddress" constant="(Boolean)true"/>
    <parameterBindings name="Title" objectPath="LocalizedTitle"/>
    <returnValueBindings name="AddressBO" objectPath="InvoiceToAddressBO"/>
  </nodes>
<!--@Location 0,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetInvoiceToAddress0">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/SetInvoiceToAddress.xml"/>
    <nodeSuccessors name="next" next="CallNode16"/>
    <parameterBindings name="Basket" objectPath="CartBO"/>
    <parameterBindings name="InvoiceToAddress" objectPath="InvoiceToAddressBO"/>
  </nodes>
<!--@Location 0,17-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode16">
    <nodeSuccessors name="next" next="JoinNode1"/>
    <parameterBindings name="LineItemCtnr" objectPath="Cart"/>
    <parameterBindings name="MailTo" objectPath="CurrentUser:Profile:Email"/>
    <startNode referencedName="ProcessOrders-SetNotificationEMail"/>
  </nodes>
<!--@Location 0,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
    <nodeSuccessors name="next" next="KeyMapper7"/>
  </nodes>
<!--@Location 0,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper7">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode35"/>
    <parameterBindings name="InValue_1" objectPath="InvoiceToAddressBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="InvoiceToAddress"/>
  </nodes>
<!--@Location 0,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode35">
    <nodeSuccessors name="next" next="EndNode3"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 0,21-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode3" name="" strict="true">
    <returnValues name="InvoiceToAddress" type="com.intershop.beehive.core.capi.profile.Address"/>
    <returnValues name="InvoiceToAddressBO" type="com.intershop.component.address.capi.AddressBO"/>
    <returnValues name="AddressCreationResult" type="com.intershop.component.address.capi.handler.AddressCreationResult"/>
  </nodes>
<!--@Location 1,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode0">
    <nodeSuccessors name="next" next="EndNode8"/>
  </nodes>
<!--@Location 1,21-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode8" name="Error" strict="true">
    <returnValues name="InvoiceToAddressBO" type="com.intershop.component.address.capi.AddressBO"
        optional="true"/>
    <returnValues name="AddressCreationResult" type="com.intershop.component.address.capi.handler.AddressCreationResult"/>
  </nodes>
<!--@Location 2,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateAddressBO4">
    <pipelet href="enfinity:/bc_address/pipelets/CreateAddressBO.xml"/>
    <nodeSuccessors name="next" next="SetInvoiceToAddress2"/>
<!--@BendPoints 3,21-->
    <nodeSuccessors name="pipelet_error" next="JoinNode0"/>
    <parameterBindings name="AddressBORepository" objectPath="CartBO"/>
    <parameterBindings name="AddressLine1" objectPath="InvoiceToAddressForm:Address1:Value"/>
    <parameterBindings name="AddressLine2" objectPath="InvoiceToAddressForm:Address2:Value"/>
    <parameterBindings name="AddressLine3" objectPath="InvoiceToAddressForm:Address3:Value"/>
    <parameterBindings name="City" objectPath="InvoiceToAddressForm:City:Value"/>
    <parameterBindings name="CompanyName1" objectPath="InvoiceToAddressForm:CompanyName:Value"/>
    <parameterBindings name="CompanyName2" objectPath="InvoiceToAddressForm:CompanyName2:Value"/>
    <parameterBindings name="CountryCode" objectPath="InvoiceToAddressForm:CountryCode:Value"/>
    <parameterBindings name="EMail" objectPath="EmailAddress"/>
    <parameterBindings name="FirstName" objectPath="InvoiceToAddressForm:FirstName:Value"/>
    <parameterBindings name="InvoiceToAddress" constant="(Boolean)true"/>
    <parameterBindings name="LastName" objectPath="InvoiceToAddressForm:LastName:Value"/>
    <parameterBindings name="MainDivision" objectPath="InvoiceToAddressForm:State:Value"/>
    <parameterBindings name="PhoneHome" objectPath="InvoiceToAddressForm:PhoneHome:Value"/>
    <parameterBindings name="PostalCode" objectPath="InvoiceToAddressForm:PostalCode:Value"/>
    <parameterBindings name="ShipToAddress" constant="(Boolean)true"/>
    <parameterBindings name="Title" objectPath="LocalizedTitle"/>
    <returnValueBindings name="AddressBO" objectPath="InvoiceToAddressBO"/>
  </nodes>
<!--@Location 2,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetInvoiceToAddress2">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/SetInvoiceToAddress.xml"/>
    <nodeSuccessors name="next" next="DecisionNode21"/>
    <parameterBindings name="Basket" objectPath="CartBO"/>
    <parameterBindings name="InvoiceToAddress" objectPath="InvoiceToAddressBO"/>
  </nodes>
<!--@Location 2,14-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode21" conditionKey="EmailAddress">
    <nodeSuccessors name="decision_yes" next="CallNode2"/>
<!--@BendPoints 6,29 6,33-->
    <nodeSuccessors name="decision_no" next="JoinNode24"/>
  </nodes>
<!--@Location 2,15-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode2">
    <nodeSuccessors name="next" next="JoinNode24"/>
    <parameterBindings name="LineItemCtnr" objectPath="Cart"/>
    <parameterBindings name="MailTo" objectPath="EmailAddress"/>
    <startNode referencedName="ProcessOrders-SetNotificationEMail"/>
  </nodes>
<!--@Location 2,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode24">
<!--@BendPoints 5,37-->
    <nodeSuccessors name="next" next="JoinNode1"/>
  </nodes>
<!--@Location 0,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetLocalizedTextByKey0">
    <pipelet href="enfinity:/core/pipelets/GetLocalizedTextByKey.xml"/>
    <nodeSuccessors name="next" next="JoinNode18"/>
<!--@BendPoints 2,9 2,11-->
    <nodeSuccessors name="pipelet_error" next="JoinNode18"/>
    <parameterBindings name="Key" objectPath="InvoiceToAddressForm:Title:Value"/>
    <returnValueBindings name="LocalizedText" objectPath="LocalizedTitle"/>
  </nodes>
<!--@Location 3,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode6" strict="true" name="CreateShipToAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper5"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="ShipToAddressForm" type="com.intershop.beehive.core.capi.webform.Form"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 3,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper5">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode32"/>
    <parameterBindings name="InValue_1" objectPath="ShipToAddressForm"/>
    <returnValueBindings name="OutValue_1" objectPath="NewAddressForm"/>
  </nodes>
<!--@Location 3,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode32">
    <nodeSuccessors name="next" next="DecisionNode20"/>
    <startNode referencedName="This:AddressToBeCreated"/>
  </nodes>
<!--@Location 3,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode20" conditionKey="ShipToAddressForm:Title:Value"
      operator="str_empty">
<!--@BendPoints 9,7 9,11-->
    <nodeSuccessors name="decision_yes" next="JoinNode42"/>
    <nodeSuccessors name="decision_no" next="GetLocalizedTextByKey3"/>
  </nodes>
<!--@Location 3,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode42">
    <nodeSuccessors name="next" next="CheckUserLoggedIn5"/>
  </nodes>
<!--@Location 3,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn5">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
<!--@BendPoints 7,14-->
    <nodeSuccessors name="next" next="GetDomainPreference1"/>
<!--@BendPoints 9,13-->
    <nodeSuccessors name="pipelet_error" next="CreateAddressBO0"/>
  </nodes>
<!--@Location 3,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetDomainPreference1">
    <configurationValues name="DefaultPreferenceKey" value="UserRegistrationUseSimpleAccount"/>
    <configurationValues name="Type" value="String"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetDomainPreference.xml"/>
    <nodeSuccessors name="next" next="JoinNode35"/>
<!--@BendPoints 8,15 8,17-->
    <nodeSuccessors name="pipelet_error" next="JoinNode35"/>
    <parameterBindings name="PreferenceDomain" objectPath="CurrentDomain"/>
    <parameterBindings name="PreferenceKey" nullBinding="true"/>
    <returnValueBindings name="PreferenceStringValue" objectPath="UseSimpleAccount"/>
  </nodes>
<!--@Location 3,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode35">
    <nodeSuccessors name="next" next="CallNode17"/>
  </nodes>
<!--@Location 3,9-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode17">
    <nodeSuccessors name="next" next="GetUserBO2"/>
<!--@BendPoints 8,19 8,21 8,23 8,25-->
    <nodeSuccessors name="ERROR" next="JoinNode26"/>
    <startNode referencedName="This:GetProfile"/>
  </nodes>
<!--@Location 3,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserBO2">
    <pipelet href="enfinity:/bc_user/pipelets/GetUserBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper11"/>
    <parameterBindings name="UserID" objectPath="Profile:ProfileID"/>
  </nodes>
<!--@Location 3,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper11">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CreateAddressBO3"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;Customer&quot;):CustomerBO"/>
    <returnValueBindings name="OutValue_1" objectPath="CustomerBO"/>
  </nodes>
<!--@Location 3,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateAddressBO3">
    <pipelet href="enfinity:/bc_address/pipelets/CreateAddressBO.xml"/>
    <nodeSuccessors name="next" next="SetCommonShipToAddress0"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode11"/>
    <parameterBindings name="AddressBORepository" objectPath="CustomerBO"/>
    <parameterBindings name="AddressLine1" objectPath="ShipToAddressForm:Address1:Value"/>
    <parameterBindings name="AddressLine2" objectPath="ShipToAddressForm:Address2:Value"/>
    <parameterBindings name="AddressLine3" objectPath="ShipToAddressForm:Address3:Value"/>
    <parameterBindings name="City" objectPath="ShipToAddressForm:City:Value"/>
    <parameterBindings name="CompanyName1" objectPath="ShipToAddressForm:CompanyName:Value"/>
    <parameterBindings name="CompanyName2" objectPath="ShipToAddressForm:CompanyName2:Value"/>
    <parameterBindings name="CountryCode" objectPath="ShipToAddressForm:CountryCode:Value"/>
    <parameterBindings name="EMail" objectPath="EmailAddress"/>
    <parameterBindings name="FirstName" objectPath="ShipToAddressForm:FirstName:Value"/>
    <parameterBindings name="InvoiceToAddress" constant="(Boolean)true"/>
    <parameterBindings name="LastName" objectPath="ShipToAddressForm:LastName:Value"/>
    <parameterBindings name="MainDivision" objectPath="ShipToAddressForm:State:Value"/>
    <parameterBindings name="PhoneHome" objectPath="ShipToAddressForm:PhoneHome:Value"/>
    <parameterBindings name="PostalCode" objectPath="ShipToAddressForm:PostalCode:Value"/>
    <parameterBindings name="ShipToAddress" constant="(Boolean)true"/>
    <parameterBindings name="Title" objectPath="LocalizedTitle"/>
    <returnValueBindings name="AddressBO" objectPath="ShipToAddressBO"/>
  </nodes>
<!--@Location 3,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetCommonShipToAddress0">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/SetCommonShipToAddress.xml"/>
    <nodeSuccessors name="next" next="JoinNode9"/>
    <parameterBindings name="Basket" objectPath="CartBO"/>
    <parameterBindings name="ShipToAddress" objectPath="ShipToAddressBO"/>
  </nodes>
<!--@Location 3,15-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
    <nodeSuccessors name="next" next="CallNode36"/>
  </nodes>
<!--@Location 3,16-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode36">
    <nodeSuccessors name="next" next="EndNode2"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 3,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" name="" strict="true">
    <returnValues name="ShipToAddress" type="com.intershop.beehive.core.capi.profile.Address"/>
    <returnValues name="ShipToAddressBO" type="com.intershop.component.address.capi.AddressBO"/>
    <returnValues name="AddressCreationResult" type="com.intershop.component.address.capi.handler.AddressCreationResult"/>
  </nodes>
<!--@Location 5,13-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
    <nodeSuccessors name="next" next="EndNode10"/>
  </nodes>
<!--@Location 5,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode10" name="Error" strict="true">
    <returnValues name="ShipToAddressBO" type="com.intershop.component.address.capi.AddressBO"
        optional="true"/>
    <returnValues name="AddressCreationResult" type="com.intershop.component.address.capi.handler.AddressCreationResult"/>
  </nodes>
<!--@Location 4,12-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode26">
<!--@BendPoints 9,31-->
    <nodeSuccessors name="next" next="JoinNode9"/>
  </nodes>
<!--@Location 4,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateAddressBO0">
    <pipelet href="enfinity:/bc_address/pipelets/CreateAddressBO.xml"/>
    <nodeSuccessors name="next" next="SetCommonShipToAddress1"/>
<!--@BendPoints 11,15-->
    <nodeSuccessors name="pipelet_error" next="JoinNode11"/>
    <parameterBindings name="AddressBORepository" objectPath="CartBO"/>
    <parameterBindings name="AddressLine1" objectPath="ShipToAddressForm:Address1:Value"/>
    <parameterBindings name="AddressLine2" objectPath="ShipToAddressForm:Address2:Value"/>
    <parameterBindings name="AddressLine3" objectPath="ShipToAddressForm:Address3:Value"/>
    <parameterBindings name="City" objectPath="ShipToAddressForm:City:Value"/>
    <parameterBindings name="CompanyName1" objectPath="ShipToAddressForm:CompanyName:Value"/>
    <parameterBindings name="CompanyName2" objectPath="ShipToAddressForm:CompanyName2:Value"/>
    <parameterBindings name="CountryCode" objectPath="ShipToAddressForm:CountryCode:Value"/>
    <parameterBindings name="EMail" objectPath="EmailAddress"/>
    <parameterBindings name="FirstName" objectPath="ShipToAddressForm:FirstName:Value"/>
    <parameterBindings name="InvoiceToAddress" constant="(Boolean)true"/>
    <parameterBindings name="LastName" objectPath="ShipToAddressForm:LastName:Value"/>
    <parameterBindings name="MainDivision" objectPath="ShipToAddressForm:State:Value"/>
    <parameterBindings name="PhoneHome" objectPath="ShipToAddressForm:PhoneHome:Value"/>
    <parameterBindings name="PostalCode" objectPath="ShipToAddressForm:PostalCode:Value"/>
    <parameterBindings name="ShipToAddress" constant="(Boolean)true"/>
    <parameterBindings name="Title" objectPath="LocalizedTitle"/>
    <returnValueBindings name="AddressBO" objectPath="ShipToAddressBO"/>
  </nodes>
<!--@Location 4,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetCommonShipToAddress1">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/SetCommonShipToAddress.xml"/>
    <nodeSuccessors name="next" next="KeyMapper2"/>
    <parameterBindings name="Basket" objectPath="CartBO"/>
    <parameterBindings name="ShipToAddress" objectPath="ShipToAddressBO"/>
  </nodes>
<!--@Location 4,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper2">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode26"/>
    <parameterBindings name="InValue_1" objectPath="ShipToAddressBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="ShipToAddress"/>
  </nodes>
<!--@Location 3,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetLocalizedTextByKey3">
    <pipelet href="enfinity:/core/pipelets/GetLocalizedTextByKey.xml"/>
    <nodeSuccessors name="next" next="JoinNode42"/>
<!--@BendPoints 8,9 8,11-->
    <nodeSuccessors name="pipelet_error" next="JoinNode42"/>
    <parameterBindings name="Key" objectPath="ShipToAddressForm:Title:Value"/>
    <returnValueBindings name="LocalizedText" objectPath="LocalizedTitle"/>
  </nodes>
<!--@padss
@Location 18,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode15" strict="true" name="DefaultSettings"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode9"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 18,1-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode9">
<!--@BendPoints 37,5-->
    <nodeSuccessors name="next" next="JoinNode19"/>
<!--@BendPoints 38,3 38,7-->
    <nodeSuccessors name="ERROR" next="JoinNode19"/>
    <startNode referencedName="ProcessCheckoutAddresses-CheckDefaultSettings"/>
  </nodes>
<!--@Location 18,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode19">
<!--@BendPoints 37,8-->
    <nodeSuccessors name="next" next="EndNode25"/>
  </nodes>
<!--@Location 18,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode25" name="" strict="true"/>
<!--@Location 6,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="DeleteAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="ResolveAddressBO3"/>
<!--The address ID.-->
    <parameters name="AddressID" type="java.lang.String"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
    <parameters name="CurrentCartBO" type="com.intershop.component.basket.capi.BasketBO"
        optional="true"/>
  </nodes>
<!--@Location 6,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ResolveAddressBO3">
    <pipelet href="enfinity:/bc_address/pipelets/ResolveAddressBO.xml"/>
    <nodeSuccessors name="next" next="DeleteAddressBO0"/>
    <nodeSuccessors name="pipelet_error" next="EndNode4"/>
    <parameterBindings name="AddressURN" objectPath="AddressID"/>
  </nodes>
<!--@Location 6,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeleteAddressBO0">
    <pipelet href="enfinity:/bc_address/pipelets/DeleteAddressBO.xml"/>
    <nodeSuccessors name="next" next="CallNode38"/>
    <nodeSuccessors name="pipelet_error" next="EndNode4"/>
  </nodes>
<!--@Location 6,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode38">
    <nodeSuccessors name="next" next="EndNode1"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 6,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" name="" strict="true">
    <returnValues name="AddressDeletionResult" type="com.intershop.component.address.capi.handler.AddressDeletionResult"/>
  </nodes>
<!--@Location 7,1-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode4" name="ERROR" strict="true">
    <returnValues name="AddressDeletionResult" type="com.intershop.component.address.capi.handler.AddressDeletionResult"
        optional="true"/>
  </nodes>
<!--@Location 0,40-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode23" strict="true" name="EmailOptInt"
      callMode="Private">
<!--@BendPoints 1,82-->
    <nodeSuccessors name="next" next="DecisionNode11"/>
    <parameters name="BasketEmailOptIn" type="java.lang.String"/>
    <parameters name="EmailAddress" type="com.intershop.beehive.core.capi.webform.Form"/>
    <parameters name="CurrentDomain" type="com.intershop.beehive.core.internal.domain.DomainPO"/>
  </nodes>
<!--@Location 0,41-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode11" conditionKey="BasketEmailOptIn"
      operator="str_eq" conditionValue="yes">
    <nodeSuccessors name="decision_yes" next="JoinNode28"/>
<!--@BendPoints 3,83 3,84-->
    <nodeSuccessors name="decision_no" next="DecisionNode9"/>
  </nodes>
<!--@Location 0,43-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode28">
<!--@BendPoints 1,88-->
    <nodeSuccessors name="next" next="CallNode55"/>
  </nodes>
<!--@Location 0,44-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode55">
    <nodeSuccessors name="next" next="JoinNode29"/>
    <parameterBindings name="Domain" objectPath="CurrentDomain"/>
    <parameterBindings name="Email" objectPath="EmailAddress:Email:Value"/>
    <startNode referencedName="ProcessNewsletter-Subscribe"/>
  </nodes>
<!--@Location 0,45-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode29">
<!--@BendPoints 1,92-->
    <nodeSuccessors name="next" next="EndNode6"/>
  </nodes>
<!--@Location 0,46-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode6" name="" strict="true"/>
<!--@Location 1,42-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode9" conditionKey="EmailAddress:Newsletter:FormattedValue"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 3,87-->
    <nodeSuccessors name="decision_yes" next="JoinNode28"/>
<!--@BendPoints 4,85 4,91-->
    <nodeSuccessors name="decision_no" next="JoinNode29"/>
  </nodes>
<!--@Location 0,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode11" strict="true" name="GenerateAddressWebFormForAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="AddEntryToMap0"/>
    <parameters name="Address" type="com.intershop.beehive.core.capi.profile.Address"/>
  </nodes>
<!--@Location 0,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddEntryToMap0">
    <pipelet href="enfinity:/core/pipelets/AddEntryToMap.xml"/>
    <nodeSuccessors name="next" next="CallNode10"/>
    <parameterBindings name="Key" constant="BirthdayForm"/>
    <parameterBindings name="Value" constant="AddressBirthday"/>
    <returnValueBindings name="Keys" nullBinding="true"/>
    <returnValueBindings name="OutMap" objectPath="FormExtensions"/>
  </nodes>
<!--@Location 0,24-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode10">
<!--@BendPoints 1,50-->
    <nodeSuccessors name="next" next="EndNode18"/>
    <parameterBindings name="ConfigurationPrefix" constant="WebFormSelectorSuffix"/>
    <parameterBindings name="CountryCode" objectPath="Address:CountryCode"/>
    <parameterBindings name="FormName" constant="address"/>
    <parameterBindings name="WebformPrefix" constant="Address"/>
    <startNode referencedName="ProcessWebforms-CreateCountrySpecificForm"/>
  </nodes>
<!--@Location 0,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode18" name="" strict="true">
    <returnValues name="Form" type="com.intershop.beehive.core.capi.webform.Form"/>
    <returnValues name="WebFormFileName" type="java.lang.String"/>
  </nodes>
<!--@Location 9,41-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode8" strict="true" name="GetAddressSuggest"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicationBO0"/>
    <parameters name="Address" type="com.intershop.beehive.core.capi.profile.Address"/>
    <parameters name="AddressSuggestID" type="java.lang.String"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="ServiceConfigurationBORepository" type="com.intershop.component.service.capi.service.ServiceConfigurationBORepository"/>
    <parameters name="CurrentOrganization" type="com.intershop.component.organization.capi.Organization"/>
  </nodes>
<!--@Location 9,42-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO0">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="GetUserBO0"/>
  </nodes>
<!--@Location 9,43-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserBO0">
    <pipelet href="enfinity:/bc_user/pipelets/GetUserBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper0"/>
    <parameterBindings name="UserBORepository" objectPath="ApplicationBO:Repository(&quot;UserBORepository&quot;)"/>
    <parameterBindings name="UserID" objectPath="CurrentUser:ID"/>
  </nodes>
<!--@Location 9,44-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper0">
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetAddressBO0"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;UserBOTempAddressStorageExtension&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="UserBOTempAddressStorage"/>
  </nodes>
<!--@Location 9,45-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAddressBO0">
    <pipelet href="enfinity:/bc_address/pipelets/GetAddressBO.xml"/>
    <nodeSuccessors name="next" next="EndNode22"/>
    <nodeSuccessors name="pipelet_error" next="EndNode26"/>
    <parameterBindings name="AddressBORepository" objectPath="UserBOTempAddressStorage"/>
    <parameterBindings name="AddressID" objectPath="AddressSuggestID"/>
    <returnValueBindings name="AddressBO" objectPath="AddressSuggest"/>
  </nodes>
<!--@Location 9,46-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode22" name="" strict="true">
    <returnValues name="AddressSuggest" type="com.intershop.component.address.capi.AddressBO"/>
  </nodes>
<!--@Location 10,45-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode26" name="error" strict="true"/>
<!--Ensures that the basket business object
@Location 31,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode18" strict="true" visibility="Private"
      name="GetCartBO" callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode17"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"
        optional="true"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"
        optional="true"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 31,1-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode17" conditionKey="CartBO">
    <nodeSuccessors name="decision_yes" next="JoinNode41"/>
<!--@BendPoints 65,3-->
    <nodeSuccessors name="decision_no" next="DecisionNode19"/>
  </nodes>
<!--@Location 31,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode41">
    <nodeSuccessors name="next" next="EndNode29"/>
  </nodes>
<!--@Location 31,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode29" strict="true">
    <returnValues name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 32,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode19" conditionKey="ApplicationBO">
<!--@BendPoints 65,6-->
    <nodeSuccessors name="decision_yes" next="JoinNode40"/>
    <nodeSuccessors name="decision_no" next="GetApplicationBO1"/>
  </nodes>
<!--@Location 32,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode40">
    <nodeSuccessors name="next" next="GetBasketBO0"/>
  </nodes>
<!--@Location 32,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBO0">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBO.xml"/>
    <nodeSuccessors name="next" next="JoinNode41"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="BasketBORepository" objectPath="ApplicationBO:Extension(&quot;Basket&quot;):getBasketBORepository(Cart)"/>
    <returnValueBindings name="BasketBO" objectPath="CartBO"/>
  </nodes>
<!--@Location 33,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO1">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
<!--@BendPoints 67,7-->
    <nodeSuccessors name="next" next="JoinNode40"/>
  </nodes>
<!--@Location 15,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode22" strict="true" name="GetLoginForm"
      callMode="Private">
<!--@BendPoints 31,46-->
    <nodeSuccessors name="next" next="CreateForm6"/>
<!--The site context-->
    <parameters name="CurrentDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 15,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateForm6">
    <configurationValues name="FormName" value="ShopLoginForm"/>
    <configurationValues name="FormResource" value="LoginUser"/>
    <pipelet href="enfinity:/core/pipelets/CreateForm.xml"/>
<!--@BendPoints 31,48-->
    <nodeSuccessors name="next" next="EndNode17"/>
    <returnValueBindings name="Form" objectPath="LoginForm"/>
  </nodes>
<!--@Location 15,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode17" name="" strict="true">
    <returnValues name="LoginForm" type="com.intershop.beehive.core.capi.webform.Form"/>
  </nodes>
<!--@Location 29,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode0" strict="true" name="GetProfile"
      callMode="Private">
    <nodeSuccessors name="next" next="CheckUserLoggedIn0"/>
<!--The current user.-->
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 29,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn0">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
    <nodeSuccessors name="next" next="GetCustomerBOByUserID2"/>
<!--@BendPoints 61,3-->
    <nodeSuccessors name="pipelet_error" next="KeyMapper3"/>
  </nodes>
<!--@Location 29,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCustomerBOByUserID2">
    <pipelet href="enfinity:/bc_customer/pipelets/GetCustomerBOByUserID.xml"/>
    <nodeSuccessors name="next" next="GetProfile0"/>
<!--@BendPoints 57,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode33"/>
    <parameterBindings name="UserID" objectPath="CurrentUser:ID"/>
  </nodes>
<!--@Location 29,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetProfile0">
    <pipelet href="enfinity:/core/pipelets/GetProfile.xml"/>
    <nodeSuccessors name="next" next="JoinNode32"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode33"/>
    <parameterBindings name="ProfileID" objectPath="CustomerBO:CustomerBOProfileID"/>
  </nodes>
<!--@Location 29,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode32">
    <nodeSuccessors name="next" next="EndNode0"/>
  </nodes>
<!--@Location 29,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode0" strict="true">
<!--The profile of the customer if the current user is logged in otherwise return his profile.-->
    <returnValues name="Profile" type="com.intershop.beehive.core.capi.profile.Profile"/>
<!--The customer object for the given user.-->
    <returnValues name="CustomerBO" type="com.intershop.component.customer.capi.CustomerBO"
        optional="true"/>
  </nodes>
<!--@Location 28,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode33">
    <nodeSuccessors name="next" next="EndNode20"/>
  </nodes>
<!--@Location 28,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode20" name="ERROR" strict="true"/>
<!--@Location 30,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper3">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
<!--@BendPoints 61,9-->
    <nodeSuccessors name="next" next="JoinNode32"/>
    <parameterBindings name="InValue_1" objectPath="CurrentUser:Profile"/>
    <returnValueBindings name="OutValue_1" objectPath="Profile"/>
  </nodes>
<!--@Location 18,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode14" strict="true" name="GetRegistrationForm"
      callMode="Private">
<!--@BendPoints 37,46-->
    <nodeSuccessors name="next" next="CallNode43"/>
<!--The site context-->
    <parameters name="CurrentDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 18,23-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode43">
<!--@BendPoints 39,48-->
    <nodeSuccessors name="next" next="CreateForm3"/>
<!--@BendPoints 37,48-->
    <nodeSuccessors name="LOGINISEMAIL" next="CreateForm4"/>
    <startNode referencedName="ProcessUserAccount-GetLoginType"/>
  </nodes>
<!--@Location 19,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateForm3">
    <configurationValues name="FormName" value="RegisterUserUsernameForm"/>
    <configurationValues name="FormResource" value="RegisterUser"/>
    <pipelet href="enfinity:/core/pipelets/CreateForm.xml"/>
<!--@BendPoints 39,50-->
    <nodeSuccessors name="next" next="JoinNode14"/>
    <returnValueBindings name="Form" objectPath="RegisterUserForm"/>
  </nodes>
<!--@Location 18,25-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode14">
<!--@BendPoints 37,52-->
    <nodeSuccessors name="next" next="EndNode19"/>
  </nodes>
<!--@Location 18,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode19" name="" strict="true">
    <returnValues name="RegisterUserForm" type="com.intershop.beehive.core.capi.webform.Form"/>
  </nodes>
<!--@Location 18,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateForm4">
    <configurationValues name="FormName" value="PostCheckoutRegisterForm"/>
    <configurationValues name="FormResource" value="RegisterUser"/>
    <pipelet href="enfinity:/core/pipelets/CreateForm.xml"/>
    <nodeSuccessors name="next" next="JoinNode14"/>
    <returnValueBindings name="Form" objectPath="RegisterUserForm"/>
  </nodes>
<!--@Location 2,21-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode9" strict="true" name="SetAsBillingAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicationBO3"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"
        optional="true"/>
    <parameters name="AddressID" type="java.lang.String"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 2,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO3">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="GetBasketBO2"/>
  </nodes>
<!--@Location 2,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBO2">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBO.xml"/>
    <nodeSuccessors name="next" next="ResolveAddressBO1"/>
    <parameterBindings name="Basket" objectPath="CurrentCart"/>
    <parameterBindings name="BasketBORepository" objectPath="ApplicationBO:Extension(&quot;Basket&quot;):getBasketBORepository(CurrentDomain)"/>
  </nodes>
<!--@Location 2,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ResolveAddressBO1">
    <pipelet href="enfinity:/bc_address/pipelets/ResolveAddressBO.xml"/>
    <nodeSuccessors name="next" next="SetInvoiceToAddress1"/>
    <nodeSuccessors name="pipelet_error" next="JumpNode1"/>
    <parameterBindings name="AddressURN" objectPath="AddressID"/>
  </nodes>
<!--@Location 2,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetInvoiceToAddress1">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/SetInvoiceToAddress.xml"/>
    <nodeSuccessors name="next" next="CallNode41"/>
    <parameterBindings name="Basket" objectPath="BasketBO"/>
    <parameterBindings name="InvoiceToAddress" objectPath="AddressBO"/>
  </nodes>
<!--@Location 2,26-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode41">
    <nodeSuccessors name="next" next="EndNode15"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 2,27-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode15" name="" strict="true">
    <returnValues name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 3,25-->
  <nodes xsi:type="pipeline:JumpNode" nodeID="JumpNode1">
    <startNode referencedName="Error-Page"/>
  </nodes>
<!--@Location 5,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode3" strict="true" name="SetAsShippingAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="GetBasketBO1"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
<!--The address which will be set as ship\-to address.-->
    <parameters name="AddressID" type="java.lang.String"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
<!--The current application the basket is used in.-->
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
<!--This flag controls if the shipping address will be updated if it has already been set. If set to true, the shipping address will always be updated. If set to false, the shipping address will only be updated if has not been set yet. Defaults to true.-->
    <parameters name="OverrideShippingAddress" type="java.lang.Boolean" optional="true"/>
  </nodes>
<!--@Location 5,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBO1">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBO.xml"/>
    <nodeSuccessors name="next" next="ResolveAddressBO0"/>
    <parameterBindings name="Basket" objectPath="CurrentCart"/>
    <parameterBindings name="BasketBORepository" objectPath="ApplicationBO:Extension(&quot;Basket&quot;):getBasketBORepository(CurrentCart)"/>
    <returnValueBindings name="BasketBO" objectPath="Basket"/>
  </nodes>
<!--@Location 5,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ResolveAddressBO0">
    <pipelet href="enfinity:/bc_address/pipelets/ResolveAddressBO.xml"/>
    <nodeSuccessors name="next" next="StartSafeChangesBlock0"/>
<!--@BendPoints 14,49 14,59-->
    <nodeSuccessors name="pipelet_error" next="JoinNode2"/>
    <parameterBindings name="AddressURN" objectPath="AddressID"/>
  </nodes>
<!--@Location 5,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="StartSafeChangesBlock0">
    <pipelet href="enfinity:/core/pipelets/StartSafeChangesBlock.xml"/>
    <nodeSuccessors name="next" next="UpdateShipToAddress0" action="begin"/>
  </nodes>
<!--@Location 5,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateShipToAddress0">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/UpdateShipToAddress.xml"/>
    <nodeSuccessors name="next" next="SetDefaultShippingMethod0"/>
<!--@BendPoints 13,53-->
    <nodeSuccessors name="pipelet_error" next="EndSafeChangesBlock1" action="rollback"/>
  </nodes>
<!--@Location 5,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDefaultShippingMethod0">
    <pipelet href="enfinity:/bc_shipping/pipelets/SetDefaultShippingMethod.xml"/>
    <nodeSuccessors name="next" next="EndSafeChangesBlock0" action="commit"/>
    <parameterBindings name="Basket" objectPath="CurrentCart"/>
  </nodes>
<!--@Location 5,28-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="EndSafeChangesBlock0">
    <pipelet href="enfinity:/core/pipelets/EndSafeChangesBlock.xml"/>
    <nodeSuccessors name="next" next="CallNode42"/>
  </nodes>
<!--@Location 5,29-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode42">
    <nodeSuccessors name="next" next="EndNode9"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 5,30-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode9" name="" strict="true">
    <returnValues name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 6,28-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="EndSafeChangesBlock1">
    <pipelet href="enfinity:/core/pipelets/EndSafeChangesBlock.xml"/>
    <nodeSuccessors name="next" next="JoinNode2"/>
  </nodes>
<!--@Location 6,29-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
    <nodeSuccessors name="next" next="EndNode16"/>
  </nodes>
<!--@Location 6,30-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode16" name="Error" strict="true">
    <returnValues name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 10,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode2" strict="true" name="UpdateAddress"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicationBO2"/>
<!--The address ID.-->
    <parameters name="AddressID" type="java.lang.String"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
<!--Use as service to address (set if key is present in dictionary/form values).-->
    <parameters name="UpdateAddressWebForm" type="com.intershop.beehive.core.capi.webform.Form"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="EditShippingAddress" type="java.lang.String" optional="true"/>
    <parameters name="EditBillingAddress" type="java.lang.String" optional="true"/>
<!--The customer repository in which this customer is.-->
    <parameters name="CustomerBORepository" type="com.intershop.component.customer.capi.CustomerBORepository"/>
<!--The user repository in which this user is.-->
    <parameters name="UserBORepository" type="com.intershop.component.user.capi.UserBORepository"/>
  </nodes>
<!--@Location 10,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO2">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="GetBasketBO3"/>
  </nodes>
<!--@Location 10,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBO3">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBO.xml"/>
    <nodeSuccessors name="next" next="ResolveAddressBO2"/>
    <parameterBindings name="Basket" objectPath="CurrentCart"/>
    <parameterBindings name="BasketBORepository" objectPath="ApplicationBO:Extension(&quot;Basket&quot;):getBasketBORepository(CurrentCart)"/>
    <returnValueBindings name="BasketBO" objectPath="Basket"/>
  </nodes>
<!--@Location 10,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ResolveAddressBO2">
    <pipelet href="enfinity:/bc_address/pipelets/ResolveAddressBO.xml"/>
    <nodeSuccessors name="next" next="DecisionNode8"/>
    <nodeSuccessors name="pipelet_error" next="JumpNode20"/>
    <parameterBindings name="AddressURN" objectPath="AddressID"/>
  </nodes>
<!--@Location 10,4-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode8" conditionKey="UpdateAddressWebForm:Title:Value"
      operator="str_empty">
    <nodeSuccessors name="decision_yes" next="JoinNode22"/>
<!--@BendPoints 23,9-->
    <nodeSuccessors name="decision_no" next="GetLocalizedTextByKey2"/>
  </nodes>
<!--@Location 10,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode22">
    <nodeSuccessors name="next" next="CallNode30"/>
  </nodes>
<!--@Location 10,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode30">
    <nodeSuccessors name="next" next="UpdateAddressBO5"/>
    <startNode referencedName="This:AddressToBeUpdated"/>
  </nodes>
<!--@Location 10,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateAddressBO5">
    <pipelet href="enfinity:/bc_address/pipelets/UpdateAddressBO.xml"/>
    <nodeSuccessors name="next" next="CheckUserLoggedIn6"/>
<!--@BendPoints 24,17 24,29-->
    <nodeSuccessors name="pipelet_error" next="JoinNode_dJ7uYAzKEeiB8ffK-OuaUA"/>
    <parameterBindings name="Address1" objectPath="UpdateAddressWebForm:Address1:Value"/>
    <parameterBindings name="Address2" objectPath="UpdateAddressWebForm:Address2:Value"/>
    <parameterBindings name="Address3" objectPath="UpdateAddressWebForm:Address3:Value"/>
    <parameterBindings name="City" objectPath="UpdateAddressWebForm:City:Value"/>
    <parameterBindings name="CompanyName" objectPath="UpdateAddressWebForm:CompanyName:Value"/>
    <parameterBindings name="CompanyName2" objectPath="UpdateAddressWebForm:CompanyName2:Value"/>
    <parameterBindings name="CountryCode" objectPath="UpdateAddressWebForm:CountryCode:Value"/>
    <parameterBindings name="FirstName" objectPath="UpdateAddressWebForm:FirstName:Value"/>
    <parameterBindings name="LastName" objectPath="UpdateAddressWebForm:LastName:Value"/>
    <parameterBindings name="PhoneHome" objectPath="UpdateAddressWebForm:PhoneHome:Value"/>
    <parameterBindings name="PostalCode" objectPath="UpdateAddressWebForm:PostalCode:Value"/>
    <parameterBindings name="State" objectPath="UpdateAddressWebForm:State:Value"/>
    <parameterBindings name="Title" objectPath="LocalizedTitle"/>
  </nodes>
<!--@Location 10,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn6">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
    <nodeSuccessors name="next" next="DecisionNode1"/>
<!--@BendPoints 23,19-->
    <nodeSuccessors name="pipelet_error" next="JoinNode_ue9uQAzPEeiB8ffK-OuaUA"/>
  </nodes>
<!--@Location 10,10-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="Address:PreferredBilling"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="CallNode4"/>
    <nodeSuccessors name="decision_no" next="JoinNode_ue9uQAzPEeiB8ffK-OuaUA"/>
  </nodes>
<!--@Location 10,11-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
    <nodeSuccessors name="next" next="JoinNode5"/>
    <parameterBindings name="City" objectPath="UpdateAddressWebForm:City:Value"/>
    <parameterBindings name="CountryCode" objectPath="UpdateAddressWebForm:CountryCode:Value"/>
    <parameterBindings name="FirstName" objectPath="UpdateAddressWebForm:FirstName:Value"/>
    <parameterBindings name="LastName" objectPath="UpdateAddressWebForm:LastName:Value"/>
    <parameterBindings name="PhoneHome" objectPath="UpdateAddressWebForm:Phone:Value"/>
    <parameterBindings name="PostalCode" objectPath="UpdateAddressWebForm:PostalCode:Value"/>
    <parameterBindings name="State" objectPath="UpdateAddressWebForm:State:Value"/>
    <parameterBindings name="Street" objectPath="UpdateAddressWebForm:Address1:Value"/>
    <parameterBindings name="Street2" objectPath="UpdateAddressWebForm:Address2:Value"/>
    <parameterBindings name="User" objectPath="CurrentUser"/>
    <startNode referencedName="ProcessUserAddresses-UpdateDataSheet"/>
  </nodes>
<!--@Location 10,12-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
    <nodeSuccessors name="next" next="CallNode39"/>
  </nodes>
<!--@Location 10,13-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode39">
    <nodeSuccessors name="next" next="JoinNode_dJ7uYAzKEeiB8ffK-OuaUA"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 10,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_dJ7uYAzKEeiB8ffK-OuaUA">
    <nodeSuccessors name="next" next="EndNode7"/>
  </nodes>
<!--@Location 10,15-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode7" name="" strict="true">
    <returnValues name="Address" type="com.intershop.beehive.core.capi.profile.Address"
        optional="true"/>
    <returnValues name="AddressBO" type="com.intershop.component.address.capi.AddressBO"/>
    <returnValues name="AddressUpdateResult" type="com.intershop.component.address.capi.handler.AddressUpdateResult"
        optional="true"/>
  </nodes>
<!--@Location 11,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_ue9uQAzPEeiB8ffK-OuaUA">
<!--@BendPoints 23,25-->
    <nodeSuccessors name="next" next="JoinNode5"/>
  </nodes>
<!--@Location 11,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetLocalizedTextByKey2">
    <pipelet href="enfinity:/core/pipelets/GetLocalizedTextByKey.xml"/>
    <nodeSuccessors name="next" next="JoinNode22"/>
<!--@BendPoints 23,13-->
    <nodeSuccessors name="pipelet_error" next="JoinNode22"/>
    <parameterBindings name="Key" objectPath="UpdateAddressWebForm:Title:Value"/>
    <returnValueBindings name="LocalizedText" objectPath="LocalizedTitle"/>
  </nodes>
<!--@Location 11,3-->
  <nodes xsi:type="pipeline:JumpNode" nodeID="JumpNode20">
    <startNode referencedName="Error-Page"/>
  </nodes>
<!--@Location 23,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode4" strict="true" name="ValidateAddressSelection"
      callMode="Private">
    <nodeSuccessors name="next" next="AddEntryToMap1"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 23,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddEntryToMap1">
    <pipelet href="enfinity:/core/pipelets/AddEntryToMap.xml"/>
    <nodeSuccessors name="next" next="StartSafeChangesBlock_h9TxEG4JEeeIO7oCCkAThQ"/>
    <parameterBindings name="Key" constant="Locale"/>
    <parameterBindings name="Value" objectPath="CurrentRequest:Locale"/>
    <returnValueBindings name="OutMap" objectPath="AdditionalParameters"/>
  </nodes>
<!--@Location 23,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="StartSafeChangesBlock_h9TxEG4JEeeIO7oCCkAThQ">
    <pipelet href="enfinity:/core/pipelets/StartSafeChangesBlock.xml"/>
    <nodeSuccessors name="next" next="ValidateBasket0_Input"/>
  </nodes>
<!--@Location 23,3-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="ValidateBasket0">
    <configurationValues name="AllowAdjustments" value="true"/>
    <configurationValues name="StopOnError" value="NeverStop"/>
    <pipelet href="enfinity:/bc_basket/pipelets/com.intershop.component.basket.pipelet.ValidateBasket.pipelinenode"/>
    <inConnectors name="Input">
      <parameterBindings name="Scopes" constant="Addresses"/>
    </inConnectors>
    <outConnectors name="Success">
      <nodeSuccessors next="EndSafeChangesBlock_nV8psG4JEeeIO7oCCkAThQ"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="EndSafeChangesBlock_nokqwG4JEeeIO7oCCkAThQ"/>
    </outConnectors>
    <outConnectors name="Adjusted">
      <nodeSuccessors next="EndSafeChangesBlock_nokqwG4JEeeIO7oCCkAThQ"/>
    </outConnectors>
  </nodes>
<!--@Location 23,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="EndSafeChangesBlock_nV8psG4JEeeIO7oCCkAThQ">
    <pipelet href="enfinity:/core/pipelets/EndSafeChangesBlock.xml"/>
    <nodeSuccessors name="next" next="EndNode24"/>
  </nodes>
<!--@Location 23,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode24" name="" strict="true"/>
<!--@Location 24,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="EndSafeChangesBlock_nokqwG4JEeeIO7oCCkAThQ">
    <pipelet href="enfinity:/core/pipelets/EndSafeChangesBlock.xml"/>
    <nodeSuccessors name="next" next="KeyMapper4"/>
  </nodes>
<!--@Location 24,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper4">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetFirstElementOfIterator0"/>
    <parameterBindings name="InValue_1" objectPath="BasketValidationResults:FailuresByCode(&quot;ShippingRestrictions&quot;):Iterator"/>
    <returnValueBindings name="OutValue_1" objectPath="Failures"/>
  </nodes>
<!--@Location 24,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetFirstElementOfIterator0">
    <pipelet href="enfinity:/core/pipelets/GetFirstElementOfIterator.xml"/>
    <nodeSuccessors name="next" next="KeyMapper8"/>
<!--@BendPoints 50,11 50,15-->
    <nodeSuccessors name="pipelet_error" next="JoinNode6"/>
    <parameterBindings name="Iterator" objectPath="Failures"/>
    <returnValueBindings name="FirstElement" objectPath="Failure"/>
  </nodes>
<!--@Location 24,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper8">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode6"/>
    <parameterBindings name="InValue_1" objectPath="Failure:Parameter(&quot;RestrictedItemsMap&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="RestrictedItemsMapShippingRestrictions"/>
  </nodes>
<!--@Location 24,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
<!--@BendPoints 49,16 51,16 51,7-->
    <nodeSuccessors name="next" next="KeyMapper12"/>
  </nodes>
<!--@Location 26,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper12">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="GetFirstElementOfIterator1"/>
    <parameterBindings name="InValue_1" objectPath="BasketValidationResults:FailuresByCode(&quot;NoEligibleShippingMethods&quot;):Iterator"/>
    <returnValueBindings name="OutValue_1" objectPath="Failures"/>
  </nodes>
<!--@Location 26,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetFirstElementOfIterator1">
    <pipelet href="enfinity:/core/pipelets/GetFirstElementOfIterator.xml"/>
    <nodeSuccessors name="next" next="KeyMapper13"/>
<!--@BendPoints 54,9 54,13-->
    <nodeSuccessors name="pipelet_error" next="JoinNode8"/>
    <parameterBindings name="Iterator" objectPath="Failures"/>
    <returnValueBindings name="FirstElement" objectPath="Failure"/>
  </nodes>
<!--@Location 26,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper13">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode8"/>
    <parameterBindings name="InValue_1" objectPath="Failure:Parameter(&quot;RestrictedItemsMap&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="RestrictedItemsMapEligibleShippingMethods"/>
  </nodes>
<!--@Location 26,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
    <nodeSuccessors name="next" next="DecisionNode2"/>
  </nodes>
<!--@Location 26,7-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="RestrictedItemsMapShippingRestrictions">
    <nodeSuccessors name="decision_yes" next="DecisionNode3"/>
<!--@BendPoints 57,15-->
    <nodeSuccessors name="decision_no" next="DecisionNode4"/>
  </nodes>
<!--@Location 26,8-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="RestrictedItemsMapEligibleShippingMethods">
    <nodeSuccessors name="decision_yes" next="CombineMaps0"/>
<!--@BendPoints 55,17-->
    <nodeSuccessors name="decision_no" next="KeyMapper15"/>
  </nodes>
<!--@Location 26,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineMaps0">
    <configurationValues name="ProcessMethod" value="Concatenate Maps"/>
    <pipelet href="enfinity:/core/pipelets/CombineMaps.xml"/>
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="Map1" objectPath="RestrictedItemsMapShippingRestrictions"/>
    <parameterBindings name="Map2" objectPath="RestrictedItemsMapEligibleShippingMethods"/>
    <returnValueBindings name="Map" objectPath="RestrictedItemsMap"/>
  </nodes>
<!--@Location 26,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="EndNode23"/>
  </nodes>
<!--@Location 26,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode23" name="ERROR" strict="true">
    <returnValues name="RestrictedItemsMap" type="java.util.Map" optional="true"/>
  </nodes>
<!--@Location 27,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper15">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode12"/>
    <parameterBindings name="InValue_1" objectPath="RestrictedItemsMapShippingRestrictions"/>
    <returnValueBindings name="OutValue_1" objectPath="RestrictedItemsMap"/>
  </nodes>
<!--@Location 27,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode12">
    <nodeSuccessors name="next" next="JoinNode10"/>
  </nodes>
<!--@Location 28,8-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="RestrictedItemsMapEligibleShippingMethods">
    <nodeSuccessors name="decision_yes" next="KeyMapper14"/>
<!--@BendPoints 58,17 58,19-->
    <nodeSuccessors name="decision_no" next="JoinNode15"/>
  </nodes>
<!--@Location 28,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper14">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode15"/>
    <parameterBindings name="InValue_1" objectPath="RestrictedItemsMapEligibleShippingMethods"/>
    <returnValueBindings name="OutValue_1" objectPath="RestrictedItemsMap"/>
  </nodes>
<!--@Location 28,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode15">
    <nodeSuccessors name="next" next="JoinNode12"/>
  </nodes>
</pipeline:Pipeline>
