<?xml version="1.0" encoding="UTF-8"?>
<!--@Group User-->

<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessUserGroups" type="process">
<!--TODO Pipeline rework:
* Still retrieves ApplicationBO.
* Still retrieves CurrentSession.
* needs CurrentRequest.
* needs CurrentDomain
Those must be handed in via parameter!
@Location 4,1-->
  <nodes xsi:type="pipeline:Text" nodeID="Text1"/>
<!--TODO Pipeline rework:
* Still retrieves CurrentSession.
Those must be handed in via parameter!
@Location 12,1-->
  <nodes xsi:type="pipeline:Text" nodeID="Text2"/>
<!--TODO Pipeline rework:
* Still retrieves CurrentSession.
* needs CurrentRequest.
* needs CurrentDomain
Must be handed in via parameter!
@Location 7,0-->
  <nodes xsi:type="pipeline:Text" nodeID="Text3"/>
<!--TODO Pipeline rework:
for example ABTest:
* needs CurrentSession.
* needs CurrentRequest.
* needs CurrentDomain
* needs User
Must be handed in via parameter!
@Location 7,19-->
  <nodes xsi:type="pipeline:Text" nodeID="Text4"/>
<!--TODO Pipeline rework:
Affiliate:
* needs Session!
Must be handed in via parameter!
@Location 7,11-->
  <nodes xsi:type="pipeline:Text" nodeID="Text5"/>
<!--TODO Pipeline rework:
implicit:
* needs CurrentDomain
Must be handed in via parameter!
@Location 5,3-->
  <nodes xsi:type="pipeline:Text" nodeID="Text6"/>
<!--TODO Pipeline rework:
UserUserGroups:
* needs CurrentSession.
* needs CurrentRequest.
* needs CurrentDomain
Must be handed in via parameter!
@Location 2,7-->
  <nodes xsi:type="pipeline:Text" nodeID="Text7"/>
<!--TODO Pipeline rework:
Preview:
* Still retrieves CurrentSession.
Those must be handed in via 
parameter!
@Location 2,4-->
  <nodes xsi:type="pipeline:Text" nodeID="Text8"/>
<!--Get the affiliates partner's user group 
in case the user comes from an 
partner page.
@Location 7,10-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode1"/>
<!--Get ABTesting user
groups if ABTesting
is enabled. 
(if disabled, leaves via error connector)
@Location 7,20-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode2"/>
<!--Important:
The session variable
"T_CurrentUserUserGroupKeys"
is shared by the A/B\-testing at
the following Pipeline:
* ProcessABTesting
And her Startnodes:
* GetAssignedABTestGroupsByUser
* GetABTestGroupsByUser
for Pipelet:
* CheckABTestSessionUserGroupKeys
@Location 5,6-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode3"/>
<!--CurrentABTestGroups:
\- all currently assigned ABTestGroups


CurrentAssigned ABTestGroups:
\- only the currently assigned ABTestGroups with ANY CONTENT assigned to them
@Location 12,22-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode4"/>
<!--If no ABTestGroupAttribute set,
remove any ABTest stuff from
session.
@Location 13,14-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode5"/>
<!--
Exclude all active promotions which are included somewhere outside of 
ABTests and at the same time explicitely assigned to an ABTest Control 
Group where one of this ABTest's Test Groups is inside the UserGroups. 
Exception: promotions which are explicitely assigned to an ABTest 
Group that belongs to the UserGroups. These promotions must not be excluded.


@Location 1,17-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode6"/>
<!--TODO Pipeline rework:
* Still retrieves CurrentSession.
* needs ApplicationBO
* needs CurrentRequest.
* needs CurrentDomain
Those must be handed in via Parameter!
@Location \-2,1-->
  <nodes xsi:type="pipeline:Text" nodeID="Text_yKHLgHrGEeibs6Yd4VUPmw"/>
<!--@Location 14,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start7" strict="true" visibility="Private"
      name="AddUserGroupWithParentsToUserGroups" callMode="Private">
    <nodeSuccessors name="next" next="Pipelet6"/>
    <parameters name="UserGroups" type="java.util.Iterator"/>
    <parameters name="UserGroup" type="com.intershop.beehive.core.capi.user.UserGroup"/>
  </nodes>
<!--@Location 14,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet6">
    <configurationValues name="Membership" value="All"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetParentUserGroups.xml"/>
    <nodeSuccessors name="next" next="Pipelet9"/>
    <parameterBindings name="UserGroup" objectPath="UserGroup"/>
    <returnValueBindings name="UserGroups" objectPath="AllParentUserGroupsOfUserGroup"/>
    <returnValueBindings name="UserGroupsHash" nullBinding="true"/>
  </nodes>
<!--@Location 14,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet9">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="Pipelet7"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" objectPath="UserGroup"/>
    <parameterBindings name="Objects" objectPath="AllParentUserGroupsOfUserGroup"/>
    <returnValueBindings name="Iterator" objectPath="UserGroupWithAllParents"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 14,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet7">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="End7"/>
    <parameterBindings name="Iterator1" objectPath="UserGroups"/>
    <parameterBindings name="Iterator2" objectPath="UserGroupWithAllParents"/>
    <returnValueBindings name="Iterator" objectPath="UserGroups"/>
  </nodes>
<!--@Location 14,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="End7" strict="true">
    <returnValues name="UserGroups" type="java.util.Iterator"/>
  </nodes>
<!--@padss
@Location \-3,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode_yKJnwHrGEeibs6Yd4VUPmw" strict="true"
      name="GetCurrentUserUserGroups" callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode_yKHykHrGEeibs6Yd4VUPmw"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentOrganization" type="com.intershop.component.organization.capi.Organization"/>
  </nodes>
<!--@Location \-3,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode_yKHykHrGEeibs6Yd4VUPmw"
      conditionKey="CurrentSession:getObject(&quot;T_CurrentUserUserGroupKeys&quot;)"
      operator="undef">
    <nodeSuccessors name="decision_yes" next="CallNode_yKJAsXrGEeibs6Yd4VUPmw"/>
    <nodeSuccessors name="decision_no" next="ExchangeSessionObject_yKK14HrGEeibs6Yd4VUPmw"/>
  </nodes>
<!--@Location \-3,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode_yKJAsXrGEeibs6Yd4VUPmw">
    <nodeSuccessors name="next" next="JoinNode_yKKO0HrGEeibs6Yd4VUPmw"/>
    <startNode referencedName="ProcessUserGroups-GetRefreshedCurrentUserUserGroups"/>
  </nodes>
<!--@Location \-3,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_yKKO0HrGEeibs6Yd4VUPmw">
    <nodeSuccessors name="next" next="EndNode_yKIZoHrGEeibs6Yd4VUPmw"/>
  </nodes>
<!--@Location \-3,10-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode_yKIZoHrGEeibs6Yd4VUPmw" strict="true">
    <returnValues name="CurrentUserUserGroupKeys" type="java.util.Set"/>
    <returnValues name="CurrentUserUserGroups" type="java.util.Iterator"/>
    <returnValues name="CurrentUserUserGroupsByType" type="java.util.Map&lt;com.intershop.beehive.core.capi.user.UserGroupType,java.util.Collection&lt;com.intershop.beehive.core.capi.user.UserGroup>>"/>
  </nodes>
<!--@Location \-2,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject_yKK14HrGEeibs6Yd4VUPmw">
    <configurationValues name="ProcessMethod" value="Get Object from Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentUserUserGroupKeys"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="DecisionNode_42paQHudEeiiavh1JJwYZw"/>
    <returnValueBindings name="LoadObject" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location \-2,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode_42paQHudEeiiavh1JJwYZw"
      conditionKey="User:Profile">
    <nodeSuccessors name="decision_yes" next="JoinNode_8nhD0HudEeiiavh1JJwYZw"/>
    <nodeSuccessors name="decision_no" next="GetApplicationBO_lO8TgHugEeiiavh1JJwYZw"/>
  </nodes>
<!--@Location \-2,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_8nhD0HudEeiiavh1JJwYZw">
    <nodeSuccessors name="next" next="ExchangeSessionObject_yKF9YHrGEeibs6Yd4VUPmw"/>
  </nodes>
<!--@Location \-2,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject_yKF9YHrGEeibs6Yd4VUPmw">
    <configurationValues name="ProcessMethod" value="Get Object from Session"/>
    <configurationValues name="SessionObjectName" value="T_ExcludedPromotionUserGroupKeys"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="ExchangeSessionObject_yKLc8HrGEeibs6Yd4VUPmw"/>
    <returnValueBindings name="LoadObject" objectPath="ExcludedPromotionUserGroupKeys"/>
  </nodes>
<!--@Location \-2,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject_yKLc8HrGEeibs6Yd4VUPmw">
    <configurationValues name="ProcessMethod" value="Get Object from Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentUserUserGroupsByType"/>
    <configurationValues name="Transient" value="true"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="GetCurrentUserUserGroups_yKMEAHrGEeibs6Yd4VUPmw"/>
    <returnValueBindings name="LoadObject" objectPath="CurrentUserUserGroupsByType"/>
  </nodes>
<!--@Location \-2,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentUserUserGroups_yKMEAHrGEeibs6Yd4VUPmw">
    <pipelet href="enfinity:/core/pipelets/GetCurrentUserUserGroups.xml"/>
    <nodeSuccessors name="next" next="GetUserGroupsByType_yKJAsHrGEeibs6Yd4VUPmw"/>
    <returnValueBindings name="CurrentUserUserGroups" nullBinding="true"/>
    <returnValueBindings name="CurrentUserUserGroupsIter" objectPath="CurrentUserUserGroups"/>
  </nodes>
<!--@Location \-2,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupsByType_yKJAsHrGEeibs6Yd4VUPmw">
    <pipelet href="enfinity:/core/pipelets/GetUserGroupsByType.xml"/>
    <nodeSuccessors name="next" next="JoinNode_yKKO0HrGEeibs6Yd4VUPmw"/>
    <parameterBindings name="UserGroups" objectPath="CurrentUserUserGroups"/>
    <returnValueBindings name="UserGroupsByType" objectPath="CurrentUserUserGroupsByType"/>
  </nodes>
<!--@Location 0,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO_lO8TgHugEeiiavh1JJwYZw">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="GetUserGroupsByCustomerSegments_jaKYoHufEeiiavh1JJwYZw"/>
  </nodes>
<!--@Location 0,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupsByCustomerSegments_jaKYoHufEeiiavh1JJwYZw">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetUserGroupsByCustomerSegments.xml"/>
    <nodeSuccessors name="next" next="CombineIterators_o8wzQH3IEei3aeKPRpPrWg"/>
  </nodes>
<!--@Location 0,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators_o8wzQH3IEei3aeKPRpPrWg">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="CreateSet_lhHoQH3HEei3aeKPRpPrWg"/>
    <parameterBindings name="Iterator1" objectPath="CurrentUserUserGroupKeys:Iterator"/>
    <parameterBindings name="Iterator2" objectPath="UserGroupsFromManagedService:Iterator"/>
    <returnValueBindings name="Iterator" objectPath="UserGroups"/>
  </nodes>
<!--@Location 0,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateSet_lhHoQH3HEei3aeKPRpPrWg">
    <configurationValues name="type" value="HashSet"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateSet.xml"/>
    <nodeSuccessors name="next" next="LoopNode_lgadoH3HEei3aeKPRpPrWg"/>
    <returnValueBindings name="createdSet" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location 0,7-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode_lgadoH3HEei3aeKPRpPrWg" loop="UserGroupsFromManagedService:Iterator">
<!--@BendPoints \-1,15-->
    <nodeSuccessors name="next" next="ExchangeSessionObject_q7tr4H3LEei3aeKPRpPrWg"/>
    <entry key="UserGroup">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode_lgTI4H3HEei3aeKPRpPrWg"/>
    </entry>
  </nodes>
<!--@Location 0,8-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode_lgTI4H3HEei3aeKPRpPrWg"
      conditionKey="UserGroup:ID">
    <nodeSuccessors name="decision_yes" next="AddObjectToVector_lhFMAH3HEei3aeKPRpPrWg"/>
    <nodeSuccessors name="decision_no" next="JoinNode_3OoL0H3HEei3aeKPRpPrWg"/>
  </nodes>
<!--@Location 0,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector_lhFMAH3HEei3aeKPRpPrWg">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="ConcatenateStrings_lgVlIH3HEei3aeKPRpPrWg"/>
    <parameterBindings name="InVector" objectPath="UserUserGroupsVector"/>
    <parameterBindings name="Object" objectPath="UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="CurrentUserUserGroupsIterator"/>
    <returnValueBindings name="OutVector" objectPath="CurrentUserUserGroupsVector"/>
  </nodes>
<!--@Location 0,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ConcatenateStrings_lgVlIH3HEei3aeKPRpPrWg">
    <configurationValues name="DefaultString1" value="@"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ConcatenateStrings.xml"/>
    <nodeSuccessors name="next" next="UpdateSet_lhHBMH3HEei3aeKPRpPrWg"/>
    <parameterBindings name="String0" objectPath="UserGroup:ID"/>
    <parameterBindings name="String2" objectPath="UserGroup:DomainID"/>
    <returnValueBindings name="Concatenated" objectPath="UserGroupKey"/>
  </nodes>
<!--@Location 0,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateSet_lhHBMH3HEei3aeKPRpPrWg">
    <configurationValues name="Operation" value="Add"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateSet.xml"/>
<!--@BendPoints 3,23-->
    <nodeSuccessors name="next" next="JoinNode_3OoL0H3HEei3aeKPRpPrWg"/>
    <parameterBindings name="Item" objectPath="UserGroupKey"/>
    <parameterBindings name="Set" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location 1,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_3OoL0H3HEei3aeKPRpPrWg">
<!--@BendPoints 3,15-->
    <nodeSuccessors name="next" next="LoopNode_lgadoH3HEei3aeKPRpPrWg_Entry"/>
  </nodes>
<!--@Location \-1,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject_q7tr4H3LEei3aeKPRpPrWg">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentUserUserGroupKeys"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="JoinNode_8nhD0HudEeiiavh1JJwYZw"/>
    <parameterBindings name="SaveObject" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location 11,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="GetPreviewUserGroups"
      callMode="Private">
    <nodeSuccessors name="next" next="AddObjectToVector6"/>
    <parameters name="PreviewContextBO" type="com.intershop.component.preview.capi.context.PreviewContextBO"/>
  </nodes>
<!--@Location 11,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector6">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="GetPreviewConfigurationAttribute1"/>
    <returnValueBindings name="Iterator" objectPath="UserGroups"/>
    <returnValueBindings name="OutVector" objectPath="UserGroupsVector"/>
  </nodes>
<!--@Location 11,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPreviewConfigurationAttribute1">
    <configurationValues name="AttributeSet" value="com.intershop.component.marketing.capi.preview.MarketingPreviewConfigurationAttributeSet"/>
    <configurationValues name="AttributeSetValue" value="PreviewUserGroups"/>
    <pipelet href="enfinity:/bc_preview/pipelets/GetPreviewConfigurationAttribute.xml"/>
    <nodeSuccessors name="next" next="DecisionNode8"/>
    <parameterBindings name="PreviewConfigurationAttributeID" nullBinding="true"/>
    <returnValueBindings name="PreviewConfigurationAttribute" objectPath="UserGroupsAttribute"/>
  </nodes>
<!--@Location 11,4-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode8" conditionKey="UserGroupsAttribute">
    <nodeSuccessors name="decision_yes" next="DecisionNode9"/>
<!--@BendPoints 25,9-->
    <nodeSuccessors name="decision_no" next="JoinNode7"/>
  </nodes>
<!--@Location 11,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode9" conditionKey="UserGroupsAttribute:Selected"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="LoopNode1"/>
    <nodeSuccessors name="decision_no" next="JoinNode7"/>
  </nodes>
<!--@Location 11,6-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode1" loop="UserGroupsAttribute:SelectedValues">
    <nodeSuccessors name="next" next="JoinNode6"/>
    <entry key="UserGroupAttributeValue">
      <nodeSuccessors name="loop_entry_next" next="AddObjectToVector12"/>
    </entry>
  </nodes>
<!--@Location 11,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector12">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="GetParentUserGroups1"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" objectPath="UserGroupAttributeValue:ValueObject"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 11,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetParentUserGroups1">
    <configurationValues name="Membership" value="All"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetParentUserGroups.xml"/>
<!--@BendPoints 23,18-->
    <nodeSuccessors name="next" next="AddObjectToVector3"/>
    <parameterBindings name="UserGroup" objectPath="UserGroupAttributeValue:ValueObject"/>
    <returnValueBindings name="UserGroups" objectPath="ParentUserGroups"/>
  </nodes>
<!--@Location 11,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector3">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 21,19 21,13-->
    <nodeSuccessors name="next" next="LoopNode1_Entry"/>
    <parameterBindings name="InVector" objectPath="UserGroupsVector"/>
    <parameterBindings name="Object" objectPath="UserGroupAttributeValue:ValueObject"/>
    <parameterBindings name="Objects" objectPath="ParentUserGroups"/>
    <returnValueBindings name="Iterator" objectPath="UserGroups"/>
    <returnValueBindings name="OutVector" objectPath="UserGroupsVector"/>
  </nodes>
<!--@Location 12,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
<!--@BendPoints 25,20 24,20-->
    <nodeSuccessors name="next" next="GetPreviewConfigurationAttribute2"/>
  </nodes>
<!--@Location 11,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPreviewConfigurationAttribute2">
    <configurationValues name="AttributeSet" value="com.intershop.component.marketing.capi.preview.MarketingPreviewConfigurationAttributeSet"/>
    <configurationValues name="AttributeSetValue" value="PreviewABTestGroups"/>
    <pipelet href="enfinity:/bc_preview/pipelets/GetPreviewConfigurationAttribute.xml"/>
    <nodeSuccessors name="next" next="DecisionNode11"/>
    <parameterBindings name="PreviewConfigurationAttributeID" nullBinding="true"/>
    <returnValueBindings name="PreviewConfigurationAttribute" objectPath="ABTestGroupAttribute"/>
  </nodes>
<!--@Location 11,11-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode11" conditionKey="ABTestGroupAttribute">
    <nodeSuccessors name="decision_yes" next="DecisionNode12"/>
<!--@BendPoints 25,23-->
    <nodeSuccessors name="decision_no" next="JoinNode8"/>
  </nodes>
<!--@Location 11,12-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode12" conditionKey="ABTestGroupAttribute:Selected"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 23,26 22,26 22,27-->
    <nodeSuccessors name="decision_yes" next="ExchangeSessionObject1"/>
    <nodeSuccessors name="decision_no" next="JoinNode8"/>
  </nodes>
<!--@Location 11,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject1">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_ABTestMode"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
<!--@BendPoints 24,27 24,28 23,28-->
    <nodeSuccessors name="next" next="AddObjectToVector5"/>
    <parameterBindings name="SaveObject" constant="Enabled"/>
    <parameterBindings name="SessionObjectName" nullBinding="true"/>
    <parameterBindings name="TargetSessionDomain" nullBinding="true"/>
    <parameterBindings name="TargetSessionID" nullBinding="true"/>
    <returnValueBindings name="LoadObject" nullBinding="true"/>
  </nodes>
<!--@Location 11,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector5">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector13"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" objectPath="ABTestGroupAttribute:SelectedValue:ValueObject"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="CurrentABTestGroups"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 11,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector13">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="CallNode8"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" objectPath="ABTestGroupAttribute:SelectedValue:ValueObject:UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--Returns all ABTestGroups of the user, which have any promotion or pagelets assigned.
Also stores CurrentABTestGroups and CurrentAssignedABTestGroups into the session.
@Location 11,16-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode8">
    <nodeSuccessors name="next" next="ExchangeSessionObject0"/>
    <startNode referencedName="ProcessABTesting-PutCurrentABTestgroupsToSession"/>
  </nodes>
<!--@Location 11,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject0">
    <configurationValues name="ProcessMethod" value="Get Object from Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentAssignedABTestGroupUUIDs"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="AssignABTestToSession0"/>
    <parameterBindings name="SaveObject" nullBinding="true"/>
    <parameterBindings name="SessionObjectName" nullBinding="true"/>
    <parameterBindings name="TargetSession" nullBinding="true"/>
    <parameterBindings name="TargetSessionDomain" nullBinding="true"/>
    <parameterBindings name="TargetSessionID" nullBinding="true"/>
    <returnValueBindings name="LoadObject" objectPath="ABTestGroupUUIDs"/>
  </nodes>
<!--@Location 11,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AssignABTestToSession0">
    <configurationValues name="ForceAssignment" value="true"/>
    <pipelet href="enfinity:/bc_abtest/pipelets/AssignABTestToSession.xml"/>
    <nodeSuccessors name="next" next="CallNode9"/>
    <parameterBindings name="ABTest" objectPath="ABTestGroupAttribute:SelectedValue:ValueObject:Test"/>
    <parameterBindings name="TestGroupUUIDParams" objectPath="ABTestGroupUUIDs:Iterator"/>
  </nodes>
<!--@Location 11,19-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode9">
<!--@BendPoints 23,41-->
    <nodeSuccessors name="next" next="JoinNode9"/>
    <parameterBindings name="UserGroup" objectPath="ABTestGroupAttribute:SelectedValue:ValueObject:UserGroup"/>
    <startNode referencedName="ProcessUserGroups-AddUserGroupWithParentsToUserGroups"/>
  </nodes>
<!--@Location 12,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
    <nodeSuccessors name="next" next="EndNode2"/>
  </nodes>
<!--@Location 12,21-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" strict="true">
    <returnValues name="UserGroups" type="java.util.Iterator" optional="true"/>
    <returnValues name="AllDirectUserGroups" type="java.util.Iterator" optional="true"/>
    <returnValues name="CurrentABTestGroups" type="java.util.Iterator" optional="true"/>
    <returnValues name="CurrentAssignedABTestGroups" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 12,12-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
    <nodeSuccessors name="next" next="AddObjectToVector14"/>
  </nodes>
<!--@Location 12,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector14">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="ExchangeSessionObject2"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 12,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject2">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_ABTestMode"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="ExchangeSessionObject3"/>
    <parameterBindings name="SaveObject" nullBinding="true"/>
    <parameterBindings name="SessionObjectName" nullBinding="true"/>
    <parameterBindings name="TargetSessionDomain" nullBinding="true"/>
    <parameterBindings name="TargetSessionID" nullBinding="true"/>
    <returnValueBindings name="LoadObject" nullBinding="true"/>
  </nodes>
<!--@Location 12,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject3">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentABTestGroupUUIDs"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
<!--@BendPoints 25,32-->
    <nodeSuccessors name="next" next="ExchangeSessionObject4"/>
    <parameterBindings name="SaveObject" nullBinding="true"/>
    <parameterBindings name="SessionObjectName" nullBinding="true"/>
    <parameterBindings name="TargetSessionDomain" nullBinding="true"/>
    <parameterBindings name="TargetSessionID" nullBinding="true"/>
    <returnValueBindings name="LoadObject" nullBinding="true"/>
  </nodes>
<!--@Location 12,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject4">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentAssignedABTestGroupUUIDs"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="JoinNode9"/>
    <parameterBindings name="SaveObject" nullBinding="true"/>
    <parameterBindings name="SessionObjectName" nullBinding="true"/>
    <parameterBindings name="TargetSessionDomain" nullBinding="true"/>
    <parameterBindings name="TargetSessionID" nullBinding="true"/>
    <returnValueBindings name="LoadObject" nullBinding="true"/>
  </nodes>
<!--@Location 12,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
    <nodeSuccessors name="next" next="JoinNode6"/>
  </nodes>
<!--@Location 3,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start1" strict="true" name="GetRefreshedCurrentUserUserGroups"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicationBO2"/>
    <parameters name="CurrentUser" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentOrganization" type="com.intershop.component.organization.capi.Organization"/>
  </nodes>
<!--@Location 3,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO2">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="DecisionNode7"/>
  </nodes>
<!--@displayNearNode@If preview mode is enabled, determine selected user groups and ABTests.
@Location 3,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode7" conditionKey="ApplicationBO:Extension(&quot;PreviewExtension&quot;):PreviewContext">
    <nodeSuccessors name="decision_yes" next="CallNode3"/>
<!--@BendPoints 8,7 8,13-->
    <nodeSuccessors name="decision_no" next="JoinNode5"/>
  </nodes>
<!--@Location 3,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode3">
    <nodeSuccessors name="next" next="DecisionNode6"/>
    <parameterBindings name="PreviewContextBO" objectPath="ApplicationBO:Extension(&quot;PreviewExtension&quot;):PreviewContext"/>
    <startNode referencedName="ProcessUserGroups-GetPreviewUserGroups"/>
    <returnValueBindings name="UserGroups" objectPath="CurrentUserUserGroups"/>
  </nodes>
<!--@displayNearNode@If no user groups are selected for preview countinue with the standard behavior.
@Location 3,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode6" conditionKey="CurrentUserUserGroups"
      operator="undef">
    <nodeSuccessors name="decision_yes" next="JoinNode5"/>
<!--@BendPoints 8,11 8,16-->
    <nodeSuccessors name="decision_no" next="CreateSet1"/>
  </nodes>
<!--@Location 3,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
<!--@BendPoints 7,14-->
    <nodeSuccessors name="next" next="CallNode1"/>
  </nodes>
<!--@Location 3,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
<!--@BendPoints 7,16-->
    <nodeSuccessors name="next" next="CreateSet1"/>
    <parameterBindings name="CustomerBO" objectPath="ApplicationBO:Extension(&quot;Customer&quot;):CurrentCustomerBO"/>
    <parameterBindings name="CustomerSegmentBORepository" objectPath="ApplicationBO:Repository(&quot;CustomerSegmentBORepository&quot;)"/>
    <parameterBindings name="Organization" objectPath="CurrentOrganization"/>
    <parameterBindings name="User" objectPath="CurrentUser"/>
    <startNode referencedName="ProcessUserGroups-GetUserUserGroups"/>
    <returnValueBindings name="UserGroups" objectPath="CurrentUserUserGroups"/>
  </nodes>
<!--@Location 3,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateSet1">
    <configurationValues name="type" value="HashSet"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateSet.xml"/>
    <nodeSuccessors name="next" next="LoopNode3"/>
    <returnValueBindings name="createdSet" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location 3,9-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode3" loop="CurrentUserUserGroups">
<!--@BendPoints 9,19-->
    <nodeSuccessors name="next" next="Pipelet4"/>
    <entry key="UserGroup">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode4"/>
    </entry>
  </nodes>
<!--@Location 3,10-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="UserGroup:ID">
    <nodeSuccessors name="decision_yes" next="AddObjectToVector1"/>
<!--@BendPoints 8,21 8,29-->
    <nodeSuccessors name="decision_no" next="JoinNode3"/>
  </nodes>
<!--@Location 3,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector1">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="ConcatenateStrings2"/>
    <parameterBindings name="InVector" objectPath="CurrentUserUserGroupsVector"/>
    <parameterBindings name="Object" objectPath="UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="CurrentUserUserGroupsIterator"/>
    <returnValueBindings name="OutVector" objectPath="CurrentUserUserGroupsVector"/>
  </nodes>
<!--@Location 3,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ConcatenateStrings2">
    <configurationValues name="DefaultString1" value="@"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ConcatenateStrings.xml"/>
    <nodeSuccessors name="next" next="UpdateSet1"/>
    <parameterBindings name="String0" objectPath="UserGroup:ID"/>
    <parameterBindings name="String2" objectPath="UserGroup:DomainID"/>
    <returnValueBindings name="Concatenated" objectPath="UserGroupKey"/>
  </nodes>
<!--@Location 3,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateSet1">
    <configurationValues name="Operation" value="Add"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateSet.xml"/>
    <nodeSuccessors name="next" next="JoinNode3"/>
    <parameterBindings name="Item" objectPath="UserGroupKey"/>
    <parameterBindings name="Set" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location 3,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
<!--@BendPoints 6,29 6,19-->
    <nodeSuccessors name="next" next="LoopNode3_Entry"/>
  </nodes>
<!--@Location 4,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet4">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentUserUserGroupKeys"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="JoinNode2"/>
<!--@BendPoints 11,21 11,23-->
    <nodeSuccessors name="pipelet_error" next="JoinNode2"/>
    <parameterBindings name="SaveObject" objectPath="CurrentUserUserGroupKeys"/>
  </nodes>
<!--@Location 4,11-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
    <nodeSuccessors name="next" next="DecisionNode0"/>
  </nodes>
<!--@Location 4,12-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode0" conditionKey="CurrentUserUserGroups">
    <nodeSuccessors name="decision_yes" next="JoinNode4"/>
<!--@BendPoints 11,25-->
    <nodeSuccessors name="decision_no" next="AddObjectToVector2"/>
  </nodes>
<!--@Location 4,13-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
    <nodeSuccessors name="next" next="GetUserGroupIDsByType0"/>
  </nodes>
<!--@Location 4,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupIDsByType0">
    <pipelet href="enfinity:/core/pipelets/GetUserGroupIDsByType.xml"/>
    <nodeSuccessors name="next" next="ExchangeSessionObject7"/>
    <parameterBindings name="UserGroups" objectPath="CurrentUserUserGroups"/>
    <returnValueBindings name="UserGroupIDsByType" objectPath="CurrentUserUserGroupIDsByType"/>
  </nodes>
<!--@Location 4,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject7">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_CurrentUserUserGroupsByType"/>
    <configurationValues name="Transient" value="true"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="GetUserGroupsByType1"/>
    <parameterBindings name="SaveObject" objectPath="CurrentUserUserGroupIDsByType"/>
  </nodes>
<!--@Location 4,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupsByType1">
    <pipelet href="enfinity:/core/pipelets/GetUserGroupsByType.xml"/>
<!--@BendPoints 7,33-->
    <nodeSuccessors name="next" next="DecisionNode15"/>
    <parameterBindings name="UserGroups" objectPath="CurrentUserUserGroups"/>
    <returnValueBindings name="UserGroupsByType" objectPath="CurrentUserUserGroupsByType"/>
  </nodes>
<!--@Location 3,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode15" conditionKey="CurrentABTestGroups">
    <nodeSuccessors name="decision_yes" next="GetABTestExcludedPromotionUserGroups0"/>
<!--@BendPoints 11,35-->
    <nodeSuccessors name="decision_no" next="JoinNode16"/>
  </nodes>
<!--@Location 3,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetABTestExcludedPromotionUserGroups0">
    <pipelet href="enfinity:/bc_abtest/pipelets/GetABTestExcludedPromotionUserGroups.xml"/>
    <nodeSuccessors name="next" next="CreateSet0"/>
    <returnValueBindings name="ABTestExcludedPromotionUserGroups" objectPath="ExcludedPromoUserGroups"/>
  </nodes>
<!--@Location 3,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateSet0">
    <configurationValues name="type" value="HashSet"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateSet.xml"/>
    <nodeSuccessors name="next" next="LoopNode0"/>
    <returnValueBindings name="createdSet" objectPath="ExcludedPromotionUserGroupKeys"/>
  </nodes>
<!--@Location 3,20-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode0" loop="ExcludedPromoUserGroups">
    <nodeSuccessors name="next" next="ExchangeSessionObject6"/>
    <entry key="UserGroup">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode3"/>
    </entry>
  </nodes>
<!--@Location 3,21-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="UserGroup:ID">
    <nodeSuccessors name="decision_yes" next="AddObjectToVector16"/>
<!--@BendPoints 9,43-->
    <nodeSuccessors name="decision_no" next="JoinNode17"/>
  </nodes>
<!--@Location 3,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector16">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="ConcatenateStrings0"/>
    <parameterBindings name="InVector" objectPath="ExcludedPromotionUserGroupsVector"/>
    <parameterBindings name="Object" objectPath="UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="ExcludedPromotionUserGroups"/>
    <returnValueBindings name="OutVector" objectPath="ExcludedPromotionUserGroupsVector"/>
  </nodes>
<!--@Location 3,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ConcatenateStrings0">
    <configurationValues name="DefaultString1" value="@"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ConcatenateStrings.xml"/>
    <nodeSuccessors name="next" next="UpdateSet0"/>
    <parameterBindings name="String0" objectPath="UserGroup:ID"/>
    <parameterBindings name="String2" objectPath="UserGroup:DomainID"/>
    <returnValueBindings name="Concatenated" objectPath="UserGroupKey"/>
  </nodes>
<!--@Location 3,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateSet0">
    <configurationValues name="Operation" value="Add"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateSet.xml"/>
    <nodeSuccessors name="next" next="JoinNode15"/>
    <parameterBindings name="Item" objectPath="UserGroupKey"/>
    <parameterBindings name="Set" objectPath="ExcludedPromotionUserGroupKeys"/>
  </nodes>
<!--@Location 3,25-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode15">
<!--@BendPoints 6,51 6,41-->
    <nodeSuccessors name="next" next="LoopNode0_Entry"/>
  </nodes>
<!--@Location 4,25-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode17">
    <nodeSuccessors name="next" next="JoinNode15"/>
  </nodes>
<!--@Location 4,20-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject6">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="T_ExcludedPromotionUserGroupKeys"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="JoinNode16"/>
<!--@BendPoints 9,42 10,42-->
    <nodeSuccessors name="pipelet_error" next="JoinNode16"/>
    <parameterBindings name="SaveObject" objectPath="ExcludedPromotionUserGroupKeys"/>
  </nodes>
<!--@Location 5,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode16">
    <nodeSuccessors name="next" next="DecisionNode14"/>
  </nodes>
<!--@Location 5,22-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode14" conditionKey="ExcludedPromotionUserGroups">
    <nodeSuccessors name="decision_yes" next="JoinNode19"/>
<!--@BendPoints 13,45-->
    <nodeSuccessors name="decision_no" next="AddObjectToVector15"/>
  </nodes>
<!--@Location 5,24-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode19">
    <nodeSuccessors name="next" next="EndNode0"/>
  </nodes>
<!--@Location 5,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode0" name="CurrentUserUserGroups"
      strict="true">
    <returnValues name="CurrentUserUserGroupKeys" type="java.util.Set"/>
    <returnValues name="CurrentUserUserGroups" type="java.util.Iterator"/>
    <returnValues name="ExcludedPromotionUserGroups" type="java.util.Iterator"/>
    <returnValues name="ExcludedPromotionUserGroupKeys" type="java.util.Set"/>
<!--Map grouping the user groups by user group type.-->
    <returnValues name="CurrentUserUserGroupsByType" type="java.util.Map&lt;com.intershop.beehive.core.capi.user.UserGroupType,java.util.Collection&lt;com.intershop.beehive.core.capi.user.UserGroup>>"/>
  </nodes>
<!--@Location 6,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector15">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="CreateSet2"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="ExcludedPromotionUserGroups"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 6,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateSet2">
    <configurationValues name="type" value="HashSet"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateSet.xml"/>
    <nodeSuccessors name="next" next="JoinNode19"/>
    <returnValueBindings name="createdSet" objectPath="ExcludedPromotionUserGroupKeys"/>
  </nodes>
<!--@Location 5,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector2">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="JoinNode4"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="CurrentUserUserGroups"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 6,0-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start3" strict="true" name="GetUserUserGroups"
      callMode="Private">
<!--@BendPoints 13,2-->
    <nodeSuccessors name="next" next="DecisionNode1"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
    <parameters name="CustomerBO" type="com.intershop.component.customer.capi.CustomerBO"
        optional="true"/>
    <parameters name="CustomerSegmentBORepository" type="com.intershop.component.customer.capi.CustomerSegmentBORepository"
        optional="true"/>
  </nodes>
<!--@Location 6,1-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="User:Profile">
    <nodeSuccessors name="decision_yes" next="CallNode5"/>
    <nodeSuccessors name="decision_no" next="Pipelet2"/>
  </nodes>
<!--@Location 6,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode5">
    <nodeSuccessors name="next" next="Pipelet19"/>
    <startNode referencedName="ProcessImplicitConsumerGroups-UpdateImplicitUserGroupsOnRegisteredUser"/>
  </nodes>
<!--@Location 6,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet19">
    <configurationValues name="Membership" value="All"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignedUserGroups.xml"/>
    <nodeSuccessors name="next" next="GetUserGroupsByCustomerSegments_tsSLQCtnEeiXa9e693uVNA"/>
    <returnValueBindings name="UserGroupsHash" nullBinding="true"/>
  </nodes>
<!--@Location 6,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupsByCustomerSegments_tsSLQCtnEeiXa9e693uVNA">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetUserGroupsByCustomerSegments.xml"/>
    <nodeSuccessors name="next" next="CombineIterators_gbSu8CtqEeiXa9e693uVNA"/>
  </nodes>
<!--@Location 6,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators_gbSu8CtqEeiXa9e693uVNA">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="GetAssignedUserGroups0"/>
    <parameterBindings name="Iterator1" objectPath="UserGroups"/>
    <parameterBindings name="Iterator2" objectPath="UserGroupsFromManagedService:Iterator"/>
    <returnValueBindings name="Iterator" objectPath="UserGroups"/>
  </nodes>
<!--@Location 6,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAssignedUserGroups0">
    <configurationValues name="Membership" value="Direct"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignedUserGroups.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector0"/>
    <returnValueBindings name="UserGroups" objectPath="DirectUserGroups"/>
    <returnValueBindings name="UserGroupsHash" nullBinding="true"/>
  </nodes>
<!--@Location 6,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector0">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 13,19-->
    <nodeSuccessors name="next" next="JoinNode12"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" objectPath="DirectUserGroups"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 8,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode12">
<!--@BendPoints 17,20-->
    <nodeSuccessors name="next" next="CallNode10"/>
  </nodes>
<!--@Location 8,10-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode10">
    <nodeSuccessors name="next" next="Decision6"/>
<!--@BendPoints 20,21 20,39-->
    <nodeSuccessors name="ERROR" next="JoinNode0"/>
    <parameterBindings name="Domain" objectPath="CurrentDomain"/>
    <parameterBindings name="TargetSession" objectPath="CurrentSession"/>
    <startNode referencedName="ProcessAffiliate-GetProgramFromSession"/>
  </nodes>
<!--@Location 8,11-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="Decision6" conditionKey="AffiliateProgram">
    <nodeSuccessors name="decision_yes" next="DecisionNode2"/>
<!--@BendPoints 19,23-->
    <nodeSuccessors name="decision_no" next="JoinNode10"/>
  </nodes>
<!--@Location 8,12-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="AffiliateProgram:isEnabled"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="DecisionNode5"/>
    <nodeSuccessors name="decision_no" next="JoinNode10"/>
  </nodes>
<!--@Location 8,13-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode5" conditionKey="AffiliateProgram:isExpired"
      operator="str_eq" conditionValue="false">
<!--@BendPoints 17,30-->
    <nodeSuccessors name="decision_yes" next="KeyMapper2"/>
    <nodeSuccessors name="decision_no" next="JoinNode11"/>
  </nodes>
<!--@Location 8,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper2">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode1"/>
    <parameterBindings name="InValue_1" objectPath="AffiliateProgram:ProgramUserGroup"/>
    <returnValueBindings name="OutValue_1" objectPath="UserGroup"/>
  </nodes>
<!--@Location 8,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
    <nodeSuccessors name="next" next="AddObjectToVector10"/>
  </nodes>
<!--@Location 8,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector10">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="Call1"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" objectPath="UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 8,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="Call1">
<!--@BendPoints 17,38-->
    <nodeSuccessors name="next" next="JoinNode0"/>
    <startNode referencedName="ProcessUserGroups-AddUserGroupWithParentsToUserGroups"/>
  </nodes>
<!--@Location 8,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode0">
    <nodeSuccessors name="next" next="CallNode7"/>
  </nodes>
<!--@Location 8,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode7">
    <nodeSuccessors name="next" next="DecisionNode13"/>
<!--@BendPoints 19,41-->
    <nodeSuccessors name="ERROR" next="JoinNode13"/>
    <parameterBindings name="Organization" objectPath="Organization"/>
    <parameterBindings name="TargetGroups" objectPath="UserGroups"/>
    <startNode referencedName="ProcessABTesting-RefreshABTestGroupsByUser"/>
    <returnValueBindings name="CurrentAssignedABTestGroups" objectPath="CurrentAssignedABTestGroups"/>
  </nodes>
<!--@Location 8,21-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode13" conditionKey="CurrentABTestGroups"
      operator="has_elements">
    <nodeSuccessors name="decision_yes" next="LoopNode4"/>
    <nodeSuccessors name="decision_no" next="JoinNode13"/>
  </nodes>
<!--@Location 8,22-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode4" loop="CurrentABTestGroups">
    <nodeSuccessors name="next" next="JoinNode14"/>
    <entry key="CurrentABTestGroup">
      <nodeSuccessors name="loop_entry_next" next="AddObjectToVector9"/>
    </entry>
  </nodes>
<!--@Location 8,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector9">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="Call3"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" objectPath="CurrentABTestGroup:UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 8,24-->
  <nodes xsi:type="pipeline:CallNode" nodeID="Call3">
<!--@BendPoints 15,49 15,45-->
    <nodeSuccessors name="next" next="LoopNode4_Entry"/>
    <parameterBindings name="UserGroup" objectPath="CurrentABTestGroup:UserGroup"/>
    <parameterBindings name="UserGroups" objectPath="UserGroups"/>
    <startNode referencedName="ProcessUserGroups-AddUserGroupWithParentsToUserGroups"/>
    <returnValueBindings name="UserGroups" objectPath="UserGroups"/>
  </nodes>
<!--@Location 9,22-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode14">
    <nodeSuccessors name="next" next="AddObjectToVector11"/>
  </nodes>
<!--@Location 9,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector11">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="EndNode1"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="AllDirectUserGroups"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 9,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" strict="true">
    <returnValues name="UserGroups" type="java.util.Iterator"/>
    <returnValues name="AllDirectUserGroups" type="java.util.Iterator"/>
    <returnValues name="CurrentABTestGroups" type="java.util.Iterator"/>
  </nodes>
<!--@Location 9,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
    <nodeSuccessors name="next" next="JoinNode14"/>
  </nodes>
<!--@Location 9,13-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
    <nodeSuccessors name="next" next="Pipelet11"/>
  </nodes>
<!--@Location 9,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet11">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 19,33-->
    <nodeSuccessors name="next" next="JoinNode1"/>
    <parameterBindings name="InValue_1" objectPath="AffiliatePartner:PartnerUserGroup"/>
    <returnValueBindings name="OutValue_1" objectPath="UserGroup"/>
  </nodes>
<!--@Location 9,12-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="JoinNode11"/>
  </nodes>
<!--@Location 7,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet2">
    <configurationValues name="Membership" value="All"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignedUserGroups.xml"/>
    <nodeSuccessors name="next" next="GetUserGroupsByCustomerSegments_5osWwHhyEeiWWaUoUiiTyQ"/>
    <returnValueBindings name="UserGroupsHash" nullBinding="true"/>
  </nodes>
<!--@Location 9,1-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupsByCustomerSegments_5osWwHhyEeiWWaUoUiiTyQ">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetUserGroupsByCustomerSegments.xml"/>
    <nodeSuccessors name="next" next="CombineIterators_KbyLYHhxEeiWWaUoUiiTyQ"/>
  </nodes>
<!--@Location 9,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators_KbyLYHhxEeiWWaUoUiiTyQ">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="GetAssignedUserGroups_MFX_YHhxEeiWWaUoUiiTyQ"/>
    <parameterBindings name="Iterator1" objectPath="UserGroups"/>
    <parameterBindings name="Iterator2" objectPath="UserGroupsFromManagedService:Iterator"/>
    <returnValueBindings name="Iterator" objectPath="UserGroups"/>
  </nodes>
<!--@Location 9,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAssignedUserGroups_MFX_YHhxEeiWWaUoUiiTyQ">
    <configurationValues name="Membership" value="Direct"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignedUserGroups.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector7"/>
    <returnValueBindings name="UserGroups" objectPath="DirectUserGroups"/>
    <returnValueBindings name="UserGroupsHash" nullBinding="true"/>
  </nodes>
<!--@Location 7,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector7">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="CallNode4"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" objectPath="UserGroups"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 7,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
    <nodeSuccessors name="next" next="AddObjectToVector4"/>
    <startNode referencedName="ProcessImplicitConsumerGroups-CreateImplicitUserGroupsIteratorForUnregisteredUser"/>
  </nodes>
<!--@Location 7,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector4">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="LoopNode2"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" objectPath="ImplicitUserGroups"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 7,6-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode2" loop="ImplicitUserGroups">
<!--@BendPoints 16,13 16,11 17,11-->
    <nodeSuccessors name="next" next="Pipelet3"/>
    <entry key="UserGroup">
      <nodeSuccessors name="loop_entry_next" next="CallNode6"/>
    </entry>
  </nodes>
<!--@Location 7,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode6">
<!--@BendPoints 15,16 14,16 14,13-->
    <nodeSuccessors name="next" next="LoopNode2_Entry"/>
    <startNode referencedName="ProcessUserGroups-AddUserGroupWithParentsToUserGroups"/>
  </nodes>
<!--@Location 8,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet3">
    <configurationValues name="DefaultUserGroupID" value="Everyone"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetUserGroupByID.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector8"/>
<!--@BendPoints 19,13 19,19-->
    <nodeSuccessors name="pipelet_error" next="JoinNode12"/>
    <parameterBindings name="Domain" objectPath="Organization:OrganizationDomain"/>
    <parameterBindings name="UserGroupID" nullBinding="true"/>
    <returnValueBindings name="UserGroup" objectPath="UserGroup"/>
  </nodes>
<!--@Location 8,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector8">
    <configurationValues name="Mode" value="Forbid Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="Call2"/>
    <parameterBindings name="InVector" objectPath="AllDirectUserGroups"/>
    <parameterBindings name="Object" objectPath="UserGroup"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="AllDirectUserGroups"/>
  </nodes>
<!--@Location 8,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="Call2">
    <nodeSuccessors name="next" next="JoinNode12"/>
    <startNode referencedName="ProcessUserGroups-AddUserGroupWithParentsToUserGroups"/>
  </nodes>
</pipeline:Pipeline>
