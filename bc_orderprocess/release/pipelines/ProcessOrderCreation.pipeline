<?xml version="1.0" encoding="UTF-8"?>
<!--This pipeline handles the subset of promotion actions required during the creation of the order using the basket.
@Group Order-->

<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessOrderCreation" type="process">
<!--Rollback & Begin new Transaction
@Location 7,4-->
  <nodes xsi:type="pipeline:Text" nodeID="Text0"/>
<!--TODO Pipeline rework:
* export:
** uses still CurrentUser
** deeper down: Application is retrieved 
@Location 15,7-->
  <nodes xsi:type="pipeline:Text" nodeID="Text1"/>
<!--TODO Pipeline Rework:
redirect:
* dependency warning from studio
* still retrieves Request
Must be handed in via parameter!
@Location 1,26-->
  <nodes xsi:type="pipeline:Text" nodeID="Text10"/>
<!--Payment already canceled
@Location 34,9-->
  <nodes xsi:type="pipeline:Text" nodeID="Text12"/>
<!--TODO Pipeline rework:
** Violates dependency:
*** Calls Pipeline in sld_ch_sf_base
@Location 12,3-->
  <nodes xsi:type="pipeline:Text" nodeID="Text2"/>
<!--TODO Pipeline Rework:
See notes below!
@Location 13,1-->
  <nodes xsi:type="pipeline:Text" nodeID="Text3"/>
<!--TODO Pipeline rework:
* OnCreateOrder:
** still retrieves CurrentRequest!
@Location 12,5-->
  <nodes xsi:type="pipeline:Text" nodeID="Text4"/>
<!--TODO Pipeline rework:
* gift cards:
** might violate dependency, when 
calling the ac\-pipeline (bc_ must not call ac_)
Must be handed in via parameter!
@Location 15,15-->
  <nodes xsi:type="pipeline:Text" nodeID="Text5"/>
<!--TODO Pipeline rework:
* current user:
** violates dependency 
    (bc must not call app layer)
** needs CurrentSession.
** needs ApplicationBO
** needs CurrentRequest.
** needs CurrentDomain
Those must be handed in via Parameter!
@Location 12,6-->
  <nodes xsi:type="pipeline:Text" nodeID="Text6"/>
<!--TODO Pipeline rework:
*onCreateOrder:
** needs CurrentSession.
** needs Application
Must be handed in via parameter!
@Location 12,8-->
  <nodes xsi:type="pipeline:Text" nodeID="Text7"/>
<!--TODO rework
currently orders are stored in the 
owning domain of the anonymous 
organization. but this may change 
with introduction of an 
OrderBORepository application 
relation
@Location 16,5-->
  <nodes xsi:type="pipeline:Text" nodeID="Text8"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 9,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode12" strict="true" name="AfterCheckoutProcessing"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode6"/>
<!--The affected User.-->
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
<!--The affected Organization.-->
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
<!--The made Order.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
<!--The app context.-->
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
<!--The affected Session.-->
    <parameters name="TargetSession" type="com.intershop.beehive.core.capi.request.Session"/>
<!--The used Domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
<!--The affected Request-->
    <parameters name="Request" type="com.intershop.beehive.core.capi.request.Request"/>
  </nodes>
<!--@Location 9,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode6">
    <nodeSuccessors name="next" next="CallNode8"/>
    <startNode referencedName="ProcessOrderCreation-AfterCheckoutProcessingSuccess"/>
  </nodes>
<!--@Location 9,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode8">
    <nodeSuccessors name="next" next="EndNode3"/>
    <startNode referencedName="ProcessOrderCreation-AfterCheckoutProcessingPromotions"/>
  </nodes>
<!--@Location 9,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode3" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 17,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode3" strict="true" visibility="Private"
      name="AfterCheckoutProcessingFailed" callMode="Private">
    <nodeSuccessors name="next" next="CallNode15"/>
<!--The affected User.-->
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
<!--The made Order.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
  </nodes>
<!--@Location 17,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode15">
    <nodeSuccessors name="next" next="EndNode2"/>
    <startNode referencedName="ProcessOrderCreation-CancelOrder"/>
  </nodes>
<!--@Location 17,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 11,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode11" strict="true" name="AfterCheckoutProcessingPromotions"
      callMode="Private">
<!--@BendPoints 23,4-->
    <nodeSuccessors name="next" next="KeyMapper0"/>
<!--The affected User.-->
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
<!--The affected Organization.-->
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
<!--The made Order.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
<!--The app context.-->
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
<!--The affected Session.-->
    <parameters name="TargetSession" type="com.intershop.beehive.core.capi.request.Session"/>
<!--The used Domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
<!--The affected Request-->
    <parameters name="Request" type="com.intershop.beehive.core.capi.request.Request"/>
  </nodes>
<!--@Location 11,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper0">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode34"/>
    <parameterBindings name="InValue_1" objectPath="OrderBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="Order"/>
  </nodes>
<!--@Location 11,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode34">
    <nodeSuccessors name="next" next="CallNode0"/>
    <parameterBindings name="Session" objectPath="TargetSession"/>
    <startNode referencedName="ProcessPersonalizationGroup-UpdateUserGroupsAndPGID"/>
  </nodes>
<!--@Location 11,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode0">
    <nodeSuccessors name="next" next="CallNode24"/>
    <startNode referencedName="ProcessPromotion-UpdateUserLastOrderDate"/>
  </nodes>
<!--@Location 11,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode24">
<!--@BendPoints 23,12-->
    <nodeSuccessors name="next" next="CallNode32"/>
    <startNode referencedName="ProcessPromotionBudget-OnCreateOrder"/>
  </nodes>
<!--@Location 11,6-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode32">
    <nodeSuccessors name="next" next="CallNode12"/>
    <parameterBindings name="CurrentOrganization" objectPath="Organization"/>
    <parameterBindings name="CurrentUser" objectPath="User"/>
    <startNode referencedName="ProcessUserGroups-GetCurrentUserUserGroups"/>
  </nodes>
<!--@Location 11,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode12">
    <nodeSuccessors name="next" next="CallNode23"/>
    <startNode referencedName="ProcessPromotionCodeForBasket-RemoveOrderAssignments"/>
  </nodes>
<!--@Location 11,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode23">
    <nodeSuccessors name="next" next="EndNode19"/>
    <startNode referencedName="ProcessPromotionCodeForBasket-OnCreateOrder"/>
  </nodes>
<!--@Location 11,9-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode19" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 14,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode2" strict="true" visibility="Private"
      name="AfterCheckoutProcessingSuccess" callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper9"/>
<!--The affected User.-->
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
<!--The affected Organization.-->
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"
        optional="true"/>
<!--The made Order.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
<!--The app context.-->
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
<!--The affected Session.-->
    <parameters name="TargetSession" type="com.intershop.beehive.core.capi.request.Session"/>
<!--The used Domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 14,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper9">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="UpdateOrderBOStatus0" action="begin"/>
    <parameterBindings name="InValue_1" objectPath="ApplicationBO:Repository(&quot;UserBORepository&quot;):UserByID(User:ID):Extension(&quot;UserBOPreferencesExtension&quot;):OrderConfirmationEmails"/>
    <parameterBindings name="InValue_2" objectPath="OrderBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="OrderConfirmationEmails"/>
    <returnValueBindings name="OutValue_2" objectPath="Order"/>
  </nodes>
<!--@Location 14,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderBOStatus0">
    <pipelet href="enfinity:/bc_order/pipelets/UpdateOrderBOStatus.xml"/>
    <nodeSuccessors name="next" next="DecisionNode21" action="commit"/>
    <parameterBindings name="newOrderStatus" constant="NEW"/>
  </nodes>
<!--@Location 14,4-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode21" conditionKey="Organization">
    <nodeSuccessors name="decision_yes" next="KeyMapper12"/>
<!--@BendPoints 31,9-->
    <nodeSuccessors name="decision_no" next="KeyMapper7"/>
  </nodes>
<!--@Location 14,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper12">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode13"/>
    <parameterBindings name="InValue_1" objectPath="Organization:OwningDomain"/>
    <returnValueBindings name="OutValue_1" objectPath="ExportScenarioDomain"/>
  </nodes>
<!--@Location 14,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
    <nodeSuccessors name="next" next="CallNode3"/>
  </nodes>
<!--@Location 14,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode3">
    <nodeSuccessors name="next" next="GetDomainPreference1"/>
    <startNode referencedName="ProcessImmediateOrderExport-StartExport"/>
  </nodes>
<!--@Location 14,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetDomainPreference1">
    <configurationValues name="DefaultPreferenceKey" value="OrderNotificationSendNotification"/>
    <configurationValues name="Type" value="String"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetDomainPreference.xml"/>
    <nodeSuccessors name="next" next="DecisionNode25"/>
<!--@BendPoints 31,17-->
    <nodeSuccessors name="pipelet_error" next="JoinNode8"/>
    <parameterBindings name="PreferenceDomain" objectPath="Order:Domain"/>
    <returnValueBindings name="PreferenceStringValue" objectPath="SendNotificationEMail"/>
  </nodes>
<!--@Location 14,9-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode25" conditionKey="SendNotificationEMail"
      operator="str_eq" conditionValue="yes">
    <nodeSuccessors name="decision_yes" next="DecisionNode11"/>
    <nodeSuccessors name="decision_no" next="JoinNode8"/>
  </nodes>
<!--@Location 14,10-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode11" conditionKey="OrderConfirmationEmails">
    <nodeSuccessors name="decision_yes" next="DecisionNode20"/>
<!--@BendPoints 28,21 28,25-->
    <nodeSuccessors name="decision_no" next="JoinNode9"/>
  </nodes>
<!--@Location 14,11-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode20" conditionKey="OrderConfirmationEmails"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="JoinNode9"/>
    <nodeSuccessors name="decision_no" next="JoinNode6"/>
  </nodes>
<!--@Location 14,12-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
<!--@BendPoints 29,26-->
    <nodeSuccessors name="next" next="ExecutePipeline2"/>
  </nodes>
<!--@Location 14,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecutePipeline2">
    <configurationValues name="Asynchronous" value="true"/>
    <configurationValues name="PipelineName" value="ProcessOrders"/>
    <configurationValues name="PipelineStartNode" value="SendOrderNotificationEMail"/>
    <pipelet href="enfinity:/core/pipelets/ExecutePipeline.xml"/>
    <nodeSuccessors name="next" next="JoinNode5"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode4"/>
    <parameterBindings name="CurrentDomain" objectPath="Domain"/>
    <parameterBindings name="CurrentUser" objectPath="User"/>
    <parameterBindings name="PipelineDomain" objectPath="Domain"/>
  </nodes>
<!--@Location 14,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
    <nodeSuccessors name="next" next="CallNode2"/>
  </nodes>
<!--@Location 14,15-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode2">
    <nodeSuccessors name="False" next="JoinNode12"/>
<!--@BendPoints 30,33-->
    <nodeSuccessors name="True" next="ExecutePipeline0"/>
    <parameterBindings name="CheckDigitalOnly" constant="true"/>
    <parameterBindings name="ProductLineItems" objectPath="OrderBO:ProductLineItemBOs:Iterator"/>
    <startNode referencedName="ProcessGiftCard-HasGiftCards"/>
  </nodes>
<!--@Location 14,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode12">
    <nodeSuccessors name="next" next="CallNode4"/>
  </nodes>
<!--@Location 14,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
    <nodeSuccessors name="next" next="EndNode1"/>
    <startNode referencedName="ProcessAffiliate-BookOrderToAffiliate"/>
  </nodes>
<!--@Location 14,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" strict="true"/>
<!--@Location 15,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecutePipeline0">
    <configurationValues name="Asynchronous" value="true"/>
    <configurationValues name="PipelineName" value="ProcessGiftCard"/>
    <configurationValues name="PipelineStartNode" value="SendGiftCardEmails"/>
    <pipelet href="enfinity:/core/pipelets/ExecutePipeline.xml"/>
    <nodeSuccessors name="next" next="JoinNode11"/>
<!--@BendPoints 33,33 33,35-->
    <nodeSuccessors name="pipelet_error" next="JoinNode11"/>
    <parameterBindings name="CurrentDomain" objectPath="Domain"/>
    <parameterBindings name="CurrentUser" objectPath="User"/>
    <parameterBindings name="PipelineDomain" objectPath="Domain"/>
  </nodes>
<!--@Location 15,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
    <nodeSuccessors name="next" next="JoinNode12"/>
  </nodes>
<!--@Location 15,13-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
<!--@BendPoints 31,29-->
    <nodeSuccessors name="next" next="JoinNode5"/>
  </nodes>
<!--@Location 15,11-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
    <nodeSuccessors name="next" next="JoinNode4"/>
  </nodes>
<!--@Location 15,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
    <nodeSuccessors name="next" next="JoinNode6"/>
  </nodes>
<!--@Location 15,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper7">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
<!--@BendPoints 31,13-->
    <nodeSuccessors name="next" next="JoinNode13"/>
    <parameterBindings name="InValue_1" objectPath="Order:Domain"/>
    <returnValueBindings name="OutValue_1" objectPath="ExportScenarioDomain"/>
  </nodes>
<!--@Location 35,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode4" strict="true" name="CancelOrder"
      callMode="Private">
    <nodeSuccessors name="next" next="UpdateOrderBOStatus1" action="begin"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
<!--The order to cancel.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
<!--The current organization.-->
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"
        optional="true"/>
<!--In case paymant already canceled.-->
    <parameters name="IgnorePaymentCancel" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 35,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderBOStatus1">
    <pipelet href="enfinity:/bc_order/pipelets/UpdateOrderBOStatus.xml"/>
    <nodeSuccessors name="next" next="KeyMapper8"/>
    <parameterBindings name="newOrderStatus" constant="CANCELLED"/>
  </nodes>
<!--@Location 35,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper8">
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 71,8-->
    <nodeSuccessors name="next" next="CallNode5"/>
    <parameterBindings name="InValue_1" objectPath="OrderBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="Order"/>
  </nodes>
<!--@Location 35,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode5">
    <nodeSuccessors name="next" next="CallNode11"/>
    <startNode referencedName="ProcessAffiliate-RemoveRevenue"/>
  </nodes>
<!--@Location 35,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode11">
    <nodeSuccessors name="next" next="RollbackInventoryBooking_g-w58MSUEeer1vdsCEaOpg"/>
    <startNode referencedName="ProcessGiftCard-CancelOrder"/>
  </nodes>
<!--@Location 35,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RollbackInventoryBooking_g-w58MSUEeer1vdsCEaOpg">
    <pipelet href="enfinity:/bts/pipelets/RollbackInventoryBooking.xml"/>
<!--@BendPoints 71,14-->
    <nodeSuccessors name="next" next="GetDomainPreference11"/>
    <parameterBindings name="LineItemCtnr" objectPath="Order"/>
  </nodes>
<!--@Location 35,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetDomainPreference11">
    <configurationValues name="DefaultPreferenceKey" value="OrderNotificationSendNotification"/>
    <configurationValues name="Type" value="String"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetDomainPreference.xml"/>
    <nodeSuccessors name="next" next="DecisionNode24"/>
    <parameterBindings name="PreferenceDomain" objectPath="Order:Domain"/>
    <returnValueBindings name="PreferenceStringValue" objectPath="SendNotificationEMail"/>
  </nodes>
<!--@Location 35,9-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode24" conditionKey="IgnorePaymentCancel">
<!--@BendPoints 73,19-->
    <nodeSuccessors name="decision_yes" next="JoinNode10"/>
    <nodeSuccessors name="decision_no" next="LoopNode1"/>
  </nodes>
<!--@Location 36,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="DecisionNode13" action="commit"/>
  </nodes>
<!--@Location 36,14-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode13" conditionKey="SendNotificationEMail"
      operator="str_eq" conditionValue="yes">
    <nodeSuccessors name="decision_yes" next="Pipelet1"/>
<!--@BendPoints 75,29-->
    <nodeSuccessors name="decision_no" next="JoinNode39"/>
  </nodes>
<!--@Location 36,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet1">
    <configurationValues name="Asynchronous" value="true"/>
    <configurationValues name="PipelineName" value="ProcessOrders"/>
    <configurationValues name="PipelineStartNode" value="SendCancelNotificationEMail"/>
    <pipelet href="enfinity:/core/pipelets/ExecutePipeline.xml"/>
    <nodeSuccessors name="next" next="JoinNode7"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode39"/>
    <parameterBindings name="CurrentUser" objectPath="User"/>
    <parameterBindings name="PipelineDomain" objectPath="CurrentDomain"/>
  </nodes>
<!--@Location 36,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
    <nodeSuccessors name="next" next="EndNode8"/>
  </nodes>
<!--@Location 36,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode8" strict="true"/>
<!--@Location 37,15-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode39">
<!--@BendPoints 75,33-->
    <nodeSuccessors name="next" next="JoinNode7"/>
  </nodes>
<!--@Location 35,10-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode1" loop="Order:PaymentTransaction">
    <nodeSuccessors name="next" next="JoinNode10"/>
    <entry key="PaymentTransaction">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode19"/>
    </entry>
  </nodes>
<!--@Location 35,11-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode19" conditionKey="PaymentTransaction:PaymentService:Capabilities:CancelSupported"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="ProcessPaymentCancel1"/>
    <nodeSuccessors name="decision_no" next="JoinNode47"/>
  </nodes>
<!--@Location 35,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ProcessPaymentCancel1">
    <pipelet href="enfinity:/bts/pipelets/ProcessPaymentCancel.xml"/>
<!--@BendPoints 69,25-->
    <nodeSuccessors name="next" next="JoinNode47"/>
    <nodeSuccessors name="pipelet_error" next="EndNode18" action="rollback"/>
  </nodes>
<!--@Location 34,11-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode47">
<!--@BendPoints 69,21-->
    <nodeSuccessors name="next" next="LoopNode1_Entry"/>
  </nodes>
<!--@Location 35,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode18" name="ERROR" strict="true"/>
<!--Checks is the provided order belongs to the current user. If the order belongs to the current user then the 'Yes' exit is used, otherwise the 'No' exit is used.
@Location 25,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode0" strict="true" name="CheckOrderBelongsToCurrentUser"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode0"/>
<!--The order that needs to be checked.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
  </nodes>
<!--@Location 25,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode0" conditionKey="CurrentUser:ID"
      operator="str_eq" conditionItem="OrderBO:User:ID">
    <nodeSuccessors name="decision_yes" next="EndNode0"/>
<!--@BendPoints 53,5-->
    <nodeSuccessors name="decision_no" next="EndNode7"/>
  </nodes>
<!--@Location 25,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode0" name="Yes" strict="true"/>
<!--@Location 26,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode7" name="No" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 28,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode7" strict="true" name="CreateGiftCards"
      callMode="Private">
    <nodeSuccessors name="next" next="GetApplicationBO1"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
  </nodes>
<!--@Location 28,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO1">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper6"/>
  </nodes>
<!--@Location 28,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper6">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="LoopNode2"/>
    <parameterBindings name="InValue_1" objectPath="ApplicationBO:Repository(&quot;ServiceConfigurationBORepository&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="ServiceConfigurationBORepository"/>
  </nodes>
<!--@Location 28,4-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode2" loop="OrderBO:ProductLineItemBOs">
<!--@BendPoints 59,9-->
    <nodeSuccessors name="next" next="EndNode13"/>
    <entry key="PLI">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode5"/>
    </entry>
  </nodes>
<!--@Location 28,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode5" conditionKey="PLI:CustomAttributes:GC_ORDER_REQUIRED_GiftCardService">
    <nodeSuccessors name="decision_yes" next="CheckForEmptyString0"/>
    <nodeSuccessors name="decision_no" next="JoinNode0"/>
  </nodes>
<!--@Location 28,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckForEmptyString0">
    <pipelet href="enfinity:/core/pipelets/CheckForEmptyString.xml"/>
    <nodeSuccessors name="next" next="CreateGiftCard2"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode32"/>
    <parameterBindings name="FilledString" objectPath="PLI:CustomAttributes:GC_ORDER_REQUIRED_GiftCardService"/>
  </nodes>
<!--@Location 28,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateGiftCard2">
    <pipelet href="enfinity:/bc_giftcard/pipelets/CreateGiftCard.xml"/>
    <nodeSuccessors name="next" next="DecisionNode9"/>
    <parameterBindings name="PLI" objectPath="PLI:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
  </nodes>
<!--@Location 28,8-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode9" conditionKey="GiftCardCreationResult:Status"
      operator="eq" conditionValue="0">
<!--@BendPoints 55,17-->
    <nodeSuccessors name="decision_yes" next="JoinNode32"/>
    <nodeSuccessors name="decision_no" next="End6"/>
  </nodes>
<!--@Location 27,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode32">
    <nodeSuccessors name="next" next="JoinNode0"/>
  </nodes>
<!--@Location 27,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode0">
<!--@BendPoints 55,9-->
    <nodeSuccessors name="next" next="LoopNode2_Entry"/>
  </nodes>
<!--@Location 28,9-->
  <nodes xsi:type="pipeline:EndNode" nodeID="End6" name="ERROR" strict="true"/>
<!--@Location 29,9-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode13" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 1,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="CreateOrder"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper1"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="AllFormValues" type="java.util.Map"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
    <parameters name="SendEmail" type="java.lang.String" optional="true"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
<!--the domain holding the preference 'InventoryService', specifiying the service to be used-->
    <parameters name="PreferenceDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"
        optional="true"/>
    <parameters name="BasketBORepository" type="com.intershop.component.basket.capi.BasketBORepository"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"
        optional="true"/>
    <parameters name="CurrentOrganization" type="com.intershop.component.organization.capi.Organization"
        optional="true"/>
  </nodes>
<!--@Location 1,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper1">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode20"/>
    <parameterBindings name="InValue_1" objectPath="BasketBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="Cart"/>
  </nodes>
<!--@Location 1,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode20">
    <nodeSuccessors name="NO" next="ExtensionPointNode2"/>
<!--@BendPoints 1,8-->
    <nodeSuccessors name="YES" next="EndNode23"/>
<!--@BendPoints 5,7-->
    <nodeSuccessors name="ERROR" next="EndNode24"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="This:CreateRecurringOrder"/>
  </nodes>
<!--@Location 1,5-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode2" name="CreateOrder"
      strict="true">
    <nodeSuccessors name="next" next="DecisionNode16"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode_OzI08FA-Eee-roxHNMm8Bg"/>
<!--The Basket to create the Order from-->
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 1,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode16" conditionKey="BasketBO:ProductLineItemBOs"
      operator="has_elements">
<!--@BendPoints 3,14-->
    <nodeSuccessors name="decision_yes" next="CallNode13" action="begin"/>
    <nodeSuccessors name="decision_no" next="JoinNode_OzI08FA-Eee-roxHNMm8Bg"/>
  </nodes>
<!--@Location 1,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode13">
<!--@BendPoints 6,14 10,10 14,10 15,10-->
    <nodeSuccessors name="next" next="JoinNode49" action="rollback"/>
    <nodeSuccessors name="CompletlyBooked" next="TryLock0"/>
    <parameterBindings name="Domain" objectPath="PreferenceDomain"/>
    <startNode referencedName="ProcessCart-BookBasketInventory"/>
  </nodes>
<!--@Location 7,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode49">
<!--@BendPoints 15,12-->
    <nodeSuccessors name="next" next="CallNode16" action="begin"/>
  </nodes>
<!--@Location 7,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode16">
<!--@BendPoints 15,18-->
    <nodeSuccessors name="next" next="CallNode21"/>
    <startNode referencedName="ProcessCart-AdjustBasketByBookingStatus"/>
  </nodes>
<!--@Location 7,9-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode21">
    <nodeSuccessors name="next" next="JoinNode53"/>
    <startNode referencedName="ProcessCart-Calculate"/>
  </nodes>
<!--@Location 7,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode53">
    <nodeSuccessors name="next" next="JoinNode54"/>
  </nodes>
<!--@Location 7,34-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode54">
    <nodeSuccessors name="next" next="JoinNode36"/>
  </nodes>
<!--@Location 7,35-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode36">
    <nodeSuccessors name="next" next="JoinNode30" action="commit"/>
  </nodes>
<!--@Location 6,36-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode30">
    <nodeSuccessors name="next" next="EndNode10"/>
  </nodes>
<!--@Location 6,37-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode10" name="ERROR" strict="true">
<!--@deprecated-->
    <returnValues name="AuthorizationResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="FailedInventoryIterator" type="java.util.Iterator&lt;com.intershop.beehive.xcs.capi.inventory.InventoryStatus>"
        optional="true"/>
    <returnValues name="AdjustedItems" type="java.util.Map" optional="true"/>
    <returnValues name="NotAvailableProductBOs" type="java.util.Iterator" optional="true"/>
    <returnValues name="NotAvailableProducts" type="java.util.Iterator" optional="true"/>
<!--@deprecated-->
    <returnValues name="PaymentReduceResultsIterator" type="java.util.Iterator" optional="true"/>
<!--@deprecated-->
    <returnValues name="PaymentRefundResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="Reverse_Gift_Card_Creation" type="java.lang.String" optional="true"/>
<!--@deprecated-->
    <returnValues name="PaymentCancelResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"
        optional="true"/>
    <returnValues name="AuthorizationResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>>"
        optional="true"/>
    <returnValues name="PaymentReversalResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result>"
        optional="true"/>
  </nodes>
<!--@Location 2,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="TryLock0">
    <configurationValues name="Timeout" value="10"/>
    <pipelet href="enfinity:/core/pipelets/TryLock.xml"/>
    <nodeSuccessors name="next" next="DecisionNode4"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode46"/>
    <parameterBindings name="LockObject" objectPath="Cart"/>
  </nodes>
<!--@Location 2,9-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="BasketBO:Status"
      operator="str_eq" conditionValue="ORDERED">
    <nodeSuccessors name="decision_yes" next="JoinNode1"/>
    <nodeSuccessors name="decision_no" next="CreateOrdersFromBasket21"/>
  </nodes>
<!--@Location 5,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
    <nodeSuccessors name="next" next="JoinNode21"/>
  </nodes>
<!--@Location 5,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode21">
    <nodeSuccessors name="next" next="JoinNode2"/>
  </nodes>
<!--@Location 5,11-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
    <nodeSuccessors name="next" next="JoinNode20"/>
  </nodes>
<!--@Location 5,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode20">
    <nodeSuccessors name="next" next="JoinNode34"/>
  </nodes>
<!--@Location 5,26-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode34">
    <nodeSuccessors name="next" next="JoinNode28"/>
  </nodes>
<!--@Location 5,35-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode28">
    <nodeSuccessors name="next" next="JoinNode30" action="rollback"/>
  </nodes>
<!--@Location 2,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateOrdersFromBasket21">
    <configurationValues name="OrderType" value="SellerOrder"/>
    <configurationValues name="SelectionMode" value="IgnoreSelected"/>
    <configurationValues name="SplitMode" value="NoSplit"/>
    <pipelet href="enfinity:/bc_requisition/pipelets/CreateOrdersFromBasket2.xml"/>
    <nodeSuccessors name="next" next="GetFirstElementOfIterator1"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode21"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="OrderDomain" objectPath="Organization:OwningDomain"/>
  </nodes>
<!--@Location 2,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetFirstElementOfIterator1">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetFirstElementOfIterator.xml"/>
    <nodeSuccessors name="next" next="AssignOrderDocumentNos1"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode2"/>
    <parameterBindings name="Iterator" objectPath="Orders"/>
    <returnValueBindings name="FirstElement" objectPath="Order"/>
  </nodes>
<!--@Location 2,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AssignOrderDocumentNos1">
    <configurationValues name="DomainSpecific" value="true"/>
    <configurationValues name="NumberPattern" value="00000000"/>
    <configurationValues name="StartWith" value="1"/>
    <pipelet href="enfinity:/bts/pipelets/AssignOrderDocumentNos.xml"/>
    <nodeSuccessors name="next" next="GetOrderBO0"/>
    <parameterBindings name="Orders" nullBinding="true"/>
  </nodes>
<!--@Location 2,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetOrderBO0">
    <pipelet href="enfinity:/bc_order/pipelets/GetOrderBO.xml"/>
    <nodeSuccessors name="next" next="CallNode22"/>
    <parameterBindings name="OrderBORepository" objectPath="ApplicationBO:Repository(&quot;OrderBORepository&quot;)"/>
  </nodes>
<!--@Location 2,14-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode22">
    <nodeSuccessors name="next" next="KeyMapper5"/>
    <nodeSuccessors name="ERROR" next="DecisionNode10"/>
    <startNode referencedName="ProcessPayment-StartPayment"/>
  </nodes>
<!--@Location 2,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper5">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="UpdateLineItemStatus2"/>
    <parameterBindings name="InValue_1" objectPath="OrderBO:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
    <returnValueBindings name="OutValue_1" objectPath="Order"/>
  </nodes>
<!--@Location 2,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateLineItemStatus2">
    <configurationValues name="StatusGroup" value="Order"/>
    <configurationValues name="StatusID" value="10"/>
    <configurationValues name="StatusType" value="Status"/>
    <pipelet href="enfinity:/bc_requisition/pipelets/UpdateLineItemStatus.xml"/>
<!--@BendPoints 5,34-->
    <nodeSuccessors name="next" next="UpdateLineItemStatus1"/>
    <parameterBindings name="InputStatusGroup" nullBinding="true"/>
    <parameterBindings name="InputStatusID" nullBinding="true"/>
    <parameterBindings name="LineItemID" nullBinding="true"/>
    <parameterBindings name="LineItemIDs" nullBinding="true"/>
    <parameterBindings name="Requisition" nullBinding="true"/>
  </nodes>
<!--@Location 2,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateLineItemStatus1">
    <configurationValues name="StatusGroup" value="Order"/>
    <configurationValues name="StatusID" value="10"/>
    <configurationValues name="StatusType" value="Status2"/>
    <pipelet href="enfinity:/bc_requisition/pipelets/UpdateLineItemStatus.xml"/>
    <nodeSuccessors name="next" next="ExtensionPointNode0"/>
    <parameterBindings name="InputStatusGroup" nullBinding="true"/>
    <parameterBindings name="InputStatusID" nullBinding="true"/>
    <parameterBindings name="LineItemID" nullBinding="true"/>
    <parameterBindings name="LineItemIDs" nullBinding="true"/>
    <parameterBindings name="Requisition" nullBinding="true"/>
  </nodes>
<!--@Location 2,18-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode0" name="OrderCreated"
      strict="true">
    <nodeSuccessors name="next" next="DecisionNode3"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
    <parameters name="CurrentSession" type="com.intershop.beehive.core.capi.request.Session"/>
  </nodes>
<!--@Location 2,19-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="CurrentSession:getObject(&quot;T_ABTestMode&quot;)"
      operator="str_eq" conditionValue="Enabled">
    <nodeSuccessors name="decision_yes" next="CallNode18"/>
<!--@BendPoints 6,39 6,43-->
    <nodeSuccessors name="decision_no" next="JoinNode26"/>
  </nodes>
<!--@Location 2,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode18">
    <nodeSuccessors name="next" next="JoinNode26"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="Order" objectPath="Order"/>
    <parameterBindings name="Session" objectPath="CurrentSession"/>
    <startNode referencedName="ProcessABTesting-LogOrderEvents"/>
  </nodes>
<!--@Location 2,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode26">
<!--@BendPoints 5,44-->
    <nodeSuccessors name="next" next="UpdateLineItemStatus11"/>
  </nodes>
<!--@Location 2,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateLineItemStatus11">
    <configurationValues name="StatusGroup" value="Product"/>
    <configurationValues name="StatusID" value="5"/>
    <pipelet href="enfinity:/bc_requisition/pipelets/UpdateLineItemStatus.xml"/>
    <nodeSuccessors name="next" next="KeyMapper3"/>
    <parameterBindings name="InputStatusGroup" nullBinding="true"/>
    <parameterBindings name="InputStatusID" nullBinding="true"/>
    <parameterBindings name="LineItemID" nullBinding="true"/>
    <parameterBindings name="LineItemIDs" nullBinding="true"/>
    <parameterBindings name="Order" nullBinding="true"/>
    <parameterBindings name="Requisition" objectPath="Cart"/>
  </nodes>
<!--@Location 2,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper3">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="LoopNode5"/>
    <parameterBindings name="InValue_1" objectPath="OrderBO:Extension(&quot;Payment&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentExtension"/>
  </nodes>
<!--@Location 2,24-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode5" loop="PaymentExtension:PaymentBOs">
<!--@BendPoints 7,49-->
    <nodeSuccessors name="next" next="AddBasketToBasketHistory0"/>
    <entry key="PaymentBO">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode1"/>
    </entry>
  </nodes>
<!--@Location 2,25-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="PaymentBO:PaymentServiceBO:Extension(&quot;RedirectAfterCheckout&quot;)">
    <nodeSuccessors name="decision_yes" next="CallNode1"/>
<!--@BendPoints 3,51 3,49-->
    <nodeSuccessors name="decision_no" next="LoopNode5_Entry"/>
  </nodes>
<!--@Location 2,26-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
    <nodeSuccessors name="next" next="UpdateOrderBOStatus2"/>
    <nodeSuccessors name="Error" next="AddObjectToVector0"/>
    <parameterBindings name="CallbackPipeline" constant="ViewCheckoutReview-CallbackAfterCheckout"/>
    <parameterBindings name="JumpTargetPipeline" constant="ViewCheckoutConfirmation-FromRedirect"/>
    <startNode referencedName="ProcessPayment-CalculateRedirectURL"/>
  </nodes>
<!--@Location 2,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderBOStatus2">
    <pipelet href="enfinity:/bc_order/pipelets/UpdateOrderBOStatus.xml"/>
    <nodeSuccessors name="next" next="JoinNode31"/>
    <parameterBindings name="newOrderStatus" constant="PENDING"/>
  </nodes>
<!--@Location 2,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode31">
    <nodeSuccessors name="next" next="CallNode19"/>
  </nodes>
<!--@Location 2,29-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode19">
    <nodeSuccessors name="next" next="CallNode26"/>
    <nodeSuccessors name="ERROR" next="CallNode25"/>
    <startNode referencedName="ProcessOrderCreation-CreateGiftCards"/>
  </nodes>
<!--@Location 2,30-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode26">
    <nodeSuccessors name="next" next="ExchangeSessionObject0" action="commit"/>
    <startNode referencedName="ProcessOrderCreation-UpdateWishlistItems"/>
  </nodes>
<!--@Location 2,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExchangeSessionObject0">
    <configurationValues name="ProcessMethod" value="Put Object to Session"/>
    <configurationValues name="SessionObjectName" value="CurrentRedirectBeforeCheckoutPII"/>
    <pipelet href="enfinity:/core/pipelets/ExchangeSessionObject.xml"/>
    <nodeSuccessors name="next" next="JoinNode38"/>
<!--@BendPoints 6,65 6,67-->
    <nodeSuccessors name="pipelet_error" next="JoinNode38"/>
    <parameterBindings name="SaveObject" nullBinding="true"/>
    <parameterBindings name="SessionObjectName" nullBinding="true"/>
  </nodes>
<!--@Location 2,33-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode38">
    <nodeSuccessors name="next" next="EndNode11"/>
  </nodes>
<!--@Location 2,37-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode11" strict="true">
    <returnValues name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"/>
    <returnValues name="RedirectURL" type="java.net.URI" optional="true"/>
    <returnValues name="NotAvailableProducts" type="java.util.Iterator" optional="true"/>
    <returnValues name="NotAvailableProductBOs" type="java.util.Iterator" optional="true"/>
    <returnValues name="AdjustedItems" type="java.util.Map" optional="true"/>
    <returnValues name="Result" type="com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>"
        optional="true"/>
    <returnValues name="AuthorizationResults" type="java.util.Collection&lt;com.intershop.api.service.common.v1.Result&lt;com.intershop.api.service.payment.v1.result.AuthorizationResult>>"
        optional="true"/>
  </nodes>
<!--@Location 3,29-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode25">
<!--@BendPoints 7,60-->
    <nodeSuccessors name="next" next="RollbackInventoryBooking_kY5egMSUEeer1vdsCEaOpg"/>
    <parameterBindings name="Domain" objectPath="Organization:OwningDomain"/>
    <startNode referencedName="ProcessOrderCreation-VoidGiftCards"/>
  </nodes>
<!--@Location 3,30-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RollbackInventoryBooking_kY5egMSUEeer1vdsCEaOpg">
    <pipelet href="enfinity:/bts/pipelets/RollbackInventoryBooking.xml"/>
<!--@BendPoints 7,62-->
    <nodeSuccessors name="next" next="DeterminePaymentAuthorizationSequence0"/>
    <parameterBindings name="LineItemCtnr" objectPath="Cart"/>
  </nodes>
<!--@Location 3,31-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeterminePaymentAuthorizationSequence0">
    <pipelet href="enfinity:/bc_payment/pipelets/DeterminePaymentAuthorizationSequence.xml"/>
<!--@BendPoints 7,64-->
    <nodeSuccessors name="next" next="SetDictionaryValue0"/>
  </nodes>
<!--@Location 3,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue0">
    <configurationValues name="Name" value="Reverse_Gift_Card_Creation"/>
    <configurationValues name="Value" value="true"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/core/pipelets/SetDictionaryValue.xml"/>
<!--@BendPoints 7,66-->
    <nodeSuccessors name="next" next="DecisionNode12"/>
  </nodes>
<!--@Location 3,33-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode12" conditionKey="PaymentTransactionBOs">
    <nodeSuccessors name="decision_yes" next="UpdateOrderBOStatus3"/>
<!--@BendPoints 7,71-->
    <nodeSuccessors name="decision_no" next="JoinNode28"/>
  </nodes>
<!--@Location 4,33-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderBOStatus3">
    <pipelet href="enfinity:/bc_order/pipelets/UpdateOrderBOStatus.xml"/>
    <nodeSuccessors name="next" next="CallNode14"/>
    <parameterBindings name="newOrderStatus" constant="CANCELLED"/>
  </nodes>
<!--@Location 4,34-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode14">
    <nodeSuccessors name="next" next="JoinNode54"/>
    <startNode referencedName="ProcessPayment-RevertAuthorization"/>
  </nodes>
<!--@Location 4,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector0">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/core/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="JoinNode34"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" objectPath="AuthorizationResult"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="AuthorizationResultsIterator"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 3,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddBasketToBasketHistory0">
    <configurationValues name="BasketType" value="REQUISITION"/>
    <pipelet href="enfinity:/bts/pipelets/AddBasketToBasketHistory.xml"/>
<!--@BendPoints 7,57-->
    <nodeSuccessors name="next" next="JoinNode31"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
  </nodes>
<!--Check if order status is 'CANCELLED'
@Location 3,14-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode10" conditionKey="OrderBO:Status"
      operator="str_eq" conditionValue="CANCELLED">
<!--@BendPoints 7,30-->
    <nodeSuccessors name="decision_yes" next="RollbackInventoryBooking_m8WSsMSUEeer1vdsCEaOpg"/>
    <nodeSuccessors name="decision_no" next="JoinNode20"/>
  </nodes>
<!--@Location 3,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RollbackInventoryBooking_m8WSsMSUEeer1vdsCEaOpg">
    <pipelet href="enfinity:/bts/pipelets/RollbackInventoryBooking.xml"/>
<!--@BendPoints 7,32-->
    <nodeSuccessors name="next" next="UpdateLineItemStatus3"/>
    <parameterBindings name="LineItemCtnr" objectPath="Cart"/>
  </nodes>
<!--@Location 3,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateLineItemStatus3">
    <configurationValues name="StatusGroup" value="Order"/>
    <configurationValues name="StatusID" value="10"/>
    <configurationValues name="StatusType" value="Status"/>
    <pipelet href="enfinity:/bc_requisition/pipelets/UpdateLineItemStatus.xml"/>
<!--@BendPoints 7,34-->
    <nodeSuccessors name="next" next="UpdateLineItemStatus4"/>
    <parameterBindings name="InputStatusGroup" nullBinding="true"/>
    <parameterBindings name="InputStatusID" nullBinding="true"/>
    <parameterBindings name="LineItemID" nullBinding="true"/>
    <parameterBindings name="LineItemIDs" nullBinding="true"/>
    <parameterBindings name="Requisition" nullBinding="true"/>
  </nodes>
<!--@Location 3,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateLineItemStatus4">
    <configurationValues name="StatusGroup" value="Order"/>
    <configurationValues name="StatusID" value="10"/>
    <configurationValues name="StatusType" value="Status2"/>
    <pipelet href="enfinity:/bc_requisition/pipelets/UpdateLineItemStatus.xml"/>
<!--@BendPoints 7,37-->
    <nodeSuccessors name="next" next="JoinNode53"/>
    <parameterBindings name="InputStatusGroup" nullBinding="true"/>
    <parameterBindings name="InputStatusID" nullBinding="true"/>
    <parameterBindings name="LineItemID" nullBinding="true"/>
    <parameterBindings name="LineItemIDs" nullBinding="true"/>
    <parameterBindings name="Requisition" nullBinding="true"/>
  </nodes>
<!--@Location 5,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode46">
    <nodeSuccessors name="next" next="JoinNode1"/>
  </nodes>
<!--@Location 6,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_OzI08FA-Eee-roxHNMm8Bg">
    <nodeSuccessors name="next" next="JoinNode_hgbTIFBBEeelBaiGiN5RtA"/>
  </nodes>
<!--@Location 6,35-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_hgbTIFBBEeelBaiGiN5RtA">
    <nodeSuccessors name="next" next="JoinNode30"/>
  </nodes>
<!--@Location 0,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode23" name="RECURRING_ORDER_SUCCESS"
      strict="true"/>
<!--@Location 2,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode24" name="RECURRING_ORDER_FAILED"
      strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 43,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode15" strict="true" name="CreateRecurringOrder"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode22"/>
    <parameters name="BasketBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
    <parameters name="Basket" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
  </nodes>
<!--@Location 43,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode22" conditionKey="BasketBO:Extension(&quot;RecurringBasket&quot;):isRecurring"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="CallNode7"/>
    <nodeSuccessors name="decision_no" next="EndNode22"/>
  </nodes>
<!--@Location 43,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode7">
    <nodeSuccessors name="next" next="CreateRecurringOrder0" action="begin"/>
    <parameterBindings name="Cart" objectPath="Basket"/>
    <startNode referencedName="ProcessCart-Calculate"/>
  </nodes>
<!--@Location 43,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateRecurringOrder0">
    <pipelet href="enfinity:/bc_order_service/pipelets/CreateRecurringOrder.xml"/>
    <nodeSuccessors name="next" next="EndNode20" action="commit"/>
    <nodeSuccessors name="pipelet_error" next="EndNode21" action="rollback"/>
    <parameterBindings name="Site" objectPath="CurrentDomain:Site"/>
  </nodes>
<!--@Location 43,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode20" name="YES" strict="true"/>
<!--@Location 44,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode21" name="ERROR" strict="true"/>
<!--@Location 44,2-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode22" name="NO" strict="true"/>
<!--@Location 23,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode6" strict="true" name="GetOrderBO"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode2"/>
    <parameters name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"
        optional="true"/>
<!--The repository that handles the life cycle management of the order business object.-->
    <parameters name="OrderBORepository" type="com.intershop.component.order.capi.OrderBORepository"/>
  </nodes>
<!--@Location 23,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="Order">
    <nodeSuccessors name="decision_yes" next="GetOrderBO1"/>
<!--@BendPoints 48,5 48,9-->
    <nodeSuccessors name="decision_no" next="JoinNode25"/>
  </nodes>
<!--@Location 23,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetOrderBO1">
    <pipelet href="enfinity:/bc_order/pipelets/GetOrderBO.xml"/>
    <nodeSuccessors name="next" next="JoinNode25"/>
  </nodes>
<!--@Location 23,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode25">
    <nodeSuccessors name="next" next="EndNode14"/>
  </nodes>
<!--@Location 23,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode14" strict="true">
    <returnValues name="OrderBO" type="com.intershop.component.order.capi.OrderBO"
        optional="true"/>
  </nodes>
<!--@Location 21,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode5" strict="true" name="GetOrderByDocumentNo"
      callMode="Private">
<!--@BendPoints 43,4-->
    <nodeSuccessors name="next" next="CreateOrderRef1"/>
    <parameters name="OrderNumber" type="java.lang.String"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
  </nodes>
<!--@Location 21,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateOrderRef1">
    <pipelet href="enfinity:/bc_requisition/pipelets/CreateOrderRef.xml"/>
<!--@BendPoints 43,6-->
    <nodeSuccessors name="next" next="GetOrderByID1"/>
    <parameterBindings name="DocumentNo" objectPath="OrderNumber"/>
    <parameterBindings name="DomainName" objectPath="Domain:DomainName"/>
    <parameterBindings name="Order" nullBinding="true"/>
    <parameterBindings name="OrderTypeName" constant="SellerOrder"/>
  </nodes>
<!--@Location 21,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetOrderByID1">
    <pipelet href="enfinity:/bc_requisition/pipelets/GetOrderByID.xml"/>
    <nodeSuccessors name="next" next="GetOrderBO2"/>
<!--@BendPoints 45,7 45,12-->
    <nodeSuccessors name="pipelet_error" next="EndNode9"/>
    <parameterBindings name="OrderID" nullBinding="true"/>
    <parameterBindings name="OrderIDs" nullBinding="true"/>
    <parameterBindings name="OrderRefIDs" nullBinding="true"/>
    <returnValueBindings name="Orders" nullBinding="true"/>
  </nodes>
<!--@Location 21,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetOrderBO2">
    <pipelet href="enfinity:/bc_order/pipelets/GetOrderBO.xml"/>
    <nodeSuccessors name="next" next="CallNode9"/>
    <parameterBindings name="OrderBORepository" objectPath="ApplicationBO:Repository(&quot;OrderBORepository&quot;)"/>
  </nodes>
<!--@Location 21,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode9">
    <nodeSuccessors name="next" next="EndNode12"/>
    <parameterBindings name="LineItemCtnr" objectPath="Order"/>
    <startNode referencedName="ProcessOrders-GetNotificationMailTo"/>
  </nodes>
<!--@Location 21,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode12" strict="true">
<!--The found order.-->
    <returnValues name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"/>
    <returnValues name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
  </nodes>
<!--@Location 22,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode9" name="ERROR" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 40,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode10" strict="true" name="GetWishlistItem"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode14"/>
    <parameters name="WishlistItemID" type="java.lang.String" optional="true"/>
    <parameters name="WishlistID" type="java.lang.String" optional="true"/>
    <parameters name="WishlistOwnerID" type="java.lang.String" optional="true"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"/>
    <parameters name="CurrentOrganization" type="com.intershop.component.organization.capi.Organization"/>
  </nodes>
<!--@Location 40,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode14" conditionKey="WishlistOwnerID">
    <nodeSuccessors name="decision_yes" next="DecisionNode15"/>
<!--@BendPoints 83,5-->
    <nodeSuccessors name="decision_no" next="JoinNode41"/>
  </nodes>
<!--@Location 40,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode15" conditionKey="WishlistID">
    <nodeSuccessors name="decision_yes" next="DecisionNode17"/>
    <nodeSuccessors name="decision_no" next="JoinNode41"/>
  </nodes>
<!--@Location 40,4-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode17" conditionKey="WishlistItemID">
    <nodeSuccessors name="decision_yes" next="KeyMapper2"/>
    <nodeSuccessors name="decision_no" next="JoinNode42"/>
  </nodes>
<!--@Location 40,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper2">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 81,12-->
    <nodeSuccessors name="next" next="GetUserBO1"/>
    <parameterBindings name="InValue_1" objectPath="ApplicationBO:Repository(&quot;UserBORepository&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="UserBORepository"/>
  </nodes>
<!--@Location 40,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserBO1">
    <pipelet href="enfinity:/bc_user/pipelets/GetUserBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper4"/>
    <parameterBindings name="UserID" objectPath="WishlistOwnerID"/>
  </nodes>
<!--@Location 40,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper4">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 81,16-->
    <nodeSuccessors name="next" next="GetWishlistBO1"/>
    <parameterBindings name="InValue_1" objectPath="UserBO:Extension(&quot;Wishlist&quot;)"/>
    <returnValueBindings name="OutValue_1" objectPath="WishlistBORepository"/>
  </nodes>
<!--@Location 40,8-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetWishlistBO1">
    <pipelet href="enfinity:/bc_wishlist/pipelets/GetWishlistBO.xml"/>
<!--@BendPoints 81,18-->
    <nodeSuccessors name="next" next="GetWishlistItemBO1"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode43"/>
  </nodes>
<!--@Location 40,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetWishlistItemBO1">
    <pipelet href="enfinity:/bc_wishlist/pipelets/GetWishlistItemBO.xml"/>
    <nodeSuccessors name="next" next="JoinNode40"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode44"/>
  </nodes>
<!--@Location 40,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode40">
    <nodeSuccessors name="next" next="EndNode17"/>
  </nodes>
<!--@Location 40,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode17" strict="true">
    <returnValues name="WishlistItemBO" type="com.intershop.component.wishlist.capi.WishlistItemBO"
        optional="true"/>
  </nodes>
<!--@Location 41,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode44">
<!--@BendPoints 83,21-->
    <nodeSuccessors name="next" next="JoinNode40"/>
  </nodes>
<!--@Location 41,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode43">
    <nodeSuccessors name="next" next="JoinNode44"/>
  </nodes>
<!--@Location 41,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode42">
    <nodeSuccessors name="next" next="JoinNode43"/>
  </nodes>
<!--@Location 41,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode41">
    <nodeSuccessors name="next" next="JoinNode42"/>
  </nodes>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 17,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode14" strict="true" name="OnPaymentNotificationFailure"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode8"/>
<!--
-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 17,23-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode8" conditionKey="Result:Output:Class:SimpleName"
      operator="str_eq" conditionValue="CancelResult">
    <nodeSuccessors name="decision_yes" next="GetApplicationBO2"/>
<!--@BendPoints 37,47 37,57-->
    <nodeSuccessors name="decision_no" next="JoinNode3"/>
  </nodes>
<!--@Location 17,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO2">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper10"/>
  </nodes>
<!--@Location 17,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper10">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode10"/>
    <parameterBindings name="InValue_1" objectPath="PaymentBO:Extension(&quot;Order&quot;):Order"/>
    <returnValueBindings name="OutValue_1" objectPath="OrderBO"/>
  </nodes>
<!--@Location 17,26-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode10">
    <nodeSuccessors name="next" next="ExtensionPointNode1"/>
    <parameterBindings name="User" objectPath="CurrentUser"/>
    <startNode referencedName="ProcessOrderCreation-AfterCheckoutProcessingFailed"/>
  </nodes>
<!--ExtensionPoint called in case a FAILED notification for a asynchronous redirect for authorization was recieved.
@Location 17,27-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode1" name="AfterCheckoutProcessingNotificationFailure"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode3"/>
<!--The made Order.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
<!--
-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 17,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
    <nodeSuccessors name="next" next="EndNode5"/>
  </nodes>
<!--@Location 17,29-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode5" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 14,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode13" strict="true" name="OnPaymentNotificationSuccess"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode23"/>
<!--
-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 14,23-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode23" conditionKey="Result:Output:Class:SimpleName"
      operator="str_eq" conditionValue="AuthorizationResult">
    <nodeSuccessors name="decision_yes" next="GetApplicationBO0"/>
<!--@BendPoints 31,47 31,49 31,57-->
    <nodeSuccessors name="decision_no" next="JoinNode16"/>
  </nodes>
<!--@Location 14,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO0">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="KeyMapper11"/>
  </nodes>
<!--@Location 14,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper11">
    <pipelet href="enfinity:/core/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode17"/>
    <parameterBindings name="InValue_1" objectPath="PaymentBO:Extension(&quot;Order&quot;):Order"/>
    <returnValueBindings name="OutValue_1" objectPath="OrderBO"/>
  </nodes>
<!--@Location 14,26-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode17">
    <nodeSuccessors name="next" next="ExtensionPointNode3"/>
    <parameterBindings name="Domain" objectPath="CurrentDomain"/>
    <parameterBindings name="Organization" objectPath="CurrentOrganization"/>
    <parameterBindings name="TargetSession" objectPath="CurrentSession"/>
    <parameterBindings name="User" objectPath="CurrentUser"/>
    <startNode referencedName="ProcessOrderCreation-AfterCheckoutProcessingSuccess"/>
  </nodes>
<!--ExtensionPoint called in case a SUCCESS notification for a asynchronous redirect for authorization was recieved.
@Location 14,27-->
  <nodes xsi:type="pipeline:ExtensionPointNode" nodeID="ExtensionPointNode3" name="AfterCheckoutProcessingNotificationSuccess"
      strict="true">
    <nodeSuccessors name="next" next="JoinNode16"/>
<!--The made Order.-->
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
<!--
-->
    <parameters name="PaymentBO" type="com.intershop.component.payment.capi.PaymentBO"/>
    <parameters name="Result" type="com.intershop.api.service.common.v1.Result"/>
  </nodes>
<!--@Location 14,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode16">
    <nodeSuccessors name="next" next="EndNode4"/>
  </nodes>
<!--@Location 14,29-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode4" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 37,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode9" strict="true" name="UpdateWishlistItems"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode18"/>
    <parameters name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"/>
    <parameters name="ApplicationBO" type="com.intershop.component.application.capi.ApplicationBO"
        optional="true"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
  </nodes>
<!--@Location 37,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode18" conditionKey="ApplicationBO">
    <nodeSuccessors name="decision_yes" next="LoopNode4"/>
<!--@BendPoints 79,5-->
    <nodeSuccessors name="decision_no" next="JoinNode45"/>
  </nodes>
<!--@Location 37,3-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode4" loop="Order:ProductLineItems">
    <nodeSuccessors name="next" next="JoinNode45"/>
    <entry key="PLI">
      <nodeSuccessors name="loop_entry_next" next="CallNode28"/>
    </entry>
  </nodes>
<!--@Location 37,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode28">
    <nodeSuccessors name="next" next="DecisionNode7"/>
    <parameterBindings name="CurrentOrganization" objectPath="Organization"/>
    <parameterBindings name="WishlistID" objectPath="PLI:WishlistID"/>
    <parameterBindings name="WishlistItemID" objectPath="PLI:WishlistItemID"/>
    <parameterBindings name="WishlistOwnerID" objectPath="PLI:WishlistOwnerID"/>
    <startNode referencedName="ProcessOrderCreation-GetWishlistItem"/>
  </nodes>
<!--@Location 37,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode7" conditionKey="WishlistItemBO">
    <nodeSuccessors name="decision_yes" next="CalculateQuantity1"/>
<!--@BendPoints 77,11-->
    <nodeSuccessors name="decision_no" next="JoinNode35"/>
  </nodes>
<!--@Location 37,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CalculateQuantity1">
    <configurationValues name="OperationType" value="addition"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CalculateQuantity.xml"/>
    <nodeSuccessors name="next" next="UpdateWishlistItemBO1"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode35"/>
    <parameterBindings name="OperandA" objectPath="WishlistItemBO:PurchasedQuantity"/>
    <parameterBindings name="OperandB" objectPath="PLI:Quantity"/>
    <returnValueBindings name="Result" objectPath="PurchasedQuantity"/>
  </nodes>
<!--@Location 37,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateWishlistItemBO1">
    <pipelet href="enfinity:/bc_wishlist/pipelets/UpdateWishlistItemBO.xml"/>
    <nodeSuccessors name="next" next="JoinNode15"/>
    <parameterBindings name="DesiredQuantity" nullBinding="true"/>
    <parameterBindings name="Public" nullBinding="true"/>
  </nodes>
<!--@Location 37,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode15">
<!--@BendPoints 74,17 74,7-->
    <nodeSuccessors name="next" next="LoopNode4_Entry"/>
  </nodes>
<!--@Location 38,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode35">
<!--@BendPoints 77,17-->
    <nodeSuccessors name="next" next="JoinNode15"/>
  </nodes>
<!--@Location 39,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode45">
    <nodeSuccessors name="next" next="EndNode16"/>
  </nodes>
<!--@Location 39,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode16" strict="true"/>
<!--@deprecated
Deprecated since 7.9.0.0, will be removed in one of the next releases. Use HandlerChain\-based order creation instead.
@Location 31,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode8" strict="true" name="VoidGiftCards"
      callMode="Private">
    <nodeSuccessors name="next" next="LoopNode3"/>
    <parameters name="OrderBO" type="com.intershop.component.order.capi.OrderBO"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 31,2-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode3" loop="OrderBO:ProductLineItemBOs">
<!--@BendPoints 67,5 67,8-->
    <nodeSuccessors name="next" next="EndNode15"/>
    <entry key="PLI">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode6"/>
    </entry>
  </nodes>
<!--@Location 31,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode6" conditionKey="PLI:GC_ORDER_REQUIRED_GiftCardService">
<!--@BendPoints 63,8-->
    <nodeSuccessors name="decision_yes" next="CheckForEmptyString10"/>
<!--@BendPoints 65,7-->
    <nodeSuccessors name="decision_no" next="JoinNode37"/>
  </nodes>
<!--@Location 31,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckForEmptyString10">
    <pipelet href="enfinity:/bc_foundation/pipelets/CheckForEmptyString.xml"/>
<!--@BendPoints 63,10-->
    <nodeSuccessors name="next" next="VoidGiftCards1"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode37"/>
    <parameterBindings name="FilledString" objectPath="PLI:GC_ORDER_REQUIRED_GiftCardService"/>
  </nodes>
<!--@Location 31,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="VoidGiftCards1">
    <pipelet href="enfinity:/bc_giftcard/pipelets/VoidGiftCards.xml"/>
    <nodeSuccessors name="next" next="JoinNode33"/>
    <parameterBindings name="ProductLineItem" objectPath="PLI:Extension(&quot;PersistentObjectBOExtension&quot;):PersistentObject"/>
  </nodes>
<!--@Location 31,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode33">
<!--@BendPoints 62,13 62,5-->
    <nodeSuccessors name="next" next="LoopNode3_Entry"/>
  </nodes>
<!--@Location 32,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode37">
<!--@BendPoints 65,13-->
    <nodeSuccessors name="next" next="JoinNode33"/>
  </nodes>
<!--@Location 33,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode15" strict="true"/>
</pipeline:Pipeline>
