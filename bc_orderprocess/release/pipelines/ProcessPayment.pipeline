<?xml version="1.0" encoding="UTF-8"?>
<!--@deprecated
Deprecated since 7.8.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
This pipeline contains processing pipelines for payment methods.
@Group Payment-->

<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessPayment" overrideMode="Inherit" type="process">
<!--Ensures that the selected
 payment method is always
 accessible by the user.
@Location 3,21-->
  <nodes xsi:type="pipeline:Text" nodeID="TextNode1"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.

@Location 4,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode13" strict="true" name="AssignPIItoCart"
      callMode="Private">
<!--@BendPoints 9,4-->
    <nodeSuccessors name="next" next="SetPaymentInstrumentInfoOwner1"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.LineItemCtnr"
        optional="true"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 4,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetPaymentInstrumentInfoOwner1">
    <pipelet href="enfinity:/bts/pipelets/SetPaymentInstrumentInfoOwner.xml"/>
<!--@BendPoints 9,6-->
    <nodeSuccessors name="next" next="DecisionNode19"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="Domain" nullBinding="true"/>
    <parameterBindings name="User" nullBinding="true"/>
  </nodes>
<!--@Location 4,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode19" conditionKey="PaymentInstrumentInfo:PaymentService:Capabilities:OpenTender"
      operator="str_eq" conditionValue="false">
<!--@BendPoints 9,8-->
    <nodeSuccessors name="decision_yes" next="CallNode12"/>
<!--@BendPoints 10,7 10,11-->
    <nodeSuccessors name="decision_no" next="JoinNode16"/>
  </nodes>
<!--@Location 4,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode12">
    <nodeSuccessors name="next" next="JoinNode16"/>
    <parameterBindings name="PII" objectPath="PaymentInstrumentInfo"/>
    <startNode referencedName="ProcessPaymentInstrument-DetermineTenderBalance"/>
  </nodes>
<!--@Location 4,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode16">
    <nodeSuccessors name="next" next="DecisionNode48"/>
  </nodes>
<!--@Location 4,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode48" conditionKey="PaymentInstrumentInfo:OriginUUIDNull"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 11,13-->
    <nodeSuccessors name="decision_yes" next="SetPaymentInstrumentInfoOrigin0" action="begin"/>
    <nodeSuccessors name="decision_no" next="JoinNode51"/>
  </nodes>
<!--@Location 5,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetPaymentInstrumentInfoOrigin0">
    <pipelet href="enfinity:/bts/pipelets/SetPaymentInstrumentInfoOrigin.xml"/>
<!--@BendPoints 11,17-->
    <nodeSuccessors name="next" next="JoinNode51" action="commit"/>
    <parameterBindings name="OriginUUID" objectPath="PaymentInstrumentInfo:UUID"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 4,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode51">
    <nodeSuccessors name="next" next="CallNode44"/>
  </nodes>
<!--@Location 4,9-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode44">
    <nodeSuccessors name="next" next="EndNode39"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 4,10-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode39" name="" strict="true">
    <returnValues name="PaymentTenderBalanceResult" type="com.intershop.beehive.bts.capi.payment.TenderBalanceResult"
        optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 10,5-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode10" strict="true" name="AssignPIItoUser"
      callMode="Private">
<!--@BendPoints 21,12-->
    <nodeSuccessors name="next" next="SetPaymentInstrumentInfoOwner2"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User" optional="true"/>
  </nodes>
<!--@Location 10,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetPaymentInstrumentInfoOwner2">
    <pipelet href="enfinity:/bts/pipelets/SetPaymentInstrumentInfoOwner.xml"/>
<!--@BendPoints 21,14-->
    <nodeSuccessors name="next" next="EndNode14"/>
    <parameterBindings name="Basket" nullBinding="true"/>
    <parameterBindings name="Domain" nullBinding="true"/>
  </nodes>
<!--@Location 10,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode14" name="" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 35,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode19" strict="true" name="CheckDefaultSettings"
      callMode="Private">
<!--@BendPoints 71,4-->
    <nodeSuccessors name="next" next="GetOrganizationByDomain3"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
    <parameters name="BasketBORepository" type="com.intershop.component.basket.capi.BasketBORepository"/>
  </nodes>
<!--@Location 35,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetOrganizationByDomain3">
    <pipelet href="enfinity:/bc_organization/pipelets/GetOrganizationByDomain.xml"/>
<!--@BendPoints 71,6-->
    <nodeSuccessors name="next" next="Call1"/>
    <parameterBindings name="OrganizationDomain" objectPath="Cart:Domain"/>
  </nodes>
<!--@Location 35,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="Call1">
<!--@BendPoints 71,8-->
    <nodeSuccessors name="next" next="CheckPaymentMethodApplicable1"/>
    <parameterBindings name="CurrencyMnemonic" objectPath="Cart:PurchaseCurrencyCode"/>
    <parameterBindings name="CurrentApplication" objectPath="CurrentAppContext:Variables:Application"/>
    <parameterBindings name="User" objectPath="CurrentUser"/>
    <startNode referencedName="ProcessPayment-GetActivePaymentMethods"/>
  </nodes>
<!--@Location 35,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckPaymentMethodApplicable1">
    <pipelet href="enfinity:/bts/pipelets/CheckPaymentMethodApplicable.xml"/>
<!--@BendPoints 71,10-->
    <nodeSuccessors name="next" next="CallNode27"/>
<!--@BendPoints 77,9-->
    <nodeSuccessors name="pipelet_error" next="LoopNode12"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="PaymentConfigurations" objectPath="ActivePaymentConfigurations"/>
  </nodes>
<!--@Location 35,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode27">
<!--@BendPoints 71,12-->
    <nodeSuccessors name="next" next="CallNode22"/>
<!--@BendPoints 73,13-->
    <nodeSuccessors name="ERROR" next="JoinNode24"/>
    <startNode referencedName="This:CheckSelectedPayment"/>
  </nodes>
<!--@Location 35,6-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode22">
    <nodeSuccessors name="next" next="CallNode3"/>
    <nodeSuccessors name="ERROR" next="JoinNode24"/>
    <startNode referencedName="This:CheckPaymentOnDeliveryCompatibility"/>
  </nodes>
<!--@Location 35,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode3">
    <nodeSuccessors name="next" next="CheckBasketCovered1"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessCart-GetCurrentCartBO"/>
  </nodes>
<!--@Location 35,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckBasketCovered1">
    <pipelet href="enfinity:/sld_ch_b2c_base/pipelets/CheckBasketCovered.xml"/>
    <nodeSuccessors name="next" next="DecisionNode24"/>
    <parameterBindings name="CartBO" objectPath="BasketBO"/>
  </nodes>
<!--@Location 35,10-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode24" conditionKey="BasketCovered"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 71,22-->
    <nodeSuccessors name="decision_yes" next="EndNode24"/>
<!--@BendPoints 73,21-->
    <nodeSuccessors name="decision_no" next="JoinNode24"/>
  </nodes>
<!--@Location 35,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode24" name="" strict="true"/>
<!--@Location 36,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode24">
<!--@BendPoints 74,15-->
    <nodeSuccessors name="next" next="EndNode36"/>
  </nodes>
<!--@Location 37,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode36" name="ERROR" strict="true"/>
<!--@Location 38,5-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode12" loop="Cart:PaymentInstrumentInfo">
    <nodeSuccessors name="next" next="EndNode35"/>
    <entry key="PaymentInstrumentInfo">
<!--@BendPoints 77,12-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode34"/>
    </entry>
  </nodes>
<!--@Location 38,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode34" conditionKey="Errors:get(PaymentInstrumentInfo:UUID)">
<!--@BendPoints 77,14-->
    <nodeSuccessors name="decision_yes" next="RemovePaymentInstrumentInfo2"/>
<!--@BendPoints 78,13 78,17-->
    <nodeSuccessors name="decision_no" next="JoinNode41"/>
  </nodes>
<!--@Location 38,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemovePaymentInstrumentInfo2">
    <pipelet href="enfinity:/bts/pipelets/RemovePaymentInstrumentInfo.xml"/>
    <nodeSuccessors name="next" next="JoinNode41"/>
  </nodes>
<!--@Location 38,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode41">
<!--@BendPoints 76,17 76,11-->
    <nodeSuccessors name="next" next="LoopNode12_Entry"/>
  </nodes>
<!--@Location 39,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode35" name="ERROR" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 36,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode25" strict="true" name="CheckIfCartHasDigitalFreight"
      callMode="Private">
<!--@BendPoints 73,30-->
    <nodeSuccessors name="next" next="LoopNode10"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 36,15-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode10" loop="Cart:IndependentProductLineItems">
<!--@BendPoints 75,31 75,41-->
    <nodeSuccessors name="next" next="JoinNode27"/>
    <entry key="ProductLineItem">
<!--@BendPoints 73,32-->
      <nodeSuccessors name="loop_entry_next" next="GetFreightClassByProductRef1"/>
    </entry>
  </nodes>
<!--@Location 36,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetFreightClassByProductRef1">
    <pipelet href="enfinity:/bc_shipping/pipelets/GetFreightClassByProductRef.xml"/>
<!--@BendPoints 73,34 72,34 72,35-->
    <nodeSuccessors name="next" next="DecisionNode22"/>
    <parameterBindings name="ProductRef" objectPath="ProductLineItem:OfferProductRef"/>
  </nodes>
<!--@Location 36,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode22" conditionKey="FreightClass:Digital"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 74,35 74,38 73,38-->
    <nodeSuccessors name="decision_yes" next="SetDictionaryValue3"/>
<!--@BendPoints 73,36 71,36 71,31-->
    <nodeSuccessors name="decision_no" next="LoopNode10_Entry"/>
  </nodes>
<!--@Location 36,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue3">
    <configurationValues name="Name" value="CartHasProductWithDigitalFreightClass"/>
    <configurationValues name="Value" value="true"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
    <nodeSuccessors name="next" next="JoinNode27"/>
  </nodes>
<!--@Location 36,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode27">
<!--@BendPoints 73,42-->
    <nodeSuccessors name="next" next="EndNode40"/>
  </nodes>
<!--@Location 36,21-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode40" name="" strict="true">
    <returnValues name="CartHasProductWithDigitalFreightClass" type="java.lang.String"
        optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 1,31-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode5" strict="true" name="CheckPayment"
      callMode="Private">
    <nodeSuccessors name="next" next="GetBasketBORepositoryFromAppContext0"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
    <parameters name="UserGroups" type="java.util.Iterator" optional="true"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="Request" type="com.intershop.beehive.core.capi.request.Request"/>
    <parameters name="CurrentApplication" type="com.intershop.beehive.core.capi.domain.Application"/>
  </nodes>
<!--@Location 1,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBORepositoryFromAppContext0">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBORepositoryFromAppContext.xml"/>
    <nodeSuccessors name="next" next="GetBasketBO1"/>
  </nodes>
<!--@Location 1,33-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBO1">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBO.xml"/>
    <nodeSuccessors name="next" next="ValidateBasket0_Input"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
  </nodes>
<!--@Location 1,34-->
  <nodes xsi:type="pipeline:PipelineNodeNode" nodeID="ValidateBasket0">
    <configurationValues name="AllowAdjustments" value="true"/>
    <configurationValues name="StopOnError" value="StopOnError"/>
    <pipelet href="enfinity:/bc_basket/pipelets/com.intershop.component.basket.pipelet.ValidateBasket.pipelinenode"/>
    <inConnectors name="Input">
      <parameterBindings name="Scopes" constant="Payment"/>
    </inConnectors>
    <outConnectors name="Success">
      <nodeSuccessors next="EndNode10"/>
    </outConnectors>
    <outConnectors name="Error">
      <nodeSuccessors next="SetDictionaryValue2"/>
    </outConnectors>
    <outConnectors name="Adjusted">
      <nodeSuccessors next="SetDictionaryValue2"/>
    </outConnectors>
  </nodes>
<!--@Location 1,36-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode10" name="" strict="true"/>
<!--@Location 2,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue2">
    <configurationValues name="Name" value="ERROR_PaymentSelection"/>
    <configurationValues name="Value" value="true"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
    <nodeSuccessors name="next" next="EndNode9"/>
  </nodes>
<!--@Location 2,36-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode9" name="ERROR" strict="true">
    <returnValues name="ERROR_PaymentSelection" type="java.lang.String" optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 39,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode24" strict="true" name="CheckPaymentOnDeliveryCompatibility"
      callMode="Private">
<!--@BendPoints 79,30-->
    <nodeSuccessors name="next" next="LoopNode9"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 39,15-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode9" loop="Cart:PaymentInstrumentInfo">
<!--@BendPoints 81,31-->
    <nodeSuccessors name="next" next="JoinNode28"/>
    <entry key="PaymentInstrumentInfo">
<!--@BendPoints 79,32-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode21"/>
    </entry>
  </nodes>
<!--@Location 39,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode21" conditionKey="PaymentInstrumentInfo:PaymentService:Capabilities:PaymentOnDelivery"
      operator="str_neq" conditionValue="true">
<!--@BendPoints 79,34 78,34 78,31-->
    <nodeSuccessors name="decision_yes" next="LoopNode9_Entry"/>
<!--@BendPoints 80,33 80,36 79,36-->
    <nodeSuccessors name="decision_no" next="CallNode20"/>
  </nodes>
<!--@Location 39,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode20">
<!--@BendPoints 79,38-->
    <nodeSuccessors name="next" next="DecisionNode23"/>
    <startNode referencedName="This:CheckIfCartHasDigitalFreight"/>
  </nodes>
<!--@Location 39,19-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode23" conditionKey="CartHasProductWithDigitalFreightClass">
<!--@BendPoints 79,40-->
    <nodeSuccessors name="decision_yes" next="EndNode32"/>
    <nodeSuccessors name="decision_no" next="JoinNode28"/>
  </nodes>
<!--@Location 39,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode32" name="ERROR" strict="true"/>
<!--@Location 40,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode28">
<!--@BendPoints 81,40-->
    <nodeSuccessors name="next" next="EndNode28"/>
  </nodes>
<!--@Location 40,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode28" name="" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 39,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode27" strict="true" name="CheckPaymentServiceAssignable"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode45"/>
    <parameters name="ActivePaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="ActivePaymentConfigurations" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentConfiguration>"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="ServiceToBeChecked" type="com.intershop.beehive.bts.capi.payment.PaymentService"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
  </nodes>
<!--@Location 39,24-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode45">
    <nodeSuccessors name="next" next="CheckBasketCovered2"/>
    <startNode referencedName="ProcessCart-Calculate"/>
  </nodes>
<!--@Location 39,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckBasketCovered2">
    <pipelet href="enfinity:/sld_ch_b2c_base/pipelets/CheckBasketCovered.xml"/>
<!--@BendPoints 79,52-->
    <nodeSuccessors name="next" next="CheckPaymentServiceAssignable1"/>
    <parameterBindings name="CartBO" objectPath="CartBO"/>
  </nodes>
<!--@Location 39,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckPaymentServiceAssignable1">
    <pipelet href="enfinity:/bts/pipelets/CheckPaymentServiceAssignable.xml"/>
    <nodeSuccessors name="next" next="EndNode44"/>
<!--@BendPoints 80,53-->
    <nodeSuccessors name="pipelet_error" next="EndNode47"/>
    <parameterBindings name="AllPaymentServicesForUserAndChannel" objectPath="ActivePaymentServices"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="PaymentConfigurations" objectPath="ActivePaymentConfigurations"/>
    <returnValueBindings name="ERROR_NotAssignablePaymentServices" nullBinding="true"/>
  </nodes>
<!--@Location 39,27-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode44" name="" strict="true"/>
<!--@Location 40,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode47" name="ERROR" strict="true">
    <returnValues name="ERROR_PaymentServiceNotAssignable" type="java.lang.Boolean"
        optional="true"/>
    <returnValues name="BasketCovered" type="java.lang.Boolean" optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 36,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode4" strict="true" name="CheckPaymentServicesAssignable"
      callMode="Private">
    <nodeSuccessors name="next" next="CheckBasketCovered5"/>
    <parameters name="ActivePaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="ActivePaymentConfigurations" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentConfiguration>"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 36,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckBasketCovered5">
    <pipelet href="enfinity:/sld_ch_b2c_base/pipelets/CheckBasketCovered.xml"/>
<!--@BendPoints 73,50-->
    <nodeSuccessors name="next" next="CheckPaymentServiceAssignable3"/>
    <parameterBindings name="CartBO" objectPath="CartBO"/>
  </nodes>
<!--@Location 36,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckPaymentServiceAssignable3">
    <pipelet href="enfinity:/bts/pipelets/CheckPaymentServiceAssignable.xml"/>
    <nodeSuccessors name="next" next="JoinNode20"/>
<!--@BendPoints 74,51 74,53-->
    <nodeSuccessors name="pipelet_error" next="JoinNode20"/>
    <parameterBindings name="AllPaymentServicesForUserAndChannel" objectPath="ActivePaymentServices"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="PaymentConfigurations" objectPath="ActivePaymentConfigurations"/>
    <parameterBindings name="ServiceToBeChecked" nullBinding="true"/>
    <returnValueBindings name="ERROR_PaymentServiceNotAssignable" nullBinding="true"/>
  </nodes>
<!--@Location 36,26-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode20">
<!--@BendPoints 73,54-->
    <nodeSuccessors name="next" next="CallNode5"/>
  </nodes>
<!--@Location 36,27-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode5">
<!--@BendPoints 73,56-->
    <nodeSuccessors name="next" next="DecisionNode3"/>
    <startNode referencedName="ProcessPayment-CheckIfCartHasDigitalFreight"/>
  </nodes>
<!--@Location 36,28-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="CartHasProductWithDigitalFreightClass">
<!--@BendPoints 73,58-->
    <nodeSuccessors name="decision_yes" next="LoopNode1"/>
<!--@BendPoints 79,57-->
    <nodeSuccessors name="decision_no" next="JoinNode21"/>
  </nodes>
<!--@Location 36,29-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode1" loop="ActivePaymentServices">
    <nodeSuccessors name="next" next="JoinNode21"/>
    <entry key="PaymentService">
<!--@BendPoints 73,60-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode6"/>
    </entry>
  </nodes>
<!--@Location 36,30-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode6" conditionKey="PaymentService:Capabilities:PaymentOnDelivery"
      operator="str_neq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="JoinNode18"/>
<!--@BendPoints 75,61 75,62-->
    <nodeSuccessors name="decision_no" next="UpdateMapping2"/>
  </nodes>
<!--@Location 36,31-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode18">
<!--@BendPoints 72,63 72,59-->
    <nodeSuccessors name="next" next="LoopNode1_Entry"/>
  </nodes>
<!--@Location 37,31-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateMapping2">
    <configurationValues name="DefaultKey" value="&quot;ERROR_IncompatibleFreightClass&quot;"/>
    <configurationValues name="Mode" value="Add"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateMapping.xml"/>
<!--@BendPoints 75,64-->
    <nodeSuccessors name="next" next="UpdateMapping3"/>
    <parameterBindings name="InMap" objectPath="ERROR_NotAssignablePaymentServices:get(PaymentService:ID)"/>
    <returnValueBindings name="OutMap" objectPath="PaymentServiceErrors"/>
    <returnValueBindings name="Values" objectPath="true"/>
  </nodes>
<!--@Location 37,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateMapping3">
    <configurationValues name="Mode" value="Add"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateMapping.xml"/>
<!--@BendPoints 75,66 73,66-->
    <nodeSuccessors name="next" next="JoinNode18"/>
    <parameterBindings name="InMap" objectPath="ERROR_NotAssignablePaymentServices"/>
    <parameterBindings name="Key" objectPath="PaymentService:ID"/>
    <parameterBindings name="Value" objectPath="PaymentServiceErrors"/>
  </nodes>
<!--@Location 39,29-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode21">
<!--@BendPoints 79,60-->
    <nodeSuccessors name="next" next="EndNode6"/>
  </nodes>
<!--@Location 39,30-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode6" name="" strict="true">
    <returnValues name="ERROR_NotAssignablePaymentServices" type="java.util.Map" optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 32,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode18" strict="true" name="CheckSelectedPayment"
      callMode="Private">
<!--@BendPoints 65,30-->
    <nodeSuccessors name="next" next="DecisionNode16"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 32,15-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode16" conditionKey="Cart:PaymentInstrumentInfo">
    <nodeSuccessors name="decision_yes" next="LoopNode8"/>
<!--@BendPoints 69,31-->
    <nodeSuccessors name="decision_no" next="JoinNode14"/>
  </nodes>
<!--@Location 32,16-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode8" loop="Cart:PaymentInstrumentInfo">
<!--@BendPoints 66,33-->
    <nodeSuccessors name="next" next="EndNode30"/>
    <entry key="PaymentInstrumentInfo">
      <nodeSuccessors name="loop_entry_next" next="CallNode16"/>
    </entry>
  </nodes>
<!--@Location 32,17-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode16">
<!--@BendPoints 65,36 64,36 64,33-->
    <nodeSuccessors name="next" next="LoopNode8_Entry"/>
<!--@BendPoints 66,37-->
    <nodeSuccessors name="ERROR" next="UpdateMapping1"/>
    <startNode referencedName="ProcessPayment-VerifyPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 33,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateMapping1">
    <configurationValues name="Mode" value="Add"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateMapping.xml"/>
<!--@BendPoints 68,37 68,35-->
    <nodeSuccessors name="next" next="JoinNode14"/>
    <parameterBindings name="InMap" objectPath="Errors"/>
    <parameterBindings name="Key" objectPath="PaymentInstrumentInfo:PaymentService:ID"/>
    <parameterBindings name="Value" constant="PIIValidationFailed"/>
    <returnValueBindings name="Keys" nullBinding="true"/>
    <returnValueBindings name="OutMap" objectPath="Errors"/>
    <returnValueBindings name="Values" nullBinding="true"/>
  </nodes>
<!--@Location 34,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode14">
<!--@BendPoints 69,36-->
    <nodeSuccessors name="next" next="EndNode33"/>
  </nodes>
<!--@Location 34,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode33" name="ERROR" strict="true"/>
<!--@Location 33,16-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode30" name="" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 27,26-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode32" strict="true" name="CloneFromWalletOrCreatePaymentInstrument"
      callMode="Private">
<!--@BendPoints 55,54-->
    <nodeSuccessors name="next" next="DecisionNode37"/>
    <parameters name="PIIDataMap" type="java.util.Map&lt;java.lang.String,java.lang.String>"
        optional="true"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="PaymentService" type="com.intershop.beehive.bts.capi.payment.PaymentService"/>
<!--@deprecated not used anymore.-->
    <parameters name="CurrencyMnemonic" type="java.lang.String" optional="true"/>
    <parameters name="WalletPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@Location 27,27-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode37" conditionKey="WalletPaymentInstrumentInfo">
    <nodeSuccessors name="decision_yes" next="CallNode39"/>
<!--@BendPoints 57,55 57,56-->
    <nodeSuccessors name="decision_no" next="CallNode38"/>
  </nodes>
<!--@Location 27,28-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode39">
    <nodeSuccessors name="next" next="JoinNode52"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="WalletPaymentInstrumentInfo"/>
    <startNode referencedName="This:ClonePII"/>
    <returnValueBindings name="ClonedPaymentInstrumentInfo" objectPath="CartPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 27,29-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode52">
    <nodeSuccessors name="next" next="JoinNode33"/>
  </nodes>
<!--@Location 27,31-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode33">
<!--@BendPoints 55,64-->
    <nodeSuccessors name="next" next="EndNode57"/>
  </nodes>
<!--@Location 27,32-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode57" name="" strict="true">
    <returnValues name="CartPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 28,28-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode38">
    <nodeSuccessors name="next" next="DecisionNode47"/>
<!--@BendPoints 58,57 58,59-->
    <nodeSuccessors name="ERROR" next="EndNode56"/>
    <startNode referencedName="ProcessPaymentInstrument-CreatePaymentInstrumentInfo"/>
    <returnValueBindings name="PaymentInstrumentInfo" objectPath="CartPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 28,29-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode47" conditionKey="CartPaymentInstrumentInfo:OriginUUIDNull"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="SetPaymentInstrumentInfoOrigin1" action="begin"/>
    <nodeSuccessors name="decision_no" next="JoinNode52"/>
  </nodes>
<!--@Location 28,30-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetPaymentInstrumentInfoOrigin1">
    <pipelet href="enfinity:/bts/pipelets/SetPaymentInstrumentInfoOrigin.xml"/>
<!--@BendPoints 57,63-->
    <nodeSuccessors name="next" next="JoinNode33" action="commit"/>
    <parameterBindings name="OriginUUID" objectPath="CartPaymentInstrumentInfo:UUID"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="CartPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 29,29-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode56" name="ERROR" strict="true">
    <returnValues name="PIIDataVerificationResult" type="com.intershop.beehive.bts.capi.payment.PIIDataVerificationResult"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.

@Location 10,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode22" strict="true" name="ClonePII"
      callMode="Private">
    <nodeSuccessors name="next" next="ClonePaymentInstrumentInfo3"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 10,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ClonePaymentInstrumentInfo3">
    <pipelet href="enfinity:/bts/pipelets/ClonePaymentInstrumentInfo.xml"/>
<!--@BendPoints 21,6-->
    <nodeSuccessors name="next" next="EndNode31"/>
    <parameterBindings name="OriginalPaymentInstrumentInfo" objectPath="PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 10,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode31" name="" strict="true">
<!--The newly created payment instrument info.-->
    <returnValues name="ClonedPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
Creates a new payment instrument info
and adds it to a users wallet. 

If the user is not logged in or the payment service
configuration does not allow saving 
payment instruments to the users wallet,
the pipeline returns null.

If their already exits a duplicate in 
the wallet this is returned instead.

Optionally sets the new paymen
instrument as default method for the user.
@Location 23,26-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode29" strict="true" name="CreatePaymentInstrumentInWallet"
      callMode="Private">
<!--@BendPoints 47,54-->
    <nodeSuccessors name="next" next="CheckUserLoggedIn8"/>
    <parameters name="PIIDataMap" type="java.util.Map&lt;java.lang.String,java.lang.String>"
        optional="true"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="PaymentService" type="com.intershop.beehive.bts.capi.payment.PaymentService"/>
<!--@deprecated not used anymore.-->
    <parameters name="CurrencyMnemonic" type="java.lang.String" optional="true"/>
    <parameters name="ActivePaymentConfigurations" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentConfiguration>"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="SetAsDefault" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 23,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn8">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
<!--@BendPoints 47,56-->
    <nodeSuccessors name="next" next="CallNode34"/>
<!--@BendPoints 50,55-->
    <nodeSuccessors name="pipelet_error" next="EndNode50"/>
  </nodes>
<!--@Location 23,28-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode34">
<!--@BendPoints 47,58-->
    <nodeSuccessors name="next" next="DecisionNode26"/>
    <startNode referencedName="ProcessPayment-GetPaymentConfigurationsIndexedByService"/>
  </nodes>
<!--@Location 23,29-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode26" conditionKey="PaymentConfigurationsIndexedByService:get(PaymentService:ID):isPiiSaveAllowed"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="JoinNode47"/>
<!--@BendPoints 48,59-->
    <nodeSuccessors name="decision_no" next="DecisionNode43"/>
  </nodes>
<!--@Location 23,30-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode47">
<!--@BendPoints 47,62-->
    <nodeSuccessors name="next" next="CallNode36"/>
  </nodes>
<!--@Location 23,31-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode36">
    <nodeSuccessors name="next" next="CheckPiiUnique2"/>
<!--@BendPoints 50,63-->
    <nodeSuccessors name="ERROR" next="EndNode55"/>
    <startNode referencedName="ProcessPaymentInstrument-CreatePaymentInstrumentInfo"/>
  </nodes>
<!--@Location 23,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckPiiUnique2">
    <configurationValues name="LetPaymentMethodDecide" value="true"/>
    <pipelet href="enfinity:/bts/pipelets/CheckPiiUnique.xml"/>
    <nodeSuccessors name="next" next="CallNode35"/>
<!--@BendPoints 49,65 49,66-->
    <nodeSuccessors name="pipelet_error" next="CallNode37"/>
    <parameterBindings name="Cart" nullBinding="true"/>
    <returnValueBindings name="SamePaymentInstrumentInfo" objectPath="WalletPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 23,33-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode35">
    <nodeSuccessors name="next" next="KeyMapper9"/>
    <startNode referencedName="ProcessPayment-AssignPIItoUser"/>
  </nodes>
<!--@Location 23,34-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper9">
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode45"/>
    <parameterBindings name="InValue_1" objectPath="PaymentInstrumentInfo"/>
    <returnValueBindings name="OutValue_1" objectPath="WalletPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 23,35-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode45">
    <nodeSuccessors name="next" next="DecisionNode40"/>
  </nodes>
<!--@Location 23,36-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode40" conditionKey="SetAsDefault"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="CallNode41"/>
<!--@BendPoints 48,73 48,77-->
    <nodeSuccessors name="decision_no" next="JoinNode46"/>
  </nodes>
<!--@Location 23,37-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode41">
    <nodeSuccessors name="next" next="JoinNode46"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="WalletPaymentInstrumentInfo"/>
    <parameterBindings name="PaymentInstrumentInfoUUID" nullBinding="true"/>
    <startNode referencedName="ProcessPayment-SetDefaultPaymentMethod"/>
  </nodes>
<!--@Location 23,38-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode46">
<!--@BendPoints 47,78-->
    <nodeSuccessors name="next" next="EndNode51"/>
  </nodes>
<!--@Location 23,39-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode51" name="" strict="true">
    <returnValues name="WalletPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@Location 24,33-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode37">
<!--@BendPoints 49,71-->
    <nodeSuccessors name="next" next="JoinNode45"/>
    <startNode referencedName="This:RemovePaymentInstrumentInfo"/>
  </nodes>
<!--@Location 25,31-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode55" name="ERROR" strict="true">
    <returnValues name="PIIDataVerificationResult" type="com.intershop.beehive.bts.capi.payment.PIIDataVerificationResult"/>
  </nodes>
<!--@Location 24,29-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode43" conditionKey="PaymentService:Capabilities:EditPIITemplate">
<!--@BendPoints 50,59 50,55-->
    <nodeSuccessors name="decision_yes" next="EndNode50"/>
<!--@BendPoints 49,61-->
    <nodeSuccessors name="decision_no" next="JoinNode47"/>
  </nodes>
<!--@Location 25,27-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode50" name="" strict="true">
    <returnValues name="WalletPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 16,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode11" strict="true" name="CreatePaymentInstrumentInfoByUser"
      callMode="Private">
<!--@BendPoints 33,4-->
    <nodeSuccessors name="next" next="GetPaymentServiceConfigurationByUUID1"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="PaymentServiceConfigurationUUID" type="java.lang.String"/>
    <parameters name="PIIDataMap" type="java.util.Map&lt;java.lang.String, java.lang.String>"
        optional="true"/>
  </nodes>
<!--@Location 16,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentServiceConfigurationByUUID1">
    <pipelet href="enfinity:/bts/pipelets/GetPaymentServiceConfigurationByUUID.xml"/>
<!--@BendPoints 33,6-->
    <nodeSuccessors name="next" next="CallNode1"/>
<!--@BendPoints 35,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode19"/>
  </nodes>
<!--@Location 16,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
    <nodeSuccessors name="next" next="EndNode20"/>
    <nodeSuccessors name="ERROR" next="JoinNode19"/>
    <parameterBindings name="CurrentUser" objectPath="User"/>
    <parameterBindings name="PaymentService" objectPath="PaymentServiceConfiguration:PaymentService"/>
    <startNode referencedName="ProcessPaymentInstrument-CreatePaymentInstrumentInfoByUser"/>
  </nodes>
<!--@Location 16,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode20" name="" strict="true">
    <returnValues name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 17,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode19">
<!--@BendPoints 35,10-->
    <nodeSuccessors name="next" next="EndNode21"/>
  </nodes>
<!--@Location 17,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode21" name="ERROR" strict="true">
    <returnValues name="PIIDataVerificationResult" type="com.intershop.beehive.bts.capi.payment.PIIDataVerificationResult"
        optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 33,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode20" strict="true" name="DefaultSettings"
      callMode="Private">
<!--@BendPoints 67,4-->
    <nodeSuccessors name="next" next="CallNode26"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
  </nodes>
<!--@Location 33,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode26">
<!--@BendPoints 67,7-->
    <nodeSuccessors name="next" next="JoinNode31"/>
<!--@BendPoints 68,6 69,6-->
    <nodeSuccessors name="PII_CHANGED" next="KeyMapper5"/>
    <startNode referencedName="This:SetReturningUserPayment"/>
  </nodes>
<!--@Location 33,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode31">
<!--@BendPoints 67,10-->
    <nodeSuccessors name="next" next="CallNode28"/>
  </nodes>
<!--@Location 33,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode28">
    <nodeSuccessors name="next" next="DecisionNode36"/>
    <startNode referencedName="This:CheckSelectedPayment"/>
  </nodes>
<!--@Location 33,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode36" conditionKey="PaymentSettingsChanged"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="EndNode34"/>
<!--@BendPoints 69,13 69,14-->
    <nodeSuccessors name="decision_no" next="EndNode43"/>
  </nodes>
<!--@Location 33,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode34" name="PAYMENT_SETTINGS_CHANGED"
      strict="true"/>
<!--@Location 34,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode43" name="" strict="true"/>
<!--@Location 34,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper5">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 69,9-->
    <nodeSuccessors name="next" next="JoinNode31"/>
    <parameterBindings name="InValue_1" constant="true"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentSettingsChanged"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 41,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode35" strict="true" name="DeletePayment"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode49"/>
    <parameters name="PaymentInstrumentInfoUUID" type="java.lang.String"/>
    <parameters name="CurrentCart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"
        optional="true"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User" optional="true"/>
  </nodes>
<!--@Location 41,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode49">
    <nodeSuccessors name="next" next="DecisionNode0"/>
<!--@BendPoints 85,5 84,19-->
    <nodeSuccessors name="ERROR" next="JoinNode48"/>
    <parameterBindings name="LineItemCtnr" objectPath="CurrentCart"/>
    <startNode referencedName="ProcessPayment-GetPaymentInstrumentInfoByID"/>
  </nodes>
<!--@Location 41,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode0" conditionKey="PaymentInstrumentInfo:OriginUUID"
      operator="str_empty">
    <nodeSuccessors name="decision_yes" next="JoinNode49"/>
<!--@BendPoints 85,7 85,8-->
    <nodeSuccessors name="decision_no" next="CallNode50"/>
  </nodes>
<!--@Location 41,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode49">
    <nodeSuccessors name="next" next="CallNode48"/>
  </nodes>
<!--@Location 41,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode48">
    <nodeSuccessors name="next" next="CallNode47"/>
    <startNode referencedName="ProcessPayment-RemovePaymentInstrumentInfo"/>
  </nodes>
<!--@Location 41,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode47">
    <nodeSuccessors name="next" next="JoinNode48"/>
    <parameterBindings name="Cart" objectPath="CurrentCart"/>
    <parameterBindings name="PaymentInstrumentInfoOriginUUID" objectPath="RemovedPaymentInstrumentInfoUUID"/>
    <startNode referencedName="ProcessCart-RemovePaymentByOrigin"/>
  </nodes>
<!--@Location 41,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode48">
    <nodeSuccessors name="next" next="CallNode46"/>
  </nodes>
<!--@Location 41,10-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode46">
    <nodeSuccessors name="next" next="EndNode61"/>
    <parameterBindings name="Basket" objectPath="CurrentCart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 41,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode61" strict="true"/>
<!--@Location 42,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode50">
<!--@BendPoints 85,10-->
    <nodeSuccessors name="next" next="CallNode51"/>
    <parameterBindings name="PaymentInstrumentInfoUUID" objectPath="PaymentInstrumentInfo:OriginUUID"/>
    <startNode referencedName="ProcessPayment-GetPaymentInstrumentInfoByID"/>
    <returnValueBindings name="PaymentInstrumentInfo" objectPath="OriginPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 42,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode51">
<!--@BendPoints 85,13-->
    <nodeSuccessors name="next" next="JoinNode49"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="OriginPaymentInstrumentInfo"/>
    <startNode referencedName="ProcessPayment-RemovePaymentInstrumentInfo"/>
    <returnValueBindings name="RemovedPaymentInstrumentInfoUUID" objectPath="RemovedOriginPaymentInstrumentInfo"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
Ensures that the selected payment method is always accessible by the user.
@Location 1,13-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode2" strict="true" name="EnsurePaymentSelectionAvailable"
      callMode="Private">
    <nodeSuccessors name="next" next="GetCurrency3"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="UserGroups" type="java.util.Iterator"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentApplication" type="com.intershop.beehive.core.capi.domain.Application"/>
  </nodes>
<!--@Location 1,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrency3">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrency.xml"/>
    <nodeSuccessors name="next" next="DecisionNode15"/>
    <parameterBindings name="Mnemonic" objectPath="Cart:PurchaseCurrencyCode"/>
  </nodes>
<!--@Location 1,15-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode15" conditionKey="Cart:PaymentInstrumentInfo">
<!--@BendPoints 3,32-->
    <nodeSuccessors name="decision_yes" next="LoopNode4"/>
<!--@BendPoints 9,31-->
    <nodeSuccessors name="decision_no" next="JoinNode4"/>
  </nodes>
<!--@Location 1,16-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode4" loop="Cart:PaymentInstrumentInfo">
<!--@BendPoints 5,33 5,57-->
    <nodeSuccessors name="next" next="JoinNode7"/>
    <entry key="PII">
<!--@BendPoints 3,34-->
      <nodeSuccessors name="loop_entry_next" next="KeyMapper6"/>
    </entry>
  </nodes>
<!--@Location 1,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper6">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 3,36-->
    <nodeSuccessors name="next" next="CallNode7"/>
    <parameterBindings name="InValue_1" objectPath="PII:PaymentService"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentService"/>
  </nodes>
<!--@Location 1,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode7">
<!--@BendPoints 3,38 2,38 2,33-->
    <nodeSuccessors name="next" next="LoopNode4_Entry"/>
<!--@BendPoints 6,39-->
    <nodeSuccessors name="ERROR" next="UpdateBasket2"/>
    <parameterBindings name="CurrentUserUserGroups" objectPath="UserGroups"/>
    <parameterBindings name="OwningDomain" objectPath="Organization:OwningDomain"/>
    <startNode referencedName="ProcessPaymentInstrument-IsPaymentMethodAvailableForUser"/>
  </nodes>
<!--@Location 3,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateBasket2">
    <pipelet href="enfinity:/bc_requisition/pipelets/UpdateBasket.xml"/>
    <nodeSuccessors name="next" next="JoinNode4"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="PaymentInstrumentInfoID" nullBinding="true"/>
    <parameterBindings name="PaymentInstrumentInfoIDNull" constant="true"/>
  </nodes>
<!--@Location 4,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
    <nodeSuccessors name="next" next="CallNode17"/>
  </nodes>
<!--@Location 4,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode17">
    <nodeSuccessors name="next" next="KeyMapper1"/>
<!--@BendPoints 11,43-->
    <nodeSuccessors name="ERROR" next="JoinNode8"/>
    <startNode referencedName="ProcessPaymentInstrument-GetPaymentInstrumentInfosByUser"/>
  </nodes>
<!--@Location 4,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper1">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode18"/>
    <parameterBindings name="InValue_1" objectPath="DefaultPaymentInstrumentInfo:PaymentService"/>
    <returnValueBindings name="OutValue_1" objectPath="PaymentService"/>
  </nodes>
<!--@Location 4,22-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode18">
    <nodeSuccessors name="next" next="ClonePaymentInstrumentInfo1"/>
    <nodeSuccessors name="ERROR" next="JoinNode8"/>
    <parameterBindings name="CurrentUserUserGroups" objectPath="UserGroups"/>
    <parameterBindings name="OwningDomain" objectPath="Organization:OwningDomain"/>
    <startNode referencedName="ProcessPaymentInstrument-IsPaymentMethodAvailableForUser"/>
  </nodes>
<!--@Location 4,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ClonePaymentInstrumentInfo1">
    <pipelet href="enfinity:/bts/pipelets/ClonePaymentInstrumentInfo.xml"/>
<!--@BendPoints 9,50-->
    <nodeSuccessors name="next" next="SetPaymentInstrumentInfoOwner3"/>
    <parameterBindings name="Domain" objectPath="Cart:Domain"/>
    <parameterBindings name="OriginalPaymentInstrumentInfo" objectPath="DefaultPaymentInstrumentInfo"/>
    <returnValueBindings name="ClonedPaymentInstrumentInfo" objectPath="NewPII"/>
  </nodes>
<!--@Location 4,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetPaymentInstrumentInfoOwner3">
    <pipelet href="enfinity:/bts/pipelets/SetPaymentInstrumentInfoOwner.xml"/>
<!--@BendPoints 9,52-->
    <nodeSuccessors name="next" next="DecisionNode5" action="commit"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <parameterBindings name="Domain" nullBinding="true"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="NewPII"/>
    <parameterBindings name="User" nullBinding="true"/>
  </nodes>
<!--by additional service as like 3\-D Secure should be the PaymentIntrumentInfo always verify
@Location 4,26-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode5" conditionKey="PaymentService:Service3DSecureSupported"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 9,54-->
    <nodeSuccessors name="decision_yes" next="CallNode23"/>
    <nodeSuccessors name="decision_no" next="JoinNode5"/>
  </nodes>
<!--@Location 4,27-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode23">
    <nodeSuccessors name="next" next="JoinNode7"/>
    <nodeSuccessors name="ERROR" next="JoinNode6"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="NewPII"/>
    <startNode referencedName="ProcessPaymentInstrument-VerifyPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 4,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
    <nodeSuccessors name="next" next="EndNode3"/>
  </nodes>
<!--@Location 4,29-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode3" name="" strict="true"/>
<!--@Location 5,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
    <nodeSuccessors name="next" next="JoinNode7"/>
  </nodes>
<!--@Location 5,26-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
    <nodeSuccessors name="next" next="JoinNode6"/>
  </nodes>
<!--@Location 5,23-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
    <nodeSuccessors name="next" next="JoinNode1"/>
  </nodes>
<!--@Location 5,24-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
    <nodeSuccessors name="next" next="JoinNode5"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
This pipeline determines all payment methods activated for the current user.
@Location 25,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start1" strict="true" name="GetActivePaymentMethods"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode4"/>
    <parameters name="CurrentUserUserGroups" type="java.util.Iterator" optional="true"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
    <parameters name="CurrencyMnemonic" type="java.lang.String" optional="true"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User" optional="true"/>
    <parameters name="CurrentApplication" type="com.intershop.beehive.core.capi.domain.Application"/>
  </nodes>
<!--@Location 25,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="CurrentUserUserGroups">
    <nodeSuccessors name="decision_yes" next="JoinNode2"/>
    <nodeSuccessors name="decision_no" next="CallNode25"/>
  </nodes>
<!--@Location 25,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
    <nodeSuccessors name="next" next="DecisionNode1"/>
  </nodes>
<!--@Location 25,4-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="CurrencyMnemonic">
    <nodeSuccessors name="decision_yes" next="GetCurrency1"/>
<!--@BendPoints 53,9 53,10-->
    <nodeSuccessors name="decision_no" next="KeyMapper2"/>
  </nodes>
<!--@Location 25,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrency1">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrency.xml"/>
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="Mnemonic" objectPath="CurrencyMnemonic"/>
  </nodes>
<!--@Location 25,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="CallNode2"/>
  </nodes>
<!--@Location 25,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode2">
    <nodeSuccessors name="next" next="LoopNode17"/>
    <parameterBindings name="OwningDomain" objectPath="Organization:OwningDomain"/>
    <startNode referencedName="ProcessPaymentInstrument-GetActivePaymentMethodsForUser"/>
  </nodes>
<!--@Location 25,8-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode17" loop="ActivePaymentConfigurations">
<!--@BendPoints 53,17 53,23-->
    <nodeSuccessors name="next" next="JoinNode54"/>
    <entry key="PaymentConfiguration">
<!--@BendPoints 51,18-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode44"/>
    </entry>
  </nodes>
<!--@Location 25,9-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode44" conditionKey="PaymentConfiguration:Default"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 51,20-->
    <nodeSuccessors name="decision_yes" next="Pipelet3"/>
<!--@BendPoints 50,19 50,17-->
    <nodeSuccessors name="decision_no" next="LoopNode17_Entry"/>
  </nodes>
<!--@Location 25,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet3">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode54"/>
    <parameterBindings name="InValue_1" objectPath="PaymentConfiguration"/>
    <returnValueBindings name="OutValue_1" objectPath="DefaultPaymentConfiguration"/>
  </nodes>
<!--@Location 25,11-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode54">
    <nodeSuccessors name="next" next="EndNode17"/>
  </nodes>
<!--@Location 25,12-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode17" name="" strict="true">
    <returnValues name="ActivePaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"/>
    <returnValues name="ActivePaymentConfigurations" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentConfiguration>"/>
    <returnValues name="DefaultPaymentConfiguration" type="com.intershop.beehive.bts.capi.payment.PaymentConfiguration"
        optional="true"/>
  </nodes>
<!--@Location 26,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper2">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 53,13-->
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="InValue_1" objectPath="CurrentRequest:Currency"/>
    <returnValueBindings name="OutValue_1" objectPath="Currency"/>
  </nodes>
<!--@Location 26,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode25">
<!--@BendPoints 53,7-->
    <nodeSuccessors name="next" next="JoinNode2"/>
    <startNode referencedName="ProcessPayment-GetUserGroupsForPaymentLookup"/>
    <returnValueBindings name="UserGroupsForPaymentLookup" objectPath="CurrentUserUserGroups"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 17,34-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode30" strict="true" name="GetAssignedOpenTenderPaymentInstrument"
      callMode="Private">
    <nodeSuccessors name="next" next="LoopNode14"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
  </nodes>
<!--@Location 17,35-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode14" loop="Cart:PaymentInstrumentInfo">
<!--@BendPoints 36,71-->
    <nodeSuccessors name="next" next="EndNode54"/>
    <entry key="PII">
<!--@BendPoints 35,72-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode42"/>
    </entry>
  </nodes>
<!--@Location 17,36-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode42" conditionKey="PII:PaymentService:Capabilities:OpenTender"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="KeyMapper8"/>
<!--@BendPoints 37,73 37,78 34,78 34,71-->
    <nodeSuccessors name="decision_no" next="LoopNode14_Entry"/>
  </nodes>
<!--@Location 17,37-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper8">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="EndNode53"/>
    <parameterBindings name="InValue_1" objectPath="PII"/>
    <returnValueBindings name="OutValue_1" objectPath="OpenTenderPaymentInstrument"/>
  </nodes>
<!--@Location 17,38-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode53" name="" strict="true">
    <returnValues name="OpenTenderPaymentInstrument" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@Location 18,35-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode54" name="ERROR" strict="true">
    <returnValues name="OpenTenderPaymentInstrument" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
Determine the payment instrument info which the user defined as default.
Null is returned if no default payment instrument info was found or if the user is anonymous.
@Location 25,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode9" strict="true" name="GetDefaultPaymentInstrumentInfoByUser"
      callMode="Private">
    <nodeSuccessors name="next" next="CheckUserLoggedIn1"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
  </nodes>
<!--@Location 25,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn1">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
    <nodeSuccessors name="next" next="CallNode10"/>
<!--@BendPoints 53,31-->
    <nodeSuccessors name="pipelet_error" next="JoinNode26"/>
  </nodes>
<!--@Location 25,16-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode10">
<!--@BendPoints 51,34-->
    <nodeSuccessors name="next" next="EndNode15"/>
    <nodeSuccessors name="ERROR" next="JoinNode26"/>
    <startNode referencedName="ProcessPaymentInstrument-GetDefaultPaymentInstrumentInfoByUser"/>
  </nodes>
<!--@Location 25,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode15" name="" strict="true">
    <returnValues name="DefaultPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 26,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode26">
<!--@BendPoints 53,36-->
    <nodeSuccessors name="next" next="EndNode16"/>
  </nodes>
<!--@Location 26,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode16" name="ERROR" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 20,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode8" strict="true" name="GetPaymentConfigurationsIndexedByService"
      callMode="Private">
<!--@BendPoints 41,4-->
    <nodeSuccessors name="next" next="LoopNode2"/>
    <parameters name="ActivePaymentConfigurations" type="java.util.List"/>
  </nodes>
<!--@Location 20,2-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode2" loop="ActivePaymentConfigurations">
<!--@BendPoints 43,5 43,8-->
    <nodeSuccessors name="next" next="EndNode7"/>
    <entry key="PaymentConfiguration">
<!--@BendPoints 41,6-->
      <nodeSuccessors name="loop_entry_next" next="CreatePaymentConfigurationBO1"/>
    </entry>
  </nodes>
<!--@Location 20,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePaymentConfigurationBO1">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/CreatePaymentConfigurationBO.xml"/>
<!--@BendPoints 41,8-->
    <nodeSuccessors name="next" next="AddEntryToMap2"/>
  </nodes>
<!--@Location 20,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddEntryToMap2">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddEntryToMap.xml"/>
<!--@BendPoints 41,10 40,10 40,5-->
    <nodeSuccessors name="next" next="LoopNode2_Entry"/>
    <parameterBindings name="InMap" objectPath="PaymentConfigurationsIndexedByService"/>
    <parameterBindings name="Key" objectPath="PaymentConfigurationBO:PaymentService:ID"/>
    <parameterBindings name="Value" objectPath="PaymentConfigurationBO"/>
    <returnValueBindings name="OutMap" objectPath="PaymentConfigurationsIndexedByService"/>
  </nodes>
<!--@Location 21,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode7" name="" strict="true">
    <returnValues name="PaymentConfigurationsIndexedByService" type="java.util.Map"
        optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 1,5-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode12" strict="true" name="GetPaymentInstrumentInfoByID"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode4"/>
    <parameters name="PaymentInstrumentInfoUUID" type="java.lang.String"/>
    <parameters name="LineItemCtnr" type="com.intershop.beehive.bts.capi.orderprocess.LineItemCtnr"
        optional="true"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User" optional="true"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"
        optional="true"/>
  </nodes>
<!--@Location 1,6-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
<!--@BendPoints 3,14-->
    <nodeSuccessors name="next" next="EndNode22"/>
<!--@BendPoints 5,14-->
    <nodeSuccessors name="ERROR" next="EndNode23"/>
    <startNode referencedName="ProcessPaymentInstrument-GetPaymentInstrumentInfoByID"/>
  </nodes>
<!--@Location 1,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode22" name="" strict="true">
<!--The Payment Instrument Info found by the given UUID.-->
    <returnValues name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 2,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode23" name="ERROR" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 23,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode0" strict="true" name="GetUserGroupsForPaymentLookup"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode0"/>
    <parameters name="Organization" type="com.intershop.component.organization.capi.Organization"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
  </nodes>
<!--@Location 23,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode0">
    <nodeSuccessors name="next" next="GetUserGroupType0"/>
    <parameterBindings name="CurrentOrganization" objectPath="Organization"/>
    <parameterBindings name="CurrentUser" objectPath="User"/>
    <startNode referencedName="ProcessUserGroups-GetCurrentUserUserGroups"/>
  </nodes>
<!--@Location 23,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetUserGroupType0">
    <pipelet href="enfinity:/core/pipelets/GetUserGroupType.xml"/>
    <nodeSuccessors name="next" next="AddObjectToCollection0"/>
    <parameterBindings name="UserGroupTypeName" constant="UNKNOWN"/>
    <returnValueBindings name="UserGroupType" objectPath="UnknownUserGroupType"/>
  </nodes>
<!--@Location 23,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToCollection0">
    <pipelet href="enfinity:/core/pipelets/AddObjectToCollection.xml"/>
    <nodeSuccessors name="next" next="EndNode0"/>
    <parameterBindings name="InCollection" objectPath="CurrentUserUserGroupsByType:get(UnknownUserGroupType)"/>
    <parameterBindings name="InObject" nullBinding="true"/>
    <returnValueBindings name="OutCollection" nullBinding="true"/>
    <returnValueBindings name="OutIterator" objectPath="UserGroupsForPaymentLookup"/>
  </nodes>
<!--@Location 23,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode0" strict="true">
    <returnValues name="UserGroupsForPaymentLookup" type="java.util.Iterator"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
Determine the payment instrument info which the user defined as default.
Null is returned if no default payment instrument info was found or if the user is anonymous.
@Location 27,34-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode33" strict="true" name="GetWalletContents"
      callMode="Private">
    <nodeSuccessors name="next" next="CheckUserLoggedIn2"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
  </nodes>
<!--@Location 27,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckUserLoggedIn2">
    <pipelet href="enfinity:/core/pipelets/CheckUserLoggedIn.xml"/>
    <nodeSuccessors name="next" next="GetPaymentInstrumentInfosByUser2"/>
<!--@BendPoints 57,71 57,78-->
    <nodeSuccessors name="pipelet_error" next="EndNode59"/>
  </nodes>
<!--@Location 27,36-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentInstrumentInfosByUser2">
    <pipelet href="enfinity:/bts/pipelets/GetPaymentInstrumentInfosByUser.xml"/>
    <nodeSuccessors name="next" next="CallNode40"/>
    <parameterBindings name="PaymentService" nullBinding="true"/>
    <returnValueBindings name="PaymentInstrumentInfos" objectPath="WalletPaymentInstrumentInfos"/>
  </nodes>
<!--@Location 27,37-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode40">
<!--@BendPoints 55,77 55,78-->
    <nodeSuccessors name="next" next="EndNode58"/>
<!--@BendPoints 55,76 54,76 54,77 54,78 55,78-->
    <nodeSuccessors name="ERROR" next="EndNode58"/>
    <startNode referencedName="ProcessPaymentInstrument-GetDefaultPaymentInstrumentInfoByUser"/>
  </nodes>
<!--@Location 27,39-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode58" name="" strict="true">
    <returnValues name="DefaultPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
    <returnValues name="WalletPaymentInstrumentInfos" type="java.util.Iterator&lt;com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo>"/>
  </nodes>
<!--@Location 28,39-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode59" name="ERROR" strict="true"/>
<!--@deprecated
Creates a map using the payment services a 
key and a list of all given payment instrument
infos of the according payment service
as value. Note that for payment services,
that do not use an editing template (and
thus have no attributes per payment 
instrument info) at most one 
payment instrument will be returned 
(preferably the payment instrument 
marked as default).
@Location 32,23-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode31" strict="true" name="GroupPaymentInstrumentInfosByService"
      callMode="Private">
    <nodeSuccessors name="next" next="AddMultipleEntriesToMap1"/>
    <parameters name="PaymentInstrumentInfos" type="java.util.Iterator&lt;com.intershop.component.orderprocess.capi.payment.PaymentInstrumentInfoBO>"/>
  </nodes>
<!--@Location 32,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddMultipleEntriesToMap1">
    <configurationValues name="Mode" value="OverwriteValue"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddMultipleEntriesToMap.xml"/>
    <nodeSuccessors name="next" next="LoopNode15"/>
    <parameterBindings name="InMap" nullBinding="true"/>
    <parameterBindings name="Key1" nullBinding="true"/>
    <parameterBindings name="Key2" nullBinding="true"/>
    <parameterBindings name="Key3" nullBinding="true"/>
    <parameterBindings name="Key4" nullBinding="true"/>
    <parameterBindings name="Key5" nullBinding="true"/>
    <parameterBindings name="Value1" nullBinding="true"/>
    <parameterBindings name="Value2" nullBinding="true"/>
    <parameterBindings name="Value3" nullBinding="true"/>
    <parameterBindings name="Value4" nullBinding="true"/>
    <parameterBindings name="Value5" nullBinding="true"/>
    <returnValueBindings name="OutMap" objectPath="PaymentInstrumentMap"/>
  </nodes>
<!--@Location 32,25-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode15" loop="PaymentInstrumentInfos">
<!--@BendPoints 68,51-->
    <nodeSuccessors name="next" next="EndNode52"/>
    <entry key="PII">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode41"/>
    </entry>
  </nodes>
<!--@Location 32,26-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode41" conditionKey="PaymentInstrumentMap:get(PII:PaymentService)">
    <nodeSuccessors name="decision_yes" next="KeyMapper7"/>
<!--@BendPoints 66,53-->
    <nodeSuccessors name="decision_no" next="AddObjectToVector13"/>
  </nodes>
<!--@Location 32,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper7">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 65,56-->
    <nodeSuccessors name="next" next="DecisionNode39"/>
    <parameterBindings name="InValue_1" objectPath="PaymentInstrumentMap:get(PII:PaymentService)"/>
    <returnValueBindings name="OutValue_1" objectPath="CurrentPIIs"/>
  </nodes>
<!--@Location 32,28-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode39" conditionKey="PII:PaymentService:Capabilities:EditPIITemplate">
<!--@BendPoints 65,58-->
    <nodeSuccessors name="decision_yes" next="AddObjectToVector14"/>
<!--@BendPoints 66,57 66,56 67,56-->
    <nodeSuccessors name="decision_no" next="DecisionNode38"/>
  </nodes>
<!--@Location 32,29-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector14">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="JoinNode43"/>
    <parameterBindings name="InVector" objectPath="CurrentPIIs"/>
    <parameterBindings name="Object" objectPath="PII"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="CurrentPIIs"/>
  </nodes>
<!--@Location 32,30-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode43">
    <nodeSuccessors name="next" next="AddEntryToMap4"/>
  </nodes>
<!--@Location 32,31-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddEntryToMap4">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddEntryToMap.xml"/>
<!--@BendPoints 65,64 64,64 64,51-->
    <nodeSuccessors name="next" next="LoopNode15_Entry"/>
    <parameterBindings name="InMap" objectPath="PaymentInstrumentMap"/>
    <parameterBindings name="Key" objectPath="PII:PaymentService"/>
    <parameterBindings name="Value" objectPath="CurrentPIIs"/>
    <returnValueBindings name="OutMap" objectPath="PaymentInstrumentMap"/>
  </nodes>
<!--@Location 33,28-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode38" conditionKey="PII:Default"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 67,58-->
    <nodeSuccessors name="decision_yes" next="AddObjectToVector15"/>
    <nodeSuccessors name="decision_no" next="JoinNode44"/>
  </nodes>
<!--@Location 33,29-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector15">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="JoinNode42"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" objectPath="PII"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="CurrentPIIs"/>
  </nodes>
<!--@Location 33,30-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode42">
    <nodeSuccessors name="next" next="JoinNode43"/>
  </nodes>
<!--@Location 34,28-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode44">
<!--@BendPoints 69,61-->
    <nodeSuccessors name="next" next="JoinNode42"/>
  </nodes>
<!--@Location 33,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector13">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 69,53-->
    <nodeSuccessors name="next" next="JoinNode44"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" objectPath="PII"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="CurrentPIIs"/>
  </nodes>
<!--@Location 34,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode52" name="" strict="true">
    <returnValues name="PaymentInstrumentMap" type="java.util.Map&lt;com.intershop.beehive.bts.capi.payment.PaymentService, java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo>"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 17,25-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode6" strict="true" name="GroupPaymentMethodsByOpenTender"
      callMode="Private">
    <nodeSuccessors name="next" next="AddObjectToVector8"/>
    <parameters name="PaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"/>
  </nodes>
<!--@Location 17,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector8">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector10"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="OpenTenderPaymentServices"/>
  </nodes>
<!--@Location 17,27-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector10">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="LoopNode13"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="LimitedTenderPaymentServices"/>
  </nodes>
<!--@Location 17,28-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode13" loop="PaymentServices">
    <nodeSuccessors name="next" next="EndNode13"/>
    <entry key="PaymentService">
<!--@BendPoints 35,58-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode20"/>
    </entry>
  </nodes>
<!--@Location 17,29-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode20" conditionKey="PaymentService:Capabilities:OpenTender"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="AddObjectToVector9"/>
<!--@BendPoints 37,59 37,60-->
    <nodeSuccessors name="decision_no" next="AddObjectToVector11"/>
  </nodes>
<!--@Location 17,30-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector9">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="JoinNode25"/>
    <parameterBindings name="InVector" objectPath="OpenTenderPaymentServices"/>
    <parameterBindings name="Object" objectPath="PaymentService"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="OpenTenderPaymentServices"/>
  </nodes>
<!--@Location 17,31-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode25">
<!--@BendPoints 34,63 34,57-->
    <nodeSuccessors name="next" next="LoopNode13_Entry"/>
  </nodes>
<!--@Location 18,30-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector11">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 37,63-->
    <nodeSuccessors name="next" next="JoinNode25"/>
    <parameterBindings name="InVector" objectPath="LimitedTenderPaymentServices"/>
    <parameterBindings name="Object" objectPath="PaymentService"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="LimitedTenderPaymentServices"/>
  </nodes>
<!--@Location 19,28-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode13" name="" strict="true">
    <returnValues name="OpenTenderPaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"
        optional="true"/>
    <returnValues name="LimitedTenderPaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 32,34-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode34" strict="true" name="PaymentInstrumentInfoPOToBOIterator"
      callMode="Private">
    <nodeSuccessors name="next" next="Pipelet1"/>
    <parameters name="PaymentInstrumentInfos" type="java.util.Iterator&lt;com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo>"/>
    <parameters name="CurrentCartBO" type="com.intershop.component.basket.capi.BasketBO"/>
  </nodes>
<!--@Location 32,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet1">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="LoopNode16"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="PaymentInstrumentInfoBOIterator"/>
    <returnValueBindings name="OutVector" objectPath="PaymentInstrumentInfoBOVector"/>
  </nodes>
<!--@Location 32,36-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode16" loop="PaymentInstrumentInfos">
<!--@BendPoints 68,73-->
    <nodeSuccessors name="next" next="EndNode60"/>
    <entry key="PII">
      <nodeSuccessors name="loop_entry_next" next="CreatePaymentInstrumentInfoBO0"/>
    </entry>
  </nodes>
<!--@Location 32,37-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePaymentInstrumentInfoBO0">
    <pipelet href="enfinity:/bc_orderprocess/pipelets/CreatePaymentInstrumentInfoBO.xml"/>
    <nodeSuccessors name="next" next="Pipelet2"/>
    <parameterBindings name="CartBO" objectPath="CurrentCartBO"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="PII"/>
    <returnValueBindings name="PaymentInstrumentInfoBO" objectPath="PIIBO"/>
  </nodes>
<!--@Location 32,38-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet2">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 64,77 64,73-->
    <nodeSuccessors name="next" next="LoopNode16_Entry"/>
    <parameterBindings name="InVector" objectPath="PaymentInstrumentInfoBOVector"/>
    <parameterBindings name="Object" objectPath="PIIBO"/>
    <parameterBindings name="Objects" nullBinding="true"/>
    <returnValueBindings name="Iterator" objectPath="PaymentInstrumentInfoBOIterator"/>
    <returnValueBindings name="OutVector" nullBinding="true"/>
  </nodes>
<!--@Location 34,36-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode60" name="" strict="true">
    <returnValues name="PaymentInstrumentInfoBOIterator" type="java.util.Iterator"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.

@Location 12,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode21" strict="true" name="RemoveAssignedOpenTenders"
      callMode="Private">
<!--@BendPoints 25,4-->
    <nodeSuccessors name="next" next="SetDictionaryValue4"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
  </nodes>
<!--@Location 12,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue4">
    <configurationValues name="Name" value="RemovedOpenTenderPII"/>
    <configurationValues name="Value" value="false"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
<!--@BendPoints 25,6-->
    <nodeSuccessors name="next" next="DecisionNode17"/>
  </nodes>
<!--@Location 12,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode17" conditionKey="Cart:PaymentInstrumentInfo">
<!--@BendPoints 25,8-->
    <nodeSuccessors name="decision_yes" next="LoopNode7"/>
<!--@BendPoints 27,7-->
    <nodeSuccessors name="decision_no" next="JoinNode12"/>
  </nodes>
<!--@Location 12,4-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode7" loop="Cart:PaymentInstrumentInfo">
    <nodeSuccessors name="next" next="JoinNode12"/>
    <entry key="PII">
<!--@BendPoints 25,10-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode8"/>
    </entry>
  </nodes>
<!--@Location 12,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode8" conditionKey="PII:PaymentService:Capabilities:OpenTender"
      operator="str_eq" conditionValue="true">
<!--@BendPoints 25,12-->
    <nodeSuccessors name="decision_yes" next="SetDictionaryValue5"/>
<!--@BendPoints 27,11 27,17-->
    <nodeSuccessors name="decision_no" next="JoinNode11"/>
  </nodes>
<!--@Location 12,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue5">
    <configurationValues name="Name" value="RemovedOpenTenderPII"/>
    <configurationValues name="Value" value="true"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
<!--@BendPoints 25,14-->
    <nodeSuccessors name="next" next="CallNode21"/>
  </nodes>
<!--@Location 12,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode21">
    <nodeSuccessors name="next" next="JoinNode11"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="PII"/>
    <startNode referencedName="ProcessPayment-RemovePaymentInstrumentInfo"/>
  </nodes>
<!--@Location 12,8-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
<!--@BendPoints 24,17 24,9-->
    <nodeSuccessors name="next" next="LoopNode7_Entry"/>
  </nodes>
<!--@Location 13,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode12">
<!--@BendPoints 27,10 29,10-->
    <nodeSuccessors name="next" next="DecisionNode13"/>
  </nodes>
<!--@Location 14,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode13" conditionKey="RemovedOpenTenderPII"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="CallNode11"/>
<!--@BendPoints 30,11 30,15-->
    <nodeSuccessors name="decision_no" next="JoinNode29"/>
  </nodes>
<!--@Location 14,6-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode11">
    <nodeSuccessors name="next" next="JoinNode29"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 14,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode29">
<!--@BendPoints 29,16-->
    <nodeSuccessors name="next" next="EndNode29"/>
  </nodes>
<!--@Location 14,8-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode29" name="" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 22,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode14" strict="true" name="RemovePaymentInstrumentInfo"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper3"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 22,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper3">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="CallNode13"/>
    <parameterBindings name="InValue_1" objectPath="PaymentInstrumentInfo:UUID"/>
    <returnValueBindings name="OutValue_1" objectPath="RemovedPaymentInstrumentInfoUUID"/>
  </nodes>
<!--@Location 22,16-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode13">
    <nodeSuccessors name="next" next="EndNode25"/>
    <startNode referencedName="ProcessPaymentInstrument-RemovePaymentInstrumentInfo"/>
  </nodes>
<!--@Location 22,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode25" name="" strict="true">
    <returnValues name="RemovedPaymentInstrumentInfoUUID" type="java.lang.String"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
Replaces the open tender payment instruments assigned to the given basket (if any) by another payment instrument of an open tender payment service. (Useful since standard Enfinity payment service selection strategy only permits one open tender payment instrument per basket.)
@Location 23,18-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode28" strict="true" name="ReplaceOpenTenderPaymentInstrumentForBasket"
      callMode="Private">
    <nodeSuccessors name="next" next="CheckPiiUnique0"/>
    <parameters name="OpenTenderPaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="CartBO" type="com.intershop.component.basket.capi.BasketBO"/>
    <parameters name="ActivePaymentServices" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentService>"/>
    <parameters name="ActivePaymentConfigurations" type="java.util.List&lt;com.intershop.beehive.bts.capi.payment.PaymentConfiguration>"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
  </nodes>
<!--@Location 23,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CheckPiiUnique0">
    <configurationValues name="LetPaymentMethodDecide" value="true"/>
    <pipelet href="enfinity:/bts/pipelets/CheckPiiUnique.xml"/>
    <nodeSuccessors name="next" next="CallNode29"/>
<!--@BendPoints 45,39 45,47-->
    <nodeSuccessors name="pipelet_error" next="JoinNode0"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="OpenTenderPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 23,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode29">
    <nodeSuccessors name="next" next="CallNode77"/>
    <startNode referencedName="This:RemoveAssignedOpenTenders"/>
  </nodes>
<!--@Location 23,21-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode77">
<!--@BendPoints 47,44-->
    <nodeSuccessors name="next" next="CallNode33"/>
<!--@BendPoints 49,43 49,44-->
    <nodeSuccessors name="ERROR" next="EndNode48"/>
    <parameterBindings name="ServiceToBeChecked" objectPath="OpenTenderPaymentInstrumentInfo:PaymentService"/>
    <startNode referencedName="ProcessPayment-CheckPaymentServiceAssignable"/>
  </nodes>
<!--@Location 23,22-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode33">
    <nodeSuccessors name="next" next="JoinNode0"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="OpenTenderPaymentInstrumentInfo"/>
    <startNode referencedName="ProcessPayment-AssignPIItoCart"/>
  </nodes>
<!--@Location 23,23-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode0">
    <nodeSuccessors name="next" next="EndNode49"/>
  </nodes>
<!--@Location 23,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode49" name="" strict="true"/>
<!--@Location 24,22-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode48" name="ERROR" strict="true">
    <returnValues name="ERROR_PaymentServiceNotAssignable" type="java.lang.Boolean"
        optional="true"/>
    <returnValues name="BasketCovered" type="java.lang.Boolean" optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 12,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode23" strict="true" name="ReverseAuthorization"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode18"/>
    <parameters name="PaymentTransactionIterator" type="java.util.Iterator" optional="true"/>
    <parameters name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"/>
  </nodes>
<!--@Location 12,15-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode18" conditionKey="PaymentTransactionIterator">
    <nodeSuccessors name="decision_yes" next="LoopNode3"/>
<!--@BendPoints 29,31-->
    <nodeSuccessors name="decision_no" next="JoinNode35"/>
  </nodes>
<!--@Location 12,16-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode3" loop="PaymentTransactionIterator">
    <nodeSuccessors name="next" next="JoinNode35"/>
    <entry key="PaymentTransaction">
<!--@BendPoints 25,34-->
      <nodeSuccessors name="loop_entry_next" next="ReversePaymentAuthorization1"/>
    </entry>
  </nodes>
<!--@Location 12,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ReversePaymentAuthorization1">
    <pipelet href="enfinity:/bts/pipelets/ReversePaymentAuthorization.xml"/>
    <nodeSuccessors name="next" next="UpdateOrderStatus4"/>
<!--@BendPoints 26,35 26,36 24,36-->
    <nodeSuccessors name="pipelet_error" next="JoinNode38"/>
  </nodes>
<!--@Location 12,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderStatus4">
    <configurationValues name="StateGroup" value="OrderStatus"/>
    <configurationValues name="StateName" value="CANCELLED"/>
    <pipelet href="enfinity:/bts/pipelets/UpdateOrderStatus.xml"/>
    <nodeSuccessors name="next" next="DecisionNode31"/>
  </nodes>
<!--@Location 12,19-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode31" conditionKey="PaymentCancelResult">
<!--@BendPoints 25,40-->
    <nodeSuccessors name="decision_yes" next="AddObjectToVector7"/>
<!--@BendPoints 27,39-->
    <nodeSuccessors name="decision_no" next="JoinNode40"/>
  </nodes>
<!--@Location 12,20-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector7">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 25,42-->
    <nodeSuccessors name="next" next="DecisionNode32"/>
    <parameterBindings name="InVector" objectPath="PaymentCancelResults"/>
    <parameterBindings name="Object" objectPath="PaymentCancelResult"/>
    <returnValueBindings name="Iterator" objectPath="PaymentCancelResultsIterator"/>
    <returnValueBindings name="OutVector" objectPath="PaymentCancelResults"/>
  </nodes>
<!--@Location 12,21-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode32" conditionKey="PaymentCancelResult:CancelStatus"
      operator="eq" conditionValue="-1">
    <nodeSuccessors name="decision_yes" next="UpdateOrderStatus5"/>
    <nodeSuccessors name="decision_no" next="JoinNode40"/>
  </nodes>
<!--@Location 12,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderStatus5">
    <configurationValues name="StateGroup" value="OrderPaymentStatus"/>
    <configurationValues name="StateName" value="MANUAL_INTERVENTION_NEEDED"/>
    <pipelet href="enfinity:/bts/pipelets/UpdateOrderStatus.xml"/>
    <nodeSuccessors name="next" next="JoinNode39"/>
  </nodes>
<!--@Location 12,23-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode39">
<!--@BendPoints 25,48-->
    <nodeSuccessors name="next" next="RemoveDictionaryValue3"/>
  </nodes>
<!--@Location 12,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue3">
    <configurationValues name="Key" value="PaymentCancelResult"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 25,50-->
    <nodeSuccessors name="next" next="DecisionNode27"/>
  </nodes>
<!--@Location 12,25-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode27" conditionKey="PaymentReduceResult">
<!--@BendPoints 25,52-->
    <nodeSuccessors name="decision_yes" next="AddObjectToVector3"/>
<!--@BendPoints 27,51-->
    <nodeSuccessors name="decision_no" next="JoinNode36"/>
  </nodes>
<!--@Location 12,26-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector3">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 25,54-->
    <nodeSuccessors name="next" next="DecisionNode29"/>
    <parameterBindings name="InVector" objectPath="PaymentReduceResults"/>
    <parameterBindings name="Object" objectPath="PaymentReduceResult"/>
    <returnValueBindings name="Iterator" objectPath="PaymentReduceResultsIterator"/>
    <returnValueBindings name="OutVector" objectPath="PaymentReduceResults"/>
  </nodes>
<!--@Location 12,27-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode29" conditionKey="PaymentReduceResult:ReduceStatus"
      operator="eq" conditionValue="-1">
    <nodeSuccessors name="decision_yes" next="UpdateOrderStatus2"/>
    <nodeSuccessors name="decision_no" next="JoinNode36"/>
  </nodes>
<!--@Location 12,28-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderStatus2">
    <configurationValues name="StateGroup" value="OrderPaymentStatus"/>
    <configurationValues name="StateName" value="MANUAL_INTERVENTION_NEEDED"/>
    <pipelet href="enfinity:/bts/pipelets/UpdateOrderStatus.xml"/>
    <nodeSuccessors name="next" next="JoinNode13"/>
  </nodes>
<!--@Location 12,29-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
<!--@BendPoints 25,60-->
    <nodeSuccessors name="next" next="RemoveDictionaryValue1"/>
  </nodes>
<!--@Location 12,30-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue1">
    <configurationValues name="Key" value="PaymentReduceResult"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 25,62-->
    <nodeSuccessors name="next" next="DecisionNode28"/>
  </nodes>
<!--@Location 12,31-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode28" conditionKey="PaymentRefundResult">
<!--@BendPoints 25,64-->
    <nodeSuccessors name="decision_yes" next="AddObjectToVector6"/>
<!--@BendPoints 27,63-->
    <nodeSuccessors name="decision_no" next="JoinNode37"/>
  </nodes>
<!--@Location 12,32-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector6">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="DecisionNode30"/>
    <parameterBindings name="InVector" objectPath="PaymentRefundResults"/>
    <parameterBindings name="Object" objectPath="PaymentRefundResult"/>
    <returnValueBindings name="Iterator" objectPath="PaymentRefundResultsIterator"/>
    <returnValueBindings name="OutVector" objectPath="PaymentRefundResults"/>
  </nodes>
<!--@Location 12,33-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode30" conditionKey="PaymentRefundResult:RefundStatus"
      operator="eq" conditionValue="-1">
    <nodeSuccessors name="decision_yes" next="UpdateOrderStatus3"/>
    <nodeSuccessors name="decision_no" next="JoinNode37"/>
  </nodes>
<!--@Location 12,34-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateOrderStatus3">
    <configurationValues name="StateGroup" value="OrderPaymentStatus"/>
    <configurationValues name="StateName" value="MANUAL_INTERVENTION_NEEDED"/>
    <pipelet href="enfinity:/bts/pipelets/UpdateOrderStatus.xml"/>
    <nodeSuccessors name="next" next="JoinNode34"/>
  </nodes>
<!--@Location 12,35-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode34">
<!--@BendPoints 25,72-->
    <nodeSuccessors name="next" next="RemoveDictionaryValue2"/>
  </nodes>
<!--@Location 12,36-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue2">
    <configurationValues name="Key" value="PaymentRefundResult"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 23,74-->
    <nodeSuccessors name="next" next="JoinNode38"/>
  </nodes>
<!--@Location 11,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode38">
<!--@BendPoints 23,33-->
    <nodeSuccessors name="next" next="LoopNode3_Entry"/>
  </nodes>
<!--@Location 13,33-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode37">
<!--@BendPoints 27,71-->
    <nodeSuccessors name="next" next="JoinNode34"/>
  </nodes>
<!--@Location 13,27-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode36">
<!--@BendPoints 27,59-->
    <nodeSuccessors name="next" next="JoinNode13"/>
  </nodes>
<!--@Location 13,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode40">
<!--@BendPoints 27,47-->
    <nodeSuccessors name="next" next="JoinNode39"/>
  </nodes>
<!--@Location 14,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode35">
<!--@BendPoints 29,34-->
    <nodeSuccessors name="next" next="EndNode45"/>
  </nodes>
<!--@Location 14,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode45" name="" strict="true">
    <returnValues name="PaymentReduceResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentRefundResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentCancelResultsIterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 29,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="SetDefaultPaymentMethod"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode9"/>
    <parameters name="PaymentInstrumentInfoUUID" type="java.lang.String" optional="true"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@Location 29,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode9" conditionKey="PaymentInstrumentInfo">
    <nodeSuccessors name="decision_yes" next="JoinNode22"/>
<!--@BendPoints 61,5 61,6-->
    <nodeSuccessors name="decision_no" next="GetPaymentInstrumentInfoByUUID1"/>
  </nodes>
<!--@Location 29,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode22">
<!--@BendPoints 59,10-->
    <nodeSuccessors name="next" next="SetDefaultPaymentInstrument1" action="begin"/>
  </nodes>
<!--@Location 29,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDefaultPaymentInstrument1">
    <pipelet href="enfinity:/bts/pipelets/SetDefaultPaymentInstrument.xml"/>
<!--@BendPoints 59,12-->
    <nodeSuccessors name="next" next="EndNode2" action="commit"/>
    <parameterBindings name="Domain" nullBinding="true"/>
  </nodes>
<!--@Location 29,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" name="" strict="true"/>
<!--@Location 30,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPaymentInstrumentInfoByUUID1">
    <pipelet href="enfinity:/bts/pipelets/GetPaymentInstrumentInfoByUUID.xml"/>
<!--@BendPoints 61,9-->
    <nodeSuccessors name="next" next="JoinNode22"/>
<!--@BendPoints 63,7 63,12-->
    <nodeSuccessors name="pipelet_error" next="EndNode1"/>
  </nodes>
<!--@Location 31,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" name="ERROR" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 28,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode16" strict="true" name="SetReturningUserPayment"
      callMode="Private">
<!--@BendPoints 57,30-->
    <nodeSuccessors name="next" next="DecisionNode10"/>
    <parameters name="Cart" type="com.intershop.beehive.bts.capi.orderprocess.basket.Basket"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
    <parameters name="CurrentAppContext" type="com.intershop.beehive.app.capi.AppContext"/>
  </nodes>
<!--@Location 28,15-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode10" conditionKey="Cart:PaymentInstrumentInfo">
    <nodeSuccessors name="decision_yes" next="DecisionNode45"/>
    <nodeSuccessors name="decision_no" next="JoinNode50"/>
  </nodes>
<!--@Location 28,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode45" conditionKey="Cart:PaymentInstrumentInfo"
      operator="has_elements">
<!--@BendPoints 57,51-->
    <nodeSuccessors name="decision_yes" next="JoinNode23"/>
    <nodeSuccessors name="decision_no" next="JoinNode50"/>
  </nodes>
<!--@Location 29,26-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode23">
    <nodeSuccessors name="next" next="DecisionNode35"/>
  </nodes>
<!--@Location 29,27-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode35" conditionKey="PIIChanged"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="EndNode37"/>
<!--@BendPoints 61,55 61,56-->
    <nodeSuccessors name="decision_no" next="EndNode38"/>
  </nodes>
<!--@Location 29,28-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode37" name="PII_CHANGED" strict="true"/>
<!--@Location 30,28-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode38" name="" strict="true"/>
<!--@Location 29,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode50">
    <nodeSuccessors name="next" next="CallNode30"/>
  </nodes>
<!--@Location 29,17-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode30">
    <nodeSuccessors name="next" next="CallNode19"/>
<!--@BendPoints 61,35 61,51-->
    <nodeSuccessors name="ERROR" next="JoinNode23"/>
    <startNode referencedName="ProcessPayment-GetDefaultPaymentInstrumentInfoByUser"/>
  </nodes>
<!--@Location 29,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode19">
    <nodeSuccessors name="next" next="CallNode31"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="DefaultPaymentInstrumentInfo"/>
    <startNode referencedName="ProcessPayment-ClonePII"/>
  </nodes>
<!--@Location 29,19-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode31">
    <nodeSuccessors name="next" next="CallNode52"/>
    <parameterBindings name="PaymentInstrumentInfo" objectPath="ClonedPaymentInstrumentInfo"/>
    <startNode referencedName="ProcessPayment-AssignPIItoCart"/>
  </nodes>
<!--@Location 29,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode52">
    <nodeSuccessors name="next" next="GetBasketBORepositoryFromAppContext1"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 29,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBORepositoryFromAppContext1">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBORepositoryFromAppContext.xml"/>
    <nodeSuccessors name="next" next="GetBasketBO0"/>
  </nodes>
<!--@Location 29,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetBasketBO0">
    <pipelet href="enfinity:/bc_basket/pipelets/GetBasketBO.xml"/>
    <nodeSuccessors name="next" next="GetApplicationBO0"/>
    <parameterBindings name="Basket" objectPath="Cart"/>
  </nodes>
<!--@Location 29,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetApplicationBO0">
    <pipelet href="enfinity:/bc_application/pipelets/GetApplicationBO.xml"/>
    <nodeSuccessors name="next" next="CallNode53"/>
  </nodes>
<!--@Location 29,24-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode53">
    <nodeSuccessors name="next" next="KeyMapper4"/>
    <parameterBindings name="Application" objectPath="ApplicationBO"/>
    <parameterBindings name="Basket" objectPath="BasketBO"/>
    <startNode referencedName="ProcessBasketCalculation-Calculate"/>
  </nodes>
<!--@Location 29,25-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper4">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode23"/>
    <parameterBindings name="InValue_1" constant="true"/>
    <returnValueBindings name="OutValue_1" objectPath="PIIChanged"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 6,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode3" strict="true" name="Start"
      callMode="Private">
<!--@BendPoints 13,30-->
    <nodeSuccessors name="next" next="CreatePayment1"/>
    <parameters name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"
        optional="true"/>
    <parameters name="Orders" type="java.util.Iterator" optional="true"/>
    <parameters name="AllFormValues" type="java.util.Map&lt;java.lang.String, java.lang.String[]>"/>
  </nodes>
<!--@Location 6,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePayment1">
    <pipelet href="enfinity:/bts/pipelets/CreatePayment.xml"/>
    <nodeSuccessors name="next" next="DecisionNode11"/>
<!--@BendPoints 19,31-->
    <nodeSuccessors name="pipelet_error" next="JoinNode9"/>
  </nodes>
<!--@Location 6,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode11" conditionKey="Orders">
    <nodeSuccessors name="decision_yes" next="LoopNode5"/>
<!--@BendPoints 17,33-->
    <nodeSuccessors name="decision_no" next="DecisionNode2"/>
  </nodes>
<!--@Location 6,17-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode5" loop="Orders">
<!--@BendPoints 14,35-->
    <nodeSuccessors name="next" next="EndNode11"/>
    <entry key="Order">
<!--@BendPoints 13,36-->
      <nodeSuccessors name="loop_entry_next" next="CallNode8"/>
    </entry>
  </nodes>
<!--@Location 6,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode8">
    <nodeSuccessors name="next" next="AddObjectToVector1"/>
<!--@BendPoints 14,38-->
    <nodeSuccessors name="ERROR" next="JoinNode3"/>
    <startNode referencedName="ProcessPayment-StartSingle"/>
  </nodes>
<!--@Location 6,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector1">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 13,40 12,40 12,35-->
    <nodeSuccessors name="next" next="LoopNode5_Entry"/>
    <parameterBindings name="InVector" objectPath="AutorizationOrders"/>
    <parameterBindings name="Object" objectPath="Order"/>
    <returnValueBindings name="Iterator" objectPath="AuthorizationOrderIterator"/>
    <returnValueBindings name="OutVector" objectPath="AuthorizationOrders"/>
  </nodes>
<!--@Location 9,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
<!--@BendPoints 19,42-->
    <nodeSuccessors name="next" next="EndNode5"/>
  </nodes>
<!--@Location 9,21-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode5" name="ERROR" strict="true">
    <returnValues name="AuthorizationResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentReduceResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentRefundResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentCancelResultsIterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 7,17-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode11" name="" strict="true">
    <returnValues name="NEEDS_REDIRECT" type="java.lang.String" optional="true"/>
    <returnValues name="AuthorizationResultsIterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 8,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="Order">
    <nodeSuccessors name="decision_yes" next="CallNode9"/>
    <nodeSuccessors name="decision_no" next="JoinNode9"/>
  </nodes>
<!--@Location 8,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode9">
<!--@BendPoints 17,38-->
    <nodeSuccessors name="next" next="EndNode4"/>
    <nodeSuccessors name="ERROR" next="JoinNode3"/>
    <startNode referencedName="ProcessPayment-StartSingle"/>
  </nodes>
<!--@Location 8,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode4" name="" strict="true">
    <returnValues name="NEEDS_REDIRECT" type="java.lang.String" optional="true"/>
    <returnValues name="AuthorizationResultsIterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 9,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
    <nodeSuccessors name="next" next="JoinNode3"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 17,14-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode7" strict="true" name="StartSingle"
      callMode="Private">
    <nodeSuccessors name="next" next="DeterminePaymentAuthorizationSequence1"/>
    <parameters name="Order" type="com.intershop.beehive.bts.capi.orderprocess.fulfillment.Order"/>
    <parameters name="AllFormValues" type="java.util.Map&lt;java.lang.String, java.lang.String[]>"/>
  </nodes>
<!--@Location 17,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeterminePaymentAuthorizationSequence1">
    <pipelet href="enfinity:/bts/pipelets/DeterminePaymentAuthorizationSequence.xml"/>
<!--@BendPoints 35,32-->
    <nodeSuccessors name="next" next="LoopNode6"/>
  </nodes>
<!--@Location 17,16-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode6" loop="PaymentTransactions">
<!--@BendPoints 36,33-->
    <nodeSuccessors name="next" next="EndNode12"/>
    <entry key="PaymentTransaction">
<!--@BendPoints 35,34-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode7"/>
    </entry>
  </nodes>
<!--@Location 17,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode7" conditionKey="PaymentTransaction:CanBeAuthorized"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="DecisionNode12"/>
<!--@BendPoints 43,35-->
    <nodeSuccessors name="decision_no" next="JoinNode17"/>
  </nodes>
<!--@Location 17,18-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode12" conditionKey="PaymentTransaction:RequiresRedirectForAuthorization"
      operator="str_eq" conditionValue="false">
<!--@BendPoints 35,38-->
    <nodeSuccessors name="decision_yes" next="GetFormRecord2"/>
<!--@BendPoints 38,37-->
    <nodeSuccessors name="decision_no" next="SetDictionaryValue1"/>
  </nodes>
<!--@Location 17,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetFormRecord2">
    <pipelet href="enfinity:/core/pipelets/GetFormRecord.xml"/>
    <nodeSuccessors name="next" next="ProcessPaymentAuthorization1"/>
    <parameterBindings name="RecordID" objectPath="PaymentTransaction:PaymentService:ID"/>
    <returnValueBindings name="FormRecord" objectPath="PIIData"/>
  </nodes>
<!--@Location 17,20-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ProcessPaymentAuthorization1">
    <pipelet href="enfinity:/bts/pipelets/ProcessPaymentAuthorization.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector5"/>
    <nodeSuccessors name="pipelet_error" next="AddObjectToVector4"/>
    <parameterBindings name="AdditionalData" objectPath="PIIData"/>
  </nodes>
<!--@Location 17,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector5">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector2"/>
    <parameterBindings name="InVector" objectPath="AutorizationResults"/>
    <parameterBindings name="Object" objectPath="AuthorizationResult"/>
    <returnValueBindings name="Iterator" objectPath="AuthorizationResultsIterator"/>
    <returnValueBindings name="OutVector" objectPath="AuthorizationResults"/>
  </nodes>
<!--@Location 17,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector2">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="JoinNode15"/>
    <parameterBindings name="InVector" objectPath="PaymentTransactionVector"/>
    <parameterBindings name="Object" objectPath="PaymentTransaction"/>
    <returnValueBindings name="Iterator" objectPath="PaymentTransactionIterator"/>
    <returnValueBindings name="OutVector" objectPath="PaymentTransactionVector"/>
  </nodes>
<!--@Location 17,23-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode15">
<!--@BendPoints 34,47 34,33-->
    <nodeSuccessors name="next" next="LoopNode6_Entry"/>
  </nodes>
<!--@Location 18,20-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector4">
    <configurationValues name="Mode" value="Allow Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
    <nodeSuccessors name="next" next="CallNode32"/>
    <parameterBindings name="InVector" objectPath="AutorizationResults"/>
    <parameterBindings name="Object" objectPath="AuthorizationResult"/>
    <returnValueBindings name="Iterator" objectPath="AuthorizationResultsIterator"/>
    <returnValueBindings name="OutVector" objectPath="AuthorizationResults"/>
  </nodes>
<!--@Location 19,20-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode32">
<!--@BendPoints 40,41-->
    <nodeSuccessors name="next" next="EndNode46"/>
    <startNode referencedName="This:ReverseAuthorization"/>
  </nodes>
<!--@Location 20,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode46" name="ERROR" strict="true">
    <returnValues name="AuthorizationResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentReduceResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentRefundResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="PaymentCancelResultsIterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 19,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue1">
    <configurationValues name="Name" value="NEEDS_REDIRECT"/>
    <configurationValues name="Value" value="true"/>
    <configurationValues name="ValueType" value="Dictionary Value"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
    <nodeSuccessors name="next" next="JoinNode17"/>
  </nodes>
<!--@Location 21,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode17">
<!--@BendPoints 43,47-->
    <nodeSuccessors name="next" next="JoinNode15"/>
  </nodes>
<!--@Location 18,16-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode12" name="" strict="true">
    <returnValues name="AuthorizationResultsIterator" type="java.util.Iterator" optional="true"/>
    <returnValues name="NEEDS_REDIRECT" type="java.lang.String" optional="true"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 10,8-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode17" strict="true" name="UpdatePII"
      callMode="Private">
<!--@BendPoints 21,18-->
    <nodeSuccessors name="next" next="UpdatePaymentInstrumentInfo1"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
    <parameters name="PIIData" type="java.util.Map&lt;java.lang.String,java.lang.String>"
        optional="true"/>
  </nodes>
<!--@Location 10,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdatePaymentInstrumentInfo1">
    <pipelet href="enfinity:/bts/pipelets/UpdatePaymentInstrumentInfo.xml"/>
    <nodeSuccessors name="next" next="CallNode43"/>
<!--@BendPoints 22,19-->
    <nodeSuccessors name="pipelet_error" next="EndNode19"/>
  </nodes>
<!--@Location 10,10-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode43">
    <nodeSuccessors name="next" next="EndNode18"/>
    <parameterBindings name="Basket" objectPath="PaymentInstrumentInfo:LineItemCtnr"/>
    <startNode referencedName="ProcessBasketInvalidation-InvalidateBasketCalculation"/>
  </nodes>
<!--@Location 10,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode18" name="" strict="true"/>
<!--@Location 11,9-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode19" name="ERROR" strict="true"/>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.
@Location 1,9-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode26" strict="true" name="ValidateCheckoutData"
      callMode="Private">
<!--@BendPoints 3,20-->
    <nodeSuccessors name="next" next="CallNode24"/>
    <parameters name="AllFormValues" type="java.util.Map&lt;java.lang.String,java.lang.String[]>"
        optional="true"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"
        optional="true"/>
  </nodes>
<!--@Location 1,10-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode24">
<!--@BendPoints 3,22-->
    <nodeSuccessors name="next" next="EndNode41"/>
<!--@BendPoints 5,22-->
    <nodeSuccessors name="ERROR" next="EndNode42"/>
    <startNode referencedName="ProcessPaymentInstrument-ValidateCheckoutData"/>
  </nodes>
<!--@Location 1,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode41" name="" strict="true"/>
<!--@Location 2,11-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode42" name="ERROR" strict="true">
    <returnValues name="PIIDataVerificationResult" type="com.intershop.beehive.bts.capi.payment.PIIDataVerificationResult"/>
  </nodes>
<!--@deprecated
Deprecated since 7.6.0.0, will be removed in one of the next releases. Use new Payment API with Pipeline bc_payment/staticfiles/cartridge/pipelines/ProcessPayment instead.

@Location 1,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode15" strict="true" name="VerifyPaymentInstrumentInfo"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode15"/>
    <parameters name="PaymentInstrumentInfo" type="com.intershop.beehive.bts.capi.payment.PaymentInstrumentInfo"/>
  </nodes>
<!--@Location 1,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode15">
<!--@BendPoints 3,6-->
    <nodeSuccessors name="next" next="EndNode26"/>
<!--@BendPoints 5,6-->
    <nodeSuccessors name="ERROR" next="EndNode27"/>
    <startNode referencedName="ProcessPaymentInstrument-VerifyPaymentInstrumentInfo"/>
  </nodes>
<!--@Location 1,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode26" name="" strict="true"/>
<!--@Location 2,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode27" name="ERROR" strict="true"/>
</pipeline:Pipeline>
