<?xml version="1.0" encoding="UTF-8"?>
<!--The pipeline is used to determine the availability of a promotion depending on the availability of promotion associated products. A product associated promotion is available if at least one associated product is available. 
@Group OnlineMarketing-->

<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessActivePromotionProducts" type="job">
<!--If the currency for a promotion has the value 'all' then
the path Promotion:Currency returns null.
So we decide to take it from the request.
@Location 16,15-->
  <nodes xsi:type="pipeline:Text" nodeID="Text0"/>
<!--@Location 18,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode28" strict="true" name="CreateActivePromoProductsJob"
      callMode="Private">
<!--@BendPoints 37,32-->
    <nodeSuccessors name="next" next="Pipelet5"/>
<!--The Domain for tha a job configuration is to create.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 18,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet5">
    <configurationValues name="DomainName" value=""/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateJobConfiguration.xml"/>
    <nodeSuccessors name="next" next="Pipelet2"/>
<!--@BendPoints 39,33-->
    <nodeSuccessors name="pipelet_error" next="JoinNode49"/>
  </nodes>
<!--@Location 18,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="Pipelet2">
    <configurationValues name="Date" value="1970.01.01_at_22:00:00"/>
    <configurationValues name="Descript" value="Fills the table ACTIVEPROMOPRODUCTS in order to prepare the date for the ProductPromotionDataProvider."/>
    <configurationValues name="EnableJob" value="true"/>
    <configurationValues name="Interval" value="1440"/>
    <configurationValues name="Name" value="ProcessActivePromotionProducts"/>
    <configurationValues name="PipelineName" value="ProcessActivePromotionProducts"/>
    <configurationValues name="PipelineStartNode" value="Start"/>
    <configurationValues name="Unit" value="Minutes"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateJobConfiguration.xml"/>
    <nodeSuccessors name="next" next="UpdateCustomAttribute1"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode49"/>
    <parameterBindings name="JobDate" nullBinding="true"/>
    <parameterBindings name="JobDescription" nullBinding="true"/>
    <parameterBindings name="JobDomain" nullBinding="true"/>
    <parameterBindings name="JobDomainName" nullBinding="true"/>
    <parameterBindings name="JobEnable" nullBinding="true"/>
    <parameterBindings name="JobInterval" nullBinding="true"/>
    <parameterBindings name="JobJavaDate" nullBinding="true"/>
    <parameterBindings name="JobName" nullBinding="true"/>
    <parameterBindings name="JobPipelineName" nullBinding="true"/>
    <parameterBindings name="JobPipelineStartNode" nullBinding="true"/>
    <parameterBindings name="JobUUID" nullBinding="true"/>
    <parameterBindings name="JobUnit" nullBinding="true"/>
  </nodes>
<!--@Location 18,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateCustomAttribute1">
    <configurationValues name="DefaultAttributeName" value="DomainName"/>
    <configurationValues name="DefaultAttributeType" value="String"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateCustomAttribute.xml"/>
<!--@BendPoints 37,38-->
    <nodeSuccessors name="next" next="EndNode44"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode48"/>
    <parameterBindings name="AttributeName" nullBinding="true"/>
    <parameterBindings name="AttributeType" nullBinding="true"/>
    <parameterBindings name="AttributeValue" objectPath="JobConfiguration:Domain:DomainName"/>
    <parameterBindings name="ExtensibleObject" objectPath="JobConfiguration"/>
    <parameterBindings name="LocaleInformation" nullBinding="true"/>
  </nodes>
<!--@Location 18,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode44" strict="true">
<!--The job configuration that is created.-->
    <returnValues name="JobConfiguration" type="com.intershop.beehive.core.capi.job.JobConfiguration"/>
  </nodes>
<!--@Location 19,18-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode48">
<!--@BendPoints 39,38-->
    <nodeSuccessors name="next" next="EndNode43"/>
  </nodes>
<!--@Location 19,19-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode43" name="error" strict="true"/>
<!--@Location 19,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode49">
    <nodeSuccessors name="next" next="JoinNode48"/>
  </nodes>
<!--@Location 23,2-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="FilterByActionMinPrice"
      callMode="Private">
<!--@BendPoints 47,6-->
    <nodeSuccessors name="next" next="CreateIteratorFromConfigValues2"/>
    <parameters name="Rebate" type="com.intershop.component.marketing.capi.rebate.Rebate"/>
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="PromotionProducts" type="java.util.Iterator"/>
    <parameters name="ProductGroupType" type="java.lang.String"/>
  </nodes>
<!--@Location 23,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateIteratorFromConfigValues2">
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateIteratorFromConfigValues.xml"/>
    <nodeSuccessors name="next" next="LoopNode3"/>
    <parameterBindings name="ValuesString" nullBinding="true"/>
    <returnValueBindings name="ValuesIterator" objectPath="ActionsMinPriceFilteredProducts"/>
  </nodes>
<!--@Location 23,4-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode3" loop="Rebate:Actions">
<!--@BendPoints 48,9-->
    <nodeSuccessors name="next" next="EndNode3"/>
    <entry key="Action">
<!--@BendPoints 47,10 46,10 46,11-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode3"/>
    </entry>
  </nodes>
<!--@Location 23,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="ProductGroupType"
      operator="str_eq" conditionValue="ConditionalProducts">
<!--@BendPoints 48,11-->
    <nodeSuccessors name="decision_yes" next="FilterProductsByActionMinPrice4"/>
<!--@BendPoints 47,12 46,12 46,13-->
    <nodeSuccessors name="decision_no" next="DecisionNode4"/>
  </nodes>
<!--@Location 24,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="FilterProductsByActionMinPrice4">
    <configurationValues name="ProductGroupType" value="ConditionalProducts"/>
    <pipelet href="enfinity:/bc_marketing/pipelets/FilterProductsByActionMinPrice.xml"/>
<!--@BendPoints 51,11-->
    <nodeSuccessors name="next" next="JoinNode3"/>
    <parameterBindings name="Site" objectPath="Domain:Site"/>
    <returnValueBindings name="FilteredProducts" objectPath="ActionMinPriceFilteredProducts"/>
  </nodes>
<!--@Location 25,6-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
<!--@BendPoints 51,14-->
    <nodeSuccessors name="next" next="CombineIterators3"/>
  </nodes>
<!--@Location 25,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators3">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
<!--@BendPoints 51,16 45,16-->
    <nodeSuccessors name="next" next="JoinNode4"/>
    <parameterBindings name="Iterator1" objectPath="ActionsMinPriceFilteredProducts"/>
    <parameterBindings name="Iterator2" objectPath="ActionMinPriceFilteredProducts"/>
    <returnValueBindings name="Iterator" objectPath="ActionsMinPriceFilteredProducts"/>
  </nodes>
<!--@Location 22,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
<!--@BendPoints 45,9-->
    <nodeSuccessors name="next" next="LoopNode3_Entry"/>
  </nodes>
<!--@Location 23,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="ProductGroupType"
      operator="str_eq" conditionValue="SelectedProducts">
<!--@BendPoints 48,13-->
    <nodeSuccessors name="decision_yes" next="FilterProductsByActionMinPrice5"/>
<!--@BendPoints 47,15-->
    <nodeSuccessors name="decision_no" next="JoinNode4"/>
  </nodes>
<!--@Location 24,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="FilterProductsByActionMinPrice5">
    <configurationValues name="ProductGroupType" value="SelectedProducts"/>
    <pipelet href="enfinity:/bc_marketing/pipelets/FilterProductsByActionMinPrice.xml"/>
    <nodeSuccessors name="next" next="JoinNode3"/>
    <parameterBindings name="Site" objectPath="Domain:Site"/>
    <returnValueBindings name="FilteredProducts" objectPath="ActionMinPriceFilteredProducts"/>
  </nodes>
<!--@Location 24,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode3" strict="true">
    <returnValues name="ActionsMinPriceFilteredProducts" type="java.util.Iterator"/>
  </nodes>
<!--@Location 10,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode24" strict="true" name="FilterConditionalProducts"
      callMode="Private">
<!--@BendPoints 21,32-->
    <nodeSuccessors name="next" next="CreateUUID1"/>
<!--The conditional product to be filtered.-->
    <parameters name="ConditionalProducts" type="java.util.Iterator"/>
<!--The promotion.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 10,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateUUID1">
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateUUID.xml"/>
<!--@BendPoints 21,34-->
    <nodeSuccessors name="next" next="DetermineUser1"/>
    <returnValueBindings name="UUID" objectPath="UserID"/>
  </nodes>
<!--@Location 10,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DetermineUser1">
    <pipelet href="enfinity:/core/pipelets/DetermineUser.xml"/>
<!--@BendPoints 21,36-->
    <nodeSuccessors name="next" next="LoopNode8"/>
  </nodes>
<!--@Location 10,18-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode8" loop="ConditionalProducts">
<!--@BendPoints 22,37-->
    <nodeSuccessors name="next" next="EndNode34"/>
    <entry key="ConditionalProduct">
<!--@BendPoints 21,38-->
      <nodeSuccessors name="loop_entry_next" next="CallNode21"/>
    </entry>
  </nodes>
<!--@Location 10,19-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode21">
<!--@BendPoints 21,40-->
    <nodeSuccessors name="next" next="AddObjectToVector4"/>
<!--@BendPoints 21,40 19,40-->
    <nodeSuccessors name="false" next="JoinNode22"/>
    <parameterBindings name="Product" objectPath="ConditionalProduct"/>
    <startNode referencedName="ProcessActivePromotionProducts-IsPromotionAvailableForProduct"/>
  </nodes>
<!--@Location 10,20-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector4">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 21,42 19,42-->
    <nodeSuccessors name="next" next="JoinNode22"/>
    <parameterBindings name="InVector" objectPath="FilteredConditionalProductsVector"/>
    <parameterBindings name="Object" objectPath="ConditionalProduct"/>
    <returnValueBindings name="Iterator" objectPath="FilteredConditionalProducts"/>
    <returnValueBindings name="OutVector" objectPath="FilteredConditionalProductsVector"/>
  </nodes>
<!--@Location 9,20-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode22">
<!--@BendPoints 19,37-->
    <nodeSuccessors name="next" next="LoopNode8_Entry"/>
  </nodes>
<!--@Location 11,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode34" strict="true">
<!--The filtered conditional products.-->
    <returnValues name="FilteredConditionalProducts" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 23,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode3" strict="true" name="GetActivePromoProducts"
      callMode="Private">
<!--@BendPoints 47,32-->
    <nodeSuccessors name="next" next="ExecuteObjectsQuery2"/>
<!--The uuid of the promotion to search the assigned products for.-->
    <parameters name="PromotionUUID" type="java.lang.String"/>
  </nodes>
<!--@Location 23,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecuteObjectsQuery2">
    <configurationValues name="Datasource" value="current ORM connection"/>
    <configurationValues name="ParameterName_01" value="PromotionUUID"/>
    <configurationValues name="QueryName" value="activepromoproducts/GetActivePromoProducts"/>
    <pipelet href="enfinity:/core/pipelets/ExecuteObjectsQuery.xml"/>
    <nodeSuccessors name="next" next="JoinNode11"/>
<!--@BendPoints 48,33 48,35-->
    <nodeSuccessors name="pipelet_error" next="JoinNode11"/>
    <parameterBindings name="Connection" nullBinding="true"/>
    <parameterBindings name="ParameterValue_01" objectPath="PromotionUUID"/>
    <parameterBindings name="Parameters" nullBinding="true"/>
    <parameterBindings name="Query" nullBinding="true"/>
    <returnValueBindings name="SearchResult" objectPath="ActivePromoProducts"/>
  </nodes>
<!--@Location 23,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
<!--@BendPoints 47,36-->
    <nodeSuccessors name="next" next="EndNode6"/>
  </nodes>
<!--@Location 23,18-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode6" name="" strict="true">
<!--Iterator with all products promotions that are assigned to the promotion.-->
    <returnValues name="ActivePromoProducts" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 10,2-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode22" strict="true" name="GetPromotionQualifiedProductsForPromotion"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode22"/>
<!--A promotion.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
<!--A domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 10,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode22">
    <nodeSuccessors name="next" next="CallNode20"/>
    <startNode referencedName="ProcessActivePromotionProducts-GetQualifyingConditionalProducts"/>
    <returnValueBindings name="QualifyingConditionalProducts" objectPath="ConditionProductInclusions"/>
  </nodes>
<!--@Location 10,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode20">
<!--@BendPoints 21,10-->
    <nodeSuccessors name="next" next="EndNode32"/>
<!--@BendPoints 23,10-->
    <nodeSuccessors name="error" next="EndNode33"/>
    <startNode referencedName="ProcessActivePromotionProducts-GetQualifyingActionProducts"/>
    <returnValueBindings name="QualifyingActionProducts" objectPath="ActionProductInclusions"/>
  </nodes>
<!--@Location 10,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode32" strict="true">
<!--The conditional products.-->
    <returnValues name="ConditionProductInclusions" type="java.util.Iterator" optional="true"/>
<!--An iterator of the action products.-->
    <returnValues name="ActionProductInclusions" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 11,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode33" name="error" strict="true"/>
<!--@Location 19,2-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode26" strict="true" name="GetQualifyingActionProducts"
      callMode="Private">
    <nodeSuccessors name="next" next="CreateIteratorFromConfigValues5"/>
<!--A promotion.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
<!--A domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 19,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateIteratorFromConfigValues5">
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateIteratorFromConfigValues.xml"/>
<!--@BendPoints 39,8-->
    <nodeSuccessors name="next" next="LoopNode1"/>
    <returnValueBindings name="ValuesIterator" objectPath="QualifyingActionProducts"/>
  </nodes>
<!--@Location 19,4-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode1" loop="Promotion:RebatesIterator">
<!--@BendPoints 40,9-->
    <nodeSuccessors name="next" next="EndNode1"/>
    <entry key="Rebate">
      <nodeSuccessors name="loop_entry_next" next="GetRebateProducts2"/>
    </entry>
  </nodes>
<!--@Location 19,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetRebateProducts2">
    <configurationValues name="FilterGroupType" value="Action"/>
    <pipelet href="enfinity:/bc_marketing/pipelets/GetRebateProducts.xml"/>
<!--@BendPoints 39,12 38,12 38,13-->
    <nodeSuccessors name="next" next="DecisionNode2"/>
<!--@BendPoints 40,11-->
    <nodeSuccessors name="pipelet_error" next="EndNode2"/>
    <parameterBindings name="Rebate" objectPath="Rebate"/>
    <returnValueBindings name="Products" objectPath="ActionProducts"/>
  </nodes>
<!--@Location 19,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="ActionProducts"
      operator="has_elements">
<!--@BendPoints 41,13 41,14-->
    <nodeSuccessors name="decision_yes" next="SetDictionaryValue2"/>
<!--@BendPoints 39,15-->
    <nodeSuccessors name="decision_no" next="JoinNode5"/>
  </nodes>
<!--@Location 20,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue2">
    <configurationValues name="Name" value="ProductGroupType"/>
    <configurationValues name="Value" value="SelectedProducts"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
    <nodeSuccessors name="next" next="CallNode2"/>
  </nodes>
<!--@Location 20,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode2">
    <nodeSuccessors name="next" next="CombineIterators2"/>
    <parameterBindings name="PromotionProducts" objectPath="ActionProducts"/>
    <startNode referencedName="ProcessActivePromotionProducts-FilterByActionMinPrice"/>
  </nodes>
<!--@Location 20,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators2">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
<!--@BendPoints 41,20-->
    <nodeSuccessors name="next" next="RemoveDictionaryValue5"/>
    <parameterBindings name="Iterator1" objectPath="QualifyingActionProducts"/>
    <parameterBindings name="Iterator2" objectPath="ActionsMinPriceFilteredProducts"/>
    <returnValueBindings name="Iterator" objectPath="QualifyingActionProducts"/>
  </nodes>
<!--@Location 20,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue5">
    <configurationValues name="Key" value="ActionProducts"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 41,22 37,22-->
    <nodeSuccessors name="next" next="JoinNode5"/>
  </nodes>
<!--@Location 18,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
<!--@BendPoints 37,9-->
    <nodeSuccessors name="next" next="LoopNode1_Entry"/>
  </nodes>
<!--@Location 20,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" name="error" strict="true"/>
<!--@Location 20,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" strict="true">
<!--An iterator containing the qualifying action products.-->
    <returnValues name="QualifyingActionProducts" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 14,2-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode25" strict="true" name="GetQualifyingConditionalProducts"
      callMode="Private">
    <nodeSuccessors name="next" next="CreateIteratorFromConfigValues1"/>
<!--A promotion.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
<!--The domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 14,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateIteratorFromConfigValues1">
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateIteratorFromConfigValues.xml"/>
    <nodeSuccessors name="next" next="LoopNode9"/>
    <parameterBindings name="ValuesString" nullBinding="true"/>
    <returnValueBindings name="ValuesIterator" objectPath="QualifyingConditionalProducts"/>
  </nodes>
<!--@Location 14,4-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode9" loop="Promotion:RebatesIterator">
<!--@BendPoints 30,9-->
    <nodeSuccessors name="next" next="EndNode39"/>
    <entry key="Rebate">
      <nodeSuccessors name="loop_entry_next" next="GetRebateProducts1"/>
    </entry>
  </nodes>
<!--@Location 14,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetRebateProducts1">
    <configurationValues name="FilterGroupType" value="Condition"/>
    <pipelet href="enfinity:/bc_marketing/pipelets/GetRebateProducts.xml"/>
<!--@BendPoints 29,12 28,12 28,13-->
    <nodeSuccessors name="next" next="DecisionNode1"/>
<!--@BendPoints 30,11-->
    <nodeSuccessors name="pipelet_error" next="EndNode37"/>
    <parameterBindings name="Rebate" objectPath="Rebate"/>
    <returnValueBindings name="Products" objectPath="ConditionalProducts"/>
  </nodes>
<!--@Location 14,6-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="ConditionalProducts"
      operator="has_elements">
<!--@BendPoints 31,13 31,14-->
    <nodeSuccessors name="decision_yes" next="CallNode26"/>
<!--@BendPoints 29,15-->
    <nodeSuccessors name="decision_no" next="JoinNode1"/>
  </nodes>
<!--@Location 15,7-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode26">
<!--@BendPoints 31,16 30,16 30,17-->
    <nodeSuccessors name="next" next="DecisionNode24"/>
    <startNode referencedName="ProcessActivePromotionProducts-FilterConditionalProducts"/>
  </nodes>
<!--@Location 15,8-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode24" conditionKey="FilteredConditionalProducts"
      operator="has_elements">
<!--@BendPoints 33,17 33,18-->
    <nodeSuccessors name="decision_yes" next="SetDictionaryValue1"/>
    <nodeSuccessors name="decision_no" next="JoinNode2"/>
  </nodes>
<!--@Location 16,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetDictionaryValue1">
    <configurationValues name="Name" value="ProductGroupType"/>
    <configurationValues name="Value" value="ConditionalProducts"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SetDictionaryValue.xml"/>
<!--@BendPoints 33,20-->
    <nodeSuccessors name="next" next="CallNode1"/>
  </nodes>
<!--@Location 16,10-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
    <nodeSuccessors name="next" next="CombineIterators1"/>
    <parameterBindings name="PromotionProducts" objectPath="FilteredConditionalProducts"/>
    <startNode referencedName="ProcessActivePromotionProducts-FilterByActionMinPrice"/>
  </nodes>
<!--@Location 16,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators1">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="RemoveDictionaryValue4"/>
    <parameterBindings name="Iterator1" objectPath="QualifyingConditionalProducts"/>
    <parameterBindings name="Iterator2" objectPath="ActionsMinPriceFilteredProducts"/>
    <returnValueBindings name="Iterator" objectPath="QualifyingConditionalProducts"/>
  </nodes>
<!--@Location 16,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue4">
    <configurationValues name="Key" value="FilteredConditionalProducts"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 33,26 31,26-->
    <nodeSuccessors name="next" next="JoinNode2"/>
  </nodes>
<!--@Location 15,9-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
<!--@BendPoints 29,19-->
    <nodeSuccessors name="next" next="RemoveDictionaryValue3"/>
  </nodes>
<!--@Location 14,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveDictionaryValue3">
    <configurationValues name="Key" value="ConditionalProducts"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/RemoveDictionaryValue.xml"/>
<!--@BendPoints 29,22 27,22-->
    <nodeSuccessors name="next" next="JoinNode1"/>
  </nodes>
<!--@Location 13,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
<!--@BendPoints 27,9-->
    <nodeSuccessors name="next" next="LoopNode9_Entry"/>
  </nodes>
<!--@Location 15,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode37" name="error" strict="true"/>
<!--@Location 15,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode39" strict="true">
<!--An iterator containing the qualifying conditional products.-->
    <returnValues name="QualifyingConditionalProducts" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 14,15-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode23" strict="true" name="IsPromotionAvailableForProduct"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode15"/>
<!--A promotion.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
<!--A product.-->
    <parameters name="Product" type="com.intershop.beehive.xcs.capi.product.Product"/>
<!--An user.-->
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
  </nodes>
<!--@Location 14,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode15" conditionKey="Promotion:Currency">
<!--@BendPoints 29,34-->
    <nodeSuccessors name="decision_yes" next="GetPromotionProductMapping3"/>
    <nodeSuccessors name="decision_no" next="DecisionNode0"/>
  </nodes>
<!--@Location 14,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPromotionProductMapping3">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetPromotionProductMapping.xml"/>
<!--@BendPoints 29,36-->
    <nodeSuccessors name="next" next="GetCurrentDate2"/>
    <parameterBindings name="CurrencyCode" objectPath="Promotion:Currency:Mnemonic"/>
  </nodes>
<!--@Location 14,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate2">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
<!--@BendPoints 29,38-->
    <nodeSuccessors name="next" next="EvaluatePromotionForProduct1"/>
  </nodes>
<!--@Location 14,19-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="EvaluatePromotionForProduct1">
    <pipelet href="enfinity:/bc_marketing/pipelets/EvaluatePromotionForProduct.xml"/>
<!--@BendPoints 29,40-->
    <nodeSuccessors name="next" next="EndNode35"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode21"/>
    <parameterBindings name="ApplicationUUID" constant=""/>
    <parameterBindings name="Date" objectPath="CurrentDate"/>
  </nodes>
<!--@Location 14,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode35" name="true" strict="true"/>
<!--@Location 15,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode21">
<!--@BendPoints 31,40-->
    <nodeSuccessors name="next" next="EndNode36"/>
  </nodes>
<!--@Location 15,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode36" name="false" strict="true"/>
<!--@Location 15,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode0" conditionKey="CurrentRequest:Currency">
    <nodeSuccessors name="decision_yes" next="GetPromotionProductMapping0"/>
    <nodeSuccessors name="decision_no" next="JoinNode21"/>
  </nodes>
<!--@Location 15,17-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPromotionProductMapping0">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetPromotionProductMapping.xml"/>
<!--@BendPoints 30,35 30,37-->
    <nodeSuccessors name="next" next="GetCurrentDate2"/>
    <parameterBindings name="CurrencyCode" objectPath="CurrentRequest:Currency:Mnemonic"/>
  </nodes>
<!--@Location 7,2-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode2" strict="true" name="Set"
      callMode="Private">
<!--@BendPoints 15,6-->
    <nodeSuccessors name="next" next="CallNode3"/>
<!--A domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
<!--A promotion.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 7,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode3">
    <nodeSuccessors name="next" next="CreateIteratorFromConfigValues3"/>
    <startNode referencedName="ProcessActivePromotionProducts-GetPromotionQualifiedProductsForPromotion"/>
  </nodes>
<!--@Location 7,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateIteratorFromConfigValues3">
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateIteratorFromConfigValues.xml"/>
    <nodeSuccessors name="next" next="DecisionNode6"/>
    <returnValueBindings name="ValuesIterator" objectPath="ProductInclusions"/>
  </nodes>
<!--@Location 7,5-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode6" conditionKey="ActionProductInclusions">
    <nodeSuccessors name="decision_yes" next="CombineIterators6"/>
<!--@BendPoints 16,11 16,15-->
    <nodeSuccessors name="decision_no" next="JoinNode6"/>
  </nodes>
<!--@Location 7,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators6">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="JoinNode6"/>
    <parameterBindings name="Iterator1" objectPath="ProductInclusions"/>
    <parameterBindings name="Iterator2" objectPath="ActionProductInclusions"/>
    <returnValueBindings name="Iterator" objectPath="ProductInclusions"/>
  </nodes>
<!--@Location 7,7-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
<!--@BendPoints 15,16-->
    <nodeSuccessors name="next" next="DecisionNode7"/>
  </nodes>
<!--@Location 7,8-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode7" conditionKey="ConditionProductInclusions">
    <nodeSuccessors name="decision_yes" next="CombineIterators5"/>
<!--@BendPoints 16,17 16,21-->
    <nodeSuccessors name="decision_no" next="JoinNode8"/>
  </nodes>
<!--@Location 7,9-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators5">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="JoinNode8"/>
    <parameterBindings name="Iterator1" objectPath="ProductInclusions"/>
    <parameterBindings name="Iterator2" objectPath="ConditionProductInclusions"/>
    <returnValueBindings name="Iterator" objectPath="ProductInclusions"/>
  </nodes>
<!--@Location 7,10-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
<!--@BendPoints 15,22-->
    <nodeSuccessors name="next" next="SetActivePromoProducts1"/>
  </nodes>
<!--@Location 7,11-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SetActivePromoProducts1">
    <configurationValues name="TouchProducts" value="true"/>
    <pipelet href="enfinity:/bc_marketing/pipelets/SetActivePromoProducts.xml"/>
<!--@BendPoints 15,24-->
    <nodeSuccessors name="next" next="EndNode4"/>
<!--@BendPoints 17,23 17,24-->
    <nodeSuccessors name="pipelet_error" next="EndNode5"/>
    <parameterBindings name="Products" objectPath="ProductInclusions"/>
  </nodes>
<!--@Location 7,12-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode4" strict="true">
<!--The products that are included by conditions.-->
    <returnValues name="ConditionProductInclusions" type="java.util.Iterator" optional="true"/>
<!--The products that are included by actions.-->
    <returnValues name="ActionProductInclusions" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 8,12-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode5" name="error" strict="true"/>
<!--@Location 3,2-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode19" strict="true" name="Start"
      callMode="Private">
    <nodeSuccessors name="next" next="VerifyBoolean3"/>
<!--The name of a domain.-->
    <parameters name="DomainName" type="java.lang.String"/>
  </nodes>
<!--@Location 3,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="VerifyBoolean3">
    <pipelet href="enfinity:/bc_foundation/pipelets/VerifyBoolean.xml"/>
    <nodeSuccessors name="next" next="GetDomainByName1"/>
<!--@BendPoints 11,7-->
    <nodeSuccessors name="pipelet_error" next="JoinNode13"/>
    <parameterBindings name="NoneLocalizedString" constant="true"/>
    <returnValueBindings name="BooleanValue" objectPath="True"/>
  </nodes>
<!--@Location 3,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetDomainByName1">
    <pipelet href="enfinity:/core/pipelets/GetDomainByName.xml"/>
    <nodeSuccessors name="next" next="ExecuteUpdateQuery0"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode13"/>
  </nodes>
<!--@Location 3,5-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecuteUpdateQuery0">
    <configurationValues name="Datasource" value="current ORM connection"/>
    <configurationValues name="QueryName" value="activepromoproducts/DeleteInconsistentEntriesInActivePromoProducts"/>
    <pipelet href="enfinity:/core/pipelets/ExecuteUpdateQuery.xml"/>
    <nodeSuccessors name="next" next="RefreshCache0"/>
    <parameterBindings name="Connection" nullBinding="true"/>
    <parameterBindings name="Parameters" nullBinding="true"/>
    <parameterBindings name="Query" nullBinding="true"/>
  </nodes>
<!--@Location 3,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RefreshCache0">
    <configurationValues name="PersistentClassName_0" value="com.intershop.component.marketing.internal.rebate.ActivePromoProductsPO"/>
    <pipelet href="enfinity:/core/pipelets/RefreshCache.xml"/>
    <nodeSuccessors name="next" next="CreateIteratorFromConfigValues10"/>
  </nodes>
<!--@Location 3,7-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreateIteratorFromConfigValues10">
    <pipelet href="enfinity:/bc_foundation/pipelets/CreateIteratorFromConfigValues.xml"/>
    <nodeSuccessors name="next" next="CallNode18"/>
    <returnValueBindings name="ValuesIterator" objectPath="AvailableProductAssociatedPromotions"/>
  </nodes>
<!--@Location 3,8-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode18">
    <nodeSuccessors name="next" next="DecisionNode28"/>
    <parameterBindings name="Availableflag" objectPath="True"/>
    <startNode referencedName="ProcessPromotion-GetAvailableProductAssociatedPromotions"/>
    <returnValueBindings name="AvailableProductAssociatedPromotions" objectPath="AvailableProductPromotions"/>
  </nodes>
<!--@Location 3,9-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode28" conditionKey="AvailableProductPromotions">
    <nodeSuccessors name="decision_yes" next="CombineIterators15"/>
<!--@BendPoints 8,19 8,23-->
    <nodeSuccessors name="decision_no" next="JoinNode56"/>
  </nodes>
<!--@Location 3,10-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators15">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="JoinNode56"/>
    <parameterBindings name="Iterator1" objectPath="AvailableProductAssociatedPromotions"/>
    <parameterBindings name="Iterator2" objectPath="AvailableProductPromotions"/>
    <returnValueBindings name="Iterator" objectPath="AvailableProductAssociatedPromotions"/>
  </nodes>
<!--@Location 3,11-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode56">
<!--@BendPoints 7,24-->
    <nodeSuccessors name="next" next="CallNode27"/>
  </nodes>
<!--@Location 3,12-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode27">
    <nodeSuccessors name="next" next="DecisionNode29"/>
    <parameterBindings name="Availableflag" objectPath="True"/>
    <startNode referencedName="ProcessPromotion-GetAvailableCategoryAssociatedPromotions"/>
    <returnValueBindings name="AvailableCategoryAssociatedPromotions" objectPath="AvailableCategoryPromotions"/>
  </nodes>
<!--@Location 3,13-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode29" conditionKey="AvailableCategoryPromotions">
    <nodeSuccessors name="decision_yes" next="CombineIterators16"/>
<!--@BendPoints 8,27 8,31-->
    <nodeSuccessors name="decision_no" next="JoinNode57"/>
  </nodes>
<!--@Location 3,14-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators16">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="JoinNode57"/>
    <parameterBindings name="Iterator1" objectPath="AvailableProductAssociatedPromotions"/>
    <parameterBindings name="Iterator2" objectPath="AvailableCategoryPromotions"/>
    <returnValueBindings name="Iterator" objectPath="AvailableProductAssociatedPromotions"/>
  </nodes>
<!--@Location 3,15-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode57">
    <nodeSuccessors name="next" next="ExecuteObjectsQuery1"/>
  </nodes>
<!--@Location 3,16-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecuteObjectsQuery1">
    <configurationValues name="Datasource" value="current ORM connection"/>
    <configurationValues name="ParameterName_01" value="PromotionDomain"/>
    <configurationValues name="QueryName" value="activepromoproducts/GetActivePromoProductPromotions"/>
    <pipelet href="enfinity:/core/pipelets/ExecuteObjectsQuery.xml"/>
    <nodeSuccessors name="next" next="DecisionNode5"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode7"/>
    <parameterBindings name="Connection" nullBinding="true"/>
    <parameterBindings name="ParameterValue_01" objectPath="Domain"/>
    <parameterBindings name="Parameters" nullBinding="true"/>
    <parameterBindings name="Query" nullBinding="true"/>
    <returnValueBindings name="SearchResult" objectPath="ExistingProductAssociatedPromotions"/>
  </nodes>
<!--@Location 3,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode5" conditionKey="ExistingProductAssociatedPromotions">
    <nodeSuccessors name="decision_yes" next="CombineIterators4"/>
<!--@BendPoints 8,35 8,39-->
    <nodeSuccessors name="decision_no" next="JoinNode10"/>
  </nodes>
<!--@Location 3,18-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CombineIterators4">
    <configurationValues name="ProcessMethod" value="Concatenate Iterators and Remove Duplicates"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/CombineIterators.xml"/>
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="Iterator1" objectPath="AvailableProductAssociatedPromotions"/>
    <parameterBindings name="Iterator2" objectPath="ExistingProductAssociatedPromotions"/>
    <returnValueBindings name="Iterator" objectPath="AvailableProductAssociatedPromotions"/>
  </nodes>
<!--@Location 3,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="LoopNode7"/>
  </nodes>
<!--@Location 3,20-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode7" loop="AvailableProductAssociatedPromotions">
<!--@BendPoints 9,41-->
    <nodeSuccessors name="next" next="EndNode26"/>
    <entry key="ProductAssociatedPromotion">
<!--@BendPoints 7,42-->
      <nodeSuccessors name="loop_entry_next" next="CallNode4"/>
    </entry>
  </nodes>
<!--@Location 3,21-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
<!--@BendPoints 5,43 5,41-->
    <nodeSuccessors name="next" next="LoopNode7_Entry"/>
    <nodeSuccessors name="error" next="JoinNode9"/>
    <parameterBindings name="Promotion" objectPath="ProductAssociatedPromotion"/>
    <startNode referencedName="ProcessActivePromotionProducts-Set"/>
  </nodes>
<!--@Location 5,21-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
    <nodeSuccessors name="next" next="EndNode27"/>
  </nodes>
<!--@Location 5,22-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode27" name="error" strict="true"/>
<!--@Location 4,22-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode26" strict="true">
<!--The products that are included by conditions.-->
    <returnValues name="ConditionProductInclusions" type="java.util.Iterator" optional="true"/>
<!--The products that are included by actions.-->
    <returnValues name="ActionProductInclusions" type="java.util.Iterator" optional="true"/>
<!--An iterator of all available promotions that have products associated.-->
    <returnValues name="AvailableProductAssociatedPromotions" type="java.util.Iterator"
        optional="true"/>
  </nodes>
<!--@Location 5,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
    <nodeSuccessors name="next" next="JoinNode9"/>
  </nodes>
<!--@Location 5,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
    <nodeSuccessors name="next" next="JoinNode7"/>
  </nodes>
</pipeline:Pipeline>
