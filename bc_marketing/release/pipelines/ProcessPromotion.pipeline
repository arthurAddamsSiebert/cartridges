<?xml version="1.0" encoding="UTF-8"?>
<pipeline:Pipeline xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:pipeline="http://www.intershop.de/pipeline/2010"
    name="ProcessPromotion" type="process">
<!--@Location 3,33-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode15" strict="true" visibility="Private"
      name="AssignUserToPromotionTargetGroups" callMode="Private">
    <nodeSuccessors name="next" next="CallNode0"/>
    <parameters name="CustomerID" type="java.lang.String"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
  </nodes>
<!--@Location 3,34-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode0">
    <nodeSuccessors name="next" next="DetermineUser0"/>
    <startNode referencedName="ProcessPromotion-GetPromotionTargetGroupsOfCustomer"/>
  </nodes>
<!--@Location 3,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DetermineUser0">
    <pipelet href="enfinity:/core/pipelets/DetermineUser.xml"/>
    <nodeSuccessors name="next" next="LoopNode5"/>
    <parameterBindings name="UserID" objectPath="UserBO:ID"/>
  </nodes>
<!--@Location 3,36-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode5" loop="PromotionsOfCustomer">
    <nodeSuccessors name="next" next="EndNode14"/>
    <entry key="SinglePromotion">
      <nodeSuccessors name="loop_entry_next" next="AddUserToPromotionTargetGroup0"/>
    </entry>
  </nodes>
<!--@Location 3,37-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddUserToPromotionTargetGroup0">
    <pipelet href="enfinity:/bc_marketing/pipelets/AddUserToPromotionTargetGroup.xml"/>
<!--@BendPoints 5,73-->
    <nodeSuccessors name="next" next="LoopNode5_Entry"/>
    <parameterBindings name="Promotion" objectPath="SinglePromotion"/>
    <parameterBindings name="User" objectPath="User"/>
  </nodes>
<!--@Location 4,36-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode14" strict="true"/>
<!--@Location 8,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode17" strict="true" name="CopyPromotion"
      callMode="Private">
<!--@BendPoints 17,4-->
    <nodeSuccessors name="next" next="CreatePromotion1"/>
<!--essential promotion information-->
    <parameters name="PromotionForm" type="com.intershop.beehive.core.capi.webform.Form"/>
<!--a promotion-->
    <parameters name="SourcePromotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 8,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CreatePromotion1">
    <pipelet href="enfinity:/bc_marketing/pipelets/CreatePromotion.xml"/>
<!--@BendPoints 17,6-->
    <nodeSuccessors name="next" next="CopyPromotion1"/>
<!--@BendPoints 19,5-->
    <nodeSuccessors name="pipelet_error" next="JoinNode14"/>
    <parameterBindings name="CurrencyCode" objectPath="SourcePromotion:CurrencyCode"/>
    <parameterBindings name="Domain" objectPath="SourcePromotion:Domain"/>
    <parameterBindings name="PromotionID" objectPath="PromotionForm:PID:Value"/>
    <parameterBindings name="PromotionUUID" nullBinding="true"/>
    <returnValueBindings name="ERROR_Promotion" objectPath="ERRORCopyPromotion"/>
    <returnValueBindings name="Promotion" objectPath="TargetPromotion"/>
  </nodes>
<!--@Location 8,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="CopyPromotion1">
    <pipelet href="enfinity:/bc_marketing/pipelets/CopyPromotion.xml"/>
    <nodeSuccessors name="next" next="EndNode22"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode14"/>
  </nodes>
<!--@Location 8,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode22" name="ok" strict="true">
<!--copy of a promotion-->
    <returnValues name="TargetPromotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 9,3-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode14">
    <nodeSuccessors name="next" next="EndNode23"/>
  </nodes>
<!--@Location 9,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode23" name="error" strict="true">
<!--error key in error case-->
    <returnValues name="ERRORCopyPromotion" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 3,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode3" strict="true" name="CreateAssignment"
      callMode="Private">
<!--@BendPoints 7,24-->
    <nodeSuccessors name="next" next="CallNode3"/>
    <parameters name="To" type="java.lang.Object"/>
    <parameters name="Repository" type="com.intershop.component.mvc.capi.catalog.Repository"/>
    <parameters name="Pagelet" type="com.intershop.component.pmc.capi.pagelet.Pagelet"/>
  </nodes>
<!--@Location 3,12-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode3">
<!--@BendPoints 7,26-->
    <nodeSuccessors name="next" next="EndNode3"/>
    <parameterBindings name="Domain" objectPath="Repository:RepositoryDomain"/>
    <parameterBindings name="From" objectPath="Pagelet"/>
    <parameterBindings name="Site" nullBinding="true"/>
    <startNode referencedName="ProcessAssignments-CreateAssignment"/>
  </nodes>
<!--@Location 3,13-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode3" strict="true">
    <returnValues name="Assignment" type="com.intershop.component.foundation.capi.assignment.Assignment"
        optional="true"/>
  </nodes>
<!--@Location 5,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode4" strict="true" name="DeleteAssignment"
      callMode="Private">
    <nodeSuccessors name="next" next="KeyMapper2"/>
    <parameters name="Repository" type="com.intershop.component.mvc.capi.catalog.Repository"/>
    <parameters name="Assignment" type="com.intershop.component.foundation.capi.assignment.Assignment"/>
    <parameters name="DeletePagelet" type="java.lang.String" optional="true"/>
    <parameters name="AssignmentStrategy" type="com.intershop.component.foundation.capi.assignment.AssignmentStrategy"
        optional="true"/>
  </nodes>
<!--@Location 5,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper2">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="DecisionNode1"/>
    <parameterBindings name="InValue_1" objectPath="Assignment:From"/>
    <returnValueBindings name="OutValue_1" objectPath="Pagelet"/>
  </nodes>
<!--@Location 5,13-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode1" conditionKey="DeletePagelet"
      operator="str_eq" conditionValue="true">
    <nodeSuccessors name="decision_yes" next="DecisionNode2"/>
    <nodeSuccessors name="decision_no" next="DecisionNode12"/>
  </nodes>
<!--@Location 5,16-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode2" conditionKey="Pagelet">
    <nodeSuccessors name="decision_yes" next="DecisionNode9"/>
    <nodeSuccessors name="decision_no" next="JoinNode3"/>
  </nodes>
<!--@Location 5,17-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode9" conditionKey="Pagelet:Domain:UUID"
      operator="str_eq" conditionItem="Repository:RepositoryDomainID">
    <nodeSuccessors name="decision_yes" next="CallNode6"/>
    <nodeSuccessors name="decision_no" next="JoinNode8"/>
  </nodes>
<!--@Location 5,18-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode6">
    <nodeSuccessors name="next" next="JoinNode1"/>
    <parameterBindings name="Pagelet" objectPath="Pagelet"/>
    <startNode referencedName="ProcessPagelet-Delete"/>
  </nodes>
<!--@Location 5,19-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode1">
<!--@BendPoints 11,40-->
    <nodeSuccessors name="next" next="EndNode4"/>
  </nodes>
<!--@Location 5,20-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode4" strict="true"/>
<!--@Location 7,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode8">
<!--@BendPoints 15,39-->
    <nodeSuccessors name="next" next="JoinNode1"/>
  </nodes>
<!--@Location 7,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode3">
    <nodeSuccessors name="next" next="JoinNode8"/>
  </nodes>
<!--@Location 6,13-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode12" conditionKey="Pagelet:Domain:UUID"
      operator="str_eq" conditionItem="Repository:RepositoryDomainID">
    <nodeSuccessors name="decision_yes" next="UpdateNativeAttribute2"/>
<!--@BendPoints 13,29-->
    <nodeSuccessors name="decision_no" next="JoinNode10"/>
  </nodes>
<!--@displayNearNode@Pagelet:SetOnline
@Location 7,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateNativeAttribute2">
    <configurationValues name="SetterMethodName" value="setOnline"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateNativeAttribute.xml"/>
    <nodeSuccessors name="next" next="JoinNode10"/>
    <parameterBindings name="UpdateObject" objectPath="Assignment:From"/>
    <parameterBindings name="Value" constant="(Boolean)false"/>
  </nodes>
<!--@Location 7,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode10">
    <nodeSuccessors name="next" next="CallNode2"/>
  </nodes>
<!--@Location 7,15-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode2">
    <nodeSuccessors name="next" next="JoinNode3"/>
    <parameterBindings name="Domain" objectPath="Repository:RepositoryDomain"/>
    <parameterBindings name="Site" objectPath="Repository:RepositoryDomain:Site"/>
    <startNode referencedName="ProcessAssignments-DeleteAssignment"/>
  </nodes>
<!--@Location 9,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode5" strict="true" name="DeleteAssignments"
      callMode="Private">
    <nodeSuccessors name="next" next="GetAssignmentStrategy2"/>
    <parameters name="Repository" type="com.intershop.component.mvc.capi.catalog.Repository"/>
    <parameters name="SelectedAssignmentsUUIDs" type="java.util.Iterator"/>
    <parameters name="DeletePagelet" type="java.lang.String" optional="true"/>
    <parameters name="To" type="java.lang.Object"/>
  </nodes>
<!--@Location 9,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAssignmentStrategy2">
    <configurationValues name="FromClass" value="com.intershop.component.pmc.capi.pagelet.Pagelet"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignmentStrategy.xml"/>
    <nodeSuccessors name="next" next="KeyMapper4"/>
    <parameterBindings name="From" nullBinding="true"/>
    <parameterBindings name="Site" objectPath="Repository:RepositoryDomain:Site"/>
  </nodes>
<!--@Location 9,13-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper4">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 19,28-->
    <nodeSuccessors name="next" next="LoopNode3" action="begin"/>
    <parameterBindings name="InValue_1" objectPath="AssignmentStrategy:AssignmentLookupStrategyByTo(To)"/>
    <returnValueBindings name="OutValue_1" objectPath="AssignmentLookup"/>
  </nodes>
<!--@Location 9,14-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode3" loop="SelectedAssignmentsUUIDs">
<!--@BendPoints 22,29-->
    <nodeSuccessors name="next" next="EndNode5" action="commit"/>
    <entry key="AssignmentUUID">
<!--@BendPoints 19,30-->
      <nodeSuccessors name="loop_entry_next" next="GetAssignmentByUUID1"/>
    </entry>
  </nodes>
<!--@Location 9,15-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAssignmentByUUID1">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignmentByUUID.xml"/>
<!--@BendPoints 19,32-->
    <nodeSuccessors name="next" next="CallNode5"/>
<!--@BendPoints 20,31 20,35-->
    <nodeSuccessors name="pipelet_error" next="JoinNode2"/>
    <parameterBindings name="UUID" objectPath="AssignmentUUID"/>
  </nodes>
<!--@Location 9,16-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode5">
    <nodeSuccessors name="next" next="JoinNode2"/>
    <startNode referencedName="ProcessPromotion-DeleteAssignment"/>
  </nodes>
<!--@Location 9,17-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode2">
<!--@BendPoints 18,35 18,29-->
    <nodeSuccessors name="next" next="LoopNode3_Entry"/>
  </nodes>
<!--@Location 11,14-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode5" strict="true"/>
<!--@Location 18,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode1" strict="true" name="GetApplicationContext"
      callMode="Private">
<!--@BendPoints 37,4-->
    <nodeSuccessors name="next" next="GetDomainByUUID2"/>
    <parameters name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
  </nodes>
<!--@Location 18,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetDomainByUUID2">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetDomainByUUID.xml"/>
<!--@BendPoints 37,6-->
    <nodeSuccessors name="next" next="GetActionApplicationContext2"/>
<!--@BendPoints 38,5 38,9-->
    <nodeSuccessors name="pipelet_error" next="JoinNode5"/>
    <parameterBindings name="DomainUUID" objectPath="PromotionDomain:SiteID"/>
    <returnValueBindings name="Domain" objectPath="SiteDomain"/>
  </nodes>
<!--@Location 18,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetActionApplicationContext2">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetActionApplicationContext.xml"/>
    <nodeSuccessors name="next" next="JoinNode5"/>
    <parameterBindings name="ActionDescriptorRegistryName" constant="promotionActionDescriptorRegistry"/>
    <parameterBindings name="ActionRepositoryName" constant="promotionActionRepository"/>
    <parameterBindings name="SiteName" objectPath="SiteDomain:DomainName"/>
  </nodes>
<!--@Location 18,4-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode5">
<!--@BendPoints 37,10-->
    <nodeSuccessors name="next" next="EndNode1"/>
  </nodes>
<!--@Location 18,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode1" strict="true">
<!--an action descriptor registry-->
    <returnValues name="ActionDescriptorRegistry" type="com.intershop.component.foundation.capi.action.ActionDescriptorRegistry"
        optional="true"/>
<!--an action repository-->
    <returnValues name="ActionRepository" type="com.intershop.component.foundation.capi.action.ActionRepository"
        optional="true"/>
  </nodes>
<!--@Location 1,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode10" strict="true" name="GetAssignments"
      callMode="Private">
    <nodeSuccessors name="next" next="GetAssignmentStrategy1"/>
    <parameters name="To" type="java.lang.Object"/>
    <parameters name="Repository" type="com.intershop.component.mvc.capi.catalog.Repository"/>
  </nodes>
<!--@Location 1,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetAssignmentStrategy1">
    <configurationValues name="FromClass" value="com.intershop.component.pmc.capi.pagelet.Pagelet"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetAssignmentStrategy.xml"/>
    <nodeSuccessors name="next" next="CallNode11"/>
    <parameterBindings name="From" nullBinding="true"/>
    <parameterBindings name="Site" objectPath="Repository:RepositoryDomain:Site"/>
  </nodes>
<!--@Location 1,13-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode11">
<!--@BendPoints 3,28-->
    <nodeSuccessors name="next" next="EndNode2"/>
    <parameterBindings name="Domain" objectPath="Repository:RepositoryDomain"/>
    <parameterBindings name="Site" objectPath="Repository:RepositoryDomain:Site"/>
    <startNode referencedName="ProcessAssignments-GetAssignments"/>
  </nodes>
<!--@Location 1,14-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode2" strict="true">
    <returnValues name="Assignments" type="java.util.Collection" optional="true"/>
  </nodes>
<!--@Location 7,20-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode29" strict="true" name="GetAvailableCategoryAssociatedPromotions"
      callMode="Private">
    <nodeSuccessors name="next" next="GetCurrentDate3"/>
<!--A domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
<!--The promotion availableflag.-->
    <parameters name="Availableflag" type="java.lang.Boolean" optional="true"/>
  </nodes>
<!--@Location 7,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate3">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
    <nodeSuccessors name="next" next="VerifyBoolean14"/>
  </nodes>
<!--@Location 7,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="VerifyBoolean14">
    <pipelet href="enfinity:/bc_foundation/pipelets/VerifyBoolean.xml"/>
    <nodeSuccessors name="next" next="UpdateDictionary13"/>
<!--@BendPoints 17,45-->
    <nodeSuccessors name="pipelet_error" next="JoinNode55"/>
    <parameterBindings name="NoneLocalizedString" constant="false"/>
    <returnValueBindings name="BooleanValue" objectPath="False"/>
  </nodes>
<!--@Location 7,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateDictionary13">
    <configurationValues name="Name_01" value="Domain"/>
    <configurationValues name="Name_02" value="CurrentDate"/>
    <configurationValues name="Name_03" value="Available"/>
    <configurationValues name="Name_04" value="StartDate"/>
    <pipelet href="enfinity:/core/pipelets/UpdateDictionary.xml"/>
    <nodeSuccessors name="next" next="ExecuteObjectsQuery7"/>
    <parameterBindings name="InDictionary" nullBinding="true"/>
    <parameterBindings name="Value_01" objectPath="Domain"/>
    <parameterBindings name="Value_02" objectPath="CurrentDate"/>
    <parameterBindings name="Value_03" objectPath="Availableflag"/>
    <parameterBindings name="Value_04" objectPath="False"/>
    <returnValueBindings name="OutDictionary" objectPath="QueryParameters"/>
  </nodes>
<!--@Location 7,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecuteObjectsQuery7">
    <configurationValues name="Datasource" value="current ORM connection"/>
    <configurationValues name="QueryName" value="marketing/GetCategoryAssociatedPromotions"/>
    <pipelet href="enfinity:/core/pipelets/ExecuteObjectsQuery.xml"/>
<!--@BendPoints 15,50-->
    <nodeSuccessors name="next" next="EndNode46"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode55"/>
    <parameterBindings name="Connection" nullBinding="true"/>
    <parameterBindings name="Parameters" objectPath="QueryParameters"/>
    <parameterBindings name="Query" nullBinding="true"/>
    <returnValueBindings name="ErrorCode" nullBinding="true"/>
    <returnValueBindings name="SearchResult" objectPath="AvailableCategoryAssociatedPromotions"/>
  </nodes>
<!--@Location 7,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode46" strict="true">
<!--An iterator of all promotions that are product associated.-->
    <returnValues name="AvailableCategoryAssociatedPromotions" type="java.util.Iterator"
        optional="true"/>
  </nodes>
<!--@Location 8,24-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode55">
<!--@BendPoints 17,50-->
    <nodeSuccessors name="next" next="EndNode45"/>
  </nodes>
<!--@Location 8,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode45" name="error" strict="true"/>
<!--@Location 4,20-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode18" strict="true" name="GetAvailableProductAssociatedPromotions"
      callMode="Private">
    <nodeSuccessors name="next" next="GetCurrentDate4"/>
<!--A domain.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
<!--The promotion availableflag.-->
    <parameters name="Availableflag" type="java.lang.Boolean" optional="true"/>
  </nodes>
<!--@Location 4,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate4">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
    <nodeSuccessors name="next" next="VerifyBoolean13"/>
  </nodes>
<!--@Location 4,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="VerifyBoolean13">
    <pipelet href="enfinity:/bc_foundation/pipelets/VerifyBoolean.xml"/>
    <nodeSuccessors name="next" next="UpdateDictionary3"/>
<!--@BendPoints 11,45-->
    <nodeSuccessors name="pipelet_error" next="JoinNode20"/>
    <parameterBindings name="NoneLocalizedString" constant="false"/>
    <returnValueBindings name="BooleanValue" objectPath="False"/>
  </nodes>
<!--@Location 4,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateDictionary3">
    <configurationValues name="Name_01" value="Domain"/>
    <configurationValues name="Name_02" value="CurrentDate"/>
    <configurationValues name="Name_03" value="Available"/>
    <configurationValues name="Name_04" value="StartDate"/>
    <pipelet href="enfinity:/core/pipelets/UpdateDictionary.xml"/>
    <nodeSuccessors name="next" next="ExecuteObjectsQuery3"/>
    <parameterBindings name="InDictionary" nullBinding="true"/>
    <parameterBindings name="Value_01" objectPath="Domain"/>
    <parameterBindings name="Value_02" objectPath="CurrentDate"/>
    <parameterBindings name="Value_03" objectPath="Availableflag"/>
    <parameterBindings name="Value_04" objectPath="False"/>
    <returnValueBindings name="OutDictionary" objectPath="QueryParameters"/>
  </nodes>
<!--@Location 4,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecuteObjectsQuery3">
    <configurationValues name="Datasource" value="current ORM connection"/>
    <configurationValues name="QueryName" value="marketing/GetProductAssociatedPromotions"/>
    <pipelet href="enfinity:/core/pipelets/ExecuteObjectsQuery.xml"/>
<!--@BendPoints 9,50-->
    <nodeSuccessors name="next" next="EndNode24"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode20"/>
    <parameterBindings name="Connection" nullBinding="true"/>
    <parameterBindings name="Parameters" objectPath="QueryParameters"/>
    <parameterBindings name="Query" nullBinding="true"/>
    <returnValueBindings name="ErrorCode" nullBinding="true"/>
    <returnValueBindings name="SearchResult" objectPath="AvailableProductAssociatedPromotions"/>
  </nodes>
<!--@Location 4,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode24" strict="true">
<!--An iterator of all promotions that are product associated.-->
    <returnValues name="AvailableProductAssociatedPromotions" type="java.util.Iterator"
        optional="true"/>
  </nodes>
<!--@Location 5,24-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode20">
<!--@BendPoints 11,50-->
    <nodeSuccessors name="next" next="EndNode25"/>
  </nodes>
<!--@Location 5,25-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode25" name="error" strict="true"/>
<!--@Location 20,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode9" strict="true" name="GetCominationTypes"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode13"/>
<!--the Promotion-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"
        optional="true"/>
    <parameters name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"
        optional="true"/>
  </nodes>
<!--@Location 20,2-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode13">
    <nodeSuccessors name="next" next="DeterminePromotionCombinable1"/>
    <startNode referencedName="This:GetApplicationContext"/>
  </nodes>
<!--@Location 20,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DeterminePromotionCombinable1">
    <pipelet href="enfinity:/bc_marketing/pipelets/DeterminePromotionCombinable.xml"/>
<!--@BendPoints 41,8-->
    <nodeSuccessors name="next" next="EndNode10"/>
  </nodes>
<!--@Location 20,4-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode10" strict="true">
<!--IDs of the available combination types, not assigned to the promotion-->
    <returnValues name="AvailableCombinationTypes" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 16,33-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode22" strict="true" name="GetEvaluationDate"
      callMode="Private">
    <nodeSuccessors name="next" next="GetPromotionPreviewConfiguration1"/>
    <parameters name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="CurrentSession" type="com.intershop.beehive.core.capi.request.Session"/>
  </nodes>
<!--@Location 16,34-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPromotionPreviewConfiguration1">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetPromotionPreviewConfiguration.xml"/>
    <nodeSuccessors name="next" next="KeyMapper3"/>
    <nodeSuccessors name="pipelet_error" next="CallNode16"/>
  </nodes>
<!--@Location 16,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper3">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode17"/>
    <parameterBindings name="InValue_1" objectPath="PromotionPreviewConfiguration:Date"/>
    <returnValueBindings name="OutValue_1" objectPath="PromotionEvaluationDate"/>
  </nodes>
<!--@Location 16,36-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode17">
    <nodeSuccessors name="next" next="EndNode18"/>
  </nodes>
<!--@Location 16,37-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode18" strict="true">
    <returnValues name="PromotionEvaluationDate" type="java.util.Date"/>
  </nodes>
<!--@Location 17,34-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode16">
    <nodeSuccessors name="SESSION" next="GetDateFromLong0"/>
    <nodeSuccessors name="TIME" next="GetCurrentDate5"/>
    <startNode referencedName="ProcessPromotionPreference-GetValidationDatePreference"/>
  </nodes>
<!--@Location 18,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetDateFromLong0">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetDateFromLong.xml"/>
<!--@BendPoints 37,73-->
    <nodeSuccessors name="next" next="JoinNode16"/>
    <nodeSuccessors name="pipelet_error" next="GetCurrentDate5"/>
    <parameterBindings name="LongObject" objectPath="CurrentSession:CreationTime"/>
    <returnValueBindings name="DateObject" objectPath="PromotionEvaluationDate"/>
  </nodes>
<!--@Location 17,36-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode16">
    <nodeSuccessors name="next" next="JoinNode17"/>
  </nodes>
<!--@Location 17,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate5">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
    <nodeSuccessors name="next" next="JoinNode16"/>
    <returnValueBindings name="CurrentDate" objectPath="PromotionEvaluationDate"/>
  </nodes>
<!--@deprecated use Pipelet GetPromotionValidityDate instead
@since 7.5.0.0
Currently, we always have to use the current date for
evaluating the page cache. Using session time currently 
may lead to serious errors
so a rework of the page cache is needed.
@Location 19,22-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode23" strict="true" name="GetEvaluationDateForPageCache"
      callMode="Private">
    <nodeSuccessors name="next" next="GetPromotionPreviewConfiguration2"/>
    <parameters name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="CurrentSession" type="com.intershop.beehive.core.capi.request.Session"/>
  </nodes>
<!--@Location 19,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPromotionPreviewConfiguration2">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetPromotionPreviewConfiguration.xml"/>
    <nodeSuccessors name="next" next="KeyMapper5"/>
<!--@BendPoints 41,47-->
    <nodeSuccessors name="pipelet_error" next="GetCurrentDate6"/>
  </nodes>
<!--@Location 19,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper5">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode15"/>
    <parameterBindings name="InValue_1" objectPath="PromotionPreviewConfiguration:Date"/>
    <returnValueBindings name="OutValue_1" objectPath="PromotionEvaluationDate"/>
  </nodes>
<!--@Location 19,25-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode15">
    <nodeSuccessors name="next" next="EndNode19"/>
  </nodes>
<!--@Location 19,26-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode19" strict="true">
    <returnValues name="PromotionEvaluationDate" type="java.util.Date"/>
  </nodes>
<!--@Location 20,24-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate6">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
<!--@BendPoints 41,51-->
    <nodeSuccessors name="next" next="JoinNode15"/>
    <returnValueBindings name="CurrentDate" objectPath="PromotionEvaluationDate"/>
  </nodes>
<!--@Location 11,33-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode21" strict="true" name="GetEvaluationTime"
      callMode="Private">
    <nodeSuccessors name="next" next="GetPromotionPreviewConfiguration0"/>
    <parameters name="PromotionEvaluationTime" type="java.lang.Long" optional="true"/>
    <parameters name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"/>
    <parameters name="CurrentSession" type="com.intershop.beehive.core.capi.request.Session"/>
  </nodes>
<!--@Location 11,34-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPromotionPreviewConfiguration0">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetPromotionPreviewConfiguration.xml"/>
    <nodeSuccessors name="next" next="KeyMapper1"/>
    <nodeSuccessors name="pipelet_error" next="DecisionNode11"/>
  </nodes>
<!--@Location 11,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper1">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
    <nodeSuccessors name="next" next="JoinNode9"/>
    <parameterBindings name="InValue_1" objectPath="PromotionPreviewConfiguration:Date:Time"/>
    <returnValueBindings name="OutValue_1" objectPath="PromotionEvaluationTime"/>
  </nodes>
<!--@Location 11,36-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode9">
    <nodeSuccessors name="next" next="JoinNode11"/>
  </nodes>
<!--@Location 11,37-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode11">
    <nodeSuccessors name="next" next="EndNode17"/>
  </nodes>
<!--@Location 11,38-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode17" strict="true">
    <returnValues name="PromotionEvaluationTime" type="java.lang.Long"/>
  </nodes>
<!--@Location 12,34-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode11" conditionKey="PromotionEvaluationTime">
<!--@BendPoints 25,73-->
    <nodeSuccessors name="decision_yes" next="JoinNode9"/>
    <nodeSuccessors name="decision_no" next="CallNode17"/>
  </nodes>
<!--@Location 13,34-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode17">
    <nodeSuccessors name="SESSION" next="KeyMapper0"/>
    <nodeSuccessors name="TIME" next="GetCurrentDate2"/>
    <startNode referencedName="ProcessPromotionPreference-GetValidationDatePreference"/>
  </nodes>
<!--@Location 14,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper0">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 29,75-->
    <nodeSuccessors name="next" next="JoinNode13"/>
    <parameterBindings name="InValue_1" objectPath="CurrentSession:CreationTime"/>
    <returnValueBindings name="OutValue_1" objectPath="PromotionEvaluationTime"/>
  </nodes>
<!--@Location 13,37-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode13">
    <nodeSuccessors name="next" next="JoinNode11"/>
  </nodes>
<!--@Location 13,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate2">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
    <nodeSuccessors name="next" next="GetLongFromDate0"/>
  </nodes>
<!--@Location 13,36-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetLongFromDate0">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetLongFromDate.xml"/>
    <nodeSuccessors name="next" next="JoinNode13"/>
    <parameterBindings name="DateObject" objectPath="CurrentDate"/>
    <returnValueBindings name="LongObject" objectPath="PromotionEvaluationTime"/>
  </nodes>
<!--@Since IS 7.4.1
Searches for all customers that are: 
1. directly explicitly assigned to a TargetGroupID (e.g. Promotion usergroup)
2. incirectly explicitly assigned to this TargetGroup via an explicit assignment to one of its child usergroups (user segments).

The indirect search can be turned off by the optional flag "OnlyDirectAssignments".

Please note: This does not return users, that are assigned implicitly to any of the user groups. Only direct or indirect, but explicit users are looked up.
@Location 13,20-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode0" strict="true" name="GetExplicitlyAssignedCustomers"
      callMode="Private">
    <nodeSuccessors name="next" next="ExecutePageableQuery0"/>
<!--If this optional flag is set true, the query only returns customers directly assigned to the TargetGroup (e.g. a promotion itself). If this flag is not set or false, the query also searchs recursively for all indirectly assigned customers. i.e. All customers explicitly assigned to one of the usergroups that are assigned to the TargetGroup.-->
    <parameters name="OnlyDirectAssignments" type="java.lang.Boolean" optional="true"/>
<!--The promotion for which the assigned customers shall be looked up.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
<!--The Domain of the Pipeline execution to resolve the correct query file.-->
    <parameters name="Domain" type="com.intershop.beehive.core.capi.domain.Domain"/>
<!--Optional value for the page size of the PagebleIterator.-->
    <parameters name="PageSize" type="java.lang.Integer" optional="true"/>
<!--Optional value of the domain from which the customers should be.-->
    <parameters name="CustomerDomainID" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 13,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecutePageableQuery0">
    <configurationValues name="Datasource" value="default"/>
    <configurationValues name="ParameterName_01" value="TargetGroupID"/>
    <configurationValues name="ParameterName_02" value="OnlyDirectAssignments"/>
    <configurationValues name="ParameterName_03" value="UserDomainID"/>
    <configurationValues name="QueryName" value="customer/GetTargetCustomers"/>
    <pipelet href="enfinity:/core/pipelets/ExecutePageableQuery.xml"/>
    <nodeSuccessors name="next" next="EndNode0"/>
    <parameterBindings name="CurrentDomain" objectPath="Domain"/>
    <parameterBindings name="ParameterValue_01" objectPath="Promotion:TargetGroupID"/>
    <parameterBindings name="ParameterValue_02" objectPath="OnlyDirectAssignments"/>
    <parameterBindings name="ParameterValue_03" objectPath="CustomerDomainID"/>
    <returnValueBindings name="SearchResult" objectPath="TargetGroupCustomers"/>
  </nodes>
<!--@Location 13,22-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode0" strict="true">
<!--A PageableIterator with all found CustomerBOs.-->
    <returnValues name="TargetGroupCustomers" type="com.intershop.beehive.core.capi.paging.PageableIterator&lt;com.intershop.component.customer.capi.CustomerBO>"/>
  </nodes>
<!--@Location 13,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode6" strict="true" name="GetPromotionDomainByChannel"
      callMode="Private">
<!--@BendPoints 27,4-->
    <nodeSuccessors name="next" next="KeyMapper7"/>
    <parameters name="Channel" type="com.intershop.component.mvc.capi.catalog.Repository"/>
  </nodes>
<!--@Location 13,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper7">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 27,6-->
    <nodeSuccessors name="next" next="EndNode6"/>
    <parameterBindings name="InValue_1" objectPath="Channel:RepositoryDomain"/>
    <returnValueBindings name="OutValue_1" objectPath="PromotionDomain"/>
  </nodes>
<!--@Location 13,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode6" strict="true">
    <returnValues name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"
        optional="true"/>
  </nodes>
<!--@Location 11,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode7" strict="true" name="GetPromotionDomainByOrganization"
      callMode="Private">
<!--@BendPoints 23,4-->
    <nodeSuccessors name="next" next="KeyMapper8"/>
    <parameters name="ChannelOrganization" type="com.intershop.component.organization.capi.Organization"/>
  </nodes>
<!--@Location 11,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="KeyMapper8">
    <pipelet href="enfinity:/bc_foundation/pipelets/KeyMapper.xml"/>
<!--@BendPoints 23,6-->
    <nodeSuccessors name="next" next="EndNode7"/>
    <parameterBindings name="InValue_1" objectPath="ChannelOrganization:OwningDomain"/>
    <returnValueBindings name="OutValue_1" objectPath="PromotionDomain"/>
  </nodes>
<!--@Location 11,3-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode7" strict="true">
    <returnValues name="PromotionDomain" type="com.intershop.beehive.core.capi.domain.Domain"
        optional="true"/>
  </nodes>
<!--@Location 1,33-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode13" strict="true" name="GetPromotionTargetGroupsOfCustomer"
      callMode="Private">
    <nodeSuccessors name="next" next="ExecuteObjectsQuery0"/>
    <parameters name="CustomerID" type="java.lang.String"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
  </nodes>
<!--@Location 1,34-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="ExecuteObjectsQuery0">
    <configurationValues name="ParameterName_01" value="CustomerID"/>
    <configurationValues name="QueryName" value="marketing/GetPromotionsForCustomer"/>
    <pipelet href="enfinity:/core/pipelets/ExecuteObjectsQuery.xml"/>
    <nodeSuccessors name="next" next="EndNode12"/>
    <parameterBindings name="Connection" nullBinding="true"/>
    <parameterBindings name="ParameterValue_01" objectPath="CustomerID"/>
    <parameterBindings name="Query" nullBinding="true"/>
    <returnValueBindings name="ErrorCode" nullBinding="true"/>
    <returnValueBindings name="SearchResult" objectPath="PromotionsOfCustomer"/>
  </nodes>
<!--@Location 1,36-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode12" strict="true">
    <returnValues name="PromotionsOfCustomer" type="com.intershop.beehive.foundation.util.ResettableIterator&lt;com.intershop.component.marketing.internal.rebate.PromotionPO>"/>
  </nodes>
<!--@Location 18,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode8" strict="true" name="RemoveConditions"
      callMode="Private">
    <nodeSuccessors name="next" next="GetConditionApplicationContext2"/>
<!--The promotion from that the conditions are removed.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 18,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetConditionApplicationContext2">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetConditionApplicationContext.xml"/>
    <nodeSuccessors name="next" next="LoopNode2"/>
    <parameterBindings name="ConditionRepositoryName" constant="promotionConditionRepository"/>
  </nodes>
<!--@Location 18,13-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode2" loop="Promotion:Rebates">
<!--@BendPoints 38,27-->
    <nodeSuccessors name="next" next="EndNode8"/>
    <entry key="Rebate">
      <nodeSuccessors name="loop_entry_next" next="DecisionNode7"/>
    </entry>
  </nodes>
<!--@Location 18,14-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode7" conditionKey="Rebate:Condition">
    <nodeSuccessors name="decision_yes" next="CallNode8"/>
<!--@BendPoints 38,29 38,33-->
    <nodeSuccessors name="decision_no" next="JoinNode7"/>
  </nodes>
<!--@Location 18,15-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode8">
    <nodeSuccessors name="next" next="JoinNode7"/>
    <parameterBindings name="Condition" objectPath="Rebate:Condition"/>
    <startNode referencedName="ProcessConditionConfiguration-RemoveCondition"/>
  </nodes>
<!--@Location 18,16-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode7">
<!--@BendPoints 36,33 36,27-->
    <nodeSuccessors name="next" next="LoopNode2_Entry"/>
  </nodes>
<!--@Location 19,13-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode8" strict="true"/>
<!--@Location 15,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode11" strict="true" name="RemovePromotionCodeGroupAssignment"
      callMode="Private">
<!--@BendPoints 31,4-->
    <nodeSuccessors name="next" next="GetPromotionCodeGroups2"/>
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 15,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetPromotionCodeGroups2">
    <pipelet href="enfinity:/bc_marketing/pipelets/GetPromotionCodeGroups.xml"/>
    <nodeSuccessors name="next" next="LoopNode4"/>
    <parameterBindings name="Domain" objectPath="Promotion:Domain"/>
  </nodes>
<!--@Location 15,3-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode4" loop="PromotionCodeGroups">
<!--@BendPoints 32,7 32,11 31,11 31,12-->
    <nodeSuccessors name="next" next="EndNode9"/>
    <entry key="PromotionCodeGroup">
<!--@BendPoints 31,8-->
      <nodeSuccessors name="loop_entry_next" next="CallNode12"/>
    </entry>
  </nodes>
<!--@Location 15,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode12">
<!--@BendPoints 31,10 30,10 30,7-->
    <nodeSuccessors name="next" next="LoopNode4_Entry"/>
    <startNode referencedName="ProcessPromotionCodeGroup-RemoveFromPromotion"/>
  </nodes>
<!--@Location 15,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode9" strict="true"/>
<!--@Location 1,20-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode16" strict="true" name="Sort"
      callMode="Private">
    <nodeSuccessors name="next" next="SortIteratorByComparator5"/>
    <parameters name="Iterator" type="java.util.Iterator"/>
    <parameters name="Comparator" type="java.util.Comparator" optional="true"/>
    <parameters name="SortingAttribute" type="java.lang.String" optional="true"/>
    <parameters name="SortingOrder" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 1,21-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="SortIteratorByComparator5">
    <configurationValues name="DefaultSortingOrder" value="true"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/SortIteratorByComparator.xml"/>
    <nodeSuccessors name="next" next="AddObjectToVector3"/>
  </nodes>
<!--@Location 1,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="AddObjectToVector3">
    <pipelet href="enfinity:/bc_foundation/pipelets/AddObjectToVector.xml"/>
<!--@BendPoints 3,46-->
    <nodeSuccessors name="next" next="EndNode21"/>
    <parameterBindings name="InVector" nullBinding="true"/>
    <parameterBindings name="Object" nullBinding="true"/>
    <parameterBindings name="Objects" objectPath="SortedIterator"/>
    <returnValueBindings name="Iterator" nullBinding="true"/>
    <returnValueBindings name="OutVector" objectPath="SortedVector"/>
  </nodes>
<!--@Location 1,23-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode21" strict="true">
    <returnValues name="SortedVector" type="java.util.Vector" optional="true"/>
    <returnValues name="SortedIterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@displayNearNode@Updates the "LastModified" date, whenever the promotion's configuration has been changed.
@Location 10,20-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode12" strict="true" name="TouchPromotion"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode8"/>
    <parameters name="Promotion" type="com.intershop.beehive.orm.capi.common.Touchable"/>
    <parameters name="Iterator" type="java.util.Iterator" optional="true"/>
  </nodes>
<!--@Location 10,21-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode8" conditionKey="Iterator">
<!--@BendPoints 21,44 20,44 20,45-->
    <nodeSuccessors name="decision_yes" next="DecisionNode6"/>
<!--@BendPoints 23,43-->
    <nodeSuccessors name="decision_no" next="GetCurrentDate1"/>
  </nodes>
<!--@Location 10,22-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode6" conditionKey="Iterator"
      operator="has_elements">
<!--@BendPoints 22,45 22,44 23,44-->
    <nodeSuccessors name="decision_yes" next="GetCurrentDate1"/>
<!--@BendPoints 21,48-->
    <nodeSuccessors name="decision_no" next="EndNode11"/>
  </nodes>
<!--@Location 11,22-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate1">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
    <nodeSuccessors name="next" next="UpdateCustomAttribute1"/>
  </nodes>
<!--@Location 11,23-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateCustomAttribute1">
    <configurationValues name="DefaultAttributeName" value="EditedDate"/>
    <configurationValues name="DefaultAttributeType" value="Date"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateCustomAttribute.xml"/>
<!--@BendPoints 23,48 21,48-->
    <nodeSuccessors name="next" next="EndNode11"/>
<!--@BendPoints 24,47 24,48 21,48-->
    <nodeSuccessors name="pipelet_error" next="EndNode11"/>
    <parameterBindings name="AttributeValue" objectPath="CurrentDate"/>
    <parameterBindings name="ExtensibleObject" objectPath="Promotion"/>
  </nodes>
<!--@Location 10,24-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode11" strict="true"/>
<!--@Location 6,33-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode19" strict="true" visibility="Private"
      name="UnassignUserFromPromotionTargetGroups" callMode="Private">
    <nodeSuccessors name="next" next="CallNode4"/>
    <parameters name="CustomerID" type="java.lang.String"/>
    <parameters name="UserBO" type="com.intershop.component.user.capi.UserBO"/>
  </nodes>
<!--@Location 6,34-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode4">
    <nodeSuccessors name="next" next="DetermineUser1"/>
    <startNode referencedName="ProcessPromotion-GetPromotionTargetGroupsOfCustomer"/>
  </nodes>
<!--@Location 6,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="DetermineUser1">
    <pipelet href="enfinity:/core/pipelets/DetermineUser.xml"/>
    <nodeSuccessors name="next" next="LoopNode6"/>
    <parameterBindings name="UserID" objectPath="UserBO:ID"/>
  </nodes>
<!--@Location 6,36-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode6" loop="PromotionsOfCustomer">
    <nodeSuccessors name="next" next="EndNode15"/>
    <entry key="SinglePromotion">
      <nodeSuccessors name="loop_entry_next" next="RemoveUserFromPromotionTargetGroup0"/>
    </entry>
  </nodes>
<!--@Location 6,37-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="RemoveUserFromPromotionTargetGroup0">
    <pipelet href="enfinity:/bc_marketing/pipelets/RemoveUserFromPromotionTargetGroup.xml"/>
<!--@BendPoints 11,73-->
    <nodeSuccessors name="next" next="LoopNode6_Entry"/>
    <parameterBindings name="Promotion" objectPath="SinglePromotion"/>
    <parameterBindings name="User" objectPath="User"/>
  </nodes>
<!--@Location 7,36-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode15" strict="true"/>
<!--@Location 15,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode2" strict="true" name="UpdateAssignments"
      callMode="Private">
    <nodeSuccessors name="next" next="CallNode7"/>
    <parameters name="Repository" type="com.intershop.component.mvc.capi.catalog.Repository"/>
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 15,12-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode7">
    <nodeSuccessors name="next" next="LoopNode1" action="begin"/>
    <parameterBindings name="To" objectPath="Promotion"/>
    <startNode referencedName="ProcessPromotion-GetAssignments"/>
  </nodes>
<!--@Location 15,13-->
  <nodes xsi:type="pipeline:LoopNode" nodeID="LoopNode1" loop="Assignments">
<!--@BendPoints 32,27-->
    <nodeSuccessors name="next" next="End2" action="commit"/>
    <entry key="Assignment">
<!--@BendPoints 31,28 30,28 30,29-->
      <nodeSuccessors name="loop_entry_next" next="DecisionNode3"/>
    </entry>
  </nodes>
<!--@Location 15,14-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode3" conditionKey="Assignment:Pagelet">
<!--@BendPoints 32,29 32,30-->
    <nodeSuccessors name="decision_yes" next="CallNode9"/>
<!--@BendPoints 31,30 30,30-->
    <nodeSuccessors name="decision_no" next="JoinNode4"/>
  </nodes>
<!--@Location 15,15-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode9">
<!--@BendPoints 31,32 29,32-->
    <nodeSuccessors name="next" next="JoinNode4"/>
    <parameterBindings name="From" objectPath="Assignment:From"/>
    <parameterBindings name="Site" objectPath="Repository:RepositoryDomain:Site"/>
    <parameterBindings name="To" objectPath="Assignment:To"/>
    <startNode referencedName="ProcessAssignments-UpdateAssignment"/>
  </nodes>
<!--@Location 14,14-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode4">
<!--@BendPoints 29,27 30,27-->
    <nodeSuccessors name="next" next="LoopNode1_Entry"/>
  </nodes>
<!--@Location 16,13-->
  <nodes xsi:type="pipeline:EndNode" nodeID="End2" strict="true"/>
<!--@Location 12,11-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start1" strict="true" name="UpdateContentActivation"
      callMode="Private">
<!--@BendPoints 25,24-->
    <nodeSuccessors name="next" next="UpdatePromotionContentActivation1"/>
<!--The promotion to be updated.-->
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
<!--The date, when the promotion content will deactivate. If not found in the pipeline dictionary the content activation end date is not changed.-->
    <parameters name="EndDate" type="java.util.Date" optional="true"/>
<!--The date, when the promotion content will activate. If not found in the pipeline dictionary the content activation start date is not changed.-->
    <parameters name="StartDate" type="java.util.Date" optional="true"/>
<!--The type of the promotion content activation.-->
    <parameters name="Type" type="java.lang.Integer" optional="true"/>
    <parameters name="Repository" type="com.intershop.component.mvc.capi.catalog.Repository"/>
  </nodes>
<!--@Location 12,12-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdatePromotionContentActivation1">
    <pipelet href="enfinity:/bc_marketing/pipelets/UpdatePromotionContentActivation.xml"/>
<!--@BendPoints 25,26-->
    <nodeSuccessors name="next" next="CallNode10"/>
  </nodes>
<!--@Location 12,13-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode10">
<!--@BendPoints 25,28-->
    <nodeSuccessors name="next" next="End1"/>
    <startNode referencedName="ProcessPromotion-UpdateAssignments"/>
  </nodes>
<!--@Location 12,14-->
  <nodes xsi:type="pipeline:EndNode" nodeID="End1" strict="true"/>
<!--@Location 4,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start8" strict="true" name="UpdatePromotion"
      callMode="Private">
<!--@BendPoints 9,4-->
    <nodeSuccessors name="next" next="GetLocale4"/>
    <parameters name="LocaleId" type="java.lang.String" optional="true"/>
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
    <parameters name="CreatorId" type="java.lang.String" optional="true"/>
<!--promotion input form-->
    <parameters name="PromotionForm" type="com.intershop.beehive.core.capi.webform.Form"/>
    <parameters name="PromotionActionPriorityHandler" type="com.intershop.component.promotion.capi.action.PromotionActionPriorityHandler"/>
  </nodes>
<!--@Location 4,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetLocale4">
    <configurationValues name="LocaleFallback" value="Request Locale"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetLocale.xml"/>
<!--@BendPoints 9,6-->
    <nodeSuccessors name="next" next="UpdatePromotion1"/>
  </nodes>
<!--@Location 4,3-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdatePromotion1">
    <pipelet href="enfinity:/bc_marketing/pipelets/UpdatePromotion.xml"/>
    <nodeSuccessors name="next" next="CallNode15"/>
    <parameterBindings name="BudgetSourceID" objectPath="PromotionForm:BudgetSource:Value"/>
    <parameterBindings name="Description" objectPath="PromotionForm:Description:Value"/>
    <parameterBindings name="DisplayName" objectPath="PromotionForm:Name:Value"/>
    <parameterBindings name="EffectDiscountLevel" objectPath="PromotionForm:EffectDiscountLevel:Value"/>
    <parameterBindings name="Enabled" objectPath="PromotionForm:Enabled:Value"/>
    <parameterBindings name="EndDate" objectPath="PromotionForm:EndDate:Value"/>
    <parameterBindings name="HasDefaultRank" objectPath="PromotionForm:RankSelection:Value"/>
    <parameterBindings name="Rank" objectPath="PromotionForm:Rank:Value"/>
    <parameterBindings name="StartDate" objectPath="PromotionForm:StartDate:Value"/>
    <parameterBindings name="Type" objectPath="PromotionForm:Type:Value"/>
    <parameterBindings name="UseCampaignTimeFrame" objectPath="PromotionForm:UseCampaignTimeFrame:Value"/>
  </nodes>
<!--@Location 4,4-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode15">
    <nodeSuccessors name="next" next="CallNode1"/>
    <startNode referencedName="ProcessPromotion-UpdatePromotionPriorityToDefault"/>
  </nodes>
<!--@Location 4,5-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode1">
    <nodeSuccessors name="next" next="UpdatePromotionCombinable1"/>
    <parameterBindings name="PromotionDomain" objectPath="Promotion:Domain"/>
    <startNode referencedName="This:GetApplicationContext"/>
  </nodes>
<!--@Location 4,6-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdatePromotionCombinable1">
    <pipelet href="enfinity:/bc_marketing/pipelets/UpdatePromotionCombinable.xml"/>
    <nodeSuccessors name="next" next="End7"/>
    <parameterBindings name="Combinable" objectPath="PromotionForm:Combinable:Value"/>
    <parameterBindings name="CombinationTypes" objectPath="PromotionForm:AssignedCombinationTypes:Value"/>
    <parameterBindings name="MultipleAllowed" objectPath="PromotionForm:MultipleAllowed:Value"/>
  </nodes>
<!--@Location 4,7-->
  <nodes xsi:type="pipeline:EndNode" nodeID="End7" strict="true">
    <returnValues name="PromotionForm:PromotionEnabled:isSubmitted" type="java.lang.String"
        optional="true"/>
    <returnValues name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"/>
  </nodes>
<!--@Location 6,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode14" strict="true" name="UpdatePromotionPriorityToDefault"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode10"/>
    <parameters name="Promotion" type="com.intershop.component.marketing.capi.rebate.Promotion"
        optional="true"/>
    <parameters name="ActionDescriptorRegistry" type="com.intershop.component.foundation.capi.action.ActionDescriptorRegistry"
        optional="true"/>
    <parameters name="PromotionActionPriorityHandler" type="com.intershop.component.promotion.capi.action.PromotionActionPriorityHandler"/>
  </nodes>
<!--@Location 6,2-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode10" conditionKey="ActionDescriptorRegistry">
<!--@BendPoints 13,8-->
    <nodeSuccessors name="decision_yes" next="UpdatePromotionRankToDefault3"/>
<!--@BendPoints 15,5 15,6-->
    <nodeSuccessors name="decision_no" next="CallNode14"/>
  </nodes>
<!--@Location 6,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdatePromotionRankToDefault3">
    <pipelet href="enfinity:/bc_marketing/pipelets/UpdatePromotionRankToDefault.xml"/>
<!--@BendPoints 13,10-->
    <nodeSuccessors name="next" next="EndNode13"/>
  </nodes>
<!--@Location 6,5-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode13" strict="true"/>
<!--@Location 7,3-->
  <nodes xsi:type="pipeline:CallNode" nodeID="CallNode14">
<!--@BendPoints 15,8 13,8-->
    <nodeSuccessors name="next" next="UpdatePromotionRankToDefault3"/>
    <parameterBindings name="PromotionDomain" objectPath="Promotion:Domain"/>
    <startNode referencedName="ProcessPromotion-GetApplicationContext"/>
  </nodes>
<!--@Location 1,1-->
  <nodes xsi:type="pipeline:StartNode" nodeID="Start5" strict="true" name="UpdateRebate"
      callMode="Private">
<!--@BendPoints 3,4-->
    <nodeSuccessors name="next" next="GetLocale3"/>
    <parameters name="UpdateLocaleID" type="java.lang.String"/>
<!--Classification type Code.-->
    <parameters name="ClassificationTypeCode" type="java.lang.Integer" optional="true"/>
<!--The rebate to be updated.-->
    <parameters name="Rebate" type="com.intershop.component.marketing.capi.rebate.Rebate"/>
    <parameters name="ConditionalProductDescription" type="java.lang.String" optional="true"/>
    <parameters name="DiscountedProductDescription" type="java.lang.String" optional="true"/>
    <parameters name="Enabled" type="java.lang.Boolean"/>
    <parameters name="DispplayName" type="java.lang.String" optional="true"/>
    <parameters name="Description" type="java.lang.String" optional="true"/>
    <parameters name="TypeCode" type="java.lang.String" optional="true"/>
  </nodes>
<!--@Location 1,2-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetLocale3">
    <configurationValues name="LocaleFallback" value="Request Locale"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/GetLocale.xml"/>
<!--@BendPoints 3,6-->
    <nodeSuccessors name="next" next="DecisionNode5"/>
    <parameterBindings name="LocaleId" objectPath="UpdateLocaleID"/>
    <returnValueBindings name="Locale" objectPath="UpdateLocale"/>
  </nodes>
<!--@Location 1,3-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode5" conditionKey="PromotionForm:Type:Value"
      operator="str_eq" conditionValue="DISCOUNT">
    <nodeSuccessors name="decision_yes" next="UpdateRebate1"/>
<!--@BendPoints 5,7 5,8-->
    <nodeSuccessors name="decision_no" next="UpdateRebate2"/>
  </nodes>
<!--@Location 1,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateRebate1">
    <pipelet href="enfinity:/bc_marketing/pipelets/UpdateRebate.xml"/>
    <nodeSuccessors name="next" next="JoinNode12"/>
    <parameterBindings name="ClassificationTypeCode" nullBinding="true"/>
    <parameterBindings name="TypeCode" nullBinding="true"/>
  </nodes>
<!--@Location 1,5-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode12">
<!--@BendPoints 3,12-->
    <nodeSuccessors name="next" next="End6"/>
  </nodes>
<!--@Location 1,6-->
  <nodes xsi:type="pipeline:EndNode" nodeID="End6" strict="true"/>
<!--@Location 2,4-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateRebate2">
    <pipelet href="enfinity:/bc_marketing/pipelets/UpdateRebate.xml"/>
<!--@BendPoints 5,11-->
    <nodeSuccessors name="next" next="JoinNode12"/>
    <parameterBindings name="ClassificationTypeCode" constant="(Integer)1"/>
    <parameterBindings name="TypeCode" nullBinding="true"/>
  </nodes>
<!--@Location 8,33-->
  <nodes xsi:type="pipeline:StartNode" nodeID="StartNode20" strict="true" name="UpdateUserLastOrderDate"
      callMode="Private">
    <nodeSuccessors name="next" next="DecisionNode4"/>
    <parameters name="User" type="com.intershop.beehive.core.capi.user.User"/>
  </nodes>
<!--@Location 8,34-->
  <nodes xsi:type="pipeline:DecisionNode" nodeID="DecisionNode4" conditionKey="User:Profile:DataSheet">
    <nodeSuccessors name="decision_yes" next="GetCurrentDate0"/>
<!--@BendPoints 20,69 20,77-->
    <nodeSuccessors name="decision_no" next="JoinNode_8Kl3YIi7Eeio68Z1Sr7o_A"/>
  </nodes>
<!--@Location 8,35-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="GetCurrentDate0">
    <pipelet href="enfinity:/bc_foundation/pipelets/GetCurrentDate.xml"/>
    <nodeSuccessors name="next" next="TryLock0" action="begin"/>
  </nodes>
<!--@Location 8,36-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="TryLock0">
    <configurationValues name="Timeout" value="10"/>
    <pipelet href="enfinity:/core/pipelets/TryLock.xml"/>
    <nodeSuccessors name="next" next="UpdateCustomAttribute_E0DAIH6uEeijj9WrG2xNSg"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode6"/>
    <parameterBindings name="LockObject" objectPath="User:Profile:DataSheet"/>
  </nodes>
<!--@Location 8,37-->
  <nodes xsi:type="pipeline:PipeletNode" nodeID="UpdateCustomAttribute_E0DAIH6uEeijj9WrG2xNSg">
    <configurationValues name="DefaultAttributeName" value="LastOrderDate"/>
    <configurationValues name="DefaultAttributeType" value="Date"/>
    <pipelet href="enfinity:/bc_foundation/pipelets/UpdateCustomAttribute.xml"/>
    <nodeSuccessors name="next" next="EndNode16" action="commit"/>
    <nodeSuccessors name="pipelet_error" next="JoinNode6"/>
    <parameterBindings name="AttributeName" nullBinding="true"/>
    <parameterBindings name="AttributeType" nullBinding="true"/>
    <parameterBindings name="AttributeValue" objectPath="CurrentDate"/>
    <parameterBindings name="ExtensibleObject" objectPath="User:Profile:DataSheet"/>
  </nodes>
<!--@Location 8,38-->
  <nodes xsi:type="pipeline:EndNode" nodeID="EndNode16" strict="true"/>
<!--@Location 9,37-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode6">
    <nodeSuccessors name="next" next="JoinNode_8Kl3YIi7Eeio68Z1Sr7o_A" action="rollback"/>
  </nodes>
<!--@Location 9,38-->
  <nodes xsi:type="pipeline:JoinNode" nodeID="JoinNode_8Kl3YIi7Eeio68Z1Sr7o_A">
    <nodeSuccessors name="next" next="EndNode16"/>
  </nodes>
</pipeline:Pipeline>
