BEGIN

	UPDATE "BASICPROFILE" b SET (b."PREFERREDINVOICETOADDRESSURN", b."PREFERREDSHIPTOADDRESSURN") = (
		SELECT
			NVL((SELECT bpav."STRINGVALUE" FROM "BASICPROFILE_AV" bpav WHERE b."UUID" = bpav."OWNERID" AND bpav."NAME" = 'Default Address1'), b."PREFERREDINVOICETOADDRESSURN"),
			NVL((SELECT bpav."STRINGVALUE" FROM "BASICPROFILE_AV" bpav WHERE b."UUID" = bpav."OWNERID" AND bpav."NAME" = 'Default Address2'), b."PREFERREDSHIPTOADDRESSURN")
		FROM DUAL
	);

	UPDATE "BASICPROFILE" b SET (b."PREFERREDINVOICETOADDRESSURN", b."PREFERREDSHIPTOADDRESSURN") = (
		SELECT
			NVL((SELECT 'urn:address:customer:' || ca."CUSTOMERID" || ':' || ca."UUID" FROM "CUSTOMERADDRESS" ca WHERE b."PREFERREDINVOICETOADDRESSURN" = ca."UUID"),  b."PREFERREDINVOICETOADDRESSURN"),
			NVL((SELECT 'urn:address:customer:' || ca."CUSTOMERID" || ':' || ca."UUID" FROM "CUSTOMERADDRESS" ca WHERE b."PREFERREDSHIPTOADDRESSURN" = ca."UUID"), b."PREFERREDSHIPTOADDRESSURN")
		FROM DUAL
	);

	DELETE FROM "BASICPROFILE_AV" bpav
	WHERE bpav."NAME" IN ('Default Address1', 'Default Address2');

	COMMIT;

END;
/
