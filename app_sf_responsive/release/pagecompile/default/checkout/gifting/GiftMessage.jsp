<%@  page buffer="none" import="java.util.*,java.io.*,com.intershop.beehive.core.internal.template.*,com.intershop.beehive.core.internal.template.isml.*,com.intershop.beehive.core.capi.log.*,com.intershop.beehive.core.capi.resource.*,com.intershop.beehive.core.capi.util.UUIDMgr,com.intershop.beehive.core.capi.util.XMLHelper,com.intershop.beehive.foundation.util.*,com.intershop.beehive.core.internal.url.*,com.intershop.beehive.core.internal.resource.*,com.intershop.beehive.core.internal.wsrp.*,com.intershop.beehive.core.capi.pipeline.PipelineDictionary,com.intershop.beehive.core.capi.naming.NamingMgr,com.intershop.beehive.core.capi.pagecache.PageCacheMgr,com.intershop.beehive.core.capi.request.SessionMgr,com.intershop.beehive.core.internal.request.SessionMgrImpl,com.intershop.beehive.core.pipelet.PipelineConstants" extends="com.intershop.beehive.core.internal.template.AbstractTemplate" %><% 
boolean _boolean_result=false;
TemplateExecutionConfig context = getTemplateExecutionConfig();
createTemplatePageConfig(context.getServletRequest());
printHeader(out);
 %><% %><%@ page contentType="text/html;charset=utf-8" %><%response.setHeader(TemplateConstants.PERSONALIZED_HEADER, "1");setEncodingType("text/html"); %><% {Object temp_obj = (getObject("PliBO:ProductBO:Extension(\"Gifting\"):ApplicableGiftMessages")); getPipelineDictionary().put("It", temp_obj);} %><% _boolean_result=false;try {_boolean_result=((Boolean)((((Boolean) ((((context.getFormattedValue(getObject("It:Size"),null).equals(context.getFormattedValue("0",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue() ? Boolean.FALSE : Boolean.TRUE) )).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",5,e);}if (_boolean_result) { %><% _boolean_result=false;try {_boolean_result=((Boolean)(((!(context.getFormattedValue(getObject("It:Size"),null).equals(context.getFormattedValue("1",null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",6,e);}if (_boolean_result) { %><div class="form-group">
<label class="col-sm-4 control-label" for="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageSelection:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {9}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"><% {out.write(localizeISText("checkout.gifting.giftmessage.message","",null,null,null,null,null,null,null,null,null,null,null));} %></label>
<div class="col-sm-8">
<select class="form-control" id="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageSelection:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {13}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" name="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageSelection:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {13}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"><% while (loop("It","message",null)) { %><% {Object temp_obj = (getObject("message:Extension(\"Pricing\")")); getPipelineDictionary().put("ProductPrice", temp_obj);} %><% processOpenTag(response, pageContext, "currentcustomerbo", new TagParameter[] {
new TagParameter("currentcustomerbo","CustomerBO")}, 16); %><% processOpenTag(response, pageContext, "getproductpricecontext", new TagParameter[] {
new TagParameter("CustomerBO",getObject("CustomerBO")),
new TagParameter("ProductPriceContext","ProductPriceContext")}, 17); %><% {Object temp_obj = (getObject("ProductPrice:Price(\"SalePrice\",CurrentRequest:Currency,ProductPriceContext)")); getPipelineDictionary().put("salePrice", temp_obj);} %><option value="<% {String value = null;try{value=context.getFormattedValue(getObject("message:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {20}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"
<% _boolean_result=false;try {_boolean_result=((Boolean)(((!((Boolean) (getObject("Subform:GiftMessageSelection:ValueMissing"))).booleanValue() && ((Boolean) ((((context.getFormattedValue(getObject("message:ID"),null).equals(context.getFormattedValue(getObject("Subform:GiftMessageSelection:Value"),null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",21,e);}if (_boolean_result) { %>
selected="selected"
<% } else {_boolean_result=false;try {_boolean_result=((Boolean)(((((Boolean) (getObject("Subform:GiftMessageSelection:ValueMissing"))).booleanValue() && ((Boolean) (disableErrorMessages().isDefined(getObject("SplitInfo:get(\"GiftMessageProduct\")")))).booleanValue() && ((Boolean) ((((context.getFormattedValue(getObject("message:ID"),null).equals(context.getFormattedValue(getObject("SplitInfo:get(\"GiftMessageProduct\"):ID"),null)))) ? Boolean.TRUE : Boolean.FALSE))).booleanValue()) ? Boolean.TRUE : Boolean.FALSE))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",23,e);}if (_boolean_result) { %>
selected="selected"
<% }} %>
><% {String value = null;try{value=context.getFormattedValue(getObject("message:Name"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {26}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %> - <% {String value = null;try{value=context.getFormattedValue(getObject("salePrice:Price"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {26}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% processOpenTag(response, pageContext, "productpriceadditionaltext", new TagParameter[] {
new TagParameter("ProductBO",getObject("message"))}, 27); %></option><% } %></select>
</div>
</div><% } else { %><div class="form-group">
<label class="col-sm-4 control-label" for="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageSelection:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {35}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"><% {out.write(localizeISText("checkout.gifting.giftmessage.message","",null,null,null,null,null,null,null,null,null,null,null));} %></label><% while (loop("It","message",null)) { %><% {Object temp_obj = (getObject("message:Extension(\"Pricing\")")); getPipelineDictionary().put("ProductPrice", temp_obj);} %><% processOpenTag(response, pageContext, "currentcustomerbo", new TagParameter[] {
new TagParameter("currentcustomerbo","CustomerBO")}, 41); %><% processOpenTag(response, pageContext, "getproductpricecontext", new TagParameter[] {
new TagParameter("CustomerBO",getObject("CustomerBO")),
new TagParameter("ProductPriceContext","ProductPriceContext")}, 42); %><% {Object temp_obj = (getObject("ProductPrice:Price(\"SalePrice\",CurrentRequest:Currency,ProductPriceContext)")); getPipelineDictionary().put("salePrice", temp_obj);} %><span><% {String value = null;try{value=context.getFormattedValue(getObject("message:Name"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {45}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %> - <% {String value = null;try{value=context.getFormattedValue(getObject("salePrice:Price"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {45}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% processOpenTag(response, pageContext, "productpriceadditionaltext", new TagParameter[] {
new TagParameter("ProductBO",getObject("message"))}, 46); %></span>
<input type="hidden" name="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageSelection:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {49}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" value="<% {String value = null;try{value=context.getFormattedValue(getObject("message:ID"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {49}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" /><% } %></div><% } %><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageTo:isInvalid"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",56,e);}if (_boolean_result) { %><div role="alertdialog" class="alert alert-danger"><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageTo:isError(\"error.maxlength\")"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",58,e);}if (_boolean_result) { %><% {out.write(localizeISText("checkout.gifting.maxlength.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% } else { %><% {out.write(localizeISText("checkout.gifting.profanitycheck.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% } %></div><% } %><div class="form-group <% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageTo:isInvalid"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",67,e);}if (_boolean_result) { %>has-error<% } %>">
<label class="col-sm-4 control-label" for="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageTo:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {68}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"><% {out.write(localizeISText("checkout.gifting.to","",null,null,null,null,null,null,null,null,null,null,null));} %></label>
<div class="col-sm-8">
<input class="form-control" type="text" maxlength="35" name="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageTo:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {72}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"
value="<% _boolean_result=false;try {_boolean_result=((Boolean)((((Boolean) (getObject("Subform:GiftMessageTo:ValueMissing"))).booleanValue() ? Boolean.FALSE : Boolean.TRUE) )).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",73,e);}if (_boolean_result) { %><% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageTo:Value"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {73}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% } else { %><% {String value = null;try{value=context.getFormattedValue(getObject("SplitInfo:get(\"GiftMessageMessage\"):To"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {73}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% } %>"/>
</div>
</div><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageFrom:isInvalid"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",78,e);}if (_boolean_result) { %><div role="alertdialog" class="alert alert-danger"><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageFrom:isError(\"error.maxlength\")"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",80,e);}if (_boolean_result) { %><% {out.write(localizeISText("checkout.gifting.maxlength.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% } else { %><% {out.write(localizeISText("checkout.gifting.profanitycheck.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% } %></div><% } %><div class="form-group <% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageFrom:isInvalid"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",89,e);}if (_boolean_result) { %>has-error<% } %>">
<label class="col-sm-4 control-label" for="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageFrom:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {90}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"><% {out.write(localizeISText("checkout.gifting.from","",null,null,null,null,null,null,null,null,null,null,null));} %></label>
<div class="col-sm-8">
<input class="form-control" type="text" maxlength="35" name="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageFrom:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {94}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"
value="<% _boolean_result=false;try {_boolean_result=((Boolean)((((Boolean) (getObject("Subform:GiftMessageFrom:ValueMissing"))).booleanValue() ? Boolean.FALSE : Boolean.TRUE) )).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",95,e);}if (_boolean_result) { %><% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageFrom:Value"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {95}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% } else { %><% {String value = null;try{value=context.getFormattedValue(getObject("SplitInfo:get(\"GiftMessageMessage\"):From"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {95}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% } %>"/>
</div>
</div><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageText:isInvalid"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",100,e);}if (_boolean_result) { %><div role="alertdialog" class="alert alert-danger"><% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageText:isError(\"error.maxlength\")"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",102,e);}if (_boolean_result) { %><% {out.write(localizeISText("checkout.gifting.maxlength.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% } else {_boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageText:isValueMissing"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",104,e);}if (_boolean_result) { %><% {out.write(localizeISText("checkout.gifting.message.required.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% } else { %><% {out.write(localizeISText("checkout.gifting.profanitycheck.error","",null,null,null,null,null,null,null,null,null,null,null));} %><% }} %><% {Object temp_obj = ("true"); getPipelineDictionary().put("errorcheck", temp_obj);} %><% {Object temp_obj = (((new Double( ((Number) getObject("index")).doubleValue() -((Number) new Double(1)).doubleValue())))); getPipelineDictionary().put("errorindex", temp_obj);} %></div><% } %><div class="form-group <% _boolean_result=false;try {_boolean_result=((Boolean)(getObject("Subform:GiftMessageText:isInvalid"))).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",116,e);}if (_boolean_result) { %>has-error<% } %>">
<label class="col-sm-4 control-label" for="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageText:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {118}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"><% {out.write(localizeISText("checkout.gifting.message","",null,null,null,null,null,null,null,null,null,null,null));} %><span class="required">*</span>
</label>
<div class="col-sm-8">
<textarea 
class="form-control"
required
maxlength="<% {String value = null;try{value=context.getFormattedValue(getObject("GiftMessage_Form_MessageLength"),"0",null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {125}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" 
data-charactercounter="cCounter<% {String value = null;try{value=context.getFormattedValue(replace(context.getFormattedValue(getObject("SplitInfo:ID"),null),(String)("\\."),(String)("")),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {126}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" 
name="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageText:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {127}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>" id="<% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageText:QualifiedName"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {127}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"
data-bv-notempty-message="<% {out.write(localizeISText("checkout.gifting.message.required.error","",null,null,null,null,null,null,null,null,null,null,null));} %>"
><% _boolean_result=false;try {_boolean_result=((Boolean)((((Boolean) (getObject("Subform:GiftMessageText:ValueMissing"))).booleanValue() ? Boolean.FALSE : Boolean.TRUE) )).booleanValue();} catch (Exception e) {Logger.debug(this,"Boolean expression in line {} could not be evaluated. False returned. Consider using the 'isDefined' ISML function.",130,e);}if (_boolean_result) { %><% {String value = null;try{value=context.getFormattedValue(getObject("Subform:GiftMessageText:Value"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {130}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% } else { %><% {String value = null;try{value=context.getFormattedValue(getObject("SplitInfo:get(\"GiftMessageMessage\"):Message"),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {130}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %><% } %></textarea>
<small class="input-help"><% {out.write(localizeISText("checkout.gifting.entered.1","",null,null,null,null,null,null,null,null,null,null,null));} %> <span id="cCounter<% {String value = null;try{value=context.getFormattedValue(replace(context.getFormattedValue(getObject("SplitInfo:ID"),null),(String)("\\."),(String)("")),null,null);}catch(Exception e){value=null;Logger.error(this,"ISPRINT has an invalid expression. Returning empty string. Line: {134}",e);}if (value==null) value="";value = encodeString(value);out.write(value);} %>"></span> <% {out.write(localizeISText("checkout.gifting.entered.2","",null,null,null,null,null,null,null,null,null,null,null));} %></small>
</div>
</div><% } %><% printFooter(out); %>